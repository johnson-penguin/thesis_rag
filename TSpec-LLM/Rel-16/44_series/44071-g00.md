![](media/image1.wmf){width="7.0875in" height="3.4229166666666666in"}

  {#section .TT}

Contents {#contents .TT}
========

[6](#foreword)

[7](#scope)

[7](#references)

[8](#definitions-and-abbreviations)

[8](#definitions)

[8](#abbreviations)

[8](#generic-procedures-for-the-control-of-location-services)

[8](#overview-of-the-generic-protocol-and-its-scope)

[8](#functional-procedures-for-the-control-of-location-services)

[8](#general)

[9](#common-information-element-category)

[9](#location-service-procedures)

[9](#introduction)

[9](#handling-of-protocol-errors-in-lcs-procedures)

[9](#handling-of-other-errors-in-lcs-procedures)

[10](#multiple-location-service-invocations)

[10](#recovery-procedures)

[10](#generic-protocol-error-handling-for-the-component-part-of-location-services-operations)

[10](#single-component-errors)

[10](#multiple-component-errors)

[10](#location-service-support-procedures)

[10](#general-1)

[10](#location-service-support-establishment)

[10](#location-service-support-establishment-at-the-originating-side)

[11](#location-service-support-establishment-at-the-terminating-side)

[11](#location-service-support-information-transfer-phase)

[11](#location-service-support-release)

[11](#recovery-procedures-1)

[11](#message-flow-single-operation-example)

[12](#lmu-initiated-location-service-transaction)

[13](#network-initiated-location-service-transaction)

[13](#handling-of-unknown-unforeseen-and-erroneous-protocol-data)

[13](#general-2)

[14](#message-too-short)

[14](#unknown-or-unforeseen-transaction-identifier)

[14](#unknown-or-unforeseen-message-type)

[14](#non-semantical-mandatory-information-element-error)

[15](#unknown-and-unforeseen-ies-in-the-nonimperative-part)

[15](#ieis-unknown-in-the-message)

[15](#out-of-sequence-ies)

[15](#repeated-ies)

[15](#non-imperative-message-part-errors)

[15](#syntactically-incorrect-optional-ies-other-than-facility)

[15](#conditional-ie-errors)

[16](#message-functional-definitions-and-contents)

[16](#general-3)

[16](#messages-for-location-services-control)

[17](#facility)

[17](#register)

[17](#register-network-to-lmu-direction)

[17](#register-lmu-to-network-direction)

[18](#release-complete)

[18](#cause)

[18](#facility-1)

[18](#general-message-format-and-information-elements-coding)

[18](#overview)

[19](#protocol-discriminator)

[19](#transaction-identifier)

[19](#message-type)

[19](#facility-information-element)

[19](#release-forbidden)

[20](#detailed-message-format-and-information-elements-coding)

[20](#transparent-lcs-information)

[21](#operation-code)

[21](#error-code)

[22](#problem-code)

[22](#lmu-lcs-protocol-operation-specifications)

[22](#general-4)

[23](#operation-types)

[26](#operation-types-description)

[26](#startrit-network----lmu)

[26](#reportrit-lmu---network)

[26](#stoprit-network----lmu)

[26](#indicateriterror-lmu----network)

[26](#void)

[26](#statusquery-network----lmu)

[26](#statusupdate-lmu----network)

[26](#resetrequest-network----lmu)

[26](#ommngrrequest-network----lmu)

[26](#omagntrequest-lmu----network)

[26](#error-types)

[26](#error-types-asn.1-specification)

[27](#error-types-description)

[27](#void-1)

[27](#void-2)

[27](#void-3)

[27](#systemfailure)

[27](#datamissing)

[27](#unexpecteddatavalue)

[27](#resourcesnotavailable)

[27](#undefinederror)

[28](#operations-and-errors-implementation)

[29](#lmu-lcs-protocol-llp-messages)

[29](#messages-data-types-and-identifiers)

[29](#general-5)

[29](#asn.1-data-types)

[37](#identifiers-definition)

[38](#annex-a-informative-rit-messages)

[38](#a.1-introduction)

[38](#a.2-messages)

[38](#a.2.1-rit-measurement-request-message)

[38](#a.2.1.1-rit-measurement-request-message-information-elements)

[38](#a.2.1.1.1-message-type-ie)

[38](#a.2.1.1.2-measurement-instructions-ie)

[40](#a.2.1.1.3-bts-list-ie)

[41](#a.2.2-rit-measurement-response-message)

[41](#a.2.2.1-rit-measurement-response-message-information-elements)

[41](#a.2.2.1.1-message-type-ie)

[41](#a.2.2.1.2-rit-measurement-ie)

[46](#a.2.3-rit-measurement-stop-message)

[46](#a.2.3.1-rit-measurement-stop-message-information-elements)

[46](#a.2.3.1.1-message-type-ie)

[46](#a.2.4-rit-measurement-error-message)

[47](#a.2.4.1-rit-measurement-error-message-information-elements)

[47](#a.2.4.1.1-message-type-ie)

[47](#a.2.4.1.2-rit-error-type-ie)

[47](#a.2.4.1.3-rit-error-ie)

[48](#annex-b-informative-void)

[49](#annex-c-informative-status-messages)

[49](#c.1-introduction)

[49](#c.2-messages)

[49](#c.2.1-status-query-message)

[49](#c.2.1.1-status-query-message-information-elements)

[49](#c.2.1.1.1-message-type-ie)

[49](#c.2.2-status-query-result-message)

[49](#c.2.2.1-status-query-result-message-information-elements)

[49](#c.2.2.1.1-message-type-ie)

[50](#c.2.2.1.2-time-ie)

[50](#c.2.2.1.3-rit-status-ie)

[50](#c.2.2.1.4-reserved-ie)

[50](#c.2.2.1.5-om-status-ie)

[51](#c.2.3-status-update-message)

[51](#c.2.3.1-status-update-message-information-elements)

[51](#c.2.3.1.1-message-type-ie)

[51](#c.2.3.1.2-reason-for-status-update-ie)

[52](#annex-d-informative-change-history)Foreword 1 Scope 2 References 3
Definitions and abbreviations 3.1 Definitions 3.2 Abbreviations 4
Generic procedures for the control of location services 4.1 Overview of
the generic protocol and its scope 4.2 Functional procedures for the
control of location services 4.2.1 General 4.2.2 Common Information
Element Category 4.2.3 Location service procedures 4.2.3.1 Introduction
4.2.3.2 Handling of protocol errors in LCS procedures 4.2.3.3 Handling
of other errors in LCS procedures 4.2.4 Multiple location service
invocations 4.2.5 Recovery procedures 4.2.6 Generic protocol error
handling for the component part of location services operations 4.2.6.1
Single component errors 4.2.6.2 Multiple component errors 5 Location
service support procedures 5.1 General 5.2 Location service support
establishment 5.2.1 Location service support establishment at the
originating side 5.2.2 Location service support establishment at the
terminating side 5.3 Location service support information transfer phase
5.4 Location service support release 5.5 Recovery procedures 5.6 Message
flow (single operation example) 5.6.1 LMU initiated location service
transaction 5.6.2 Network initiated location service transaction 5.7
Handling of unknown, unforeseen, and erroneous protocol data 5.7.1
General 5.7.2 Message too short 5.7.3 Unknown or unforeseen transaction
identifier 5.7.4 Unknown or unforeseen message type 5.7.5 Non-semantical
mandatory Information Element Error 5.7.6 Unknown and Unforeseen IEs in
the non‑imperative part 5.7.6.1 IEIs unknown in the message 5.7.6.2 Out
of sequence IEs 5.7.6.3 Repeated IEs 5.7.7 Non-imperative message part
errors 5.7.7.1 Syntactically incorrect optional IEs (other than
Facility) 5.7.7.2 Conditional IE errors 6 Message functional definitions
and contents 6.1 General 6.2 Messages for location services control 6.3
Facility 6.4 Register 6.4.1 Register (network to LMU direction) 6.4.2
Register (LMU to network direction) 6.5 Release complete 6.5.1 Cause
6.5.2 Facility 7 General message format and information elements coding
7.1 Overview 7.2 Protocol discriminator 7.3 Transaction identifier 7.4
Message type 7.5 Facility information element 7.6 Release forbidden 8
Detailed message format and information elements coding 8.1 Transparent
LCS Information 8.1.1 Operation Code 8.1.2 Error Code 8.1.3 Problem Code
9 LMU LCS Protocol operation specifications 9.1 General 9.2 Operation
types 9.2.1 Operation types description 9.2.1.1 StartRIT (network \--\>
LMU) 9.2.1.2 ReportRIT (LMU \--\>network) 9.2.1.3 StopRIT (network \--\>
LMU) 9.2.1.4 IndicateRITError (LMU \--\> network) 9.2.1.5 (void) 9.2.1.6
StatusQuery (network \--\> LMU) 9.2.1.7 StatusUpdate (LMU \--\> network)
9.2.1.8 ResetRequest (network \--\> LMU) 9.2.1.9 OMMngrRequest (network
\--\> LMU) 9.2.1.10 OMAgntRequest (LMU \--\> network) 10.3 Error types
10.3.1 Error types ASN.1 specification 10.3.2 Error types description
10.3.2.1 (void) 10.3.2.2 (void) 10.3.2.3 (void) 10.3.2.4 SystemFailure
10.3.2.5 DataMissing 10.3.2.6 UnexpectedDataValue 10.3.2.7
ResourcesNotAvailable 10.3.2.9 UnDefinedError 10.4 Operations and errors
implementation 11 LMU LCS Protocol (LLP) messages 11.1 Messages, data
types and identifiers 11.1.1 General 11.1.2 ASN.1 data types 11.1.3
Identifiers definition Annex A (informative): RIT messages A.1
Introduction A.2 Messages A.2.1 RIT Measurement Request Message A.2.1.1
RIT Measurement Request Message Information Elements A.2.1.1.1 Message
Type IE A.2.1.1.2 Measurement Instructions IE A.2.1.1.3 BTS List IE
A.2.2 RIT Measurement Response Message A.2.2.1 RIT Measurement Response
Message Information Elements A.2.2.1.1 Message type IE A.2.2.1.2 RIT
Measurement IE A.2.3 RIT Measurement Stop Message A.2.3.1 RIT
Measurement Stop Message Information Elements A.2.3.1.1 Message type IE
A.2.4 RIT Measurement Error Message A.2.4.1 RIT Measurement Error
Message Information Elements A.2.4.1.1 Message type IE A.2.4.1.2 RIT
Error Type IE A.2.4.1.3 RIT Error IE Annex B (informative): (void) Annex
C (informative): Status Messages C.1 Introduction C.2 Messages C.2.1
Status Query Message C.2.1.1 Status Query Message Information Elements
C.2.1.1.1 Message Type IE C.2.2 Status Query Result Message C.2.2.1
Status Query Result Message Information Elements C.2.2.1.1 Message Type
IE C.2.2.1.2 Time IE C.2.2.1.3 RIT Status IE C.2.2.1.4 Reserved IE
C.2.2.1.5 O&M Status IE C.2.3 Status Update Message C.2.3.1 Status
Update Message Information Elements C.2.3.1.1 Message Type IE C.2.3.1.2
Reason for Status Update IE Annex D (informative): Change history

Foreword
========

This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document contains the coding of information necessary for
support of location service operation on the mobile radio interface
layer 3 between the LMU and SMLC.

Clause 4 defines generic procedures for the control of location
services. In clause 5 location service support procedures are defined.
Clause 6 gives the functional definitions and contents of messages for
location service operations. Clause 7 gives the general format and
coding for messages used for location service and the format and coding
of information elements used for location service operations. Clause 6
gives the detailed message format and information elements coding
between the LMU and SMLC.

Clause 8 gives the specification of the LMU LCS Protocol (LLP)
operations. In clause 9 LMU - SMLC messages, data types and identifiers
are given.

This version does not support segmentation of messages.

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".

\[2\] 3GPP TS 44.006: \"Mobile Station - Base Station System (MS - BSS)
interface Data Link (DL) layer specification\".

\[3\] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3;
General aspects\".

\[4\] 3GPP TS 44.018: \"Mobile radio interface layer 3 specification;
Radio Resource Control Protocol\".

\[5\] 3GPP TS 43.059: \"Functional Stage 2 Description of Location
Services (LCS) in GERAN\".

\[6\] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".

\[7\] ITU-T Recommendation X.691 (1997) \| ISO/IEC 8825-2 (1998):
\"Information technology - ASN.1 encoding rules: Specification of Packed
Encoding Rules (PER)\".

\[8\] ITU-T Recommendation X.690 (1997) \| ISO/IEC 8825-1 (1998):
\"Information technology - ASN.1 encoding rules: Specification of Basic
Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished
Encoding Rules (DER)\".

\[9\] ITU-T Recommendation X.680 (1997) \| ISO/IEC 8824-1 (1998):
\"Information technology - Abstract Syntax Notation One (ASN.1):
Specification of basic notation\".

\[10\] ITU-T Recommendation Q.773: \"Transaction capabilities formats
and encoding\".

\[11\] (void)

\[12\] 3GPP TS 44.004: \"Layer 1; General requirements\".

\[13\] 3GPP TS 44.005: \"Data Link (DL) layer General aspects\".

\[14\] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification;
Core Network Protocols; Stage 3\".

\[15\] 3GPP TS 45.002: \"Multiplexing and Multiple Access on the Radio
Path\".

\[16\] 3GPP TS 52.071: \"Location Services (LCS); Location services
management\".

3 Definitions and abbreviations
===============================

3.1 Definitions
---------------

For the purposes of the present document, the following terms and
definitions apply:

**E-OTD Assistance Data Message:** contains the RTD and BTS coordinates
of the neighbours that should be used in E-OTD measurements. This E-OTD
Assistance Data is broadcasted using CBCH channel using SMSCB DRX
service. The reception of this broadcast message enables MS to calculate
its own location.

**GPS Assistance Data Message:** contains GPS differential corrections.
The reception of this broadcast message enables MS to have calculate
more accurate location estimate.

**GANSS Assistance Data Message:** contains GANSS differential
corrections. The reception of this broadcast message enables MS to have
calculate more accurate location estimate.

3.2 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
3GPP TR 21.905 and 3GPP TS 43.059.

4 Generic procedures for the control of location services
=========================================================

4.1 Overview of the generic protocol and its scope
--------------------------------------------------

One generic protocol is defined for the control of location services at
the radio interface. This protocol operates at layer 3 of the radio
interface and assumes the use of layers 1 and 2 conform to 3GPP TS
45‑series and 3GPP TS 44.004, 3GPP TS 44.005 and 3GPP TS 44.006. The
generic protocol uses the acknowledged information transfer service
available at the layer 2 ‑ layer 3 interface.

The Functional protocol is based on the use of the Facility information
element and the FACILITY message as well as other specific functional
messages specified in the present document.

4.2 Functional procedures for the control of location services
--------------------------------------------------------------

### 4.2.1 General

This subclause specifies the functional signalling procedures for the
control of location services at the radio interface.

The functional protocol utilizes functions and services defined in 3GPP
TS 24.008, 3GPP TS 44.018 and the functions of the data link layer as
defined in 3GPP TS 44.006. This protocol utilizes also definitions in
3GPP TS 24.007.

The Common Information Element Category utilizes the Facility
information element to transport the protocol defined in the present
document. The use of the Facility information element is common to many
services, and its contents indicates what type of procedure is being
requested. This category can be signalled both in the LMU to network and
the network to LMU directions.

The correlation of location service operations and their responses, is
provided by the combination of the transaction identifier of the
messages containing the Facility information element and the Invoke
identifier present within the Facility information element itself.

### 4.2.2 Common Information Element Category

The Common Information Element Category uses operations defined in the
present document for location services signalling. Procedures are
initiated by sending an operation including an invoke component. The
invoke component may yield a Return Error, Return Result or Reject
component (also included in an operation) depending on the outcome of
the procedure.

The operation state machines, and procedures for management of Invoke
IDs specified in ITU-T Recommendation Q.774 White Book are used.

A REGISTER message, a FACILITY message or RELEASE COMPLETE message is
used to carry the Facility information element which includes these
operations. These operations request, acknowledge or reject the desired
location service procedure.

### 4.2.3 Location service procedures

#### 4.2.3.1 Introduction

For location service procedures independent of any call, the initiating
side must establish a MM‑connection between the network and the LMU
according to the rules given in 3GPP TS 24.007 and 3GPP TS 24.008. The
LMU or the network starts the transaction by transferring a REGISTER
message across the radio interface. This transaction is identified by
the transaction identifier associated with the REGISTER message present
in the component part of the Facility information element. Following the
REGISTER message one or more FACILITY messages may be transmitted, all
of them related by the use of the same transaction identifier. If the
transaction is no longer used, it shall be released by sending a RELEASE
COMPLETE message. This procedure is specified in detail in clause 5, and
the text in clause 5 takes precedence over this introduction.

To convey the location service invocation, the Facility information
element is used. The Facility information element present either in the
REGISTER message or a subsequent message identifies the location service
involved and the type of component (i.e. Invoke, Return result, Return
error or Reject component).

When the REGISTER or FACILITY message contains a Facility information
element and the requested service is available, a FACILITY message
containing a Facility information element may be returned. One or more
exchanges of FACILITY messages may subsequently occur. To terminate the
service interaction and release the transaction identifier value, a
RELEASE COMPLETE message is sent as specified for the specific location
service procedure. The RELEASE COMPLETE message may also contain the
Facility information element.

#### 4.2.3.2 Handling of protocol errors in LCS procedures

Messages containing a Facility information element shall be checked for
protocol errors before the contents of the Facility IE is acted on. The
checks shall be performed in the following order:

1\) The message carrying the Facility IE shall be checked for protocol
errors as specified in subclause 5.7. If a protocol error is found then
the procedures in subclause 5.7 apply.

2\) The contents of the Facility IE shall be checked for protocol errors
as specified in subclause 4.2.6. If a protocol error is found then the
procedures in subclause 4.2.6 apply.

#### 4.2.3.3 Handling of other errors in LCS procedures

If the tests specified in subclause 4.2.3.2 have been passed without the
detection of a protocol error, the receiver will attempt to process the
contents of the Facility Information Element. If errors occur during
this processing (e.g. system failure, or information in the Facility IE
is incompatible with the requested operation) then the procedures
specified in the individual service specifications apply.

An example of the behaviour that could occur in this case is:

\- the LMU or network sends a Facility information element containing a
return error component in a FACILITY or RELEASE COMPLETE message. If the
FACILITY message is used then the MM Connection may continue to be used
for further signalling.

### 4.2.4 Multiple location service invocations

It is possible for several LCS transactions to be used simultaneously.
LCS transactions can also exist in parallel with other CM‑Layer and MM
transactions. The handling of multiple MM connections is defined in 3GPP
TS 24.007 and 3GPP TS 24.008.

A single Facility Information Element shall not contain more than one
component.

### 4.2.5 Recovery procedures

In case a transaction is not terminated according to the normal
procedure as described in the present document the network side has to
ensure that the transaction is terminated e.g. by a supervision timer.

### 4.2.6 Generic protocol error handling for the component part of location services operations

If a location service operation is to be rejected the operation will be
denied, and provided the transaction is still in progress, an
appropriate reject component will be returned in a Facility Information
Element.

#### 4.2.6.1 Single component errors

The reject component shall be sent in a RELEASE COMPLETE message.

If the component containing the error was itself sent in a RELEASE
COMPLETE message then the contents of the component shall be ignored,
and no reject component is sent.

#### 4.2.6.2 Multiple component errors

If a single Facility IE contains more than one component then a RELEASE
COMPLETE message with the cause \"Facility rejected\" and without any
component shall be sent.

5 Location service support procedures
=====================================

5.1 General
-----------

This clause describes the location service support procedures at the
radio interface. These procedures are provided by the location service
support entity defined in 3GPP TS 24.007. The location service support
procedures provide the means to transfer messages for the location
service procedures. These procedures are regarded as the user of the
location service support.

5.2 Location service support establishment
------------------------------------------

At the beginning of each location service procedure a location service
support must be established.

### 5.2.1 Location service support establishment at the originating side

If the entity that uses the location support procedures needs to send a
REGISTER message, the location service support entity shall first
request the establishment of an MM‑connection. This MM‑connection is
established according to 3GPP TS 24.008 and 3GPP TS 24.007. If the
network is the initiating side then MM‑connection establishment may
involve paging the LMU.

The location service support entity shall send the REGISTER message as
the first CM‑message on the MM‑connection. The REGISTER message is sent
to the corresponding peer entity on the MM‑connection and the location
service support shall be regarded as being established.

### 5.2.2 Location service support establishment at the terminating side

At the terminating side a location service support is regarded as being
established when an MM‑connection is established. According 3GPP TS
24.008 this can be ascertained by the receipt of the first message, with
a new transaction identifier. For successful establishment of location
service support this message shall be a REGISTER message.

If the terminating side needs to reject the establishment of location
services support then it may be immediately initiate location services
support release (see subclause 5.4).

5.3 Location service support information transfer phase
-------------------------------------------------------

After the establishment of the location service support both users may
exchange FACILITY messages by use of the location service support.

5.4 Location service support release
------------------------------------

At the end of each location service procedure the established location
service support is released, if a permanent connection is not used.

The side closing the transaction shall release the transaction by
sending the RELEASE COMPLETE message to its corresponding peer entity.

Both location service support entities release the MM‑connection
locally.

5.5 Recovery procedures
-----------------------

The location service support does not provide recovery procedures, i.e.
the operations are transparent to the location service support.

5.6 Message flow (single operation example)
-------------------------------------------

This subclause contains examples of message flows for a single
transaction consisting of a single operation. These examples may not
show all possibilities.

### 5.6.1 LMU initiated location service transaction

LMU Network

REGISTER

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>

Facility (Invoke = Operation (Location service code, Parameter(s)))

RELEASE COMPLETE or FACILITY

\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Facility (Return result = Operation (Parameter(s)))

RELEASE COMPLETE or FACILITY

\<- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - - -

Facility (Return error (Error))

RELEASE COMPLETE

\<- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - - -

Facility (Reject (Invoke\_problem))

RELEASE COMPLETE (note)

\<- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - - -

RELEASE COMPLETE (note)

\- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - \>

NOTE: To prevent transactions being kept open following exceptional
cases, either side of the transaction may release it by sending a
RELEASE COMPETE message without a Facility IE.

Figure 5.6.1: LMU initiated location service transaction

### 5.6.2 Network initiated location service transaction

LMU Network

REGISTER

\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Facility (Invoke = Operation (Location service code, Parameter(s)))

RELEASE COMPLETE or FACILITY (note 1)

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>

Facility (Return result = Operation (Parameter(s))

RELEASE COMPLETE or FACILITY (note 1)

\- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - -\>

Facility (Return error (Error))

RELEASE COMPLETE (note 1)

\- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - -\>

Facility (Reject (Invoke\_problem))

RELEASE COMPLETE (note 1, note 2)

\- - - - \-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - - -\>

RELEASE COMPLETE (note 2)

\<- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- - - - - - - - - - - - - - - - -

NOTE 1: If the network initiated operation does not require a result,
reject or error to be returned then the LMU may release the transaction
by sending a RELEASE COMPLETE message without a Facility Information
Element and release of transaction by LMU is allowed (i.e. Release
Forbidden has not been present in Register message). If release is not
allowed by LMU, the LMU sends the result using Facility message.

NOTE 2: To prevent transactions being kept open following exceptional
cases, either side of the transaction may release it by sending a
RELEASE COMPETE message without a Facility IE.

Figure 5.6.2: Network initiated location service transaction

5.7 Handling of unknown, unforeseen, and erroneous protocol data
----------------------------------------------------------------

### 5.7.1 General

These procedures only apply to messages where the protocol discriminator
is set to indicate LCS operations according to the rules in 3GPP TS
24.007 and the present document. Messages that do not meet this criteria
are treated according to other GSM technical specifications.

This subclause specifies procedures for handling of unknown, unforeseen
and erroneous protocol data by the receiving entity. The procedures are
called \"error handling procedures\", but they also define a
compatibility mechanism for future extension of the protocol.

Most error handling procedures are mandatory in the LMU, but optional in
the network. Detailed error handling procedures may vary from PLMN to
PLMN.

In this subclause, the following terminology is used:

\- An IE is defined to be syntactically incorrect in a message if it
contains at least one value defined as \"reserved\" in the present
document or 3GPP TS 44.018. However, it is not a syntactical error if a
type 4 IE specifies a length indicator greater than that defined. The
component part of the Facility information element is handled by a
separate mechanism, and errors in the component part are not covered by
this subclause.

The following procedures are listed in order of precedence.

Handling of errors in the contents of the Facility IE is described in
subclause 4.2.6, and is outside the scope of this subclause.

### 5.7.2 Message too short

When a message is received that is too short to contain a complete
message type information element, that message shall be ignored.

### 5.7.3 Unknown or unforeseen transaction identifier

The LMU shall ignore messages with the transaction identifier value set
to \"111\".

If the transaction identifier value is not \"111\" the following
procedures shall apply to the LMU:

a\) If a RELEASE COMPLETE message is received specifying a transaction
identifier that is not recognized as relating to a LCS transaction that
is in progress then the message shall be ignored.

b\) If a FACILITY message is received specifying a transaction
identifier that is not recognized as relating to a LCS transaction that
is in progress then a RELEASE COMPLETE message shall be sent.

c\) If a REGISTER message is received specifying a transaction
identifier that is not recognized as relating to a LCS transaction that
is in progress and with a transaction identifier flag incorrectly set to
\"1\", this message shall be ignored.

The network may follow the same procedures.

### 5.7.4 Unknown or unforeseen message type

If the LMU receives a message type not defined for the protocol
discriminator or not implemented by the receiver, then a RELEASE
COMPLETE message shall be sent with cause value \#97 \"message type
non‑existent or not implemented\".

If the LMU receives a message type not consistent with the transaction
state then a RELEASE COMPLETE message shall be sent with cause value
\#98 \"message not compatible with control state\".

The network may follow the same procedures.

### 5.7.5 Non-semantical mandatory Information Element Error

When on receipt of a message:

\- an \"imperative message part\" error; or

\- a \"missing mandatory IE\" error;

is diagnosed, or when a message containing:

\- a syntactically incorrect mandatory IE; or

\- an IE unknown in the message, but encoded as \"comprehension
required\" (see 3GPP TS 24.007); or

\- an out of sequence IE encoded as \"comprehension required\";

is received, the LMU shall proceed as follows:

a\) If the message is not RELEASE COMPLETE it shall send a RELEASE
COMPLETE message with cause \"\#96 - Invalid mandatory information\".

b\) If the message is RELEASE COMPLETE, it shall be treated as a normal
RELEASE COMPLETE message.

The network may follow the same procedures.

### 5.7.6 Unknown and Unforeseen IEs in the non‑imperative part

#### 5.7.6.1 IEIs unknown in the message

The LMU shall ignore all IEs unknown in the message which are not
encoded as \"comprehension required\". The network shall take the same
approach.

#### 5.7.6.2 Out of sequence IEs

The LMU shall ignore all out of sequence IEs in a message which are not
encoded as \"comprehension required\".

The network may take the same approach.

#### 5.7.6.3 Repeated IEs

If an information element with format T, TV or TLV (see 3GPP TS 24.007)
is repeated in a message in which repetition of the information element
is not specified, only the contents of the information element appearing
first shall be handled and all subsequent repetitions of the information
element shall be ignored. When repetition of information elements is
specified, only the contents of specified repeated information elements
shall be handled. If the limit on repetition of information elements is
exceeded, the contents of information elements appearing first up to the
limit of repetitions shall be handled and all subsequent repetitions of
the information element shall be ignored.

The network may follow the same procedures.

### 5.7.7 Non-imperative message part errors

This category includes:

\- syntactically incorrect optional IEs;

\- conditional IE errors.

Errors in the content of the Facility IE are handled according to
subclause 4.2.6.

#### 5.7.7.1 Syntactically incorrect optional IEs (other than Facility)

The LMU shall treat all optional IEs that are syntactically incorrect in
a message as not present in the message

The network shall take the same approach.

#### 5.7.7.2 Conditional IE errors

When the LMU upon receipt of a message diagnoses a \"missing conditional
IE\" error, or an \"unexpected conditional IE error\", or when it
receives a message containing at least one syntactically incorrect
conditional IE (other than Facility), it shall send a RELEASE COMPLETE
message with cause \#100 \"conditional IE error\".

The network may follow the same procedure.

6 Message functional definitions and contents
=============================================

6.1 General
-----------

This subclause defines the structure of the messages of the layer 3
protocol defined in 3GPP TS 43.059. These messages are standard L3
messages as defined in 3GPP TS 24.007.

Each definition includes:

a\) a brief description of the message;

b\) a table listing the information elements in the order of their
appearance in the message. In a sequence of consecutive IEs with half
octet length, the first IE occupies bits 1 to 4 of octet N, the second
bits 5 to 8 of octet N, the third bits 1 to 4 of octet N+1 etc.;

For each IE the table indicates:

1\) the information element identifier, in hexadecimal notation, if the
IE has format T, TV or TLV. If the IEI has half octet length, it is
specified by a notation representing the IEI as a hexadecimal digit
followed by a \"-\" (example: B-);

2\) the name of the IE (which gives an idea of the semantics of the
element), which is used in this and other specifications as a reference
to the IE within the message;

3\) the name of the type of the IE (which indicates the coding of the
value part of the IE), and a reference to a description of the value
part of the IE;

4\) the presence requirement indication (M, C or O) for the IE, as
defined in 3GPP TS 24.007;

5\) the format of the IE (T, V, TV, LV, TLV) as defined in 3GPP TS
24.007;

6\) the length of the IE (or permissible range of lengths), in octets,
in the message, where \"?\" means that the maximum length of the IE is
only constrained by the link layer protocol, and in the case of the
facility IE by possible further considerations specified in 3GPP TS
43.059. This indication is non-normative.

c\) subclauses specifying conditions for IEs with presence requirement C
or O in the relevant message. Together with other conditions specified
in the present document and 3GPP TS 43.059 defines when the IE shall be
included or not, what non-presence of such IEs means, and (for IEs with
presence requirement C) the static conditions for presence and/or
non-presence of the IEs (see 3GPP TS 24.007).

6.2 Messages for location services control
------------------------------------------

Table 6.2 summarises the messages for location services control.

The logical DTAP LCS Information Request and DTAP LCS Information Report
messages, that are used in LCS Stage 2 (3GPP TS 43.059), are transported
using REGISTER, FACILITY and RELEASE COMPLETE messages.

If there exists no LCS transaction between LMU and SMLC, REGISTER
message is used to deliver the logical message. If LCS transaction
between LMU and SMLC exists, FACILITY message is used to deliver the
logical message. RELEASE COMPLETE message is used to indicate that LCS
transaction is not any more needed, LMU can also use this message to
transport logical LCS Information Response message.

Table 6.2: Messages for location service control

  --------------------------------------- -----------
  Messages for location service control   Reference
  FACILITY                                6.3
  REGISTER                                6.4
  RELEASE COMPLETE                        6.5
  --------------------------------------- -----------

6.3 Facility
------------

This message is sent by the Location Measurement Unit (LMU) or the
network to request or acknowledge a location service. It is used when
information is to be conveyed and the transaction already exists, but is
not to be released. The location service to be invoked, and its
associated parameters, are specified in the Facility information element
(see table 6.3).

Table 6.3: FACILITY message content

  ----- ------------------------ ------------------------- ---------- -------- --------
  IEI   Information element      Type / Reference          Presence   Format   Length

        Location service\        Protocol discriminator\   M          V        1/2
        Protocol discriminator   7.2                                           

        Transaction identifier   Transaction identifier\   M          V        1/2
                                 7.3                                           

        Facility\                Message type\             M          V        1
        Message type             7.4                                           

        Facility                 Facility\                 M          LV       2-?
                                 7.5                                           

  90    Release forbidden        Release forbidden\        O          T        1
                                 7.6                                           
  ----- ------------------------ ------------------------- ---------- -------- --------

6.4 Register
------------

### 6.4.1 Register (network to LMU direction)

This message is sent by the network to the location measurement unit to
assign a new transaction identifier for location service control and to
request or acknowledge a location service (see table 6.4.1).

Table 6.4.1: REGISTER message content (network to LMU direction)

  --------- ------------------------- ------------------------- -------------- ------------ ------------
  **IEI**   **Information element**   **Type / Reference**      **Presence**   **Format**   **Length**

            Location service\         Protocol discriminator\   M              V            1/2
            Protocol discriminator    7.2                                                   

            Transaction identifier    Transaction identifier\   M              V            1/2
                                      7.3                                                   

            Register\                 Message type\             M              V            1
            Message type              7.4                                                   

            Facility                  Facility\                 M              LV           2-?
                                      7.5                                                   

  90        Release forbidden         Release forbidden\        O              T            1
                                      7.6                                                   
  --------- ------------------------- ------------------------- -------------- ------------ ------------

### 6.4.2 Register (LMU to network direction)

This message is sent by the location measurement unit to the network to
assign a new transaction identifier for location service control and to
request or acknowledge a location service (see table 6.4.2).

Table 6.4.2: REGISTER message content (LMU to network direction)

  ----- ------------------------ ------------------------- ---------- -------- --------
  IEI   Information element      Type / Reference          Presence   Format   Length

        Location service\        Protocol discriminator\   M          V        1/2
        Protocol discriminator   7.2                                           

        Transaction identifier   Transaction identifier\   M          V        1/2
                                 7.3                                           

        Register                 Message type\             M          V        1
                                 7.4                                           

        Facility                 Facility\                 M          LV       2-?
                                 7.5                                           
  ----- ------------------------ ------------------------- ---------- -------- --------

6.5 Release complete
--------------------

This message is sent by the location measurement unit or the network to
release a transaction used for location service control. It may also
request or acknowledge a location service (see table 6.5).

Table 6.5: RELEASE COMPLETE message content

  ----- ------------------------ ------------------------- ---------- -------- --------
  IEI   Information element      Type / Reference          Presence   Format   Length

        Location service\        Protocol discriminator\   M          V        1/2
        Protocol discriminator   7.2                                           

        Transaction identifier   Transaction identifier\   M          V        1/2
                                 7.3                                           

        Release Complete\        Message type\             M          V        1
        Message type             7.4                                           

  10    Cause                    Cause\                    O          TLV      4-32
                                 3GPP TS 44.018                                

  11    Facility                 Facility\                 O          TLV      2-?
                                 7.5                                           
  ----- ------------------------ ------------------------- ---------- -------- --------

### 6.5.1 Cause

This information element shall be included when the functional handling
of the Cause IE is specified in the service description. If the
functional handling of the Cause IE is not specified, the receiving
entity may ignore the IE. The Cause IE used in location services is
defined in 3GPP TS 44.018 in subclause 10.5.4.11 (only applicable Cause
values are used).

### 6.5.2 Facility

This information element shall be included as required by the service
description and the procedures defined in the present document and in
3GPP TS 43.059.

7 General message format and information elements coding
========================================================

The figures and text in this clause describe message contents. Within
each octet, the bit designated \"bit 1\" is transmitted first, followed
by bits 2, 3, 4, etc. Similarly, the octet shown at the top of each
figure is sent first.

7.1 Overview
------------

Within the layer 3 protocol defined in the present document, every
message is a standard L3 message as defined in 3GPP TS 24.007. This
means that the message consists of the following parts:

a\) protocol discriminator;

b\) transaction identifier;

c\) message type;

d\) other information elements, as required.

Unless specified otherwise, a particular information element may be
present only once in a given message.

When a field extends over more than one octet, the order of bit values
progressively decreases as the octet number increases. The least
significant bit of the field is represented by the lowest numbered bit
of the highest numbered octet of the field.

7.2 Protocol discriminator
--------------------------

The Protocol Discriminator (PD) and its use are defined in 3GPP TS
24.007. The present document defines the protocols relating to the PD
values:

1 1 0 0 location services

7.3 Transaction identifier
--------------------------

For general rules, format and coding of transaction identifier values,
see 3GPP TS 24.008.

7.4 Message type
----------------

The message type IE and its use are defined in 3GPP TS 24.007. Table 7.4
defines the value part of the message type IE used in the location
service protocol.

Table 7.4: Message types

<table>
<tbody>
<tr class="odd">
<td>8</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td></td>
<td><strong>Message types</strong></td>
</tr>
<tr class="even">
<td>0</td>
<td>X</td>
<td>1</td>
<td>0</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td></td>
<td>Clearing messages:</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td></td>
<td>- RELEASE COMPLETE</td>
</tr>
<tr class="even">
<td>0</td>
<td>X</td>
<td>1</td>
<td>1</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td></td>
<td>Miscellaneous message group:</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td></td>
<td>- FACILITY</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td></td>
<td>- REGISTER</td>
</tr>
<tr class="odd">
<td><p>NOTE 1: Bit 8 is reserved for possible future use as an extension bit, see 3GPP TS 24.007.</p>
<p>NOTE 2: Bit 7 is reserved for the send sequence number in messages sent from the LMU. In messages sent from the SMLC, bit 7 is coded with a "0", see 3GPP TS 24.007.</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

7.5 Facility information element
--------------------------------

The purpose of the Facility information element is to indicate the
invocation and operation of location services, identified by the
corresponding operation code within the Facility information element.

The Facility information element is coded as shown in figure 7.5 and
clause 8.

The Facility is a type 4 information element with no upper length limit
except that given by the maximum number of octets in a L3 message, see
3GPP TS 44.006.

  ----------------------------------------------------------------------------------------------------------------- -------------- --- --- --- --- --- --- --
  8                                                                                                                 7              6   5   4   3   2   1   
  Facility IEI                                                                                                      octet 1                                
  Length of Facility contents                                                                                       octet 2                                
  Component(s) (note)                                                                                               octet 3 etc.                           
  NOTE: This component contains Transparent LCS Information. Encoding of this component is according to clause 8.                                          
  ----------------------------------------------------------------------------------------------------------------- -------------- --- --- --- --- --- --- --

Figure 7.5: Facility information element

7.6 Release forbidden
---------------------

This information element is used only in SMLC to LMU messages. The
presence of IE indicates that the release of LCS transaction is not
allowed by LMU.

8 Detailed message format and information elements coding
=========================================================

8.1 Transparent LCS Information
-------------------------------

This clause provides the formats and encoding of Transparent LCS
Information component in the Facility information element. The contents
of this component are copied directly from Signal Info (defined in
subclause 11.1). Encoding methods for the entire LLP component are based
on BASIC-PER; unaligned variant is used. Format and encoding of the
entire LLP component - part of which can be seen as a subset of ITU-T
Recommendation Q.773 - is based on and consistent with the following
ITU-T recommendations:

\- Abstract Syntax Notation One (ASN.1) \"Specification of Basic
Notation\" ITU-T Recommendation X.680 \| ISO/IEC 8824-1.

\- ASN.1 encoding rules \"Specification of Packed Encoding Rules (PER)\"
ITU-T Recommendation X.691 \| ISO/IEC 8825-2.

NOTE 1: Concerning the general rules for encoding (structure of
encoding, identifier octets, length octets, etc.) see ITU-T
Recommendations X.680 and ITU-T Recommendation X.691. For these general
rules the same exceptions apply as stated in 3GPP TS 29.002. Following
ASN.1 definitions are exactly same than in ITU-T Recommendation Q.773.

NOTE 2: invokeNotLast component is added to the Component list. This
change impacts to the coding of the Component type and thus to coding of
the LLP messages.

The Component portion of the TCAP used in this protocol, LLP, is a
modification of the TCAP Component portion defined in ITU-T
Recommendation, Q.773. Even though part of the LLP component can be seen
as a subset of TCAP, BER encoding is not used.

Component ::= CHOICE {

invoke \[1\] IMPLICIT Invoke,

returnResultLast \[2\] IMPLICIT ReturnResult,

returnError \[3\] IMPLICIT ReturnError,

reject \[4\] IMPLICIT Reject,

returnResultNotLast \[7\] IMPLICIT ReturnResult,

invokeNotLast \[8\] IMPLICIT Invoke }

\-- The Components are sequences of data elements.

Invoke ::= SEQUENCE {

invokeID InvokeIdType,

linkedID \[0\] IMPLICIT InvokeIdType OPTIONAL,

operationCode OPERATION,

parameter ANY DEFINED BY operationCode OPTIONAL }

\-- ANY is filled by the single ASN.1 data type following the keyword
PARAMETER or the keyword ARGUMENT\
\-- in the type definition of a particular operation.

ReturnResult ::= SEQUENCE {

invokeID InvokeIdType,

result SEQUENCE {

operationCode OPERATION,

parameter ANY DEFINED BY operationCode

} OPTIONAL

}

\-- ANY is filled by the single ASN.1 data type following the keyword
RESULT in the type definition\
\-- of a particular operation.

ReturnError ::= SEQUENCE {

invokeID InvokeIdType,

errorCode ERROR,

parameter ANY DEFINED BY errorCode OPTIONAL }

\-- ANY is filled by the single ASN.1 data type following the keyword
PARAMETER in the type definition\
\-- of a particular error.

Reject ::= SEQUENCE {

invokeID CHOICE {

derivable InvokeIdType,

not-derivable NULL },

problem CHOICE {

generalProblem \[0\] IMPLICIT GeneralProblem,

invokeProblem \[1\] IMPLICIT InvokeProblem,

returnResultProblem \[2\] IMPLICIT ReturnResultProblem,

returnErrorProblem \[3\] IMPLICIT ReturnErrorProblem} }

InvokeIdType ::= INTEGER (-128..127)

### 8.1.1 Operation Code

Each Operation is assigned an Operation Code to identify it. The
Operation Codes for the different Operations are defined in subclause
9.2.

### 8.1.2 Error Code

Each Error is assigned a value (Error Code) to identify it. The Error
Codes for the different Errors are defined in subclause 10.3.

### 8.1.3 Problem Code

The Problem Code consists of one of the four elements: General Problem,
Invoke Problem, Return Result Problem or Return Error Problem. ASN.1
definitions are presented below.

\-- PROBLEMS

GeneralProblem ::= INTEGER { unrecognizedComponent (0),

mistypedComponent (1),

badlyStructuredComponent (2) }

InvokeProblem ::= INTEGER { duplicateInvokeID (0),

unrecognizedOperation (1),

mistypedParameter (2),

resourceLimitation (3),

initiatingRelease (4),

unrecognizedLinkedID (5),

linkedResponseUnexpected (6),

unexpectedLinkedOperation (7) }

ReturnResultProblem ::= INTEGER { unrecognizedInvokeID (0),

returnResultUnexpected (1),

mistypedParameter (2) }

ReturnErrorProblem ::= INTEGER { unrecognizedInvokeID (0),

returnErrorUnexpected (1),

unrecognizedError (2),

unexpectedError (3),

mistypedParameter (4) }

9 LMU LCS Protocol operation specifications
===========================================

9.1 General
-----------

This clause specifies the abstract syntax for the LMU LCS Protocol using
the Abstract Syntax Notation One (ASN.1), defined in ITU-T
Recommendation X.680.

The encoding rules which are applicable to the defined abstract syntax
are the Packet Encoding Rules for Abstract Syntax Notation One, defined
in ITU-T Recommendation X.691. For each Location Service parameter which
has to be transferred by a Location Service message, there is a PDU
field (an ASN.1 NamedType) whose ASN.1 identifier has the same name as
the corresponding parameter, except for the differences required by the
ASN.1 notation (blanks between words are removed, the first letter of
the first word is lower-case and the first letter of the following words
are capitalized (e.g. \"bearer service\" is mapped to
\"bearerService\"). In addition some words may be abbreviated as
follows:

\- lmu location measurement unit;

\- lcs location services.

The ASN.1 data type which follows the keywords ARGUMENT \"PARAMETER\" or
\"RESULT\" (for OPERATION and ERROR) is always optional from a syntactic
point of view. However, except specific mention, it has to be considered
as mandatory from a semantic point of view. When in an invoke component,
a mandatory element is missing in any component or inner data structure,
a reject component is returned with the problem code \"Mistyped
Parameter\". When an optional element is missing in an invoke component
or in an inner data structure while it is required by the context, an
error component is returned; the associated type of error is
\"DataMissing\".

In case an element is defined as mandatory in the protocol description
(including imports from 3GPP TS 29.002), but is not present according to
the service description (stage 1 to stage 3), the ASN.1 protocol
description takes precedence over the diagrams in the 3GPP TS 24.08x and
3GPP TS 24.09x-series of technical specifications.

When possible operations and errors are imported from 3GPP TS 29.002.

Timer values for operations which require timers are shown as ASN.1
comments.

Ellipsis Notation shall be used in the same way as described in 3GPP TS
29.002 and shall be supported on the radio interface by the LMU and the
network for all operations defined in the present document including
those imported from 3GPP TS 29.002.

9.2 Operation types
-------------------

Table 9.2 summarizes the operations defined for LMU LCS Protocol in the
present document, and shows which of these operations are Radio
Interface Timing (RIT) related and general LMU procedures related. In
this ASN.1 module, ASN.1/88 defined in ITU-T Recommendation X.680 (ASN.1
1997) is used.

Table 9.2: Relevance of location service operations

  ------------------ -------------- ------------------------ ----- -------------
  Operation name     Direction      Response allowed         RIT   General LMU

  StartRIT           SMLC -\> LMU   ReturnResult (empty) .   X     

  ReportRIT          LMU -\> SMLC   No                       X     

  StopRIT            SMLC -\> LMU   ReturnResult (empty).    X     

  IndicateRITError   LMU -\> SMLC   No                       X     

  StatusQuery        SMLC -\> LMU   ReturnResult                   X

  StatusUpdate       LMU -\> SMLC   ReturnResult\                  X
                                    (empty)                        

  ResetRequest       SMLC -\> LMU   ReturnResult (empty).          X

  OMMngrRequest      SMLC -\> LMU   ReturnResult                   X

  OMAgntRequest      LMU -\> SMLC   ReturnResult                   X
  ------------------ -------------- ------------------------ ----- -------------

The present document defines the following operations:

\- StartRIT.

\- ReportRIT.

\- StopRIT.

\- IndicateRITError.

\- StatusQuery.

\- StatusUpdate.

\- ResetRequest.

\- OMMngrRequest.

\- OMAgntRequest.

\-- LLP-Operations module defines the operations transparent to MSC

LLP-Operations

\-- { LLP-Operations object identifier }

DEFINITIONS ::=

BEGIN

IMPORTS

OPERATION

FROM TCAPMessages {

ITU-T recommendation q 773 modules (2) messages (1) version2 (2)}

SystemFailure,

DataMissing,

UnexpectedDataValue,

FacilityNotSupported,

UnknownSubscriber,

FROM MAP-Errors {

ITU-T identified-organization (4) etsi (0) mobileDomain (0)

gsm-Network (1) modules (3) map-Errors (10) version4 (4)}

UnDefinedError

FROM LLP-Errors

\-- {}

StartRITReq,

StartRITRsp,

ReportRITArg,

StopRITReq,

StopRITRsp,

ErrorRITArg,

PerformTOAReq,

TOAResultRsp,

StatusReq,

StatusRsp,

ResetReq,

ResetRsp,

StatusUpdateReq,

StatusUpdateRsp

FROM LLP-DataTypes {

ITU-T identified-organization (4) etsi (0) mobileDomain (0)

gsm-Network (1) modules (3) map-LCS-DataTypes (n) version4 (4)}

OMMngrReq,

OMMngrRsp,

OMAgntReq,

OMAgntRsp,

NACKCauses

FROM LLP-OM-Protocol \--{ LLP-OM-Protocol Object identifier }\--

;

\-- OPERATION definitions based on macro notation

StartRIT::= OPERATION \-- identifier StartRIT-Measurement

ARGUMENT

startRITReq StartRITReq

RESULT

startRITRsp StartRITRsp

ERROR {

SystemFailure,

DataMissing,

UnexpectedDataValue,

ResourcesNotAvailable,

UnDefinedError

}

ReportRIT::= OPERATION \-- identifier ReportRIT-Measurement

ARGUMENT

reportRITArg ReportRITArg

StopRIT::= OPERATION \-- identifier StopRIT-Measurement

ARGUMENT

stopRITReq StopRITReq

RESULT

StopRITRsp StopRITRsp

IndicateRITError ::= OPERATION

ARGUMENT

errorRITArg ErrorRITArg

PerformTOA::= OPERATION \-- identifier PerformTOA-Measurment

ARGUMENT

performTOAReq PerformTOAReq

RESULT

toaResultRsp TOAResultRsp

ERROR {

SystemFailure,

DataMissing,

UnexpectedDataValue,

ResourcesNotAvailable,

UnDefinedError

}

StatusQuery::= OPERATION

ARGUMENT

statusReq StatusReq

RESULT

statusRsp StatusRsp

ERROR {

}

ResetRequest::= OPERATION

ARGUMENT

resetReq ResetReq

RESULT

resetRsp ResetRsp

ERROR {

SystemFailure,

UnDefinedError

}

OMMngrRequest ::= OPERATION \-- defined in LLP-OM, 52.071

ARGURMENT

oMMngrReq OMMngrReq

RESULT

oMMngrRsp OMMngrRsp

ERROR

{

NACKCauses

}

OMAgntRequest ::= OPERATION \-- defined in LLP-OM, 52.071

ARGURMENT

oMAgntReq OMAgntReq

RESULT

oMAgntRsp OMAgntRsp

ERROR

{

NACKCauses

}

StatusUpdate ::= OPERATION \-- identifier Status Update

ARGUMENT

statusUpdateReq StatusUpdateReq

RESULT

statusUpdateRsp StatusUpdateRsp

ERROR {

SystemFailure,

DataMissing,

UnexpectedDataValue,

ResourceNotAvailable,

UnDefinedError

}

END

### 9.2.1 Operation types description

For each operation type this subclause provides a brief prose
description.

#### 9.2.1.1 StartRIT (network \--\> LMU)

This operation type is invoked by the network to request RIT measurement
information from an LMU.

#### 9.2.1.2 ReportRIT (LMU \--\>network)

This operation type is invoked by an LMU to report to the network RIT
measurement information. This operation is used to report periodical
measurements.

#### 9.2.1.3 StopRIT (network \--\> LMU)

This operation type is invoked by the network to request an LMU to stop
on-going RIT measurements and reporting.

#### 9.2.1.4 IndicateRITError (LMU \--\> network)

This operation type is invoked by an LMU to indicate error situations.

#### 9.2.1.5 (void)

#### 9.2.1.6 StatusQuery (network \--\> LMU)

This operation type is invoked by the network to request status an LMU
The status is returned using the return result component of the
operation.

#### 9.2.1.7 StatusUpdate (LMU \--\> network)

This operation type is invoked by an LMU to report status of LMU, e.g.
after reset or periodically.

#### 9.2.1.8 ResetRequest (network \--\> LMU)

This operation type is invoked by the network to reset an LMU.

#### 9.2.1.9 OMMngrRequest (network \--\> LMU)

This operation type is invoked by the network to request a specific O&M
activity to LMU as defined in 3GPP TS 52.071.

#### 9.2.1.10 OMAgntRequest (LMU \--\> network)

This operation type is invoked by the LMU to report an O&M event to
Network or asking for reporting O&M information from Network as defined
in 3GPP TS 52.071.

10.3 Error types
----------------

### 10.3.1 Error types ASN.1 specification

The following ASN.1 module provides an ASN.1 specification of errors.
Errors from MAP are imported in the LCS‑Protocol module in subclause
9.2. In this ASN.1 module, ASN.1/88 defined in ITU-T Recommendation
X.680 recommendations (ASN.1 1997) is used.

LLP-Errors

\-- { LLP-Errors object identifier }

DEFINITIONS ::=

BEGIN

IMPORTS

ERROR FROM

TCAPMessages FROM {

ITU-T recommendation q 773 modules (2) messages (1) version2 (2) }

;

\-- The MAP errors

\-- error types definition

UnDefinedError ::=ERROR

END

### 10.3.2 Error types description

For each error type this subclause provides a brief prose description.

#### 10.3.2.1 (void)

#### 10.3.2.2 (void)

#### 10.3.2.3 (void)

#### 10.3.2.4 SystemFailure

This error is returned by the LMU or the network, when it cannot perform
an operation because of a failure.

#### 10.3.2.5 DataMissing

This error is returned by the network or the LMU when an optional
parameter is missing in an invoke component or an inner data structure,
while it is required by the context of the request.

#### 10.3.2.6 UnexpectedDataValue

This error is returned by the network or the LMU when it receives a
parameter with an unexpected value, without type violation.

#### 10.3.2.7 ResourcesNotAvailable

This error is returned by the network or the LMU if temporarily there
are no resources.

#### 10.3.2.9 UnDefinedError 

This error is returned by the LMU or the network when any other error
type is not applicable.

10.4 Operations and errors implementation
-----------------------------------------

For the actual implementation of location services, operations and
errors have to be defined by value. The following ASN.1 module, imports
operation types from the ASN.1 module described in subclause 9.2 and
operation and error types from MAP. It defines operations by allocating
operations and errors a local value. For the involved operations and
errors the same local values as in MAP are allocated. In this ASN.1
module, ASN.1/88 defined in ITU-T Recommendation X.680 (ASN.1 1997) is
used.

LLP-Protocol

\-- { LLP-Protocol object identifier }

DEFINITIONS ::=

BEGIN

IMPORTS

SystemFailure,

DataMissing,

UnexpectedDataValue,

FacilityNotSupported,

UnknownSubscriber,

FROM MAP-Errors {

ccitt identified-organization (4) etsi (0) mobileDomain (0)

gsm-Network (1) modules (3) map-Errors (10) version4 (4)}

UnDefinedError

FROM LLP-Errors

\-- { LLP-Errors object identifier }

StartRIT,

ReportRIT,

StopRIT,

IndicateRITError,

PerformTOA,

StatusQuery,

ResetRequest,

OMRequest,

OMReport,

StatusUpdate

FROM -LLP-Operations

\-- { LLP-Operations object identifier }

\-- allocate local values for errors

systemFailure SystemFailure ::= localValue 10

dataMissing DataMissing ::= localValue 11

unexpectedDataValue UnexpectedDataValue ::= localValue 12

facilityNotSupported FacilityNotSupported ::= localValue 13

unknownSubscriber UnknownSubscriber ::= localValue 14

unDefinedError UnDefinedError ::= localValue 50

startRIT StartRIT ::= localValue 10

reportRIT ReportRIT ::= localValue 11

stopRIT StopRIT ::= localValue 12

indicateRITError IndicateRITError ::= localValue 13

performTOA PerformTOA ::= localValue 20

statusQuery statusQuery ::= localValue 30

resetRequest ResetRequest ::= localValue 31

omMngrRequest OMMngrRequest ::= LocalValue 32

omAgntRequest OMAgntRequest ::= LocalValue 33

StatusUpdate StatusUpdate ::= LocalValue 34

END

11 LMU LCS Protocol (LLP) messages
==================================

11.1 Messages, data types and identifiers
-----------------------------------------

### 11.1.1 General

This clause defines the External Signal Info IE, that contains Signal
Info string. Signal Info string contains the MLC‑LMU messages defined by
ASN.1 and coded by PER (ITU-T Recommendation X.691). In this ASN.1
module, ASN.1/94 defined in ITU-T Recommendation X.680 (ASN.1 1997) is
used.

### 11.1.2 ASN.1 data types

LLP-DataTypes

\-- { LLP-DataTypes object identifier }

DEFINITIONS AUTOMATIC TAGS ::=

BEGIN

IMPORTS

ExtensionContainer

FROM MAP-ExtensionDataTypes {

ccitt identified-organization (4) etsi (0) mobileDomain (0)

gsm-Network (1) modules (3) map-ExtensionDataTypes (21) version4 (4)}

;

StartRITReq ::= SEQUENCE {

rit-MeasurementType RIT-MeasurementType,

rit-ReportingType RIT-ReportingType,

rit-Environment RIT-Environment,

rit-NeigborNumber RIT-NeighborNumber,

rit-NeighborType RIT-NeighborType,

rit-CIMethod CIMethod,

rit-BTSInfo RIT-BTSInfo OPTIONAL,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StartRITRsp ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StopRITReq ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StopRITRsp ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

ReportRITArg ::= SEQUENCE {

rit-ReferenceIDInfo RIT-ReferenceIDInfo,

rit-ResponseInfo SeqOfRIT-ResponseInfo,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StatusReq ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StatusRsp ::= SEQUENCE {

statusTime StatusTime,

rit-Status RIT-Status,

toa-Status TOA-Status,

omStatus OMStatus,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

ErrorRITArg ::= SEQUENCE {

rit-ErrorType RIT-ErrorType,

rit-ErrorReason RIT-ErrorReason,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

PerformTOA ::= SEQUENCE {

toa-MeasurementDeviceInfo TOA-MeasurementDeviceInfo,

toa-ChannelDescr TOA-ChannelDescr,

toa-SignalDescr TOA-SignalDescr,

toa-TimingDescr TOA-TimingDescr,

toa-MeasurementOpt TOA-MeasurementOpt OPTIONAL,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

TOAResultRsp ::= SEQUENCE {

toa-TimingReferenceInfo TOA-TimingReferenceInfo,

toa-Measurements TOA-MeasurementInfo,

extensionContainer ExtensionContainer OPTIONAL,

\...

}

StatusUpdateReq ::= SEQUENCE {

statusReason StatusReason,

statusTime StatusTime,

ritStatus RIT-Status,

toaStatus TOA-Status,

omStatus OMStatus,

extensionContainer ExtensionContainer OPTIONAL,

...

}

StatusUpdateRsp ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

ResetReq ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

ResetRsp ::= SEQUENCE {

extensionContainer ExtensionContainer OPTIONAL,

\...

}

\-- DATA TYPES DEFINITION

\-- RIT measurement Type information

RIT-MeasurementType ::= INTEGER {

atdMeasure (0),

atdOrOtdMeasure (1),

rtdMeasure (2)

} (0..7)

\-- RIT Reporting Type information

RIT-ReportingType ::= SEQUENCE {

rit-ReportingPeriodInfo RIT-ReportingPeriodInfo OPTIONAL,

rit-ChangeLimit INTEGER (1..255) OPTIONAL,

rit-DeviationLimit INTEGER (1..255) OPTIONAL,

rit-MonitorPeriod INTEGER (1..64) OPTIONAL

}

RIT-ReportingPeriodInfo ::= SEQUENCE {

rit-ReportingPeriodFormat ENUMERATED {

tensOfSeconds (0),

tensOfMinutes (1) },

rit-ReportingPeriod INTEGER (1..120)

}

\-- RIT Environment Information

RIT-Environment ::= INTEGER {

heavyMultiPathAndNLOS (0),

\-- bad urban or urban heavy multipath and NLOS conditions

lightMultiPathAndLOS (1),

\-- suburban or rural ligth multipath and LOS conditions

mixedEnvironement (2)

\-- not defined or mixed environment

} (0..7)

RIT-NeighborNumber ::= INTEGER (0..15)

RIT-NeighborType ::= INTEGER {

listedNeighbors (0),

listedAndSystemInfo2or5 (1),

systemInfoType2or5 (2),

allNeighbors (3)

} (0..7)

CIMethod ::= INTEGER {

notCi (0), \-- report ci and carrier instead of CI

ci (1) \-- report CI if possible

} (0..3)

\-- element contains information of base stations

\-- to be measured

RIT-BTSInfo ::= SEQUENCE (SIZE(1..31)) OF RIT-BTSList \-- list of btss

RIT-BTSList ::= SEQUENCE {

rit-ListCi CI,

rit-TimeSlotScheme TimeSlotScheme,

rit-ListBSIC BSIC,

rit-ListBCCHCarrier BCCHCarrier

}

CI ::= INTEGER (0..65535)

TimeSlotScheme ::= INTEGER {

schemeUnknown (0),

equalLength (1), \-- time slots are equal length

variousLength (2) \-- the first time slot is 157b } (0..7)

BSIC ::= INTEGER (0..63)

BCCHCarrier ::= INTEGER (0..1023)

RIT-ReferenceIDInfo ::= SEQUENCE {

rit-ReferenceLAC LAC, \-- defined earlier

rit-ReferenceCI CI, \-- defined earlier

rit-ReferenceFrameNbr FrameNumber, \-- defined earlier

\-- If rit-ATReference is absent then there is not RIT AT refernce
value.

rit-ATReference RIT-ATReference OPTIONAL,

rit-ReferenceTimeSlot TimeSlot, \-- defined earlier

rit-ReferenceRXLevel RXLevel, \-- defined earlier

rit-ATDRTDQualityRes INTEGER (0..3), \-- defines the resolution for
ATDRTD values

rit-ATDRTDChangeQualityRes INTEGER (0..3) \-- defines the resolution for
ATDRTD change values

}

RIT-ATReference ::= SEQUENCE {

rit-CommonClock CommonClock,

rit-ReferenceATValue ReferenceATValue,

\-- This Quality information defines the quality of AT value

\-- Resolution defines the resolution of Quality field as follows,

\-- 0= 0.005 us, 1= 0.01 us, 2= 0.05 us

rit-RefATQuality SEQUENCE {

resolution INTEGER (0..3),

atQuality INTEGER (0..63) },

rit-ReferenceATChange INTEGER (-1000 .. 1000),

\-- This Quality information defines the quality of ATChange value

\-- Resolution defines the resolution of Quality field as follows,

\-- 0= 0.00005 ppm, 1= 0.0001 ppm, 2= 0.0005

rit-RefATChangeQuality SEQUENCE {

resolution INTEGER (0..3),

atChangeQuality INTEGER (0..63) }

}

\-- Editor\'s note: ReferenceATValue was divided in two parts because 15
999 999 999 requires 34 bits.

\-- In order to handle 34-bits values, LMU should support 64-bits
calculation, which can cause problems.

\-- This solution can be handled with 32-bits and in addition it gives
better resolution.

ReferenceATValue ::= SEQUENCE {

seconds INTEGER (0..59),

nsecods INTEGER (0..999999999)

}

SeqOfRIT-ResponseInfo ::= SEQUENCE (SIZE (1..15)) OF RIT-ResponseInfo

\-- Measured RTD values from one neighbor

RIT-ResponseInfo ::= SEQUENCE {

rit-NeighborCellIDInfo RIT-CellIDInfo,

rit-NeighborTimeSlot TimeSlot,

rit-NeighborRxLevel RXLevel,

rit-NeighborFrameNumber FrameNumber OPTIONAL,

rit-NeighborATDRTD INTEGER (0..923200),

rit-NeighborATDRTDQuality INTEGER (0..63),

rit-NeighborATDRTDChange INTEGER (-2000..2000),

rit-NeighborATDRTDChangeQuality INTEGER (0..63)

}

RIT-CellIDInfo ::= CHOICE {

rit-NeighborCI CI,

rit-NeighborBTS RIT-NeighborBTS

}

RIT-NeighborBTS ::= SEQUENCE {

rit-NeighborBSIC BSIC,

rit-NeighborBCCHCarrier BCCHCarrier

}

FrameNumber ::= INTEGER (0..2715647)

LAC ::= INTEGER (0..65535)

CommonClock ::= INTEGER {

gpsClock (0),

glonass (1),

galileoClock (2),

qzssClock (3),

bdsClock (4)

} (0..7)

TimeSlot ::= INTEGER (0..7)

RXLevel ::= INTEGER (0..63) \-- range -150 to -24 with 2dBm steps

\-- STATUS ELEMENTS

StatusReason ::= ENUMERATED {

powerUp (0), \-- no knowledge about previous states

unsucSWReset (1), \-- unsuccessful recovery

sucSWReset (2), \-- successful recovery

unknownError (3), \-- unknown selfdiagnosis error

unrelTBError (4), \-- unreliable timebase error

periodicReport (5), \-- periodic status report

...

}

StatusTime ::= SEQUENCE {

referenceLAC LAC, \-- defined earlier

referenceCI CI, \-- defined earlier

referenceFrameNumber FrameNumber \-- defined earlier

}

RIT-Status ::= INTEGER (0..63) \-- defines the number of RIT-Jobs

TOA-Status ::= INTEGER (0..63) \-- defines the number of TOA-Jobs

OMStatus ::= INTEGER (0..63) \-- defines the number of OM-Jobs

\-- ERROR RIT ELEMENTS

RIT-ErrorType ::= INTEGER {

permament (0),

temporary (1)

} (0..3)

RIT-ErrorReason ::= INTEGER {

noNeighbors (0),

noReferenceClock (1),

notSupportedType (2),

undefinedError (3)

} (0..15)

\-- TOA DEFINITIONS

\-- MEASUREMENTDEVICE INFORMATION

TOA-MeasurementDeviceInfo ::= SEQUENCE

(SIZE(1..6)) OF TOA-LMUMeasurementDevice \-- list of measurement devices

TOA-LMUMeasurementDevice ::= INTEGER (0..5)

\-- CHANNEL DESCRIPTION

TOA-ChannelDescr ::= SEQUENCE {

toa-FrequencyListType TOA-FrequencyListType,

toa-hopping TOA-Hopping OPTIONAL,

toa-channelType TOA-ChannelType,

toa-numberOfBursts TOA-NumberOfBurst

}

TOA-FrequencyListType ::= CHOICE {

frequencyListOnly FrequencyListOnly,

frequencyListAndIndex FrequencyListAndIndex,

frequencyIndexOnly FrequencyIndexOnly

}

FrequencyListOnly ::= SEQUENCE (SIZE(1..64)) OF TOA-ARFCNumber \-- list
of channels

FrequencyListAndIndex ::= SEQUENCE {

toa-arfcnList TOA-ARFCList,

\-- list of channels

frequencyIndex FrequencyIndex

}

TOA-ARFCList ::= SEQUENCE (SIZE(1..64)) OF TOA-ARFCNumber

FrequencyIndexOnly ::= SEQUENCE {

frequencyIndex FrequencyIndex

}

FrequencyIndex ::= INTEGER (0..31)

TOA-ARFCNumber ::= BCCHCarrier \-- defined earlier

TOA-Hopping ::= SEQUENCE {

toa-maio MAIO,

toa-hsn HSN,

toa-MsframeNumber ModuloFrameNumber

}

MAIO ::= INTEGER (0..63) \-- Mobile Allocation Index Offset

HSN ::= INTEGER (0..63) \-- Hopping Sequence Number

ModuloFrameNumber ::= INTEGER (0..84863)

TOA-ChannelType ::= INTEGER {

tchf(0),

tchhscn0 (1),

tchhscn1 (2)

} (0..7)

TOA-NumberOfBurst ::= INTEGER (0..7)

\-- SIGNAL DESCRIPTION

TOA-SignalDescr ::= SEQUENCE {

toa-BurstType TOA-BurstType

}

TOA-BurstType ::= CHOICE {

toa-AccessBurst TOA-AccessBurst, \-- access burst

toa-TSC TSC \-- normal burst

}

TOA-AccessBurst ::= SEQUENCE {

toa-HOReference HOReference,

toa-BSIC BSIC \-- defined earlier

}

HOReference ::= INTEGER (0..255)

TSC ::= INTEGER (0..7)

\-- TIMING DESCRIPTION

TOA-TimingDescr ::= SEQUENCE {

toa-TimeReference TOA-TimeReference,

toa-timeUncertainty TimeUncertainty

}

TOA-TimeReference ::= CHOICE {

toa-gpsTime TOA-GPSTime,

toa-gsmStartTime TOA-GSMStartTime

}

TOA-GPSTime ::= SEQUENCE {

toa-GPSStartTime GPSStartTime,

toa-GPSSV GPSSV

}

GPSStartTime ::= INTEGER (0..14999999) \-- unit is microseconds

GPSSV ::= INTEGER (0..31)

TOA-GSMStartTime ::= SEQUENCE {

toa-arfcn BCCHCarrier, \-- defined earlier

toa-bsic BSIC, \-- defined earlier

toa-GSMStartTime GSMTime

}

GSMTime ::= SEQUENCE {

toa-GSMTimeframeNumber GSMTimeFrameNumber,

toa-timeSlot TimeSlot,

toa-bitNumber BitNumber

}

GSMTimeFrameNumber ::= INTEGER (0..42323)

BitNumber ::= INTEGER (0..156)

TimeUncertainty ::= INTEGER (0..15)

\-- MEASUREMENT OPTIONS

TOA-MeasurementOpt ::= SEQUENCE {

toa-LMUMethod TOA-Method,

toa-Environment TOA-Environment,

toa-MeasurementType TOA-MeasurementType

}

TOA-Method ::= INTEGER (0..7)

TOA-Environment ::= INTEGER {

heavyMpathAndNLOS (0),

lightMpathAndLOS (1),

mixed (2)

} (0..7)

TOA-MeasurementType ::= INTEGER {

reportTOA-only (0),

reportAOA-only (1),

reportTOAandAOA (2)

} (0..3)

\-- TIMING INFO

TOA-TimingReferenceInfo ::= CHOICE {

toa-GPSTimeInfo NULL,

toa-GSMTimeInfo TOA-GSMTimeInfo

}

TOA-GSMTimeInfo ::= SEQUENCE {

toa-bcch BCCHCarrier, \-- defined earlier

toa-bsic BSIC \-- defined earlier

}

\-- THE ACTUAL TOA MEASUREMENTS

TOA-MeasurementInfo ::= SEQUENCE(SIZE(1..6)) OF TOA-Measurements

\-- list of measurementDevices

TOA-Measurements ::= SEQUENCE {

toa-MeasurementDeviceID MeasurementDeviceID,

toa-AddMeasurementInfo TOA-AddMeasurementInfo,

toa-measuredPeakList TOA-MeasuredPeakList

}

\-- MEASUREMENT DEVICE ID IE

MeasurementDeviceID ::= INTEGER (0..5)

\-- MEASUREMENT INFO IE IN RESULT MESSAGE

TOA-AddMeasurementInfo ::= SEQUENCE {

toa-Method TOA-Method, \-- defined earlier

toa-Diversity TOA-Diversity,

toa-NumberOfBurst TOA-NumberOfBurst, \-- defined earlier

toa-AOA TOA-AOA OPTIONAL,

toa-AOAUncertainty TOA-AOAUncertainty OPTIONAL

}

TOA-Diversity ::= INTEGER {

noDiversity (0),

diversity (1)

} (0..3)

TOA-AOA ::= INTEGER (0..3599)

TOA-AOAUncertainty ::= INTEGER (0..31)

\-- PEAKS LIST OF MEASURED TOAs

TOA-MeasuredPeakList ::= SEQUENCE (SIZE(0..4)) OF TOA-MeasuredPeaks

\-- list of peaks

\-- MEASURED TOA IE

TOA-MeasuredPeaks ::= SEQUENCE {

toa-MeasuredTOA MeasuredTOA,

toa-QualityInfo TOA-QualityInfo

}

MeasuredTOA ::= INTEGER (-131072..131071)

\-- the absolute TOA value

TOA-QualityInfo ::= SEQUENCE {

toa-Uncertainty TOA-Uncertainty OPTIONAL,

snrEstimate SNREstimate OPTIONAL,

toaSignalStrength TOASignalStrength OPTIONAL

}

TOA-Uncertainty ::= INTEGER (0..63)

\-- the uncertainty of the TOA estimate

SNREstimate ::= INTEGER (-30..33)

\-- the estimated value for Signal Noise Radio

TOASignalStrength ::= INTEGER (0..63)

\-- range -150 to -24 with 2dBm steps

END

\-- The definition below will be imported from MAP specification.

\--

\--

\-- MAP-ExtensionDataTypes {

\-- ccitt identified-organization (4) etsi (0) mobileDomain (0)

\-- gsm-Network (1) modules (3) map-ExtensionDataTypes (21) version4
(4)}

\--

\-- DEFINITIONS

\--

\-- IMPLICIT TAGS

\--

\-- ::=

\--

\-- BEGIN

\--

\-- EXPORTS

\--

\-- PrivateExtension,

\-- ExtensionContainer;

\--

\--

\--

\-- MAP-EXTENSION ::= CLASS {

\-- &ExtensionType OPTIONAL,

\-- &extensionId OBJECT IDENTIFIER }

\-- \-- The length of the Object Identifier shall not exceed 16 octets
and the

\-- \-- number of components of the Object Identifier shall not exceed
16

\--

\--

\--

\-- data types

\--

\-- ExtensionContainer ::= SEQUENCE {

\-- privateExtensionList \[0\]PrivateExtensionList OPTIONAL,

\-- pcs-Extensions \[1\]PCS-Extensions OPTIONAL,

\-- \...}

\--

\-- PrivateExtensionList ::= SEQUENCE SIZE
(1..maxNumOfPrivateExtensions) OF

\-- PrivateExtension

\--

\-- PrivateExtension ::= SEQUENCE {

\-- extId MAP-EXTENSION.&extensionId

\-- ({ExtensionSet}),

\--

\-- extType MAP-EXTENSION.&ExtensionType

\-- ({ExtensionSet}{\@extId}) OPTIONAL}

\--

\-- maxNumOfPrivateExtensions INTEGER ::= 10

\--

\-- ExtensionSet MAP-EXTENSION ::=

\-- {\...

\-- \-- ExtensionSet is the set of all defined private extensions

\-- }

\--

\-- Unsupported private extensions shall be discarded if received.

\--

\--

\-- PCS-Extensions ::= SEQUENCE {

\-- \...}

\--

\-- END

### 11.1.3 Identifiers definition

In the informative annexes the contents of the identifiers used in
operation and error types description are further discussed.

######## Annex A (informative): RIT messages

A.1 Introduction
----------------

This annex describes the contents of Radio Interface Timing (RIT)
related messages.

A.2 Messages
------------

The messages below are considered to be transported between the SMLC and
the LMU.

### A.2.1 RIT Measurement Request Message

The RIT Measurement Request is a message from the SMLC to the LMU. As a
response to it the LMU performs Real Time Difference (RTD) or Absolute
Time Difference (ATD) measurements. It contains the following
information elements.

Table A.2.1: RIT Measurement Request message content

  -------------------------- ------------------------------------ ----------
  Information element        Type/Reference                       Presence
  Message Type               Message Type A.2.1.1.1               M
  Measurement Instructions   Measurement Instructions A.2.1.1.2   M
  BTS List                   BTS List A.2.1.1.3                   C
  -------------------------- ------------------------------------ ----------

#### A.2.1.1 RIT Measurement Request Message Information Elements

##### A.2.1.1.1 Message Type IE

This IE contains the type of the message. This IE is mandatory.

##### A.2.1.1.2 Measurement Instructions IE

The purpose of the Measurement Instructions IE is to inform the LMU
about the measurement type (RTD/ATD), measurement result reporting rate,
and tell which BTSs should be measured. This IE is mandatory, and it
contains the following fields:

##### Measurement Type {#measurement-type .H6}

> This field indicates whether AT of reference BTS is required.

\'0\': AT of reference BTS should be reported. If AT of reference BTS
can not be measured, no ATD/RTD measurements are reported, but RIT Error
IE is sent instead.

\'1\': AT of reference BTS should be reported . If AT of reference BTS
can not be measured, ATD/RTD measurements are reported anyhow.

\'2\': ATD/RTD measurements timestamped with frame number of the
reference BTS should be performed.

##### Reporting Period Format {#reporting-period-format .H6}

> This field describes the units of the Reporting Period field. This
> field is optional. If this field is included, RIT Measurement
> Responses shall be send with the period indicated in this and
> Reporting Period fields.

\'0\': Reporting Period is told in tens of seconds.

\'1\': Reporting Period is in tens of minutes.

##### Reporting Period  {#reporting-period .H6}

> This field describes the value for the reporting period, i.e. the
> required time period between the RIT Measurement Response messages.
> Its units and multiplication factor are defined in the Reporting
> Period Format field. This field is conditional and included only if
> the Reporting Period Format is included.

Range: 1-120.

##### Change Limit {#change-limit .H6}

> This field indicates the limit for the change of AT or ATD /RTD values
> in units of 0.02 micro-seconds. If any AT or ATD/RTD value has changed
> more than the value in this field since the last RIT Measurement
> Response, a new RIT Measurement Response message is sent. This field
> is optional. If this field is included, RIT Measurement Responses
> shall be send when some RIT value has changed more than this limit.

Range: 1-255.

##### Deviation Limit  {#deviation-limit .H6}

> This field indicates the limit for the deviation of the AT or ATD/RTD
> values. If any time the predicted AT or ATD/RTD value (based on
> reported AT or ATD/RTD values and changes in the last RIT Measurement
> Response) has deviated more than the value in this field compared to
> the current measurement result, a new RIT Measurement Response message
> is sent. This field is optional. If this field is included, RIT
> Measurement Responses shall be send when the first deviation of some
> RIT value is more than this limit. The values are in units of 0.02
> micro-seconds.

Range: 1-255.

NOTE: Predicted AT or ATD/RTD value means the value that is calculated
(extrapolated) based on AT or ATD/RTD value and AT or ATD/RTD Change
value in last RIT Measurement Response message.

##### Monitor Period  {#monitor-period .H6}

> This field indicates the requested time period for monitoring the time
> derivative of AT or ATD/RTD values, i.e. on how long monitor period
> the reported AT or ATD/RTD change is based. The value is in tens of
> seconds. This field is optional.

Range: 1- 64.

##### Environment Characterization {#environment-characterization .H6}

> Environment Characterization field gives a LMU information about
> expected multipath and NLOS in the area.

\'0\': possibly heavy multipath and NLOS conditions (e.g. bad urban or
urban).

\'1\': no or light multipath and usually LOS conditions (e.g. suburban
or rural).

\'2\': not defined or mixed environment.

\'3\': reserved.

\'4\': reserved (i.e. several values should be reserved).

##### Neighbor Number {#neighbor-number .H6}

> This field indicates the maximum number of neighbor BTSs that the LMU
> should try to report.

Range: 0-15.

##### Neighbor Type {#neighbor-type .H6}

> This field indicates which neighbor BTSs are used for RIT
> measurements. If the value of the Neighbor Number field is lower than
> the total number of BTSs in the required list, then the BTS are
> selected in the order of the list.

\'0\': Neighbor BTSs listed in the BTS List IE are used for RIT
measurements in the order of the list.

\'1\': If possible, neighbor BTSs listed in the BTS List IE are used,
otherwise neighbors received in SYSTEM INFORMATION 2 or 5 message are
used in the order of received signal strength.

\'2\': Neighbor BTSs indicated in SYSTEM INFORMATION TYPE 2 or 5 are
used for RIT measurements (i.e. this is normal operation) in the order
of received signal strength.

\'3\': All neighbor BTSs that can be received (i.e. reported BTSs are
not limited to BTSs listed in SYSTEM INFORMATION TYPE 2 or 5 or BTS List
IE). Support of this option in LMU is optional.

##### CellIdMethod {#cellidmethod .H6}

> CellIdMethod field indicates whether CI or BSIC and BCCH carrier is
> used to identify neighbor BTSs in RIT Measurement Responses.

\'0\' = BSIC and BCCH carrier are used to identify the cell, even if CI
is available.

\'1\' = CI is used to identify the neighbor cell, if it is available,
otherwise BSIC and BCCH carrier are used.

##### A.2.1.1.3 BTS List IE

This information element indicates neighbor BTSs that are used for RIT
measurements. This IE is conditional. If Neighbor Type field in the
Measurement Instructions IE is \'0\' or \'1\' this field must be
included. The first BTS on the list is the reference BTS that should be
used as reference when reporting the RTD or AT values. If this reference
BTS is not available, the LMU can select the used reference BTS based on
signal strength.

This IE contains the following fields.

##### Number of BTSs  {#number-of-btss .H6}

> This field indicates, how many BTSs are included in this IE.

Range: 1 to 31.

> The following fields are repeated the number of times included in
> Number of BTSs field.

##### CI {#ci .H6}

> This field indicates the Cell Identity of the particular BTS. The
> purpose of the Cell Identity value is to identify a BTS within a
> location area.

Range: 0 - 65535.

NOTE: Here is assumed that when LMU starts to make measurements, it
firsts goes to the requested frequencies, and starts to decode BSICs and
CIs from those specific frequencies. Because of this procedure the risk
that there would be two BTSs with same CIs and same Channel numbers is
minimal (i.e. there is no need to transmit LAC).

##### Time Slot Scheme {#time-slot-scheme .H6}

> The Time Slot Scheme field indicates what kind of transmission scheme
> the particular BTS is using. If the LMU measures signals from BTSs
> from other time slots than 0 or 4, and it is informed about the burst
> length schemes used by BTSs, then it can compensate for the possible
> error. (This is necessary if the LMU averages bursts from different
> time slots, and the BTS uses varying lengths of bursts.)

\'0\' = the burst scheme is unknown (The time slot should remain the
same).

\'1\' = all time slots are 156.25 bits long.

\'2\' = time slots 0 and 4 are 157 bits long and other time slots are
156 bits long.

##### BSIC {#bsic .H6}

> This field indicates the BSIC (Base Station Identity Code) of the
> particular BTS.

Range: 0 - 63.

##### BCCH Carrier {#bcch-carrier .H6}

> This field indicates the absolute RF channel number of the particular
> BTS.

Range: 0 - 1023.

### A.2.2 RIT Measurement Response Message

The RIT Measurement Response is a message from the LMU to the SMLC. It
is the response to the RIT Measurement Request. It contains the
following information elements.

Table A.2.2: RIT Measurement Response message content

  --------------------- --------------------------- ----------
  Information element   Type/Reference              Presence
  Message Type          Message Type A.2.2.1.1      M
  RIT Measurement       RIT Measurement A.2.2.1.2   M
  --------------------- --------------------------- ----------

#### A.2.2.1 RIT Measurement Response Message Information Elements

##### A.2.2.1.1 Message type IE

This IE contains the type of the message. This IE is mandatory.

##### A.2.2.1.2 RIT Measurement IE

This IE includes the required RIT measurements. The length of this IE
depends on the number of measured neighbor BTSs. This IE is mandatory.

##### Reference LAC {#reference-lac .H6}

This field indicates the Location Area Code of the reference BTS. The
purpose of the Location Area Code is to identify a location area.

Range: 0 - 65535.

##### Reference CI {#reference-ci .H6}

This field indicates the Cell Identity value of the reference BTS. The
purpose of the Cell Identity value is to identify a cell within a
location area.

Range: 0 - 65535.

##### Reference Frame Number {#reference-frame-number .H6}

This field indicates the frame number of the last measured burst from
the reference BTS.

Range: 0 - 2715647.

##### Response Type {#response-type .H6}

This field indicates whether AT of reference BTS is reported or not.

\'0\': AT of reference BTS is not reported.

\'1\': AT of reference BTS is reported.

##### Common Clock {#common-clock .H6}

This field indicates the type of the common reference clock for AT
measurement. This field is included only if the Response Type field is
\'1\'.

\'0\': GPS clock is used.

\'1\': glonass clock is used

\'2\': Galileo clock is used

\'3\': QZSS clock is used

\'4\': BDS clock is used

\'5\' to \'7\' : Reserved for future use (e.g. Synchronized atomic
clocks).

##### Reference AT {#reference-at .H6}

This field indicates the measured AT value for the serving BTS. It is
the starting moment of a time slot. It is counted in two parts: seconds
after last minute change, and nanoseconds after last second change.This
field is included only if the Response Type field is \'1\'.

Range:

seconds: 0-59.

nanoseconds: 0-999,999,999.

##### Reference AT Quality Resolution {#reference-at-quality-resolution .H6}

Reference AT Quality Resolution field includes the resolution used in
Reference AT Quality field. Encoding on 2 bits as follows.

\'00\' 0.005 micro seconds.

\'01\' 0.01 micro seconds.

\'10\' 0.05 micro seconds.

\'11\' Reserved.

This field is included only if the Response Type field is \'1\'.

##### Reference AT Quality {#reference-at-quality .H6}

Reference AT Quality field includes the quality of reported RIT
measurement. This Reference AT Quality field can be e.g. used to
evaluate the reliability of AT measurements in the SMLC. Reference AT
quality is defined as

Reference AT Quality
=$\sqrt{E\left\lbrack \left( x - \mu \right)^{2} \right\rbrack}$= Std of
reported AT value;

where $x$ is the reported Reference AT value and
$\mu = E\left\lbrack x \right\rbrack$ is its expectation value. The
reporting resolution of Reference AT Quality is defined by Reference AT
Quality resolution field.

Range: 0 to 63.

Value 63 means that Reference AT Quality is greater than or equal to
R\*63, where R is the resolution defined in Reference AT Quality
Resolution field.

This field is included only if the Response Type field is \'1\'.

##### Reference AT Change {#reference-at-change .H6}

This field indicates the first time derivative of the AT value for the
reference BTS. This value is based on measurements made during Monitor
Period, if the monitoring period is provided. Otherwise it is the best
estimate of AT Change value at the time of last AT measurement. This
field is conditional and included if Response Type field is \'1\'. The
range is -0.05 ... 0.05 ppm and resolution is 0,00005 ppm.

Range: -1000 ... 1000.

##### Reference AT Change Quality Resolution {#reference-at-change-quality-resolution .H6}

Reference AT Change Quality Resolution field includes the resolution
used in Reference AT Change Quality field. Encoding on 2 bits as
follows.

\'00\' 0.00005 ppm.

\'01\' 0.0001 ppm.

\'10\' 0.0005 ppm.

\'11\' Reserved.

This field is conditional and included if the Response Type field is
\'1\'.

##### Reference AT Change Quality {#reference-at-change-quality .H6}

Reference AT Change Quality field includes the quality of reported
Reference AT Change. This Reference AT Change Quality field can be e.g.
used to evaluate the reliability of RIT measurements in the SMLC.
Reference AT Change Quality is defined as.

Reference AT Change Quality
=$\sqrt{E\left\lbrack \left( x - \mu \right)^{2} \right\rbrack}$= Std of
reported AT Change value;

where $x$ is the reported Reference AT Change and
$\mu = E\left\lbrack x \right\rbrack$ is its expectation value. The
reporting resolution of Reference AT Change Quality is defined by
Reference AT Change Quality Resolution field.

Range: 0 to 63.

This field is conditional and included if the Response Type field is
\'1\'.

##### Reference Time Slot {#reference-time-slot .H6}

Reference Time Slot indicates the time slot relative to which the LMU
reports the reference BTS measurements. This field is mandatory.

Range: 0 to 7

NOTE: If the LMU does not know timeslot scheme, the LMU reports the used
timeslot. The LMU can only report results based on one time slot (N) or
two time slots (N and N+4). If the LMU knows timeslot scheme, the LMU
can make measurements from several timeslots and reports that the used
timeslot is zero (and makes correction).

##### Reference RX Level {#reference-rx-level .H6}

RX Level field includes the received signal strength of the reference
BTS.

The RX Level is expressed in 2 dBm steps within the range -150 .. -24
dBm.

Range: 0 .. 63.

##### ATD/RTD Quality Resolution {#atdrtd-quality-resolution .H6}

ATD/RTD Quality Resolution field includes the resolution used in ATD/RTD
Quality field. Encoding on 2 bits as follows.

\'00\' 0.005 micro seconds.

\'01\' 0.01 micro seconds.

\'10\' 0.05 micro seconds.

\'11\' Reserved.

This field is mandatory.

##### ATD/RTD Change Quality Resolution {#atdrtd-change-quality-resolution .H6}

ATD/RTD Change Quality Resolution field includes the resolution used in
ATD/RTD Change Quality field. Encoding on 2 bits as follows.

\'00\' 0.00005 ppm.

\'01\' 0.0001 ppm.

\'10\' 0.0005 ppm.

\'11\' Reserved.

This field is mandatory.

##### Number of Measured Neighbors {#number-of-measured-neighbors .H6}

This field indicates the number of different neighbor BTSs.

NOTE: If the LMU can not measure any neighbor BTSs, then this value is
set to \'0\'.

Range: 0 - 15

The following fields are repeated the number of times included in Number
of Measured Neighbors field.

##### CellIdType {#cellidtype .H6}

This field indicates is the identity method of the cell.

\'0\' = Cell identity is told using BSIC and BCCH carrier.

\'1\' = Cell identity is told using CI.

##### Neighbor CI {#neighbor-ci .H6}

This field indicates the Cell Identity of the particular neighbor cell.
The purpose of the Cell Identity value is to identify a cell within a
location area.

Neighbor CI field is a conditional field and it is included only if
CellIdType is set \'1\' and CI value of the given cell is available.

Range: 0 - 65535.

##### Neighbor BSIC {#neighbor-bsic .H6}

This field indicates the BSIC (Base Station Identity Code of the base
station).

BSIC field is conditional and it is included only if CellIdType is set
\'0\'.

Range: 0 - 63.

##### Neighbor BCCH Carrier {#neighbor-bcch-carrier .H6}

This field indicates the absolute RF channel number of the neighbor base
station. BCCH carrier field is conditional and it is included only if
CellIdType is set \'0\'.

Range: 0 - 1023

##### Neighbor RX Level {#neighbor-rx-level .H6}

RX Level field includes the received signal strength on the neighbor
BTS.

The RX Level is expressed in 2 dBm steps within the range -150 .. -24
dBm.

Range: 0 .. 63.

##### Neighbor Frame Number {#neighbor-frame-number .H6}

This field indicates the calculated value of the neighbor BTS\'s frame
that would have been received at the same time or immediately after as
the last measured frame from the reference BTS. This field is optional.

Range: 0 - 2715647

##### Neighbor Time Slot  {#neighbor-time-slot .H6}

Neighbor Time Slot indicates the time slot relative to which the LMU
reports the serving BTS measurements. This field is mandatory.

Range: 0 to 7

NOTE: If the LMU does not know timeslot scheme, the LMU reports the used
timeslot. The LMU can only report results based on one time slot (N) or
two time slots (N and N+4). If the LMU knows timeslot scheme, the LMU
can make measurements from several timeslots and reports that the used
timeslot is zero (and makes correction).

##### ATD/RTD Value {#atdrtd-value .H6}

This field indicates the measured ATD/RTD value between the receptions
of signals from the reference and the neighbor BTS. This ATD/RTD value
is the difference in reception of signal (the starting moment of time
slot) from reference BTS compared to the signal (next starting moment of
a time slot) from the neighbor BTS (i.e. this value is always positive).
This field is mandatory. The reporting resolution of ATD/RTD value is
0.005 micro-seconds.

Range: 0 ... 923200.

NOTE: The reported ATD/RTD value may be based on some filtering or
estimation algorithm. I.e. the reported value is not the last
measurement result, it is the best estimate of real RTD value at the
time of last measurement.

##### ATD/RTD Quality {#atdrtd-quality .H6}

ATD/RTD Quality field includes the quality of reported RIT measurement.
This ATD/RTD Quality field can be e.g. used to evaluate the reliability
of RIT measurements in the SMLC. ATD/RTD quality is defined as

ATD/RTD Quality
=$\sqrt{E\left\lbrack \left( x - \mu \right)^{2} \right\rbrack}$ = Std
of reported ATD/RTD value;

where $x$ is the reported ATD/RTD value and
$\mu = E\left\lbrack x \right\rbrack$ is its expectation value. The
reporting resolution of ATD/RTD Quality is defined by ATD/RTD Quality
resolution field.

Range: 0 to 63

This field is mandatory.

##### ATD/RTD Change {#atdrtd-change .H6}

This field indicates the first time derivative of the ATD/RTD value
between the receptions of signals from the reference and the neighbor
BTS. This value is based on measurements made during Monitor Period, if
the monitoring period is provided. Otherwise it is the best estimate of
the ATD/RTD Change value at the time of last ATD/RTD measurement. The
range is -0.1 ... 0.1 ppm and resolution is 0,00005 ppm.

Range: -2000 ... 2000

##### ATD/RTD Change Quality {#atdrtd-change-quality .H6}

ATD/RTD Change Quality field includes the quality of reported ATD/RTD
Change. This ATD/RTD Change Quality field can be e.g. used to evaluate
the reliability of RIT measurements in the SMLC. ATD/RTD Change Quality
is defined as

ATD/RTD Change Quality
=$\sqrt{E\left\lbrack \left( x - \mu \right)^{2} \right\rbrack}$= Std of
reported ATD/RTD Change value;

where $x$ is the reported ATD/RTD Change and
$\mu = E\left\lbrack x \right\rbrack$ is its expectation value. The
reporting resolution of ATD/RTD Change Quality is defined by ATD/RTD
Change Quality resolution field.

Range: 0 to 63

This field is mandatory.

### A.2.3 RIT Measurement Stop Message

The RIT Measurement Stop is a message from the SMLC to the LMU. It is
sent when the SMLC wants the LMU to stop doing RIT measurements and
reporting them. It contains the following information elements.

Table A.2.3: RIT Measurement Stop message content

  --------------------- ------------------------ ----------
  Information element   Type/Reference           Presence
  Message Type          Message Type A.2.3.1.1   M
  --------------------- ------------------------ ----------

#### A.2.3.1 RIT Measurement Stop Message Information Elements

##### A.2.3.1.1 Message type IE

This IE contains the type of the message. This IE is mandatory.

### A.2.4 RIT Measurement Error Message

The RIT Measurement Error is a message from the LMU to the SMLC. It is
sent any time when the LMU can not perform RIT measurements asked for in
the RIT Measurement Request. This message can be returned in return
result (after reception of measurement command) or as separate message
(during periodic measurement). It contains the following information
elements.

Table A.2.4: RIT Measurement Error message content

  --------------------- -------------------------- ----------
  Information element   Type/Reference             Presence
  Message Type          Message Type A.2.4.1.1     M
  Error Type            RIT Error Type A.2.4.1.2   M
  RIT Error             RIT Error A.2.4.1.3        M
  --------------------- -------------------------- ----------

#### A.2.4.1 RIT Measurement Error Message Information Elements

##### A.2.4.1.1 Message type IE

This IE contains the type of the message. This IE is mandatory.

##### A.2.4.1.2 RIT Error Type IE

This IE indicates whether the error is temporarily (e.g. GNSS receiver
reset) or permanent errors. Permanent error requires actions in SMLC,
temporarily error informs that LMU can not send results temporarily (but
it is expected to recover without any actions from SMLC).

\'0\' = Permanent error.

\'1\' = Temporarily error.

##### A.2.4.1.3 RIT Error IE

The purpose of the RIT Error IE is to provide the indication of error
and the reason for it, when the LMU can not report required RIT results.
This IE is mandatory. This IE has the following fields.

##### Error Reason {#error-reason .H6}

This field indicates the reason for error.

> \'0\': There were no neighbor BTSs to be received.
>
> \'1\': No ATD measurements were possible, since the common reference
> clock was not available.
>
> \'2\': Requested type of measurements is not supported.
>
> \'3\': Undefined error.

######## Annex B (informative): (void) 

######## Annex C (informative): Status Messages

C.1 Introduction
----------------

This annex describes the contents of messages related to the status of
an LMU.

C.2 Messages
------------

The messages below are considered to be transported between the SMLC and
the LMU.

### C.2.1 Status Query Message

The Status Query is a message from the SMLC to the LMU. It contains the
following information elements.

Table C.2.1: Status Query message content

  --------------------- ------------------------ ----------
  Information element   Type/Reference           Presence
  Message Type          Message Type C.2.1.1.1   M
  --------------------- ------------------------ ----------

#### C.2.1.1 Status Query Message Information Elements

##### C.2.1.1.1 Message Type IE

This IE contains the type of the message. This IE is mandatory.

### C.2.2 Status Query Result Message

The Status Query Result is a message from the LMU to the SMLC. It
contains the following information elements.

Table C.2.2: Status Query Result message content

  --------------------------------------------------------------------------------------------------------- ------------------------------- ----------
  Information element                                                                                       Type/Reference                  Presence
  Message Type                                                                                              Message Type 5.2.1.1            M
  Time                                                                                                      Time C.2.2.1.2                  M
  RIT Status                                                                                                RIT Status C.2.2.1.3            M
  Reserved                                                                                                  Reserved (see note) C.2.2.1.4   M
  O&M Status                                                                                                O&M Status C.2.2.1.5            M
  NOTE: This value was allocated in an earlier phase of the protocol and shall not be used in the future.                                   
  --------------------------------------------------------------------------------------------------------- ------------------------------- ----------

#### C.2.2.1 Status Query Result Message Information Elements

##### C.2.2.1.1 Message Type IE

This IE contains the type of the message. This IE is mandatory.

##### C.2.2.1.2 Time IE

This IE contains the time stamp for this message. This IE is mandatory,
and it contains the following fields:

##### Reference LAC {#reference-lac-1 .H6}

This field indicates the Location Area Code of the reference BTS. The
purpose of the Location Area Code is to identify a location area.

Range: 0 - 65535.

##### Reference CI {#reference-ci-1 .H6}

This field indicates the Cell Identity value of the reference BTS. The
purpose of the Cell Identity value is to identify a cell within a
location area.

Range: 0 - 65535.

##### Reference Frame Number {#reference-frame-number-1 .H6}

This field indicates the frame number of the last measured burst from
the reference BTS.

Range: 0 - 2715647.

##### C.2.2.1.3 RIT Status IE

The purpose of the RIT Status IE is to inform the SMLC about the status
of on-going RIT related activity. This IE is mandatory, and it contains
the following fields:

##### RIT Jobs {#rit-jobs .H6}

This field indicates the number of on-going RIT related jobs, i.e. the
number of neighbor BTSs that are tried to be measured. Notice that 0
means that no RIT related activity is on-going.

Range: 0 - 63.

##### C.2.2.1.4 Reserved IE

This IE is reserved and the value is 0.

Range: 0 - 63.

##### C.2.2.1.5 O&M Status IE

The purpose of the O&M Status IE is to inform the SMLC about the status
of on-going O&M related activity. This IE is mandatory, and it contains
the following fields:

##### O&M Jobs {#om-jobs .H6}

This field indicates the number of on-going O&M related jobs.

Range: 0 - 63.

### C.2.3 Status Update Message

The Status Update is a message from the LMU to the SMLC. It contains the
following information elements.

Table C.2.3: Status Response message content

  --------------------------------------------------------------------------------------------------------- ------------------------------------ ----------
  Information element                                                                                       Type/Reference                       Presence
  Message Type                                                                                              Message Type C.2.3.1.1               M
  Reason for Status Update                                                                                  Reason for Status Update C.2.3.1.2   M
  Time                                                                                                      Time C.2.2.1.2                       M
  RIT Status                                                                                                RIT Status C.2.2.1.3                 M
  Reserved                                                                                                  Reserved (see note) C.2.2.1.4        M
  O&M Status                                                                                                O&M Status C.2.2.1.5                 M
  NOTE: This value was allocated in an earlier phase of the protocol and shall not be used in the future.                                        
  --------------------------------------------------------------------------------------------------------- ------------------------------------ ----------

#### C.2.3.1 Status Update Message Information Elements

##### C.2.3.1.1 Message Type IE

This IE contains the type of the message. This IE is mandatory.

##### C.2.3.1.2 Reason for Status Update IE

This IE contains the reason for sending this Status Update Message. This
IE is mandatory, and it contains the following fields:

##### Reason Code {#reason-code .H6}

This field indicates Reason code for sending this Status Update Message.

> \'0\': power up (no knowledge about previous states).
>
> \'1\': SW reset, unsuccessful recovery.
>
> \'2\': SW reset, successful recovery.
>
> \'3\': unknown selfdiagnosis error.
>
> \'4\': unreliable timebase error.
>
> \'5\': periodic status report, normal operation.

######## Annex D (informative): Change history

  -------------------- ------------- ---------- -------- --------- --------- ---------------------------------------------------- -----------------
  **Change history**                                                                                                              
  **Date**             **Meeting**   **TDoc**   **CR**   **Rev**   **Cat**   **Subject/Comment**                                  **New version**
  2016-01                            \-         \-       \-        \-        Version 13.0.0 based on version 12.0.0               13.0.0
  2017-03              RP-75         \-         \-       \-        \-        Release 14 version (frozen at TSG-75)                14.0.0
  2018-06              RP-80         \-         \-       \-        \-        Release 15 version (frozen at TSG-80)                15.0.0
  2020-07              RP-88e        \-         \-       \-        \-        Upgrade to Rel-16 version without technical change   **16.0.0**
  -------------------- ------------- ---------- -------- --------- --------- ---------------------------------------------------- -----------------
