![](media/image1.jpeg){width="7.0875in" height="3.4229166666666666in"}

Contents {#contents .TT}
========

[15](#foreword)

[16](#scope)

[17](#references)

[18](#definitions-symbols-and-abbreviations)

[18](#definitions)

[18](#symbols)

[18](#abbreviations)

[18](#architectural-assumptions-and-principles)

[19](#key-issues)

[19](#key-issue-1-support-for-infrequent-small-data-transmission)

[19](#description)

[19](#architectural-requirements)

[19](#architectural-baseline)

[20](#open-issues)

[20](#key-issue-2-frequent-small-data-communication)

[20](#description-1)

[20](#architectural-requirements-1)

[21](#architectural-baseline-1)

[21](#open-issues-1)

[21](#key-issue-3-high-latency-communication)

[21](#description-2)

[21](#architectural-requirements-2)

[21](#architectural-baseline-2)

[22](#open-issues-2)

[22](#key-issue-4-power-saving-functions)

[22](#description-3)

[23](#architectural-requirements-3)

[23](#architectural-baseline-3)

[23](#open-issues-3)

[23](#key-issue-5-ue-tx-power-saving-functions)

[23](#description-4)

[24](#architectural-requirements-4)

[24](#architectural-baseline-4)

[24](#open-issues-4)

[24](#key-issue-6-management-of-enhanced-coverage)

[24](#description-5)

[24](#architectural-requirements-5)

[24](#architectural-baseline-5)

[25](#open-issues-5)

[25](#key-issue-7-overload-control-for-small-data)

[25](#description-6)

[25](#architectural-requirements-6)

[25](#architectural-baseline-6)

[25](#open-issues-6)

[26](#key-issue-8-support-of-the-reliable-data-service)

[26](#description-7)

[26](#architectural-requirements-7)

[26](#architectural-baseline-7)

[26](#open-issues-7)

[26](#key-issue-9-support-of-common-north-bound-apis-for-epc-5gc-interworking)

[26](#description-8)

[27](#architectural-requirements-8)

[27](#architectural-baseline-8)

[27](#open-issues-8)

[27](#key-issue-10-network-parameter-configuration-api-via-nef)

[27](#description-9)

[27](#architectural-requirements-9)

[28](#architectural-baseline-9)

[28](#open-issues-9)

[28](#key-issue-11-monitoring)

[28](#description-10)

[29](#architectural-requirements-10)

[29](#architectural-baseline-10)

[29](#open-issues-10)

[29](#key-issue-12-inter-rat-mobility-support-tofrom-nb-iot)

[29](#description-11)

[29](#architectural-requirements-11)

[29](#architectural-baseline-11)

[30](#open-issues-11)

[30](#key-issue-13-support-for-expected-ue-behaviour)

[30](#description-12)

[30](#architectural-requirements-12)

[30](#architectural-baseline-12)

[30](#open-issues-12)

[31](#key-issue-14-qos-support-for-nb-iot)

[31](#description-13)

[31](#architectural-requirements-13)

[31](#architectural-baseline-13)

[31](#open-issues-13)

[31](#key-issue-15-core-network-selection-for-cellular-iot)

[31](#description-14)

[32](#architectural-requirements-14)

[32](#architectural-baseline-14)

[32](#open-issues-14)

[32](#key-issue-16-support-of-group-communication-and-messaging)

[32](#description-15)

[33](#architectural-requirements-15)

[33](#architectural-baseline-15)

[33](#open-issues-15)

[33](#key-issue-17-msisdn-less-mo-sms)

[33](#description-16)

[33](#architectural-requirements-16)

[33](#architectural-baseline-16)

[34](#open-issues-16)

[34](#solutions)

[34](#solution-1-infrequent-small-data-transfer-via-nas-sm-and-n6)

[34](#introduction)

[34](#general)

[34](#architecture-reference-models)

[34](#general-1)

[35](#non-roaming-reference-architectures)

[35](#roaming-reference-architectures)

[36](#functional-description)

[38](#support-of-epc-interworking)

[39](#procedures)

[39](#general-2)

[39](#pdu-session-establishment)

[40](#mobile-originated-data-transport-via-nas-sm-and-n6)

[42](#mobile-terminated-data-transport-via-nas-sm-and-n6)

[43](#impacts-on-existing-entities-and-interfaces)

[44](#evaluation)

[45](#solution-2-infrequent-small-data-transfer-through-nas-and-a-direct-interface-between-amf-and-upf)

[45](#introduction-1)

[45](#functional-description-1)

[46](#support-of-epc-interworking-1)

[46](#procedures-1)

[46](#nx-tunnel-setup)

[47](#nx-tunnel-release)

[48](#mo-data-transport)

[49](#mt-data-transport)

[49](#nidd-support)

[50](#impacts-on-existing-entities-and-interfaces-1)

[51](#evaluation-1)

[51](#solution-3-infrequent-small-data-transmission-with-no-pdu-session-available)

[51](#introduction-2)

[51](#functional-description-2)

[51](#support-of-epc-interworking-2)

[51](#procedures-2)

[51](#registration-procedure)

[52](#mo-nsdd-procedure)

[54](#mt-small-data-transmission-procedure)

[54](#impacts-on-existing-entities-and-interfaces-2)

[55](#evaluation-2)

[55](#solution-4-reliable-data-service-support)

[55](#introduction-3)

[55](#functional-description-3)

[55](#support-of-reliable-data-service)

[55](#architecture-to-support-rds-over-5gc)

[57](#support-of-epc-interworking-3)

[58](#procedures-3)

[58](#registration-procedure-supporting-reliable-small-data-delivery-over-nas)

[59](#rds-configuration-procedure-between-nef-and-afas)

[60](#mo-reliable-small-data-delivery-procedure)

[61](#mt-reliable-small-data-delivery-procedure)

[61](#impacts-on-existing-entities-and-interfaces-3)

[62](#evaluation-3)

[62](#solution-5-small-data-fast-path-communication)

[62](#introduction-4)

[62](#functional-description-4)

[62](#general-3)

[63](#mobility)

[63](#security)

[63](#upf-and-pdu-session-information-in-the-ue)

[64](#support-of-epc-interworking-4)

[65](#procedures-4)

[65](#ue-requested-sdfp-pdu-session-establishment)

[66](#sdfp-transfer-initiated-by-ul-data)

[67](#alternative-1-sdfp-transfer-initiated-by-dl-data)

[69](#a-alternative-2-sdfp-transfer-initiated-by-dl-data)

[70](#impacts-on-existing-entities-and-interfaces-4)

[70](#evaluation-4)

[70](#solution-6-small-data-communication-based-on-data-pdu-routed-over-the-user-plane.)

[70](#introduction-5)

[70](#general-4)

[70](#protocol-stack-for-user-data)

[71](#architecture-reference-models-1)

[71](#functional-description-5)

[72](#support-of-epc-interworking-5)

[73](#procedures-5)

[73](#small-data-via-upf)

[73](#general-5)

[73](#assumptions)

[74](#pdu-session-establishment-1)

[75](#mobile-originated-data-transport)

[76](#b-mobile-originated-data-transport-using-edt-and-as-based-rai)

[77](#mobile-terminated-data-transport)

[78](#nidd-via-nef-specific-procedures)

[78](#general-6)

[78](#nx-session-establishment)

[79](#mobile-terminated-nidd-procedure)

[80](#mobile-originated-nidd-procedure)

[81](#impacts-on-existing-entities-and-interfaces-5)

[81](#evaluation-5)

[82](#solution-7-small-data-frequent-communication)

[82](#introduction-6)

[82](#functional-description-6)

[82](#support-of-epc-interworking-6)

[83](#procedures-6)

[83](#mo-transmissions)

[83](#general-7)

[83](#mo-transmission-with-rrc-inactive)

[84](#mo-transmission-with-early-data-transmission-and-rrc-inactive)

[86](#mt-transmissions)

[86](#general-8)

[86](#mt-transmission-with-cn-extended-buffering-at-rrc-inactive)

[87](#mt-transmission-with-ran-buffering-at-rrc-inactive)

[87](#impacts-on-existing-entities-and-interfaces-6)

[88](#evaluation-6)

[88](#solution-8-enhancing-mico-for-mobile-terminated-datasignaling)

[88](#introduction-7)

[88](#general-9)

[88](#functional-description-7)

[89](#support-of-epc-interworking-7)

[89](#procedures-7)

[89](#impacts-on-existing-entities-and-interfaces-7)

[89](#evaluation-7)

[90](#solution-9-enhanced-mico-mode-with-active-time)

[90](#introduction-8)

[90](#functional-description-8)

[91](#support-of-interworking)

[91](#procedures-8)

[91](#impacts-on-existing-entities-and-interfaces-8)

[92](#evaluation-8)

[92](#solution-10-solution-for-supporting-high-latency-communication)

[92](#introduction-9)

[92](#functional-description-9)

[92](#support-of-interworking-1)

[92](#procedures-9)

[92](#support-for-ue-reachability-notification-for-mobile-terminated-communication)

[93](#support-for-ue-availability-notification-procedure-after-ddn-failure)

[94](#impacts-on-existing-entities-and-interfaces-9)

[95](#evaluation-9)

[95](#solution-11-extended-buffering-in-smf-and-nef)

[95](#introduction-10)

[95](#functional-description-10)

[95](#support-of-interworking-2)

[95](#procedures-10)

[95](#data-transfer-via-n6-interface)

[96](#data-transfer-via-api)

[97](#impacts-on-existing-entities-and-interfaces-10)

[97](#evaluation-10)

[97](#solution-12-solution-for-management-of-enhanced-coverage-for-5gc)

[97](#introduction-11)

[97](#functional-description-11)

[97](#support-of-enhanced-coverage)

[97](#support-of-restriction-of-use-of-enhanced-coverage)

[98](#support-of-epc-interworking-8)

[98](#idle-mode-aspects)

[98](#connected-mode-aspects)

[98](#procedures-11)

[98](#procedure-for-restriction-of-use-of-enhanced-coverage)

[99](#enhanced-coverage-restriction-control-and-via-nef)

[100](#impacts-on-existing-entities-and-interfaces-11)

[101](#evaluation-11)

[101](#solution-13-scefnef-node)

[101](#introduction-12)

[102](#functional-description-12)

[103](#support-of-epc-interworking-9)

[103](#procedures-12)

[103](#impacts-on-existing-entities-and-interfaces-12)

[103](#evaluation-12)

[103](#solution-14-apisupportcapability-service)

[103](#introduction-13)

[103](#functional-description-13)

[105](#support-of-epc-interworking-10)

[105](#procedures-13)

[105](#subscribe-and-notify-service-operations-information-flow)

[106](#unsubscribe-service-operation-information-flow)

[107](#query-service-operation-information-flow)

[108](#impacts-on-existing-entities-and-interfaces-13)

[108](#evaluation-13)

[109](#solution-15-external-parameter-provisioning-in-the-5gc)

[109](#introduction-14)

[109](#functional-description-14)

[109](#support-of-epc-interworking-11)

[110](#procedures-14)

[111](#impacts-on-existing-entities-and-interfaces-14)

[112](#evaluation-14)

[112](#solution-16-ue-assisted-inter-ue-qos-support-for-data-over-nas)

[112](#introduction-15)

[112](#functional-description-15)

[113](#support-of-epc-interworking-12)

[113](#procedures-15)

[113](#qos-index-configuration-during-registration-procedure)

[113](#using-qos-index-in-mo-data-over-nas)

[114](#impacts-on-existing-entities-and-interfaces-15)

[115](#evaluation-15)

[115](#solution-17-ue-driven-packet-classification)

[115](#introduction-16)

[115](#functional-description-16)

[115](#support-of-epc-interworking-13)

[116](#procedures-16)

[117](#impacts-on-existing-entities-and-interfaces-16)

[117](#evaluation-16)

[118](#solution-18-qos-control-for-unstructured-pdu-sessions)

[118](#introduction-17)

[118](#functional-description-17)

[118](#qos-flow-mapping-for-unstructured-pdu-session)

[119](#qos-rule-for-unstructured-pdu-session)

[119](#achieving-reflective-qos)

[119](#field-position-based-packet-filters)

[120](#support-of-epc-interworking-14)

[120](#procedures-17)

[122](#impacts-on-existing-entities-and-interfaces-17)

[122](#evaluation-17)

[122](#solution-19-5gs-up-optimization-for-infrequent-small-data-transmission)

[122](#introduction-18)

[124](#functional-description-18)

[124](#general-10)

[124](#mobility-1)

[124](#security-1)

[124](#support-of-epc-interworking-15)

[125](#procedures-18)

[125](#pdu-session-establishment-2)

[126](#ul-data-transmission-from-cm-idle)

[127](#b-ul-data-transmission-from-cm-idle-with-early-data-transmission)

[128](#dl-data-transmission)

[130](#connection-suspend-procedure)

[130](#cn-initiated-up-deactivation-procedure)

[132](#impacts-on-existing-entities-and-interfaces-18)

[132](#evaluation-18)

[133](#solution-20-nidd-api-support-by-smf-for-infrequent-small-data-transfer-via-nas-sm)

[133](#introduction-19)

[133](#general-11)

[133](#architecture-reference-models-2)

[133](#general-12)

[133](#non-roaming-reference-architecture)

[133](#roaming-reference-architectures-1)

[134](#functional-description-19)

[134](#support-of-epc-interworking-16)

[135](#procedures-19)

[135](#pdu-session-establishment-non-roaming)

[136](#pdu-session-establishment-home-routed-roaming)

[137](#mobile-originated-data-transport-via-nas-sm-and-nidd-api)

[138](#mobile-terminated-data-transport-via-nas-sm-and-nidd-api)

[140](#nidd-configuration-procedure)

[142](#impacts-on-existing-entities-and-interfaces-19)

[142](#evaluation-19)

[142](#solution-21-nidd-service-activation)

[142](#introduction-20)

[143](#functional-description-20)

[143](#general-13)

[143](#mobility-2)

[143](#support-of-epc-interworking-17)

[143](#procedures-20)

[143](#nidd-service-activation-for-amf-based-solution)

[145](#nidd-service-activation-for-smf-based-solution)

[146](#bulk-subscription-of-nidd-service-activation)

[147](#impacts-on-existing-entities-and-interfaces-20)

[147](#evaluation-20)

[147](#solution-22-edrx-for-cm-idle-state-in-5gs)

[147](#introduction-21)

[147](#functional-description-21)

[148](#support-of-epc-interworking-18)

[148](#procedures-21)

[148](#impacts-on-existing-entities-and-interfaces-21)

[148](#evaluation-21)

[148](#solution-23-mico-mode-management-for-expected-application-behaviour)

[148](#introduction-22)

[149](#functional-description-22)

[149](#support-of-interworking-3)

[149](#procedures-22)

[150](#impacts-on-existing-entities-and-interfaces-22)

[150](#evaluation-22)

[151](#solution-24-high-latency-communication-with-extended-buffering-and-event-notifications)

[151](#introduction-23)

[151](#functional-description-23)

[152](#support-of-epc-interworking-19)

[152](#procedures-23)

[152](#extended-buffering)

[152](#general-14)

[152](#dl-data-in-cm-idle-mode)

[154](#dl-data-in-cm-connected-mode-without-cn-extended-buffering)

[154](#dl-data-in-cm-connected-mode-with-cn-extended-buffering)

[156](#notification-procedures)

[156](#general-15)

[156](#event-subscription-and-notification-of-ue-reachability)

[157](#notification-of-availability-after-ddn-failure)

[160](#configuration-for-notification-related-approaches)

[161](#notification-of-availability-after-mt-control-plane-signalling)

[163](#impacts-on-existing-entities-and-interfaces-23)

[164](#evaluation-23)

[165](#solution-25-hlcom-buffering-and-event-notification-support-for-cm-idle)

[165](#introduction-24)

[165](#functional-description-24)

[165](#support-of-epc-interworking-20)

[165](#procedures-24)

[165](#extended-data-buffering-at-upf)

[167](#a-extended-data-buffering-at-nef)

[167](#af-notification-from-amf)

[167](#general-17)

[167](#event-subscription-of-ue-reachability)

[167](#mt-data-transfer-with-notification-of-ue-availability)

[168](#event-subscription-of-availability-notification-after-ddn-failure)

[168](#notification-about-availability-notification-after-ddn-failure)

[168](#af-notification-from-smf)

[168](#application-notification-overall-procedure)

[169](#event-subscription-for-data-delivery-status)

[170](#monitoring-report-procedure-for-data-delivery-status)

[172](#impacts-on-existing-entities-and-interfaces-24)

[172](#evaluation-24)

[172](#solution-26-expected-ue-behaviour-provisioning-for-ciot)

[172](#introduction-25)

[173](#functional-description-25)

[174](#support-of-epc-interworking-21)

[174](#procedures-25)

[174](#impacts-on-existing-entities-and-interfaces-25)

[175](#evaluation-25)

[175](#solution-27-reuse-of-eps-overload-control-mechanisms)

[175](#introduction-26)

[175](#functional-description-26)

[175](#small-data-rate-control)

[175](#service-gap-control)

[175](#amf-and-smf-overload)

[176](#control-plane-data-back-off-timer)

[176](#low-access-priority)

[176](#support-of-epc-interworking-22)

[176](#procedures-26)

[176](#small-data-rate-control-1)

[176](#general-18)

[177](#service-gap-control-1)

[177](#general-19)

[177](#overload-procedure)

[177](#general-20)

[177](#low-access-priority-1)

[177](#general-21)

[177](#control-plane-data-back-off-timer-procedure)

[177](#impacts-on-existing-entities-and-interfaces-26)

[178](#evaluation-26)

[178](#solution-28-smf-assisted-ng-ran-information)

[178](#introduction-27)

[178](#functional-description-27)

[179](#support-of-epc-interworking-23)

[179](#procedures-27)

[181](#impacts-on-existing-entities-and-interfaces-27)

[182](#evaluation-27)

[182](#solution-29-user-plane-data-transmission-with-connectionless-signalling)

[182](#introduction-28)

[182](#functional-description-28)

[186](#support-of-epc-interworking-24)

[186](#procedures-28)

[186](#identities)

[186](#upf-cl-service-id-uclsi)

[186](#assumptions-1)

[186](#procedures-29)

[186](#set-up-of-a-pdu-sessions-with-connectionless-mode-data-transfer-on-the-ran-core-interface)

[189](#ue-connectionless-uplink-data-transfer)

[190](#ue-connectionless-downlink-data-transfer)

[192](#paging-for-ue-connectionless-downlink-data-transfer)

[193](#mobility-support)

[193](#upf-triggered-release-and-redirection-during-ue-connectionless-active-mode)

[194](#impacts-on-existing-entities-and-interfaces-28)

[194](#impact-on-interfaces)

[194](#impact-on-entities)

[194](#evaluation-28)

[194](#solution-30-nef-based-infrequent-small-data-transfer-via-nas-sm)

[194](#introduction-29)

[194](#general-22)

[195](#architecture-reference-models-3)

[195](#general-23)

[195](#non-roaming-reference-architectures-1)

[196](#roaming-reference-architectures-2)

[196](#functional-description-29)

[196](#support-of-epc-interworking-25)

[197](#procedures-30)

[197](#pdu-session-establishment-non-roaming-1)

[198](#pdu-session-establishment-home-routed-roaming-1)

[200](#mobile-originated-data-transport-via-nas-sm-and-n6-nef-anchored)

[200](#mobile-terminated-data-transport-via-nas-sm-and-n6-nef-anchored)

[200](#nidd-configuration-for-data-transport-via-nas-sm)

[200](#smf-nef-connection)

[201](#nidd-configuration-by-nef)

[202](#impacts-on-existing-entities-and-interfaces-29)

[202](#evaluation-29)

[202](#solution-31-deferring-of-periodic-registration-update)

[202](#introduction-30)

[202](#functional-description-30)

[203](#support-of-interworking-4)

[203](#procedures-31)

[203](#impacts-on-existing-entities-and-interfaces-30)

[204](#evaluation-30)

[204](#solution-32-mo-data-buffering-in-the-ue)

[204](#introduction-31)

[204](#functional-description-31)

[204](#support-of-epc-interworking-26)

[204](#procedures-32)

[205](#impacts-on-existing-entities-and-interfaces-31)

[205](#evaluation-31)

[205](#solution-33-delayed-paging-response)

[205](#introduction-32)

[206](#functional-description-32)

[206](#support-of-epc-interworking-27)

[206](#procedures-33)

[207](#impacts-on-existing-entities-and-interfaces-32)

[208](#evaluation-32)

[208](#solution-34-provisioning-of-ue-tx-power-saving-parameters)

[208](#introduction-33)

[208](#functional-description-33)

[209](#support-of-epc-interworking-28)

[209](#procedures-34)

[209](#impacts-on-existing-entities-and-interfaces-33)

[209](#evaluation-33)

[209](#solution-35-small-data-delivery)

[209](#introduction-34)

[209](#functional-description-34)

[209](#architecture)

[211](#small-data-delivery)

[212](#support-of-epc-interworking-29)

[212](#procedures-35)

[212](#connection-establishment-for-upf-and-nef)

[214](#mo-small-data-transfer)

[215](#impacts-on-existing-entities-and-interfaces-34)

[215](#evaluation-34)

[215](#solution-36-cm-connected-with-rrc-inactive-state-for-frequent-small-data-transmission)

[215](#introduction-35)

[215](#functional-description-35)

[216](#support-of-epc-interworking-30)

[216](#procedures-36)

[216](#connection-inactive-procedure)

[216](#connection-resume-procedure)

[217](#cn-initiated-deactivation-of-up-connection-when-the-ue-is-in-rrc-inactive-state)

[219](#impacts-on-existing-entities-and-interfaces-35)

[219](#evaluation-35)

[219](#solution-37-monitoring)

[219](#introduction-36)

[219](#functional-description-36)

[220](#support-of-epc-interworking-31)

[220](#general-24)

[220](#interworking-with-n26-interface)

[220](#interworking-without-n26-interface)

[220](#procedures-37)

[220](#monitoring-events-at-amf)

[220](#monitoring-events-at-udm)

[220](#monitoring-events-at-pcf)

[220](#general-25)

[221](#pcf-service-operations-information-flow)

[222](#impacts-on-existing-entities-and-interfaces-36)

[222](#evaluation-36)

[222](#solution-38-edrx-rrc_inactive-state-in-5gs)

[222](#introduction-37)

[222](#functional-description-37)

[223](#support-of-epc-interworking-32)

[223](#procedures-38)

[223](#impacts-on-existing-entities-and-interfaces-37)

[224](#evaluation-37)

[224](#solution-39-ue-availability-after-ddn-failure-for-multiple-afs)

[224](#introduction-38)

[224](#functional-description-38)

[224](#support-of-epc-interworking-33)

[225](#procedures-39)

[225](#event-configuration)

[226](#notification)

[227](#impacts-on-existing-entities-and-interfaces-38)

[227](#evaluation-38)

[228](#solution-40-infrequent-small-data-transmission-with-temporary-pdu-session)

[228](#introduction-39)

[228](#functional-description-39)

[228](#support-of-epc-interworking-34)

[229](#procedures-40)

[230](#impacts-on-existing-entities-and-interfaces-39)

[230](#evaluation-39)

[231](#solution-41-combining-rrc-inactive-and-5g-up-optimization)

[231](#introduction-40)

[231](#functional-description-40)

[232](#support-of-epc-interworking-35)

[232](#procedures-41)

[232](#impacts-on-existing-entities-and-interfaces-40)

[232](#evaluation-40)

[232](#solution-42-nas-based-redirection-between-core-networks)

[232](#introduction-41)

[232](#functional-description-41)

[232](#support-of-epc-interworking-36)

[233](#procedures-42)

[233](#redirection-using-nas-indication)

[233](#general-26)

[233](#redirection-from-epc-to-5gc-network)

[234](#redirection-from-5gc-to-epc-network)

[234](#interaction-with-steering-of-roaming)

[234](#impacts-on-existing-entities-and-interfaces-41)

[235](#evaluation-41)

[235](#solution-43-rrc-based-redirection-between-core-networks)

[235](#introduction-42)

[235](#functional-description-42)

[235](#support-of-epc-interworking-37)

[235](#procedures-43)

[235](#redirection-using-rrc-indication)

[235](#general-27)

[236](#redirection-from-epc-to-5gc-network-1)

[237](#redirection-from-5gc-to-epc-network-1)

[237](#impacts-on-existing-entities-and-interfaces-42)

[238](#evaluation-42)

[238](#solution-44-c-iot-ue-core-network-selection-based-on-s-nssais)

[238](#introduction-43)

[238](#functional-description-43)

[238](#general-28)

[239](#g-cellular-iot-support-information-based-on-s-nssais)

[239](#support-of-epc-interworking-38)

[239](#procedures-44)

[241](#impacts-on-existing-entities-and-interfaces-43)

[241](#evaluation-43)

[241](#solution-45-core-network-type-and-node-selection-for-ciot-ue-using-explicit-indications)

[241](#introduction-44)

[241](#functional-description-44)

[241](#support-of-epc-interworking-39)

[241](#procedures-45)

[241](#registration-procedure-1)

[242](#core-network-type-selection-at-ue-and-amf-selection-at-ran)

[242](#impacts-on-existing-entities-and-interfaces-44)

[243](#evaluation-44)

[243](#solution-46-network-controlled-ul-data-transmission-delay)

[243](#introduction-45)

[243](#functional-description-45)

[243](#support-of-epc-interworking-40)

[243](#procedures-46)

[244](#impacts-on-existing-entities-and-interfaces-45)

[245](#evaluation-45)

[245](#solution-47-improved-signallingdata-plane-separation-for-data-over-nas-small-data-solutions)

[245](#introduction-46)

[245](#functional-description-46)

[245](#support-of-epc-interworking-41)

[245](#procedures-47)

[246](#impacts-on-existing-entities-and-interfaces-46)

[246](#evaluation-46)

[247](#solution-48-nb-iot-idle-mode-inter-rat-mobility-reusing-eps-features)

[247](#introduction-47)

[247](#functional-description-47)

[247](#general-29)

[247](#ue-radio-capability-handling)

[247](#pdu-session-handling)

[247](#determining-rat-type-change)

[248](#support-of-epc-interworking-42)

[248](#procedures-48)

[248](#rat-change-with-mobility-between-5gc-and-epc-with-n26)

[248](#rat-change-with-mobility-between-5gc-and-epc-without-n26)

[249](#rat-change-without-mobility-between-5gc-and-epc)

[249](#determining-rat-type-change-1)

[249](#impacts-on-existing-entities-and-interfaces-47)

[249](#evaluation-47)

[250](#solution-49-support-for-rds-with-infrequent-small-data-transmission-solutions-1-2-3)

[250](#introduction-48)

[250](#functional-description-48)

[251](#support-of-epc-interworking-43)

[252](#procedures-49)

[252](#impacts-on-existing-entities-and-interfaces-48)

[252](#evaluation-48)

[252](#solution-50-af-notifications-after-ddn-failure)

[252](#introduction-49)

[252](#functional-description-49)

[253](#support-of-epc-interworking-44)

[253](#procedures-50)

[253](#event-configuration-1)

[254](#notification-1)

[255](#impacts-on-existing-entities-and-interfaces-49)

[256](#evaluation-49)

[256](#solution-51-core-network-steering-via-cn-type-selection-rules-configurationreconfiguration)

[256](#introduction-50)

[256](#functional-description-50)

[258](#support-of-epc-interworking-45)

[258](#procedures-51)

[258](#impacts-on-existing-entities-and-interfaces-50)

[258](#evaluation-50)

[258](#solution-52-inter-ue-qos-differentiation-based-on-retrieval-of-ue-context)

[258](#introduction-51)

[259](#functional-description-51)

[259](#support-of-epc-interworking-46)

[259](#procedures-52)

[259](#provision-of-ue-context-to-amf)

[260](#retrieval-of-ue-context-from-amf-and-inter-ue-qos-differentiation)

[261](#impacts-on-existing-entities-and-interfaces-51)

[261](#evaluation-51)

[261](#evaluation-52)

[261](#key-issue-1-support-for-infrequent-small-data-transmission-1)

[263](#key-issue-2-frequent-small-data-communication-1)

[263](#overview)

[264](#enhancements-of-existing-procedures)

[264](#optimised-up-data-solutions)

[264](#upf-nef-interface)

[264](#key-issue-3-high-latency-communication-1)

[266](#key-issue-4-power-saving-functions-1)

[266](#key-issue-5-ue-tx-power-saving-functions-1)

[267](#key-issue-6-management-of-enhanced-coverage-1)

[267](#key-issue-7-overload-control-for-small-data-1)

[267](#key-issue-8-support-of-the-reliable-data-service-1)

[267](#key-issue-9-support-of-common-north-bound-apis-for-epc-5gc-interworking-1)

[267](#key-issue-10-network-parameter-configuration-api-via-nef-1)

[267](#overview-1)

[268](#evaluation-relative-to-key-issue-3-high-latency-communication)

[268](#evaluation-relative-to-key-issue-4-power-savings-functions)

[268](#key-issue-11-monitoring-1)

[268](#key-issue-12-inter-rat-mobility-support-tofrom-nb-iot-1)

[268](#key-issue-13-support-for-expected-ue-behaviour-1)

[269](#key-issue-14-qos-support-for-nb-iot-1)

[269](#key-issue-15-core-network-selection-for-cellular-iot-1)

[270](#key-issue-16-support-of-group-communication-and-messaging-1)

[270](#key-issue-17-msisdn-less-mo-sms-1)

[270](#conclusions)

[270](#key-issue-1-support-for-infrequent-small-data-transmission-2)

[270](#key-issue-2-frequent-small-data-communication-2)

[270](#key-issue-3-high-latency-communication-2)

[271](#key-issue-4-power-saving-functions-2)

[271](#key-issue-5-ue-tx-power-saving-functions-2)

[271](#key-issue-6-management-of-enhanced-coverage-2)

[271](#key-issue-7-overload-control-for-small-data-2)

[272](#key-issue-8-support-of-the-reliable-data-service-2)

[272](#key-issue-9-support-of-common-north-bound-apis-for-epc-5gc-interworking-2)

[272](#key-issue-10-network-parameter-configuration-api-via-nef-2)

[272](#key-issue-11-monitoring-2)

[272](#key-issue-12-inter-rat-mobility-support-tofrom-nb-iot-2)

[272](#key-issue-13-support-for-expected-ue-behaviour-2)

[273](#key-issue-14-qos-support-for-nb-iot-2)

[273](#key-issue-15-core-network-selection-for-cellular-iot-2)

[273](#key-issue-16-support-of-group-communication-and-messaging-2)

[273](#key-issue-17-msisdn-less-mo-sms-2)

[274](#annex-a-change-history)Foreword 1 Scope 2 References 3
Definitions, symbols and abbreviations 3.1 Definitions 3.2 Symbols 3.3
Abbreviations 4 Architectural Assumptions and Principles 5 Key Issues
5.1 Key Issue 1: Support for infrequent small data transmission 5.1.1
Description 5.1.2 Architectural requirements 5.1.3 Architectural
baseline 5.1.4 Open issues 5.2 Key Issue 2: Frequent small data
communication 5.2.1 Description 5.2.2 Architectural requirements 5.2.3
Architectural baseline 5.2.4 Open issues 5.3 Key Issue 3: High latency
communication 5.3.1 Description 5.3.2 Architectural requirements 5.3.3
Architectural baseline 5.3.4 Open issues 5.4 Key Issue 4: Power Saving
Functions 5.4.1 Description 5.4.2 Architectural requirements 5.4.3
Architectural baseline 5.4.4 Open issues 5.5 Key Issue 5: UE TX Power
Saving Functions 5.5.1 Description 5.5.2 Architectural requirements
5.5.3 Architectural baseline 5.5.4 Open issues 5.6 Key Issue 6:
Management of Enhanced Coverage 5.6.1 Description 5.6.2 Architectural
requirements 5.6.3 Architectural baseline 5.6.4 Open issues 5.7 Key
Issue 7: Overload Control for small data 5.7.1 Description 5.7.2
Architectural requirements 5.7.3 Architectural baseline 5.7.4 Open
issues 5.8 Key Issue 8: Support of the Reliable Data Service 5.8.1
Description 5.8.2 Architectural requirements 5.8.3 Architectural
baseline 5.8.4 Open issues 5.9 Key Issue 9: Support of common
north-bound APIs for EPC-5GC Interworking 5.9.1 Description 5.9.2
Architectural requirements 5.9.3 Architectural baseline 5.9.4 Open
issues 5.10 Key Issue 10: Network Parameter Configuration API via NEF
5.10.1 Description 5.10.2 Architectural requirements 5.10.3
Architectural baseline 5.10.4 Open issues 5.11 Key Issue 11: Monitoring
5.11.1 Description 5.11.2 Architectural requirements 5.11.3
Architectural baseline 5.11.4 Open issues 5.12 Key Issue 12: Inter-RAT
mobility support to/from NB-IoT 5.12.1 Description 5.12.2 Architectural
requirements 5.12.3 Architectural baseline 5.12.4 Open issues 5.13 Key
Issue 13: Support for Expected UE Behaviour 5.13.1 Description 5.13.2
Architectural requirements 5.13.3 Architectural baseline 5.13.4 Open
issues 5.14 Key Issue 14: QoS Support for NB-IoT 5.14.1 Description
5.14.2 Architectural requirements 5.14.3 Architectural baseline 5.14.4
Open issues 5.15 Key Issue 15: Core Network selection for Cellular IoT
5.15.1 Description 5.15.2 Architectural requirements 5.15.3
Architectural baseline 5.15.4 Open issues 5.16 Key Issue 16: Support of
Group communication and messaging 5.16.1 Description 5.16.2
Architectural requirements 5.16.3 Architectural baseline 5.16.4 Open
issues 5.17 Key Issue 17: MSISDN-less MO SMS 5.17.1 Description 5.17.2
Architectural requirements 5.17.3 Architectural baseline 5.17.4 Open
issues 6 Solutions 6.1 Solution 1: Infrequent small data transfer via
NAS-SM and N6 6.1.1 Introduction 6.1.1.1 General 6.1.1.2 Architecture
reference models 6.1.1.2.0 General 6.1.1.2.1 Non-roaming reference
architectures 6.2.1.2.2 Roaming reference architectures 6.1.2 Functional
Description 6.1.3 Support of EPC interworking 6.1.4 Procedures 6.1.4.0
General 6.1.4.1 PDU Session Establishment 6.1.4.2 Mobile Originated Data
Transport via NAS-SM and N6 6.1.4.3 Mobile Terminated Data Transport via
NAS-SM and N6 6.1.5 Impacts on existing entities and interfaces 6.1.6
Evaluation 6.2 Solution 2: Infrequent small data transfer through NAS
and a direct interface between AMF and UPF 6.2.1 Introduction 6.2.2
Functional Description 6.2.3 Support of EPC interworking 6.2.4
Procedures 6.2.4.1 Nx tunnel setup 6.2.4.2 Nx tunnel release 6.2.4.3 MO
data transport 6.2.4.4 MT data transport 6.2.4.5 NIDD support 6.2.5
Impacts on existing entities and interfaces 6.2.6 Evaluation 6.3
Solution 3: Infrequent small data transmission with no PDU session
available 6.3.1 Introduction 6.3.2 Functional Description 6.3.3 Support
of EPC interworking 6.3.4 Procedures 6.3.4.1 Registration Procedure
6.3.4.2 MO NSDD procedure 6.3.4.3 MT Small data transmission procedure
6.3.5 Impacts on existing entities and interfaces 6.3.6 Evaluation 6.4
Solution 4: Reliable Data Service Support 6.4.1 Introduction 6.4.2
Functional Description 6.4.2.1 Support of Reliable Data Service 6.4.2.2
Architecture to support RDS over 5GC 6.4.3 Support of EPC interworking
6.4.4 Procedures 6.4.4.1 Registration procedure supporting reliable
small data delivery over NAS 6.4.4.2 RDS Configuration procedure between
NEF and AF/AS 6.4.4.3 MO reliable small data delivery procedure 6.4.4.4
MT reliable small data delivery procedure 6.4.5 Impacts on existing
entities and interfaces 6.4.6 Evaluation 6.5 Solution 5: Small Data Fast
Path communication 6.5.1 Introduction 6.5.2 Functional Description
6.5.2.1 General 6.5.2.2 Mobility 6.5.2.3 Security 6.5.2.4 UPF and PDU
Session information in the UE 6.5.3 Support of EPC interworking 6.5.4
Procedures 6.5.4.1 UE requested SDFP PDU session establishment 6.5.4.2
SDFP transfer initiated by UL data 6.5.4.3 Alternative 1: SDFP transfer
initiated by DL data 6.5.4.3a Alternative 2: SDFP transfer initiated by
DL data 6.5.5 Impacts on existing entities and interfaces 6.5.6
Evaluation 6.6 Solution 6: Small Data Communication based on Data PDU
routed over the User Plane. 6.6.1 Introduction 6.6.1.1 General 6.6.1.2
Protocol stack for User data 6.6.1.3 Architecture reference models 6.6.2
Functional Description 6.6.3 Support of EPC interworking 6.6.4
Procedures 6.6.4.1 Small Data via UPF 6.6.4.1.1 General 6.6.4.1.2
Assumptions 6.6.4.1.3 PDU Session Establishment 6.6.4.1.4 Mobile
Originated Data Transport 6.6.4.1.4b Mobile Originated Data Transport,
using EDT and AS based RAI 6.6.4.1.5 Mobile Terminated Data Transport
6.6.4.2 NIDD via NEF specific procedures 6.6.4.2.1 General 6.6.4.2.2 Nx
Session Establishment 6.6.4.2.3 Mobile Terminated NIDD procedure
6.6.4.2.4 Mobile Originated NIDD procedure 6.6.5 Impacts on existing
entities and interfaces 6.6.6 Evaluation 6.7 Solution 7: Small data
frequent communication 6.7.1 Introduction 6.7.2 Functional Description
6.7.3 Support of EPC interworking 6.7.4 Procedures 6.7.4.1 MO
transmissions 6.7.4.1.0 General 6.7.4.1.1 MO transmission with RRC
Inactive 6.7.4.1.2 MO transmission with Early Data Transmission and RRC
Inactive 6.7.4.2 MT transmissions 6.7.4.2.0 General 6.7.4.2.1 MT
transmission with CN extended buffering at RRC Inactive 6.7.4.2.2 MT
transmission with RAN buffering at RRC Inactive 6.7.5 Impacts on
existing entities and interfaces 6.7.6 Evaluation 6.8 Solution 8:
Enhancing MICO for Mobile terminated data/signaling 6.8.1 Introduction
6.8.1.1 General 6.8.2 Functional Description 6.8.3 Support of EPC
interworking 6.8.4 Procedures 6.8.5 Impacts on existing entities and
interfaces 6.8.6 Evaluation 6.9 Solution 9: Enhanced MICO mode with
Active Time 6.9.1 Introduction 6.9.2 Functional Description 6.9.3
Support of interworking 6.9.4 Procedures 6.9.5 Impacts on existing
entities and interfaces 6.9.6 Evaluation 6.10 Solution 10: Solution for
supporting High Latency Communication 6.10.1 Introduction 6.10.2
Functional Description 6.10.3 Support of interworking 6.10.4 Procedures
6.10.4.1 Support for UE Reachability Notification for Mobile Terminated
Communication 6.10.4.2 Support for UE Availability Notification
Procedure after DDN Failure 6.10.5 Impacts on existing entities and
interfaces 6.10.6 Evaluation 6.11 Solution 11: Extended buffering in SMF
and NEF 6.11.1 Introduction 6.11.2 Functional Description 6.11.3 Support
of interworking 6.11.4 Procedures 6.11.4.1 Data Transfer via N6
interface 6.11.4.2 Data Transfer via API 6.11.5 Impacts on existing
entities and interfaces 6.11.6 Evaluation 6.12 Solution 12: Solution for
Management of Enhanced Coverage for 5GC 6.12.1 Introduction 6.12.2
Functional Description 6.12.2.1 Support of Enhanced Coverage 6.12.2.2
Support of restriction of use of Enhanced Coverage 6.12.3 Support of EPC
interworking 6.12.3.1 IDLE Mode aspects 6.12.3.2 CONNECTED Mode aspects
6.12.4 Procedures 6.12.4.1 Procedure for restriction of use of Enhanced
Coverage 6.12.4.2 Enhanced Coverage Restriction Control and via NEF
6.12.5 Impacts on existing entities and interfaces 6.12.6 Evaluation
6.13 Solution 13: SCEF+NEF Node 6.13.1 Introduction 6.13.2 Functional
Description 6.13.3 Support of EPC interworking 6.13.4 Procedures 6.13.5
Impacts on existing entities and interfaces 6.13.6 Evaluation 6.14
Solution 14: APISupportCapability service 6.14.1 Introduction 6.14.2
Functional Description 6.14.3 Support of EPC interworking 6.14.4
Procedures 6.14.4.1 Subscribe and Notify service operations information
flow 6.14.4.2 Unsubscribe service operation information flow 6.14.4.3
Query service operation information flow 6.14.5 Impacts on existing
entities and interfaces 6.14.6 Evaluation 6.15 Solution 15: External
parameter provisioning in the 5GC 6.15.1 Introduction 6.15.2 Functional
Description 6.15.3 Support of EPC interworking 6.15.4 Procedures 6.15.5
Impacts on existing entities and interfaces 6.15.6 Evaluation 6.16
Solution 16: UE assisted Inter-UE QoS Support for Data over NAS 6.16.1
Introduction 6.16.2 Functional Description 6.16.3 Support of EPC
interworking 6.16.4 Procedures 6.16.4.1 QoS Index configuration during
Registration Procedure 6.16.4.2 Using QoS index in MO Data over NAS
6.16.5 Impacts on existing entities and interfaces 6.16.6 Evaluation
6.17 Solution 17: UE-Driven Packet Classification 6.17.1 Introduction
6.17.2 Functional Description 6.17.3 Support of EPC interworking 6.17.4
Procedures 6.17.5 Impacts on existing entities and interfaces 6.17.6
Evaluation 6.18 Solution 18: QoS control for unstructured PDU sessions
6.18.1 Introduction 6.18.2 Functional Description 6.18.2.1 QoS Flow
mapping for unstructured PDU Session 6.18.2.2 QoS Rule for Unstructured
PDU Session 6.18.2.2.1 Achieving Reflective QoS 6.18.2.3 Field position
based Packet Filters 6.18.3 Support of EPC interworking 6.18.4
Procedures 6.18.5 Impacts on existing entities and interfaces 6.18.6
Evaluation 6.19 Solution 19: 5GS UP Optimization for Infrequent Small
Data Transmission 6.19.1 Introduction 6.19.2 Functional Description
6.19.2.1 General 6.19.2.2 Mobility 6.19.2.3 Security 6.19.3 Support of
EPC Interworking 6.19.4 Procedures 6.19.4.1 PDU Session Establishment
6.19.4.2 UL data transmission from CM-IDLE 6.19.4.2b UL data
transmission from CM-IDLE with Early Data Transmission 6.19.4.3 DL data
transmission 6.19.4.4 Connection Suspend procedure 6.19.4.5 CN-initiated
UP Deactivation procedure 6.19.5 Impacts on existing entities and
interfaces 6.19.6 Evaluation 6.20 Solution 20: NIDD API support by SMF
for infrequent small data transfer via NAS-SM 6.20.1 Introduction
6.20.1.1 General 6.20.1.2 Architecture reference models 6.20.1.2.1
General 6.20.1.2.2 Non-roaming reference architecture 6.20.1.2.3 Roaming
reference architectures 6.20.2 Functional Description 6.20.3 Support of
EPC interworking 6.20.4 Procedures 6.20.4.1 PDU Session Establishment
(non-roaming) 6.20.4.2 PDU Session Establishment (home-routed roaming)
6.20.4.3 Mobile Originated Data Transport via NAS-SM and NIDD API
6.20.4.4 Mobile Terminated Data Transport via NAS-SM and NIDD API
6.20.4.5 NIDD configuration procedure 6.20.5 Impacts on existing
entities and interfaces 6.20.6 Evaluation 6.21 Solution 21: NIDD service
activation 6.21.1 Introduction 6.21.2 Functional Description 6.21.2.1
General 6.21.2.2 Mobility 6.21.3 Support of EPC Interworking 6.21.4
Procedures 6.21.4.1 NIDD service activation for AMF based solution
6.21.4.2 NIDD service activation for SMF based solution 6.21.4.3 Bulk
subscription of NIDD service activation 6.21.5 Impacts on existing
entities and interfaces 6.21.6 Evaluation 6.22 Solution 22: eDRX for
CM-IDLE state in 5GS 6.22.1 Introduction 6.22.2 Functional Description
6.22.3 Support of EPC interworking 6.22.4 Procedures 6.22.5 Impacts on
existing entities and interfaces 6.22.6 Evaluation 6.23 Solution 23:
MICO Mode Management for Expected Application Behaviour 6.23.1
Introduction 6.23.2 Functional Description 6.23.3 Support of
interworking 6.23.4 Procedures 6.23.5 Impacts on existing entities and
interfaces 6.23.6 Evaluation 6.24 Solution 24: High latency
communication with extended buffering and event notifications 6.24.1
Introduction 6.24.2 Functional Description 6.24.3 Support of EPC
interworking 6.24.4 Procedures 6.24.4.1 Extended buffering 6.24.4.1.1
General 6.24.4.1.2 DL data in CM-IDLE mode 6.24.4.1.3 DL data in
CM-CONNECTED mode without CN extended buffering 6.24.4.1.4 DL data in
CM-CONNECTED mode with CN Extended buffering 6.24.4.2 Notification
procedures 6.24.4.2.1 General 6.24.4.2.2 Event Subscription and
Notification of UE reachability 6.24.4.2.3 Notification of Availability
after DDN failure 6.24.4.2.4 Configuration for notification related
approaches 6.24.4.3 Notification of Availability after MT control plane
signalling 6.24.5 Impacts on existing entities and interfaces 6.24.6
Evaluation 6.25 Solution 25: HLCom buffering and event notification
support for CM-IDLE 6.25.1 Introduction 6.25.2 Functional Description
6.25.3 Support of EPC interworking 6.25.4 Procedures 6.25.4.1 Extended
data buffering at UPF 6.25.4.1A Extended data buffering at NEF 6.25.4.2
AF notification from AMF 6.25.4.2.1 General 6.25.4.2.2 Event
Subscription of UE reachability 6.25.4.2.3 MT data transfer with
Notification of UE availability 6.25.4.2.4 Event Subscription of
\"Availability Notification after DDN Failure\" 6.25.4.2.5 Notification
about \"Availability Notification after DDN Failure\" 6.25.4.3 AF
notification from SMF 6.25.4.3.1 Application Notification overall
procedure 6.25.4.3.2 Event subscription for data delivery status
6.25.4.3.3 Monitoring report procedure for data delivery status 6.25.5
Impacts on existing entities and interfaces 6.25.6 Evaluation 6.26
Solution 26: Expected UE Behaviour provisioning for CIoT 6.26.1
Introduction 6.26.2 Functional Description 6.26.3 Support of EPC
interworking 6.26.4 Procedures 6.26.5 Impacts on existing entities and
interfaces 6.26.6 Evaluation 6.27 Solution 27: Reuse of EPS Overload
Control Mechanisms 6.27.1 Introduction 6.27.2 Functional Description
6.27.2.1 Small Data Rate Control 6.27.2.2 Service Gap Control 6.27.2.3
AMF and SMF Overload 6.27.2.4 Control plane data back-off timer 6.27.2.5
Low Access Priority 6.27.3 Support of EPC interworking 6.27.4 Procedures
6.27.4.1 Small Data Rate Control 6.27.4.1.1 General 6.27.4.2 Service Gap
Control 6.27.4.2.1 General 6.27.4.3 Overload procedure 6.27.4.3.1
General 6.27.4.4 Low access priority 6.27.4.3.1 General 6.27.4.5 Control
plane data back-off timer procedure 6.27.5 Impacts on existing entities
and interfaces 6.27.6 Evaluation 6.28 Solution 28: SMF assisted NG-RAN
information 6.28.1 Introduction 6.28.2 Functional Description 6.28.3
Support of EPC interworking 6.28.4 Procedures 6.28.5 Impacts on existing
entities and interfaces 6.28.6 Evaluation 6.29 Solution 29: User Plane
data transmission with ConnectionLess signalling 6.29.1 Introduction
6.29.2 Functional Description 6.29.3 Support of EPC interworking 6.29.4
Procedures 6.29.4.1 Identities 6.29.4.1.1 UPF CL SERVICE Id (UCLSI)
6.29.4.2 Assumptions 6.29.4.3 Procedures 6.29.4.3.1 Set-up of a PDU
sessions with Connectionless mode data transfer on the RAN-Core
interface 6.29.4.3.2 UE connectionless uplink data transfer 6.29.4.3.3
UE connectionless downlink data transfer 6.29.4.3.4 Paging for UE
connectionless downlink data transfer 6.29.4.3.5 Mobility support
6.29.4.4.6 UPF Triggered Release and Redirection During UE
Connectionless Active Mode 6.29.5 Impacts on existing entities and
interfaces 6.29.5.1 Impact on interfaces 6.29.5.2 Impact on entities
6.29.6 Evaluation 6.30 Solution 30: NEF based infrequent small data
transfer via NAS-SM 6.30.1 Introduction 6.30.1.1 General 6.30.1.2
Architecture reference models 6.1.1.2.0 General 6.30.1.2.1 Non-roaming
reference architectures 6.30.1.2.2 Roaming reference architectures
6.30.2 Functional Description 6.30.3 Support of EPC interworking 6.30.4
Procedures 6.30.4.1 PDU Session Establishment (non-roaming) 6.30.4.2 PDU
Session Establishment (home-routed roaming) 6.30.4.3 Mobile Originated
Data Transport via NAS-SM and N6 (NEF Anchored) 6.30.4.4 Mobile
Terminated Data Transport via NAS-SM and N6 (NEF Anchored) 6.30.4.5 NIDD
Configuration for Data Transport via NAS-SM 6.30.4.6 SMF-NEF Connection
6.30.4.7 NIDD Configuration by NEF 6.30.5 Impacts on existing entities
and interfaces 6.30.6 Evaluation 6.31 Solution 31: Deferring of Periodic
Registration Update 6.31.1 Introduction 6.31.2 Functional Description
6.31.3 Support of interworking 6.31.4 Procedures 6.31.5 Impacts on
existing entities and interfaces 6.31.6 Evaluation 6.32 Solution 32: MO
Data Buffering in the UE 6.32.1 Introduction 6.32.2 Functional
Description 6.32.3 Support of EPC interworking 6.32.4 Procedures 6.32.5
Impacts on existing entities and interfaces 6.32.6 Evaluation 6.33
Solution 33: Delayed Paging Response 6.33.1 Introduction 6.33.2
Functional Description 6.33.3 Support of EPC interworking 6.33.4
Procedures 6.33.5 Impacts on existing entities and interfaces 6.33.6
Evaluation 6.34 Solution 34: Provisioning of UE TX power saving
parameters 6.34.1 Introduction 6.34.2 Functional Description 6.34.3
Support of EPC interworking 6.34.4 Procedures 6.34.5 Impacts on existing
entities and interfaces 6.34.6 Evaluation 6.35 Solution 35: Small data
delivery 6.35.1 Introduction 6.35.2 Functional Description 6.35.2.1
Architecture 6.35.2.2 Small data delivery 6.35.3 Support of EPC
interworking 6.35.4 Procedures 6.35.4.1 Connection establishment for UPF
and NEF 6.35.4.2 MO small data transfer 6.35.5 Impacts on existing
entities and interfaces 6.35.6 Evaluation 6.36 Solution 36: CM-CONNECTED
with RRC Inactive state for frequent small data transmission 6.36.1
Introduction 6.36.2 Functional Description 6.36.3 Support of EPC
interworking 6.36.4 Procedures 6.36.4.1 Connection Inactive procedure
6.36.4.2 Connection Resume procedure 6.36.4.3 CN-initiated deactivation
of UP connection when the UE is in RRC inactive state 6.36.5 Impacts on
existing entities and interfaces 6.36.6 Evaluation 6.37 Solution 37:
Monitoring 6.37.1 Introduction 6.37.2 Functional Description 6.37.3
Support of EPC interworking 6.37.3.1 General 6.37.3.2 Interworking with
N26 interface 6.37.3.3 Interworking without N26 interface 6.37.4
Procedures 6.37.4.1 Monitoring events at AMF 6.37.4.2 Monitoring events
at UDM 6.37.4.3 Monitoring events at PCF 6.37.4.3.1 General 6.37.4.3.2
PCF service operations information flow 6.37.5 Impacts on existing
entities and interfaces 6.37.6 Evaluation 6.38 Solution 38: eDRX
RRC\_INACTIVE STATE in 5GS 6.38.1 Introduction 6.38.2 Functional
Description 6.38.3 Support of EPC interworking 6.38.4 Procedures 6.38.5
Impacts on existing entities and interfaces 6.38.6 Evaluation 6.39
Solution 39: UE availability after DDN failure for multiple AFs 6.39.1
Introduction 6.39.2 Functional Description 6.39.3 Support of EPC
interworking 6.39.4 Procedures 6.39.4.1 Event Configuration 6.39.4.2
Notification 6.39.5 Impacts on existing entities and interfaces 6.39.6
Evaluation 6.40 Solution 40: Infrequent small data transmission with
temporary PDU session 6.40.1 Introduction 6.40.2 Functional Description
6.40.3 Support of EPC interworking 6.40.4 Procedures 6.40.5 Impacts on
existing entities and interfaces 6.40.6 Evaluation 6.41 Solution 41:
Combining RRC-INACTIVE and 5G UP optimization 6.41.1 Introduction 6.41.2
Functional Description 6.41.3 Support of EPC interworking 6.41.4
Procedures 6.41.5 Impacts on existing entities and interfaces 6.41.6
Evaluation 6.42 Solution 42: NAS based Redirection between Core Networks
6.42.1 Introduction 6.42.2 Functional Description 6.42.3 Support of EPC
interworking 6.42.4 Procedures 6.42.4.1 Redirection using NAS indication
6.42.4.1.1 General 6.42.4.1.2 Redirection from EPC to 5GC network
6.42.4.1.3 Redirection from 5GC to EPC network 6.42.4.1.4 Interaction
with Steering of Roaming 6.42.5 Impacts on existing entities and
interfaces 6.42.6 Evaluation 6.43 Solution 43: RRC based Redirection
between Core networks 6.43.1 Introduction 6.43.2 Functional Description
6.43.3 Support of EPC interworking 6.43.4 Procedures 6.43.4.1
Redirection using RRC indication 6.43.4.1.1 General 6.43.4.1.2
Redirection from EPC to 5GC network 6.43.4.1.3 Redirection from 5GC to
EPC network 6.43.5 Impacts on existing entities and interfaces 6.43.6
Evaluation 6.44 Solution 44: C-IoT UE Core Network selection based on
S-NSSAIs 6.44.1 Introduction 6.44.2 Functional Description 6.44.2.1
General 6.44.2.2 5G Cellular IoT support information based on S-NSSAIs
6.44.3 Support of EPC interworking 6.44.4 Procedures 6.44.5 Impacts on
existing entities and interfaces 6.44.6 Evaluation 6.45 Solution 45:
Core Network Type and Node Selection for CIoT UE Using Explicit
Indications 6.45.1 Introduction 6.45.2 Functional Description 6.45.3
Support of EPC interworking 6.45.4 Procedures 6.45.4.1 Registration
Procedure 6.45.4.2 Core network type selection at UE and AMF selection
at RAN 6.45.5 Impacts on existing entities and interfaces 6.45.6
Evaluation 6.46 Solution 46: Network controlled UL data transmission
delay 6.46.1 Introduction 6.46.2 Functional Description 6.46.3 Support
of EPC interworking 6.46.4 Procedures 6.46.5 Impacts on existing
entities and interfaces 6.46.6 Evaluation 6.47 Solution 47: Improved
Signalling/Data plane separation for Data over NAS small data solutions
6.47.1 Introduction 6.47.2 Functional Description 6.47.3 Support of EPC
interworking 6.47.4 Procedures 6.47.5 Impacts on existing entities and
interfaces 6.47.6 Evaluation 6.48 Solution 48: NB-IoT idle mode
inter-RAT mobility reusing EPS features 6.48.1 Introduction 6.48.2
Functional Description 6.48.2.1 General 6.48.2.2 UE Radio Capability
Handling 6.48.2.3 PDU Session Handling 6.48.2.4 Determining RAT Type
Change 6.48.3 Support of EPC interworking 6.48.4 Procedures 6.48.4.1 RAT
change with mobility between 5GC and EPC with N26 6.48.4.2 RAT change
with mobility between 5GC and EPC without N26 6.48.4.3 RAT change
without mobility between 5GC and EPC 6.48.4.4 Determining RAT Type
Change 6.48.5 Impacts on existing entities and interfaces 6.48.6
Evaluation 6.49 Solution 49: Support for RDS with infrequent small data
transmission solutions \#1, 2, 3 6.49.1 Introduction 6.49.2 Functional
Description 6.49.3 Support of EPC interworking 6.49.4 Procedures 6.49.5
Impacts on existing entities and interfaces 6.49.6 Evaluation 6.50
Solution 50: AF Notifications after DDN failure 6.50.1 Introduction
6.50.2 Functional Description 6.50.3 Support of EPC interworking 6.50.4
Procedures 6.50.4.1 Event Configuration 6.50.4.2 Notification 6.50.5
Impacts on existing entities and interfaces 6.50.6 Evaluation 6.51
Solution 51: Core Network steering via CN type selection rules
configuration/reconfiguration 6.51.1 Introduction 6.51.2 Functional
Description 6.51.3 Support of EPC interworking 6.51.4 Procedures 6.51.5
Impacts on existing entities and interfaces 6.51.6 Evaluation 6.52
Solution 52: Inter-UE QoS differentiation based on retrieval of UE
Context 6.52.1 Introduction 6.52.2 Functional Description 6.52.3 Support
of EPC interworking 6.52.4 Procedures 6.52.4.1 Provision of UE Context
to AMF 6.52.4.2 Retrieval of UE Context from AMF and Inter-UE QoS
differentiation 6.52.5 Impacts on existing entities and interfaces
6.52.6 Evaluation 7 Evaluation 7.1 Key Issue 1: Support for infrequent
small data transmission 7.2 Key Issue 2: Frequent small data
communication 7.2.1 Overview 7.2.2 Enhancements of existing procedures
7.2.3 Optimised UP data solutions 7.2.4 UPF-NEF interface 7.3 Key Issue
3: High latency communication 7.4 Key Issue 4: Power Saving Functions
7.5 Key Issue 5: UE TX Power Saving Functions 7.6 Key Issue 6:
Management of Enhanced Coverage 7.7 Key Issue 7: Overload Control for
small data 7.8 Key Issue 8: Support of the Reliable Data Service 7.9 Key
Issue 9: Support of common north-bound APIs for EPC-5GC Interworking
7.10 Key Issue 10: Network Parameter Configuration API via NEF 7.10.1
Overview 7.10.2 Evaluation Relative to Key Issue 3 (High Latency
Communication) 7.10.3 Evaluation Relative to Key Issue 4 (Power Savings
Functions) 7.11 Key Issue 11: Monitoring 7.12 Key Issue 12: Inter-RAT
mobility support to/from NB-IoT 7.13 Key Issue 13: Support for Expected
UE Behaviour 7.14 Key Issue 14: QoS Support for NB-IoT 7.15 Key Issue
15: Core Network selection for Cellular IoT 7.16 Key Issue 16: Support
of Group communication and messaging 7.17 Key Issue 17: MSISDN-less MO
SMS 8 Conclusions 8.1 Key Issue 1: Support for infrequent small data
transmission 8.2 Key Issue 2: Frequent small data communication 8.3 Key
Issue 3: High latency communication 8.4 Key Issue 4: Power Saving
Functions 8.5 Key Issue 5: UE TX Power Saving Functions 8.6 Key Issue 6:
Management of Enhanced Coverage 8.7 Key Issue 7: Overload Control for
small data 8.8 Key Issue 8: Support of the Reliable Data Service 8.9 Key
Issue 9: Support of common north-bound APIs for EPC-5GC Interworking
8.10 Key Issue 10: Network Parameter Configuration API via NEF 8.11 Key
Issue 11: Monitoring 8.12 Key Issue 12: Inter-RAT mobility support
to/from NB-IoT 8.13 Key Issue 13: Support for Expected UE Behaviour 8.14
Key Issue 14: QoS Support for NB-IoT 8.15 Key Issue 15: Core Network
selection for Cellular IoT 8.16 Key Issue 16: Support of Group
communication and messaging 8.17 Key Issue 17: MSISDN-less MO SMS Annex
A: Change history

Foreword
========

This Technical Report has been produced by the 3rd Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

This technical report studies and evaluates architecture enhancements to
address the following objectives:

**Objective I: Enable CIoT/MTC functionalities in 5G CN.**

The objective is to study how to support identified CioT/MTC
functionalities in 5G CN with potential connectivity to WB-EUTRA (eMTC)
and/or NB-IoT for 5GS capable devices.

The following CIoT/MTC functionalities need to be evaluated and studied
how to enable them in 5G CN, if needed:

\- Equivalent overall functionalities as provided by SCEF for CIoT/MTC.

\- Monitoring.

\- Small data transmission (infrequent and frequent small data
transmission including frequent small data transmission from tracking
devices).

\- Additional power saving functions unless those are supported for 5G
system in Rel-15.

\- Non-IP Data Delivery.

\- Overload control (as relevant in 5G CN).

\- Support of Coverage enhancement including adaptations in 5G CN
required to support latencies.

\- Equivalent to Group communication and messaging.

\- Reliable communication via functionality equivalent to SCEF.

\- Inter-RAT mobility support to/from NB-IoT.

\- High latency communication.

\- Include location services procedures for IoT in 5G location services.

NOTE: Attach without PDN connection and non-IP PDN Connection type is
already supported in 5G CN(TS23.501\[5\]).

Ensure that regulatory requirements can be fulfilled at the same level
as in EPC.

**Objective II: Co-existence and migration from EPC based eMTC/NB-IoT to
5GCN.**

Study solutions for coexistence and migration from EPC towards 5G CN for
eMTC/NB-IoT.

This objective will study solutions where the same service is offered to
some UEs connected to EPC and some UEs connected to 5G CN e.g. using
SCEF and equivalent functionalities in 5GCN. Solutions that assume that
5G CN needs to support EPC NAS signaling for legacy IoT devices access
are not considered.

Any modifications in the EPC-5GC interworking \"baseline\" specific to
CIOT will also be discussed as part of Objective II.

**Objective III: 5G System enhancements to address 5G service
requirements (based on TS22.261\[2\] and TR38.913\[3\]).**

To study system architecture enhancements to address related service
requirements defined in TS22.261\[2\] and RAN requirements defined in
TR38.913\[3\] and how to enable them in 5G CN, if needed. At least the
following service requirements have been identified:

\- Enable the change of association between subscription and
address/number of an IoT device within same operator and in between
different operators.

\- Restricted Registration procedure to allow IoT device provisioning.

Any system implications for the RAN will be coordinated with RAN WGs.

This study is not going to study enhancements to EPC.

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or nonspecific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPPTR21.905: \"Vocabulary for 3GPP Specifications\".

\[2\] 3GPPTS22.261:\"Service requirements for next generation new
services and markets\".

\[3\] 3GPPTR38.913: \"Study on scenarios and requirements for next
generation access technologies\".

\[4\] 3GPPTS23.401:\"General Packet Radio Service (GPRS) enhancements
for Evolved Universal Terrestrial Radio Access Network (E-UTRAN)
access\".

\[5\] 3GPPTS23.501: \"System Architecture for the 5G System\".

\[6\] 3GPPTS23.682: \"Architecture enhancements to facilitate
communications with packet data networks and applications\".

\[7\] 3GPPTS23.502: \"Procedures for the 5G System\".

\[8\] 3GPPTS24.250: \"Protocol for Reliable Data Service between UE
and SCEF; Stage 3\".

\[9\] 3GPPTS29.122: \"T8 reference point for northbound Application
Programming Interfaces (APIs)\".

\[10\] 3GPPTS24.501: \"Non-Access-Stratum (NAS) protocol for 5G System
(5GS)\".

\[11\] Void.

\[12\] Open Mobile Alliance: \"Lightweight Machine to Machine
Requirements, V1.0\".

\[13\] MQTT For Sensor Networks, (MQTT-SN): www.mqtt.org.

\[14\] IETFRFC6347: \"Rescorla et al.: Datagram Transport Layer
Security\", IETF, January 2012.

\[15\] 3GPPTR38.804: \"Study on New Radio Access Technology; Radio
Interface Protocol Aspects\".

\[16\] 3GPPTS29.244: \"Interface between the Control Plane and the
User Plane nodes\".

\[17\] 3GPPTS29.303: \"Domain Name System Procedures; Stage 3\".

\[18\] 3GPPTS29.510: \"5G System; Network function repository
services; Stage 3\".

\[19\] 3GPPTS38.300: \"NR; NR and NG-RAN Overall Description; Stage
2\".

\[20\] 3GPPTS23.222: \"Functional architecture and information flows
to support Common API Framework for 3GPP Northbound APIs\".

\[21\] 3GPPTS23.122: \"Non-Access-Stratum (NAS) functions related to
Mobile Station (MS) in idle mode\".

\[22\] 3GPPTS36.413: \"Evolved Universal Terrestrial Radio Access
Network (E-UTRAN); S1 Application Protocol (S1AP)\".

\[23\] 3GPPTS36.331: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Radio Resource Control (RRC); Protocol specification\".

\[24\] 3GPPTS33.401: \"3GPP System Architecture Evolution (SAE);
Security architecture\".

\[25\] 3GPPTS33.501: \"Security architecture and procedures for 5G
System\".

\[26\] 3GPPTS29.502: \"Session Management Services; Stage 3\".

\[27\] 3GPPTS36.321: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Medium Access Control (MAC) protocol specification\".

3 Definitions, symbols and abbreviations
========================================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions
given in TR21.905\[1\] apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in
TR21.905\[1\].

3.2 Symbols
-----------

For the purposes of the present document, the terms and definitions
given in TR21.905\[1\] apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in
TR21.905\[1\].

3.3 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
TR21.905\[1\] apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any,
in TR21.905\[1\].

4 Architectural Assumptions and Principles
==========================================

The following architecture assumptions and principles apply:

\- The assumption is that WB-E-UTRA and NB-IoT are connected to 5GC via
N2/N3.

\- Regulatory requirements (e.g. LI) shall be fulfilled at the same
level as in EPC.

\- No architectural enhancements made to EPC.

\- APIs for CIoT related services provided to the SCS/AS shall be common
for UEs connected to EPS and 5GS and accessed via the HPLMN.

NOTE1: The level of support of the API may differ between EPS and 5GS.

\- Notifications and data from NFs in the VPLMN to the NEF can be routed
through an IWK-NEF, similar to the IWK-SCEF in EPC.

NOTE2: Some solutions documented in this TR may not necessarily show
the IWK-NEF. It is however assumed that IWK-NEF support will be added
during the normative phase.

\- Support for small data delivery using IP data and Unstructured
(Non-IP).

\- At least equivalent level of security for UEs used for CIoT in 5GS
system as in EPS.

NOTE3: Security may need to be investigated by SAWG3.

\- Equivalent or reduced level of power consumption for UEs used for
CIoT in 5GS system to that in EPS shall be supported.

\- UEs used for CIoT can be mobile or nomadic/static, and resource
efficiency should be considered for both for relevant optimization(s).

\- The 5GS system is assumed to operate with a large number of UEs used
for CIoT in the system and be able to appropriately handle overload and
congestion situations.

\- External exposure of network capabilities towards SCS/AS or AF is
supported via NEF.

> \- UEs used for CIoT can simultaneously connect to one or multiple
> SCSs/ASs or AFs.

5 Key Issues
============

5.1 Key Issue 1: Support for infrequent small data transmission
---------------------------------------------------------------

### 5.1.1 Description

This key issue aims to provide solutions to support efficient infrequent
small data transmissions for at least low complexity, power constrained,
and low data-rate CIoT UEs. In some of the usage scenarios the devices
(e.g., utility meters) may not be mobile throughout their lifetime. It
is expected that the number of CIoT devices will increase exponentially
but the data size per device will remain small.

### 5.1.2 Architectural requirements

This key issue addresses infrequently sending and receiving small data
with the following architectural requirements:

\- Resource efficient system signalling load (especially over the Radio
interface);

\- An at least equivalent level of security mechanisms for CIoT in 5G
system as in EPS;

\- Equivalent or reduced level of power consumption for UEs used for
CIoT in 5GS system as in EPS;

\- Minimal Access Stratum changes required for NB-IoT/eMTC UEs to
connect to 5GS;

\- Support for the following small data transmissions:

\- single packet transmission (UL or DL);

\- dual packet transmission (UL with subsequent DL, or DL with
subsequent UL);

\- multiple packet transmission (one or a few UL and/or one or a few DL
(in any combination or order));

\- Support for delivery of IP data and Unstructured (Non-IP) data;

\- Support for charging, roaming and policy control;

\- Support API(s) for infrequent small data transmission and capability
exposure to AF.

\- Support of Exception Report for NB-IoT in 5G system as in EPS.

### 5.1.3 Architectural baseline

The following architectural baseline assumptions should be considered:

\- Small data can be exchanged using either the northbound API interface
between 5GC and AF or the N6 interface between UPF and AF.

\- The 5GS network function terminating the northbound API is assumed to
support message based charging.

### 5.1.4 Open issues

The following open issues remains to be studied:

\- Efficient handling of nomadic/static and mobile usage scenarios.

\- Whether and how small infrequent User Data delivery via Control Plane
and/or User Plane in the 5GS is supported.

\- Assumptions on UE indication of preferred and supported network
behaviour (see TS23.401\[4\], clause4.3.5.10) may be required: A UE
includes in a Preferred Network Behaviour indication the Network
Behaviour the UE can support and what it would prefer to use.

\- Whether PDU sessions need to be established to exchange infrequent
small data.

\- Identify whether specific AMF/SMF selection for CIoT devices is
needed.

\- How to support Exception Report in the manner of infrequent small
data transmission.

NOTE: This key issue may have some dependencies to the key issues for
High Latency Communications.

5.2 Key Issue 2: Frequent small data communication
--------------------------------------------------

### 5.2.1 Description

This key issue aims at providing a solution to support efficient
frequent small data transmissions for CIoT, e.g. tracking devices for
both Mobile Originated (MO) and Mobile Terminated (MT) use cases. It is
expected that the number of such devices can increase exponentially, but
the data size per device will remain small. Traffic characteristics for
UEs used for CIoT using frequent small data transmissions may lead to
inefficient use of resources in the 3GPP system and high UE power
consumption without use of appropriate optimization.

Frequent small data communication targets optimizations that can meet
both architecture requirements on UE power consumption and resource
efficient system signalling in a balanced way. A traffic pattern is
assumed where small data transmissions may occur from a few small data
transmissions per hour to multiple small data transmissions per minute.

The objective of this key issue is to ensure optimized transmission with
IP based and non-IP based protocols. Failure to do so may lead to
sub-optimal transmission characteristics with increased signalling and
UE power consumption.

### 5.2.2 Architectural requirements

In addition to the common requirements in clause4, the following
architecture requirements shall be supported in 5GS:

\- It shall be possible to transmit frequent small data with
consideration of resource-efficiency and UE power efficiency;

\- Minimal Access Stratum changes required for NB-IoT UEs to connect to
5GS;

\- Support for delivery of IP data and Unstructured (Non-IP) data;

\- Support for the following small data transmissions:

\- single packet transmission (UL or DL);

\- dual packet transmission (UL with subsequent DL, or DL with
subsequent UL);

\- multiple packet transmission (one or a few UL and/or one or a few DL
(in any combination or order));

\- An at least equivalent level of security mechanisms for CIoT in 5G
system as in EPS;

\- Equivalent or reduced level of power consumption for UEs used for
CIoT in 5GS system as in EPS;

\- Support for charging, roaming, policy control;

\- Support of Exception Report for NB-IoT in 5G system as in EPS.

### 5.2.3 Architectural baseline

The following are considered architecture baselines for this key issue:

\- The 5GS network function terminating the T8 NIDD API is assumed to
support message based charging.

\- The AF (i.e. SCS/AS) shall be able to access frequent small data
service via an API equivalent to T8 NIDD API.

\- The AF (i.e. SCS/AS) shall be able to access frequent small data
communication over N6.

### 5.2.4 Open issues

The following open issues for supporting key issue Small data frequent
communication:

\- How to enable frequent small data transmissions (see clause5.2.1) in
a resource-efficient and UE power efficient way in 5GS;

\- Whether and how to support Exception Report in the manner of frequent
small data transmission.

5.3 Key Issue 3: High latency communication
-------------------------------------------

### 5.3.1 Description

Functions for high latency communication may be used to handle Mobile
Terminated (MT) communication with UEs being unreachable while using
power saving functions (see key issue on power saving functions) and for
coordinating the maximum latency between the application, the UE and the
network. \"High latency\" refers to the initial response time before
normal exchange of packets is performed and may be further classified
into shorter and longer latencies. That is, the time it takes before a
UE has woken up from its power saving state and responded to the initial
downlink packet(s).

In EPC (see TS23.682\[6\]) high latency communication is handled by
the following two mechanisms:

\- Extended buffering of downlink data in the network: The data is
buffered until the UE wakes up from its power saving state and moves to
ECM-CONNECTED state, when the buffered downlink data is conveyed to the
UE.

\- Notification procedures: An AF (i.e. SCS/AS) may request notification
when a UE wakes up or is expected to wake up from its power saving
state, to send the downlink data to the UE when the UE becomes
reachable.

Similar approaches may be considered for 5GC. Extended buffering is not
recommended for UEs using very long sleep durations.

### 5.3.2 Architectural requirements

In addition to the common requirements in clause4, the following
architecture requirements shall be supported for high latency
communication in the 5G system:

\- Send DL data to UEs at the earliest possible opportunity when the UEs
are applying power saving functions, followed by subsequent return to
power saving state when the data has been delivered.

\- Coordination of the UE sleep duration between the Application, the UE
and the network.

\- Provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable).

### 5.3.3 Architectural baseline

\- 5GS enhanced with resource efficient buffering until UE wakes up from
its power saving state;

\- The buffered downlink data can be forwarded, if needed, between the
network function instances that provide the buffering to avoid packet
loss.

\- Support for UE status information related to power saving functions
(e.g. UE reachability) reporting to SCS/AS .

\- The 5GS may receive parameters related to reachability and buffering
via the Network Parameter Configuration API.

### 5.3.4 Open issues

The following issues shall be considered:

\- Study how to support high latency communication when power saving
solutions are used in 5GS;

\- Study where downlink data can be buffered;

\- Study which monitoring events can be generated;

\- Study whether the 5G system should support obtaining Maximum Latency
parameters from the UE via NAS signalling.

NOTE: This key issue may have some dependencies to the key issues for
Power saving functions, Infrequent small data communication, Frequent
small data communication and Network Parameter Configuration API via
NEF.

5.4 Key Issue 4: Power Saving Functions
---------------------------------------

### 5.4.1 Description

EPC supports Power Saving Mode (PSM) and Extended Idle Mode DRX (eDRX).
This key issue addresses how equivalent EPS power saving functions and
5G enhancements will be supported in the 5G system allowing connectivity
between 5GC and WB-EUTRA (eMTC) and/or NB-IoT devices.

E-UTRAN (both WB-E-UTRAN and NB-IoT) already supports extended idle mode
DRX functionality and the same is assumed to be available when E-UTRAN
is connected to 5GC: operators have begun deploying eDRX support for
NB-IoT/eMTC and are expecting continued support of eDRX regardless of
whether E-UTRAN is connected to EPC or 5GC. Therefore, this key issue
aims at supporting eDRX in 5GC.

Furthermore, as already studied for EPC, extended idle mode DRX has a
limitation in the amount of time the UE can be in deep sleep (\~45
minutes for WB-E-UTRAN and \~3hs for NB-IoT). Therefore, a NAS based
approach should be adopted as well to support sleep cycles similar to
the ones supported by PSM in EPC.

Therefore two tracks of this key issue should be studied:

\- Track 1: 5G NAS/5GC support of extended idle mode DRX:

\- Reuse as is the RAN aspects of extended idle mode DRX already
supported in WB-E-UTRAN and NB-IoT.

\- Include NAS, N2, subscription and CN handling aspects of extended
idle mode DRX feature.

\- Track 2: NAS based approach addressing very long delay tolerance for
MT data, i.e. sleep cycles similar in duration as supported by PSM in
EPC.

\- NAS based solution with no/minimal RAN impact that allows for sleep
periods of up to similar duration as in EPC PSM.

NOTE1: How the SCS/AS influences the configuration of the power savings
functions will be impacted by the conclusion of the \"Network Parameter
Configuration API via NEF\" key issue.

NOTE2: Reachability and buffering aspects will be addressed in the key
issue on high latency communication.

### 5.4.2 Architectural requirements

Architecture goals for UE power consumption optimizations include:

\- Solutions shall enable UE power savings while also supporting mobile
terminating communications with a delay governed by the duration of the
UE\'s sleep cycles.

\- Solutions shall enable UE power savings while also supporting
delay-sensitive mobile terminating communications triggered by mobile
originated communications.

\- Solutions shall optimize UE power savings according to expected and
desired UE and application behaviour (e.g. communication pattern) if
such information is available.

\- Sleep cycle durations supported by 5GC should be the same as
supported by eDRX and PSM in EPC.

### 5.4.3 Architectural baseline

**Track 1:** 5G NAS/CN will be updated to support extended idle mode DRX
for sleep cycles up to \~45 minutes for WB-E-UTRAN and \~3hs for NB-IoT
as follows:

\- 5G NAS to support eDRX sleep cycle negotiation during
registration/registration update, etc.

\- Subscription information to be enhanced by extended idle mode DRX
parameters.

\- AMF to support Hyper SFN, Paging Hyperframe and Paging Time Window
length as described in TS23.682\[6\] for paging the UE.

Editor\'s note: Support for eDRX functionality by E-UTRA connected to
5GC as described above to be confirmed by RAN groups.

**Track 2:** NAS based approach addressing very long delay tolerance for
MT data, i.e. for sleep cycles similar in duration as supported by PSM
in EPC.

\- Power Saving Function (e.g. the MICO mode, PSM), enabling sleep
periods similar in duration to those supported by PSM in EPC is
negotiated at NAS.

### 5.4.4 Open issues

\- No open issues for Track 1, translation of signalling to 5G CN should
be straightforward.

\- For Track 2, how to ensure that pending downlink data can be
delivered to the UE when the UE wakes up from a sleep cycle.

\- For 5GS enhancements how 5GS is configured with the UE\'s and
application\'s expected and desired behaviour and and how the 5GS
fulfils those requirements.

\- Support for eDRX in RRC\_Inactive is FFS.

NOTE: This key issue may have some dependencies and relations to other
key issues including high latency communication, etc.

5.5 Key Issue 5: UE TX Power Saving Functions
---------------------------------------------

### 5.5.1 Description

It is observed that when UE communicates with network, the TX power
consumption of each data transmission is more than ten times of the RX
power consumption and the TX power consumption contributes much to the
UE whole power consumption. So, optimizing the TX power consumption is
an effective way to improve UE power saving.

This key issue aims to optimize UE TX power consumption under certain
conditions, e.g. in weak coverage, with high latency application, or
other any conditions under which UE TX power consumption can be
improved.

NOTE: In this key issue UE TX power consumption optimization should be
considered only at system level.

### 5.5.2 Architectural requirements

The following architecture requirement shall be supported:

\- It shall be possible to optimize UE TX power consumption under the
identified conditions.

\- Optimizing UE TX power consumption shall reduce overall UE power
consumption.

### 5.5.3 Architectural baseline

### 5.5.4 Open issues

\- To identify the conditions under which UE TX power consumption can be
improved.

5.6 Key Issue 6: Management of Enhanced Coverage
------------------------------------------------

### 5.6.1 Description

Both NB-IoT and WB-E-UTRA, with enhancements for MTC radio access
technologies are expected to be used in 5G to provide radio access
support for massive IoT. Both these RATs support Enhanced Coverage (EC)
based on radio signal repetitions. Radio signal repetition is costly and
therefore management of the feature is important from overall system
cost perspective.

### 5.6.2 Architectural requirements

The following functionality should be supported:

\- Enable an Application Server/Function to query the status of the
enhanced coverage restriction for a UE;

\- Means for the 5GC to restrict UE usage of the EC feature;

\- Enable an Application Server/Function to enable, or to disable the EC
restriction for a particular UE; and

\- Temporary storage of RAN parameters in 5GC, related to the EC
feature.

\- Indication of UE capability of CE mode B support to the 5GC.

\- Storage of restriction of use of EC as part of subscription parameter
in UDM.

### 5.6.3 Architectural baseline

Baseline for EC support for 5G, is the T8 API towards the AF/AS and the
5GS architecture.

5GC already support monitoring/exposure function of certain UE aspects,
see TS23.502\[7\] clause4.15. The exposure functionality already
specified should be considered when enabling an Application
Server/Function to query the status of the enhanced coverage restriction
for a UE.

The AMF receives, at N2 release, RAN parameters, important for paging a
UE in EC. The AMF shall store the parameters during the time the UE is
in CM-IDLE and return the parameters to RAN in a subsequent paging
message unless the UE is restricted from using EC. Same or similar IE as
the Information Element *UEPagingCoverageInformation* is used for this
purpose in 5GS.

Use of Enhanced Coverage can be restricted per subscriber per PLMN in
the UDM. If the Enhanced Coverage is restricted as per subscription or
based on local configuration then the AMF informs:

\- the UE as part of the Registration procedure;

\- the RAN whenever the UE context is established or modified in the
RAN.

### 5.6.4 Open issues

Compared to EPC there are a few new aspects in 5GS that should be
studied and considered in proposed solutions:

\- OI1: Impacts to the Enhanced Coverage feature due to MICO mode and
any other power save solutions proposed and studied for 5GS.

\- OI2: Impacts, if any, to the Enhanced Coverage feature due to
RRC\_Inactive feature.

\- OI3: Signalling details for status query of Enhanced Coverage
restriction and enabling/disabling Enhanced coverage restriction by
Application Server/Function.

5.7 Key Issue 7: Overload Control for small data
------------------------------------------------

### 5.7.1 Description

In EPC two solutions are provided for small data communication a.k.a.
CIoT optimizations: User Plan CIoT EPS optimization and Control Plane
CIoT EPS optimization. For the Control Plane CIoT EPS optimization
overload control mechanism is defined in EPC to protect the MME and the
Signalling Radio Bearers (SRBs) in the E-UTRAN from the load generated
by NAS Data PDUs. This key issue aims to study whether and how
equivalent overload control mechanism can apply for NB-IoT and WB-E-UTRA
connected to 5GC.

NOTE: The Overload control for 5G IoT depends on the selected solution
for small data communication.

### 5.7.2 Architectural requirements

The following architecture requirement shall be supported:

\- The system should support procedures to handle the overload from data
transmission via the control plane (if data transmission via control
plane is agreed as a feature in 5GS).

\- The system should allow Exception Report during overload control.

### 5.7.3 Architectural baseline

Depending on the selected solution for small data communication in 5GS,
similar functionality e.g. control plane data back-off timer, control
plane overload start indication and service gap as applied in the EPC
can be applied to protect the 5GS control plane from overload when used
to transport user data packets.

### 5.7.4 Open issues

The following open issues remains to be studied.

\- In what network function(s) can the overload conditions occur, and
where should the overload control be executed?

\- What are the function and procedures required to handle overload?

\- How to allow Exception Report when network function is in overload
condition?

\- Whether and how to handle UEs configured for Low Priority and
Overriding of Low priority in 5G System?

5.8 Key Issue 8: Support of the Reliable Data Service
-----------------------------------------------------

### 5.8.1 Description

This key issue will address how to enable the Reliable Data Service for
unstructured PDU sessions and functionality equivalent to the Reliable
Data Service.

NOTE: Solutions to this key issue will likely depend on solutions to
several other key issues (e.g. Frequent and Infrequent Small Data key
issues).

### 5.8.2 Architectural requirements

\- In an unstructured PDU session type, it shall optionally be possible
to provide for reliability and the detection and elimination of
duplicate packets between the UE and the PDU session termination point.

\- AF\'s shall be able to send and receive data via a set of exposed
APIs.

\- When an AF uses an exposed API to send and receive data:

\- It shall optionally be possible for the sender to indicate whether or
not the data needs to be sent with reliability or not.

\- It shall optionally be possible to identify the sending and receiving
application.

\- UE and Network shall be able to indicate its support for reliable
communication.

### 5.8.3 Architectural baseline

\- It shall be an option to use the Reliable Data Service protocol
(defined in TS24.250\[8\]) to provide for reliability and the
detection and elimination of duplicate packets between the UE and the
unstructured PDU session termination point as well as a means for
identifying the sending and the receiving application.

\- The APIs that are exposed to the AF will support the functionality
and features that are exposed on the T8 interface by the Non-IP Data
Delivery APIs that are defined in TS29.122\[9\] so that the T8 APIs
may be re-used in 5GC.

### 5.8.4 Open issues

\- What NF is used as the PDU session termination point (UPF, NEF, etc.)
will be decided as part of other key issues (e.g. Frequent and
Infrequent Small Data key issues).

\- How reliable communication is enabled and disabled (e.g. based on
static DNN configuration, or using dynamic mechanism).

5.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC Interworking
----------------------------------------------------------------------------

### 5.9.1 Description

An IoT UE can possibly switch between EPC and 5GC. An authorized third
party service provider should be able to get access to authorized and
available services when the UE is either on EPC or on 5GC. This key
issue will address architectural issues that may arise when a UE
switches between being served between EPC and 5GC.

NOTE: Evaluation of solutions to this key issue should consider whether
there are any CAPIF impacts.

### 5.9.2 Architectural requirements

\- An authorized third party service provider should be able to get
access to authorized and available services when the UE is either on EPC
or on 5GC.

### 5.9.3 Architectural baseline

### 5.9.4 Open issues

\- With respect to the UE\'s movement between EPC and 5GC:

\- Whether this will cause the API termination point(s) associated with
the UE to change.

\- How does the AF become aware of the availability or of the expected
level of support of a given service?

\- Whether it is possible for the exposure function (e.g. SCEF or NEF)
serving a UE to change.

\- If so, then how the AF determines what node to direct API requests
towards.

\- If so, then how the new node gets the UE\'s context (i.e. NIDD
Configuration, Monitoring Event Configurations, etc.).

5.10 Key Issue 10: Network Parameter Configuration API via NEF
--------------------------------------------------------------

### 5.10.1 Description

This key issue addresses how the Network Parameter Configuration API may
be implemented the Nnef interface.

TS23.682\[6\] defines a Network Parameter Configuration procedure on
the T8 interface. The procedure is used by the SCS/AS to provide the EPS
with suggested parameter values for Maximum Latency, Maximum Response
Time and Suggested Number of Downlink Packets.

In the EPS, these values are used to influence the UE\'s PSM, extended
idle mode DRX, and extended buffering configurations. However, the
SCS/AS is largely unaware of the details of the power savings techniques
that are used by the network (e.g. PSM and eDRX). From the SCS/AS point
of view, the UE is essentially reachable or unreachable.

The SCS/AS provides Maximum Latency as a guide for the maximum amount of
time between UE reachability events.

The SCS/AS provides Maximum Response as a guide for how much time the
SCS/AS needs to begin sending data to the UE after receiving a
reachability notification.

The SCS/AS provides the Suggested Number of Downlink Packets parameters
to configure how many packets should be buffered by the network when the
UE is not reachable.

This key issue will examine how, in 5GS, the AF (i.e. SCS/AS) may
provide Maximum Latency, Maximum Response, and Suggested Number of
Downlink Packets to the 5GS and expect network behaviour similar to EPS.

### 5.10.2 Architectural requirements

\- The Nnef interface should allow the AF to provide a Maximum latency
parameter as a guide for the maximum amount of time between UE
reachability events.

\- The Nnef interface should allow the AF to provide a Maximum Response
parameter as a guide for how much time the AF needs to begin sending
data to the UE after receiving a reachability notification.

\- The Nnef interface should allow the AF to provide a Suggested Number
of Downlink Packets parameter to configure how many packets should be
buffered by the network when the UE is not reachable.

### 5.10.3 Architectural baseline

\- As is done on T8, the AF will use the Network Parameter Configuration
API to provide the NEF with Maximum Latency, Maximum Response Time, and
Suggested Number of Downlink Packets.

\- The NEF will provide the Maximum Latency, Maximum Response Time, and
Suggested Number of Downlink Packets parameters to the UDM or UDR and
the values will be added to the UE\'s subscription information.

NOTE 1: Whether UDM or UDR is used depends on whether it is concluded
that per subscriber authorisation and/or data validation is required.

\- The UDM/UDR will provide the Maximum Latency, Maximum Response Time,
and the Suggested Number of Downlink packets to the NFs that use them.

\- An NF that buffers downlink data may use the Suggested Number of
Downlink Packets parameter as a guide for configuring whether or not
buffering should be enabled and the amount of data to be buffered.

NOTE 2: This key issue is dependent on and should adapt to the outcome
of other key issues (e.g. power saving, high latency, etc.).

### 5.10.4 Open issues

\- How and whether Maximum Response Time is used to configure power
saving functions and impact a UE\'s reachability for downlink data.

\- How the 5GS uses the Maximum Response Time parameter to determine
when to send reachability notifications to the AF.

\- How and whether Maximum Latency is used to configure power saving
functions and impact a UE\'s reachability for downlink data.

\- How and whether the Suggested Number of Downlink Packets parameter
impacts buffering.

\- How the UDM knows what NF to provide the Suggested Number of Downlink
Packets to (i.e. what PDU session the setting applies to).

\- Whether the NEF adds parameters to the UE\'s subscription information
via the UDM or directly to the UDR (i.e. do parameter updates need to be
authorised per subscriber and/or is any data validation is required
prior to storage).

\- It is FFS how the Network Parameter Configuration API and the Maximum
Response, Maximum Latency, and Suggested Number of Downlink Packets
parameters are used may be impacted by solutions/conclusions to other
key issues within this study (e.g. 5GS small data, high latency
communication, and power saving functions solution(s)).

NOTE: Where buffering occurs will be decided as part of the High Latency
Communication key issue.

\- It is FFS whether other parameters may be need to configure power
saving functions and buffering in 5GS.

5.11 Key Issue 11: Monitoring
-----------------------------

### 5.11.1 Description

Rel-15 5GC supports event monitoring for many of the same or similar
events as EPC. This key issue will address how to add support to 5GC for
any monitoring features that are supported in EPC but not 5GC. The key
issue shall also make an assessment of the relevance for any identified
features in 5GC. This key issue will also address how monitoring event
configurations are handled when the UE moves between EPC and 5GC.

### 5.11.2 Architectural requirements

\- Monitoring Events that are available via the T8 interface in EPC
should also be available in 5GC.

### 5.11.3 Architectural baseline

\- The Monitoring Events that are already available in Rel-15 5GC are
assumed to be reused as much as possible.

### 5.11.4 Open issues

\- Identify missing monitoring events, assess their relevance in 5GC,
and study how to add any identified relevant events in 5GC.

\- How is Monitoring Event Configuration information handled or
transferred when a UE moves from EPC to 5GC.

\- Depending on solutions to the Interworking KI, does the node that is
supposed to receive the report (NEF or SCEF) change when a UE moves
between EPC and 5GC.

5.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
------------------------------------------------------------

### 5.12.1 Description

In Rel-14, inter-RAT mobility to/from NB-IoT without the need to
detach/reattach was introduced with a CN only approach with three
aspects:

\- Force TAU triggering UE via different TAs for different RAT types
WB-E-UTRAN and NB-IoT.

\- Maintaining two separate UE radio capabilities in the CN (MME)
depending on whether they were received when the UE was camping on
WB-E-UTRAN or NB-IoT.

\- PDN connection handling based on subscription.

### 5.12.2 Architectural requirements

The architectural requirements are:

\- Intra-PLMN idle mode inter-RAT mobility to and from NB-IoT should be
supported in a radio, core network and battery efficient manner. The
other RAT to be supported are NR, WB-E-UTRAN.

Editor\'s note: Additional considerations for GERAN/UTRAN are FFS.

\- The solution should enable data sent on different RATs to be
correctly recorded on CDRs.

\- The HPLMN should be able to influence which DNNs/S-NSSAIs are
maintained, reconnected or disconnected at inter-RAT idle mode mobility
to/from NB-IoT.

### 5.12.3 Architectural baseline

The architecture baseline uses the EPC solution as baseline for the core
network aspects.

\- It is assumed that the UE radio capabilities provided by the UE in
NB-IoT are different from the UE radio capabilities provided by the UE
in WB-E-UTRAN and NR.

\- Therefore two sets of capabilities are maintained by the AMF:

\- UE radio capabilities provided while UE is camping on NB-IoT are
stored in AMF and provided to the RAN only when the UE is camping on
NB-IoT.

\- UE radio capabilities provided while UE is camping on WB-E-UTRAN or
NR are stored in AMF and provided to the RAN only when the UE is camping
on WB-E-UTRAN or NR.

\- When the UE preforms inter-RAT idle mode mobility to/from NB-IoT, the
SMF decides, based on policies received from UDM or based on local
policy, whether to maintain, reconnect or release a PDU session based on
the DNN/S-NSSAI information.

### 5.12.4 Open issues

\- How to handle established PDU Session for following idle mode
mobility scenarios:

\- Between NB-IoT connected to 5GC and WB-EUTRAN connected to 5GC;

\- Between NB-IoT connected to 5GC and WB-EUTRAN connected to EPC;

\- Between NB-IoT connected to 5GC and NR connected to 5GC.

5.13 Key Issue 13: Support for Expected UE Behaviour
----------------------------------------------------

### 5.13.1 Description

The procedure for External Parameter Provisioning is supported in Rel-15
5GC, and the Expected UE Behaviour parameters can be provided by the 3rd
party via this procedure (see TS23.502\[7\], clause4.15.6). The
Expected UE Behaviour is regarded as a kind of 3rd party provided
parameters set, which should also include the Communication Pattern
parameters (see TS23.682\[6\], clause5.10) which were defined for EPC
mainly to optimize resource utilization for CIoT.

This key issue investigates:

\- Which parameters are necessary to be indicated to the 5GC in order to
allow the 5GC to operate as effectively as EPC for devices with
communication patterns and how they are provided to the AMF and to the
SMF;

\- Investigate the relevance of parameters in Communication Pattern list
for the procedures and features in 5GC.

NOTE: Other key issues, such as Power Saving Functions, Network
Parameter Configuration API via NEF, and High Latency Communication are
affected by this Key Issue.

### 5.13.2 Architectural requirements

\- Communication Pattern parameters and new parameters which may be used
by 5GC to optimize network resource usage should also be part of the
Expected UE Behaviour parameters.

\- The 5GC authorises whether the AF is allowed to provide the
parameters and checks that they are within the range allowed by the
operator.

### 5.13.3 Architectural baseline

The architectural baseline for supporting the Expected UE Behaviour
provisioning for 5G is the T8 API towards the AF/AS and the 5GS
architecture.

\- The External Parameter Provisioning procedure is already available in
Rel-15 5GC and is assumed to be reused and extended to support the
provisioning of Communication Pattern parameters.

### 5.13.4 Open issues

The following open issues remains to be studied:

\- Which existing Communication Pattern parameters and new parameters
(e.g. mobility related parameters) are necessary for 5GC.

\- Which parameters are provided to AMF and to SMF.

\- Whether and how the parameters provided to the 5GC are provided to
the RAN.

NOTE: Potential impacts on RAN and whether these parameters are provided
to RAN will be coordinated with the relevant RAN WGs.

5.14 Key Issue 14: QoS Support for NB-IoT
-----------------------------------------

### 5.14.1 Description

This key issue aims at studying QoS differentiation for NB-IoT. If
relevant end-user use cases can be identified, the study should include
the required level of QoS differentiation, if any (e.g., QoS
differentiation across different UEs, QoS differentiation across PDU
sessions of the same UE, QoS differentiation for different traffic flows
within a PDU session of the same UE). Consideration should be given for
PDU Session types used by NB-IoT (i.e. IPv6, IPv4, and Unstructured) and
that dedicated bearers are not supported in NB-IoT.

The key issue should assume traffic models used by NB-IoT devices, e.g.,
consideration of relevance for QoS differentiation of traffic flows of
small data transmission.

The key issue should include and assume exception reporting would be
present for NB-IoT in 5G.

### 5.14.2 Architectural requirements

Study whether and how to introduce support for QoS differentiation for
NB-IoT.

### 5.14.3 Architectural baseline

The baseline includes:

\- PDU session types can be IPv4, IPv6, or Unstructured.

### 5.14.4 Open issues

If relevant end-user use cases can be identified, the open issues
include:

1\. The required level of QoS differentiation, if any (e.g. QoS
differentiation across different UEs, QoS differentiation across PDU
sessions of the same UE, QoS differentiation for different traffic flows
within a PDU session of the same UE).

5.15 Key Issue 15: Core Network selection for Cellular IoT
----------------------------------------------------------

### 5.15.1 Description

Rel-15 provides a mechanism to indicate over E-UTRA whether connectivity
to 5GC is available, and a mechanism for the UE to indicate whether it
has selected EPC or 5GC in RRC signaling.

A UE that supports EPS CIoT features and 5GS CIoT features as well as a
UE that only supports 5GS CIoT features needs to additionally be made
aware whether CIoT features are available in EPC and/or 5GC when
selecting the core network to connect to via an NB-IoT/WB-E-UTRA cell.

In the networks that support CIoT features in both EPC and 5GC, the
operator may steer the UEs to a specific CN type due to operator policy,
e.g., due to roaming agreements, UE\'s Preferred and Supported Network
Behaviour, load redistribution, etc. This key issue aims at studying how
to inform the UE whether and which 5GS CIoT features are available in
5GC, and how to steer the UE to EPC or 5GC based on operator policies if
the CIoT features required by the UE are supported in both EPC in 5GC.

NOTE: Steering of UEs to the other CN type is not assumed to be
performed for frequent load re-distribution. Operator policies in EPC
and 5GC, respectively, are assumed to avoid steering UEs back and forth
between EPC and 5GC.

### 5.15.2 Architectural requirements

The architectural requirements are as follows:

\- It shall be possible for a UE supporting CIoT features to discover
whether 5G CIoT feature(s) are supported in 5GC via NB-IoT/WB-E-UTRA
access, and to perform core network selection between EPC and 5GC based
on such discovery.

\- It shall be possible for the RAN to take into account CIoT feature
indication(s) from the UE to perform AMF selection.- Upon UE selecting
5GC, it shall be possible for the 5GC, based on e.g. operator policy, to
redirect the UE to EPC, and vice versa.

\- Upon redirecting the UE to EPC, it shall be possible for the EPC to
prevent idle and connected mode mobility to 5GC, and vice versa.

### 5.15.3 Architectural baseline

The architectural baseline is as follows:

\- A UE supporting 5G CIoT feature(s), discovers whether 5G CIoT
feature(s) are supported in 5GC.

\- A UE supporting 5G CIoT feature(s) and EPC CIoT optimizations
performs CN type selection (EPC vs 5GC) based on the information about
the features available for EPS (i.e. CP and/or UP optimizations) and
5GC.

\- A UE selecting 5GC may also request 5G CIoT feature(s) during RRC
connection establishment procedure.

\- If the UE has requested 5G CIoT feature(s), the RAN takes that into
account for AMF selection.

\- If the UE has selected 5GC, the 5GC can based on e.g. operator
policy, redirect the UE to EPC, and vice versa.

\- If the 5GC has redirected the UE to EPC, the EPC indicates the idle
mode camping policy and connected mode mobility restrictions to RAN to
prevent mobility to 5GC, and vice versa.

### 5.15.4 Open issues

The open issues for this key issue are the following:

\- The granularity of CIoT features to be discovered and to be taken
into account, i.e. which solution or set of solutions constitute a 5GS
CIoT(s) features to be taken into account during CN selection.

\- How the network determines the UE(s) need to be moved to the other
system (i.e. EPC to 5GC or vice versa)

\- Whether and how the 5GS C-IoT feature(s) are indicated to UE in
broadcast or by any other means.

\- How the 5GS CIoT feature(s) are indicated in RRC by UE.

Editor\'s note: The previous two aspects require coordination with RAN
WGs.

\- How potential solutions relate to network slicing.

\- How the potential solutions for Core Network selection can be
generalized and applied also to other than CIoT UEs.

5.16 Key Issue 16: Support of Group communication and messaging
---------------------------------------------------------------

### 5.16.1 Description

In order for 5GS to support similar group communication and messaging as
in EPC, the following aspects should be studied:

\- Mechanisms for efficient delivery of group messages.

\- A service interface provided to application servers to send group
messages intended to a group of devices.

\- Depending on solutions, a mechanism might be needed for synchronized
wake up for group messages reception by UEs in a group that are using
power saving functions.

Editor\'s note: Depending on RAN WGs progress, this Key Issue may be
moved to another Study Item.

### 5.16.2 Architectural requirements

The following architecture requirement shall be supported:

\- The system shall support efficient delivery of a group message to a
group of devices.

\- The system shall support the negotiation of group message delivery
between application server and network.

\- The system shall (depending on selected solution) support to
synchronised wake up for a group of UEs that are using power saving
functions.

### 5.16.3 Architectural baseline

The following are considered architecture baselines for this key issue:

\- A group message may be sent to a group of devices via unicast Mobile
Terminated data delivery procedure.

\- The AF (i.e. SCS/AS) may be able to access group messaging service
via an API equivalent to T8 group message delivery API.

### 5.16.4 Open issues

The following issues shall be considered:

\- Pending RAN decisions on multicast/broadcast, study how to support
efficient a group message to a group of devices.

NOTE 1: This key issue may have some dependencies to the key issues for
Power saving functions and Infrequent small data communication.

NOTE 2: Work on multicast/broadcast will not be started until RAN
related decisions. Multicast over UP in the CN is not precluded.

5.17 Key Issue 17: MSISDN-less MO SMS
-------------------------------------

### 5.17.1 Description

This key issue addresses how the MSISDN-less MO SMS API may be
implemented on the Nnef interface.

TS23.682\[6\] defines a procedure for sending MSISDN-less MO SMS via
the T8 interface. The procedure is used by the network to send MO SMS to
the SCS/AS.

### 5.17.2 Architectural requirements

\- The Nnef interface should allow the NEF to forward MO SMS to an AF.

### 5.17.3 Architectural baseline

\- MO SMS between the UE and SMS-SC is unchanged. The service centre
address points to the SMS-SC which can route the MO SMS to the AF, the
destination SME address is set to short/long code of the AF, and
Application Port ID element of the TP-User-Data field is set to an
appropriate value.

\- The SMS-SC uses the destination SME address (long/short code of the
AF) to identify the corresponding NEF based on a pre-configured mapping
table. SMS-SC extracts the SMS payload, Application port ID, and IMSI of
the UE and delivers them to NEF via a T4 Interface along with the
destination SME address (long/short code of the SCS/AS). The NEF acts as
an MTC-IWF on the T4 interface.

\- The NEF identifies the AF with the destination SME address
(long/short code of the SCS/AS) received from the SMS-SC.

\- As is done on T8, the NEF will use the MSISDN-less MO SMS API to send
MO SMS to the AF via the Nnef interface.

### 5.17.4 Open issues

None.

6 Solutions
===========

6.1 Solution 1: Infrequent small data transfer via NAS-SM and N6
----------------------------------------------------------------

### 6.1.1 Introduction

#### 6.1.1.1 General

This solution applies to Key issue 1 (support for infrequent small data
transmission). The key idea of the solution is to convey small data
inside NAS PDUs between UE and SMF for PDU session types IPv4, IPv6,
unstructured.

Operators are not required to upgrade all SMFs to support small data
transfer via NAS as the AMF is assumed to be able to select an SMF
capable of small data transfer via NAS. This enables isolation from SMFs
handling non-CIoT related sessions but also allows for separate scaling
of SMFs supporting small data via NAS-SM.

Support for Reliable Data Service (RDS) is provided as described in
Solution\[49\].

Further details related to infrequent data transfer via API(s)/NEF are
described in clause6.30 (Solution30).

#### 6.1.1.2 Architecture reference models

##### 6.1.1.2.0 General

This clauseshows the architecture reference models for the cases where
a NAS Small Data Delivery PDU Session terminates at a UPF and
architecture reference models that support API usage in the cases where
a NAS Small Data Delivery PDU Session terminates at a NEF.

This solution presents no Roaming Reference Architecture for the Local
Breakout case when the PDU session terminates at an NEF because a Small
Data API service will not be exposed by the visited network. This is in
line with the architecture principle from TS23.501\[5\] which states
\"*For external exposure of services related to specific UE(s), the NEF
resides in the HPLMN. Depending on operator agreements, the NEF in the
HPLMN may have interface(s) with NF(s) in the VPLMN*.\".

APIs are exposed to the AF via the N33/Nnef reference point.

The N29 reference point will be used to send and receive small data
packets via the NEF.

##### 6.1.1.2.1 Non-roaming reference architectures

Figure 6.1.1.2.1-1: Architecture for small data delivery via NAS and N6
or N33 (non-roaming)

##### 6.2.1.2.2 Roaming reference architectures

Figure 6.1.1.2.2-1: Architecture for small data delivery via NAS and N6
or N33 (home-routed roaming)

Figure 6.1.1.2.2-2: Architecture for small data delivery via NAS and N6
(roaming with local break-out)

### 6.1.2 Functional Description

The following principles apply:

\- Small data transfer via NAS-SM:

\- Small data is exchanged between the UE and SMF as payload of SM data
transfer message in both uplink and downlink direction.

NOTE1: It is assumed that the PDU Session ID in the SM data transfer
message is not sent in the SM data transfer message but is instead
provided separately by the AMF to the SMF. Whether or not other IEs in
the SM header can be omitted is left for Stage 3.

\- AMF transparently forwards downlink SM data transfer messages between
UE and SMF.

\- NAS transport messages are used to transfer SM data transfer messages
between UE and AMF.

\- The payload container type use for the downlink/uplink NAS transport
message carrying SM data transfer message is a new container type \"SM
data transfer\". This allows the AMF to differentiate between regular SM
signaling and SM data transfer and apply overload control accordingly.

\- For uplink NAS transport, the PDU session ID allows the AMF to route
the SM data transfer message to the correct SMF as stored in the UE
context.

\- SM data transfer messages are associated with a PDU session.

\- For a UE in CM Idle mode, it should be possible to send an initial
NAS transport message with the SM data transfer message as payload.

NOTE2: It is currently not possible to send NAS transport message as
defined in TS24.501\[10\] as Initial NAS message (the UE needs to
perform service request or registration procedure first to establish a
secure NAS connection between UE and AMF). It is up to CTWG1 to decide
whether a new NAS message needs to be defined, NAS transport message is
extended or service request is extended to transport SM data transfer
message.

\- Supported PDU session types:

\- Small data transfer supports IP and unstructured data.

\- Integrity protection, ciphering and header compression:

\- Integrity protection and ciphering for small data are performed by
AMF (existing NAS PDU integrity protection and ciphering functionality
are re-used as is).

\- UE and SMF may perform header compression for IP data.

\- AMF selection:

NOTE3: AMF selection is part of Key Issue15 (Core Network selection
for Cellular IoT) and the selected solution for Key Issue15 is used.-
SMF selection.

\- During the PDU session establishment procedure the AMF takes the UE
request into account to select an SMF that supports Data Transfer over
NAS-SM.

\- PDU Session Anchor (NEF or UPF) Selection:

\- When the PDU Session is established, as described in clause6.1.4.1,
PDU Session Anchor (NEF or UPF) selection is performed in step 5 as
follows:

\- If the PDU Session type is unstructured, the SMF uses the DNN and/or
the S-NSSAI to check the UE\'s subscription. The UE\'s subscription may
include an \"Invoke NEF Selection\" flag for the DNN/S-NSSAI
combination.

\- When the \"Invoke NEF Selection\" flag is present, the subscription
information will also include the NEF Identity that should be used to
anchor the PDU Session.

\- When the \"Invoke NEF Selection\" flag is not present, the SMF will
perform UPF selection to select a UPF to anchor the PDU Session as
described in Solution1.

\- Further details on the support of APIs for infrequent small data
transmission are described in Solution30.

\- Releasing the UE based on Release Assistance Indication provided by
the UE. Two options have been discussed:

\- Option 1 (Release Assistance Indication in NAS-MM - NAS RAI):

\- The UE sends the NAS Release Assistance Indication (NAS RAI) to the
AMF inside the NAS PDU, i.e. outside the SM data transfer message
embedded in the NAS PDU.

\- The AMF handles the NAS RAI as follows:

\- if the NAS RAI indicates that no further uplink or downlink data
transmissions are expected and unless the AMF is aware of other pending
MT traffic, the AMF requests NG-RAN to release the UE context;

\- if the NAS RAI indicates that only a single downlink data
transmission subsequent to this uplink data transmission is expected,
then the AMF requests NG-RAN to release the UE context once the AMF has
forwarded the next downlink NAS transport message with container type
\"SM data transfer\" to the UE unless the AMF is aware of other pending
MT traffic.

\- Option 2 (Release Assistance Indication in AS - AS RAI plus N2 RAI):

\- The UE sends AS Release Assistance Indication (AS RAI) to the NG-RAN.
The AS RAI indicates whether no further uplink/downlink transmissions or
only a single downlink transmission is expected.

NOTE4: This differs from the AS RAI defined in Rel-14 EPS (see
TS36.321\[27\], TS36.331\[23\]).

\- When NG-RAN receives the AS RAI from the UE, NG-RAN shall maintain
the UE\'s RRC connection in case RRC connection establishment procedure
was executed, and include an N2 RAI indication (no further
uplink/downlink transmissions or only a single downlink transmission) in
the Initial UE message, in the next Uplink NAS transport message or in
an RAI specific NGAP indication;

\- The AMF evaluates the N2 RAI as follows:

\- If the N2 RAI indicates no further uplink/downlink transmissions and
the AMF is not aware of any pending DL data for the UE (e.g. a pending
SMS or pending DL data buffered e.g. in SMF/UPF as part of extended
buffering), the AMF sends the N2 UE Context Release Command to NG-RAN as
per the AN Release procedure (TS23.502\[7\], clause4.2.6).

\- If the N2 RAI indicates only a single downlink transmission is
expected, the AMF sends the N2 UE Context Release Command to NG-RAN as
per the AN Release procedure (TS23.502\[7\], clause4.2.6) once the
AMF has forwarded the next downlink NAS transport message with container
type \"SM data transfer\" to the UE and unless the AMF is aware of other
pending MT traffic.

NOTE5: The Release Assistance Indication in AS can also support
UP-based data delivery. In this case the RAN is expected to send the N2
UE Context Release Request including the N2 RAI to the AMF. The AMF
sends the N2 UE Context Release Command to NG-RAN unless the AMF is
aware of other pending MT traffic. The RAN releases the UE once it has
received the N2 UE Context Release Command from the AMF and once an
outstanding UP downlink transmission has been received (if applicable).

The UE may choose which option to use, allowing it to take advantage of
the different optimisation that each option brings and how the UL
traffic the RAI is associated with is being transferred. The UE should
not use NAS RAI when the last UL traffic is via DRBs or data via AMF is
not being used as in these cases any efficiencies will be lost. The UE
may use AS RAI at any time.

NOTE6: The details of Option 2 are to be defined by RAN WGs.

NOTE7: The AS RAI and related N2 RAI apply only to Higher Layer PDUs
(i.e. NAS PDU, NAS Signalling, UP Data, but not RLC signalling).

NOTE8: See Solution30 for further details on NEF based data transfer.

\- Early Data Transmission may be initiated by the UE for mobile
originated small data over NAS-SM.

### 6.1.3 Support of EPC interworking

EPC interworking for small data transfer via NAS-SM uses the
architecture for EPC-5GC interworking with N26 as specified in
TS23.501\[5\] clauses 4.3.1 and 4.3.2 as a baseline.

The following principles apply:

\- Idle-mode mobility from 5GS to EPS is performed as per the procedure
described in TS23.502\[7\] clause4.11.1.3.2 with the following
differences:

\- Step 5b: When the SMF returns the mapped EPS bearer contexts to the
AMF the SMF sets the Control Plane Only PDN Connection Indication for
Data over NAS-SM PDU sessions.

\- Idle-mode mobility from to EPS to 5GS is performed as per the
procedure described in TS23.502\[7\] clause4.11.1.3.3 with the
following differences:

\- AMF indicates support of CIoT Optimizations when requesting the UE
context from the MME via N26;

\- for a PDN connection for which Control Plane Only PDN Connection
Indication is set,

\- in case of home-routed roaming,

\- Step 14: the AMF selects a V-SMF supporting small data over NAS-SM;

\- Step 14: the V-SMF configures the UPF for data transfer via N4;

\- When the \"Invoke NEF Selection\" flag is present in the UE\'s
subscription information for the PDU Session, the identified NEF will
point to an SCEF+NEF if EPC Interworking is supported.

\- When the \"Invoke NEF Selection\" flag is not present in the UE\'s
subscription information for the PDU Session, the identified SMF will
select a PGW+UPF as the PDU Session anchor.

### 6.1.4 Procedures

#### 6.1.4.0 General

This clause describes the procedures for the case where the PDU Session
is terminated at a UPF. Refer to Solution30 for the case where the PDU
session anchor is an NEF.

#### 6.1.4.1 PDU Session Establishment 

This procedure takes the PDU Session Establishment procedure as
described in TS23.502\[7\], clause4.3.2.2.1 as the baseline.

Figure 6.1.4.2-1: PDU Session Establishment enabling Data over NAS-SM

1\. The UE sends a PDU session establishment request message as SM
payload of a NAS transport message. The NAS transport message contains
PDU session ID along with other regular information e.g. DNN, S-NSSAI,
etc. if applicable.

2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs.
If the PDU Session will use NAS-SM to transfer PDUs, the AMF selects an
SMF that supports Data over NAS-SM if available for the requested DNN,
and S-NSSAI. The AMF stores the association of the PDU Session ID and
the selected SMF ID in the UE context. The network chooses to transfer
data to the DN via N6.

NOTE 1: How the AMF determines if the PDU Session uses NAS-SM to
transfer PDUs will be determined as part of the Key Issue15 conclusion.

NOTE 2: As captured in clause4, it is assumed that the exposure of
network capabilities towards the SCS/AS is done via NEF. In addition, as
captured in clause8.9, *when a UE is capable of switching between EPC
and 5GC, it shall only be associated with combined SCEF+NEF node(s) for
Service Capability Exposure.* Consequently, data towards SCS/AS can be
routed via a NEF+SCEF combined node. See also Solution30.

3\. The AMF invokes Nsmf\_PDUSession\_CreateSMContext request including
DNN, S-NSSAI and PDU Session ID. The AMF also indicates to the SMF if
the PDU Session uses NAS-SM to transfer PDUs. The SMF replies with an
Nsmf\_PDUSession\_CreateSMContext Response.

4\. The SMF may perform a Session Management Policy Establishment
procedure.

5\. The SMF selects a UPF.

6\. The SMF configures the UPF for data transfer via N4.

7\. The SMF sends a PDU Session Establishment Accept providing
indication that Data Over NAS-SM is enabled for this PDU session without
including the N2 SM container.

8\. The AMF forwards the NAS message to the UE.

#### 6.1.4.2 Mobile Originated Data Transport via NAS-SM and N6

Figure 6.1.4.2-1: Mobile Originated Data Transport via NAS-SM

0\. The UE is in CM-IDLE.

1\. The UE establishes an RRC connection or sends the
RRCEarlyDataRequest message and sends a NAS PDU as part of this. The NAS
PDU carries encrypted uplink data as payload of an SM data transfer
message and a PDU session ID.

2\. NG-RAN forwards the NAS PDU to the AMF. If RRCEarlyDataRequest
message was received in step 1, the NG-RAN includes \"EDT Session\"
indication in the N2 Initial UE message. For Option 2, the NG-RAN
further indicates request to release RRC connection in N2 Initial UE
message.

3\. AMF checks the integrity of the incoming NAS PDU and decrypts the
data it contains.

3a. If the AMF received \"EDT Session\" indication from the NG-RAN in
step 2, the AMF sends an N2 message to the NG-RAN.

a\) If the Release Assistance Information was received from UE in Option
1 with Uplink data and it indicated that Downlink data was not expected
or if the AMF received a request to release RRC connection in N2 Initial
UE message for Option 2, and the AMF does not expect any other
signalling with the UE, the AMF should:

\- either send a NAS service accept in the N2 Downlink NAS message and
include End Indication to indicate that no further data or signalling is
expected with the UE; or,

\- alternatively, instead of a NAS service accept, the AMF sends an N2
Connection Establishment Indication message including End Indication to
indicate that no further data or signalling is expected with the UE.

b\) If the AMF determines more data or signalling may be pending, the
AMF sends an N2 connection establishment indication message without End
Indication.

3b. In case 3a was executed, the NG-RAN completes the RRC early data
procedure as follows.

a\) For the case of 3a.a) the NG-RAN proceeds with RRCEarlyDataComplete
message. The procedure is completed in Step 5.

b\) For the case of 3a.b) the NG-RAN proceeds with RRC connection
establishment procedure. In that case all steps up to step 12 apply,

4\. AMF forwards the data to the (V-)SMF handling the PDU session
identified by the PDU session ID contained in the NAS transport message.

NOTE 1: Whether a new or an existing service operation of SMF should be
invoked in this step is to be decided during normative phase.

5\. The (V-)SMF decompresses the header if header compression applies to
the PDU session. The V-SMF forwards the data to the UPF. (In the
home-routed roaming case, the UPF may forward the data to a different
UPF in the HPLMN via N9.) The UPF forwards the data to the DN, In case
of unstructured data, tunneling may be applied according to
clause5.6.10.3 in TS23.501\[5\].

6\. \[Conditional\] The UPF forwards available downlink data to the
(V-)SMF,

7\. \[Conditional\] The (V-)SMF compresses the header if header
compression applies to the PDU session and encapsulates the downlink
data as payload in an SM data transfer message. The (V-)SMF forwards the
SM data transfer message and the PDU session ID to the AMF using the
Namf\_Communication\_N1N2MessageTransfer service operation.

8\. \[Conditional\] The AMF creates a DL NAS transport message with the
received PDU session ID and the SM data transfer message (container type
is set to SM data transfer). The AMF ciphers and integrity protects the
NAS transport message.

9\. \[Conditional\] The AMF sends the DL NAS transport message to
NG-RAN.

10\. \[Conditional\] NG-RAN delivers the NAS payload over RRC to the UE.

11\. \[Conditional\] If no further NAS PDU activity is detected by
NG-RAN, then NG-RAN triggers the AN release procedure.

12\. The UE\'s logical NG-AP signaling connection and RRC signaling
connection are released as per TS23.502\[7\] clause4.2.6.

NOTE2: How the UE is released based on Release Assistance Information
is covered in clause6.1.2.

NOTE3: The details of the NGAP messages to be used for this procedure
are to be decided by RAN WG3.

#### 6.1.4.3 Mobile Terminated Data Transport via NAS-SM and N6

Figure 6.1.4.3-1: Mobile Terminated Data Transport via NAS-SM

1\. The UPF forwards a downlink data packet to the SMF.

2\. The (V-)SMF compresses the header if header compression applies to
the PDU session and encapsulates the downlink data as payload in an SM
data transfer message. The (V-)SMF forwards the SM data transfer message
and the PDU session ID to the AMF using the
Namf\_Communication\_N1N2MessageTransfer service operation.

3\. \[Conditional\] If the UE is in CM Idle, the AMF sends a paging
message to NG-RAN.

4\. \[Conditional\] If NG-RAN received a paging message from AMF, NG-RAN
perform paging.

5\. \[Conditional \] If the UE receives paging message, it responds with
service request.

7\. The AMF creates a DL NAS transport message with the received PDU
session ID and the SM data transfer message (container type is set to SM
data transfer). The AMF ciphers and integrity protects the NAS transport
message.

8\. The AMF sends the DL NAS transport message to NG-RAN.

9\. NG-RAN delivers the NAS payload over RRC to the UE.

10\. While the RRC connection is established further uplink and downlink
data can be exchanged. In order to send uplink data, the UE sends an
integrity protected NAS PDU as RRC uplink data. The NAS PDU carries
encrypted uplink data as payload of an SM data transfer message and a
PDU session ID.

11\. NG-RAN forwards the NAS PDU to the AMF.

12\. AMF checks the integrity of the incoming NAS PDU and decrypts the
data it contains.

13\. AMF forwards the data to the (V-)SMF handling the PDU session
identified by the PDU session ID contained in the NAS transport message.

NOTE1: Whether a new or an existing service operation of SMF should be
invoked in this step is to be decided during normative phase.

14\. The (V-)SMF decompresses the header if header compression applies
to the PDU session. The V-SMF forwards the data to the UPF. (In the
home-routed roaming case, the UPF may forward the data to a different
UPF in the HPLMN via N9.) The UPF forwards the data to the DN, In case
of unstructured data, tunneling may be applied according to
clause5.6.10.3 in TS23.501\[5\].

15\. \[Conditional\] If no further NAS PDU activity is detected by
NG-RAN, then NG-RAN triggers the AN release procedure.

16\. The UE\'s logical NG-AP signaling connection and RRC signaling
connection are released according to TS23.502\[7\] clause4.2.6.

NOTE2: How the UE is released based on Release Assistance Information
is covered in clause6.1.2.

NOTE3: The details of the NGAP messages to be used for this procedure
are to be decided by RAN WG3.

### 6.1.5 Impacts on existing entities and interfaces

AMF:

\- Support of new payload container type for SM data transfer.

\- Support for initial NAS transport message with the SM data transfer
message as payload.

\- Support for selecting SMF capable of Data over NAS.

\- Support of release assistance indication handling.

SMF:

\- Supports and Sending and Receiving PDUs via NAS-SM.

\- Support of new payload container type and SM data transfer message.

\- Header compression for IP data.

\- Receives the \"Invoke NEF Selection\" and \"NEF ID\" during PDU
Session Establishment.

\- Support for a N4-like services on the N29 interface with the NEF for
Unstructured PDU Session.

\- Supports exchange of Small Data PDUs with the UPF on the N4
interface.

UPF:

\- Support for extended buffering.

\- Supports exchange of Small Data PDUs with the SMF on the N4
interface.

UE:

\- Supports and Sending and Receiving PDUs via NAS-SM.

\- Support of new payload container type and SM data transfer message.

\- Support for initial NAS transport message with the SM data transfer
message as payload.

\- Support of release assistance indication handling.

UDM/UDR:

\- Support for the NIDD Configuration, MT NIDD, and MO NIDD APIs as
described in TS29.122\[9\] and TS23.682\[6\].

\- Support for the authorisation during the NIDD Configuration
procedure.

NG-RAN:

\- Release Assistance Indication in AS (if chosen as the way forward).

### 6.1.6 Evaluation

This solution proposes to convey small data inside NAS-SM between UE and
SMF for PDU session types IPv4, IPv6 and unstructured. The AMF
transparently forwards small data inside NAS-SM between UE and SMF.
Integrity protection and ciphering for small data are performed by AMF,
and the UE and SMF may perform header compression for IP data. This
solution supports also infrequent data transfer via API(s)/NEF (see
clause6.30 - in particular conclusions in clause6.30.6 - for more
details). Solution1 supports early data and reuses EPC interworking as
defined in Rel-15, i.e. relies on mapping PDU sessions to PDN
connections.

Pros:

\- No need to establish user plane PDU session to transfer data.

\- UE\'s application functionality are not affected.

\- Limited or no impact on RAN (depending on RAI conclusions).

\- Easy interworking with EPC based CIoT. Solution1 follows the same
concept as EPS CP optimization. This enables low complexity IoT devices
that support both EPC and 5GC connectivity to send small data over NAS
(i.e. without having to support a user-plane stack, AS security, etc.)
regardless of the core network those devices are connected to.

Cons:

\- The solution(s) for Overload Control for small data (see KI7 and
related solutions) are required to help manage any additional load on
the AMF and/or SMF.

\- Impact on AMF and SMF to transfer small data.

\- Whether to send the existing SM header or a shortened SM header with
the small data is up to CTWG1.

This solution successfully addresses Key Issues1 (Support for
infrequent small data transmission).

6.2 Solution 2: Infrequent small data transfer through NAS and a direct interface between AMF and UPF
-----------------------------------------------------------------------------------------------------

### 6.2.1 Introduction

This solution applies to Key Issue 1 - Support for infrequent small data
transmission.

### 6.2.2 Functional Description

This solution introduces a user plane interface between AMF and UPF. We
call it Nx interface here which is a user plane tunnel. Packets are
transferred from UE to AMF through NAS and from AMF to UPF through the
Nx tunnel. To support NIDD, packets can be transferred from UE to AMF
through NAS and from AMF to NEF. It\'s shown in the Figure 6.2.2-1.

Figure 6.2.2-1: Architecture for infrequent small data transfer through
NAS and a direct interface between AMF and UPF

The assumption is UE has registered with network and has negotiated with
the network of control plane small data transfer capabilities.

During the UE requested PDU session establishment procedure, a session
level Nx user plane tunnel is established between AMF and UPF. N11and N4
signalling is used to control the Nx tunnel setup. E.g. exchanges the
tunnel info between AMF and UPF.

For MO data transfer, When AMF receives the NAS data PDU including the
PDU session ID from UE, AMF identifies the related Nx tunnel based on
the PDU session ID and transfers the received data PDU to UPF through
the Nx tunnel. The UPF forwards the data to the DN. If the Nx tunnel is
not established, N11and N4 signalling is used to control the Nx tunnel
setup.

For MT data, after receiving DL data from DN, UPF buffers the DL data
and sends Data Notification to SMF, and SMF sends the Data Notification
to AMF. AMF paging UE in case the UE is in CM-IDLE state. Upon reception
of paging indication, the UE sends a UE triggered Service Request NAS
message to AMF, the Nx tunnel is established after the N11 and N4
signalling interaction. UPF forwards the DL data to AMF through the Nx
tunnel. AMF sends the DL data as NAS data PDU to UE.

For IP data, the UE and AMF may perform header compression. For uplink
IP data, UE implements the compressor, and AMF implements the
decompressor. For downlink IP data, AMF implements the compressor, and
UE implements the decompressor. The header compression is supported at
AMF. The NAS data PDU is sent using NAS MM message.

For NIDD support, AMF determines whether or not the NIDD via NEF shall
be used for a PDU session based on subscription information and the
DNN/S-NSSAI received from UE. The subscription information includes NEF
ID for the DNN/S-NSSAI. To setup the Session between AMF and NEF, AMF
sends NEF id, the C-Plane address of AMF and the Create NEF Session
Request to SMF, SMF forwards the received information to NEF and gets
the Create NEF Session Response and the NEF C-Plane address. SMF
provides the Create NEF Session Response and the NEF C-Plane address to
AMF, thus the Session between AMF and NEF are setup. NEF supports
infrequent small data transmission and capability exposure to AF is
similar to the SCEF as described in TS23.682\[6\]

### 6.2.3 Support of EPC interworking

The existing EPS-5GS interworking principles are used with the
differences that the UE should support for small data over NAS in both
in 4G and 5G network. Idle-mode mobility from 5GS to EPS and Idle-mode
mobility from to EPS to 5GS are supported as the procedures described in
TS23.502\[7\], clause4.11.1.3.

### 6.2.4 Procedures

### 6.2.4.1 Nx tunnel setup

The Nx tunnel is setup during the PDU session establishment procedure.
Figure 6.2.4.1-1 depicts how to setup an Nx tunnel between AMF and UPF.

Figure 6.2.4.1-1: Nx tunnel setup

1\. The PDU Session Establishment Request NAS message is received from
UE.

2\. If this PDU Session is used for control plane small data transfer
and AMF decides to setup Nx tunnel for the data transfer between AMF and
UPF, AMF allocates the its Nx tunnel info used for DL data forwarding
from UPF. AMF includes its Nx tunnel info in the
Nsmf\_PDUSession\_CreateSMContext Request from AMF to SMF.

3\. The Nsmf\_PDUSession\_CreateSMContext Response is provided from SMF
to AMF.

4\. The SMF sends an N4 Session Establishment Request to the UPF
including the Nx tunnel info of AMF. If the Nx Tunnel Info of UPF is
allocated by the SMF, the Nx Tunnel Info of UPF is provided to UPF in
this step.

5\. The UPF acknowledges by sending an N4 Session Establishment
Response. If UPF is responsible for allocating its Nx Tunnel Info, the
Nx Tunnel Info of UPF is provided to SMF in this step.

6\. SMF sends the Nx Tunnel Info of UPF to AMF using the
Namf\_Communication\_N1N2MessageTransfer operation. The Nx tunnel is
setup between AMF and UPF. PDU Session Establishment Accept message is
carried in the N1 SM container.

7\. The PDU Session Establishment Accept NAS message is sent to UE.

### 6.2.4.2 Nx tunnel release

The Nx tunnel could be released during the AN release procedure as
depicted in Figure6.2.4.2-1 or during the CN-initiated selective
deactivation of UP connection of an existing PDU Session procedure as
depicted in Figure6.2.4.2-2.

Figure 6.2.4.2-1: Nx tunnel release due to AN release

1\. AMF may decide to perform AN release based on local reason or the
request received from AN. the AMF sends an N2 UE Context Release Command
to the (R)AN.

2\. If the (R)AN connection with the UE is not already released, the
(R)AN requests the UE to release the (R)AN connection.

3\. The (R)AN confirms the N2 Release by returning an N2 UE Context
Release Complete message to the AMF. The N2 signalling connection
between the AMF and the (R)AN for that UE is released.

4\. If there are active Nx tunnels between AMF and UPF for the UE, for
each active Nx tunnel, the AMF invokes Nsmf\_PDUSession\_UpdateSMContext
Request to deactivate the Nx tunnel for the PDU Session.

5\. SMF sends the N4 Session Modification Request to UPF to remove the
Nx tunnel info.

6\. UPF sends the N4 Session Modification Response acknowledging the SMF
request.

7\. SMF sends Nsmf\_PDUSession\_UpdateSMContext Ack to AMF to confirm
the Nx tunnel is released.

Figure 6.2.4.2-2: Nx tunnel release due to selective PDU session
deactivation

1\. When SMF determines to deactivate a PDU session and the PDU Session
is used for control plane small data transfer, the SMF sends N4 Session
Modification Request to remove the Nx tunnel of the corresponding PDU
Session.

2\. UPF sends the N4 Session Modification Response acknowledging the SMF
request.

3\. The SMF invokes the Namf\_Communication\_N1N2MessageTransfer service
operation to indicate AMF to release the Nx tunnel. AMF removes the
related Nx tunnel info.

4\. The AMF invokes the Nsmf\_PDUSession\_UpdateSMContext service
operation to acknowledge the Namf service received in step 3.

### 6.2.4.3 MO data transport

Figure 6.2.4.3-1: MO data transfer

1\. UE transfers the data to AMF as the NAS data PDU. The PDU session ID
is included in the NAS data PDU.

2\. When AMF receives the NAS data PDU including the PDU session ID from
UE, The AMF decompresses the IP header if header compression applies to
the PDU session. AMF identifies the related Nx tunnel based on the PDU
session ID. If the Nx tunnel is not established, AMF includes its Nx
tunnel info in the Nsmf\_PDUSession\_UpdateSMContext from AMF to SMF.

3\. The SMF sends the Nx tunnel info of AMF to UPF, and the Nx tunnel
info of UPF is determined at this step.

4\. SMF sends the Nx Tunnel Info of UPF to AMF. The Nx tunnel is setup
between AMF and UPF.

5\. AMF transfers the received data PDU to UPF through the Nx tunnel.
The UPF forwards the data to the DN.

### 6.2.4.4 MT data transport

Figure 6.2.4.4-1: MT data transfer

1\. When UPF receives downlink data of a PDU session, and the Nx tunnel
is not established, the UPF buffers the downlink data. UPF sends Data
Notification message to the SMF.

2\. The SMF invokes the Namf\_Communication\_N1N2MessageTransfer to the
AMF.

3\. If the UE is in CM-IDLE state, AMF performs paging for the UE.

4\. Upon reception of paging indication, the UE sends a UE triggered
Service Request NAS message to AMF.

5\. AMF includes its Nx tunnel info in the
Nsmf\_PDUSession\_UpdateSMContext from AMF to SMF.

6\. The SMF sends the Nx tunnel info of AMF to UPF, and the Nx tunnel
info of UPF is determined at this step.

7\. SMF sends the Nx Tunnel Info of UPF to AMF. The Nx tunnel is setup
between AMF and UPF.

8\. UPF forwards the downlink data to the AMF through the Nx tunnel.

9\. The AMF compresses the header if header compression applies to the
PDU session and encapsulates the downlink data into the NAS message. AMF
sends the DL data as NAS data PDU to UE over NAS signalling.

### 6.2.4.5 NIDD support

The procedure for PDU Session Establishment enabling Data over NAS and
NEF is as following:

Figure 6.2.4.5-1: PDU Session Establishment enabling Data over NAS and
NEF

1\. The PDU Session Establishment Request is carried in a NAS message.
The session ID and DNN, S-NSSAI, etc. if applicable are also contained
in this NAS message.

2\. If this PDU Session is used for control plane small data transfer,
and the subscription information includes NEF ID for the corresponding
DNN/S-NSSAI, the AMF determines to setup the connection between AMF and
NEF, AMF includes NEF id, the C-Plane address of AMF and the Create NEF
Session Request (the UE ID, session ID and DNN, S-NSSAI, etc.) with the
N1 SM container (PDU Session Establishment Request) in the
Nsmf\_PDUSession\_CreateSMContext Request from AMF to SMF.

3\. The SMF replies with an Nsmf\_PDUSession\_CreateSMContext Response.

4\. The SMF sends the connection setup request to NEF including the NEF
id, the C-Plane address of AMF and the Create NEF Session Request (the
UE ID, session ID and DNN, S-NSSAI, etc.). The rate control information
may also be included in this message based on the SMF local
configuration or interaction with PCF.

5\. If an SCS/AS has performed the NIDD Configuration procedure (similar
procedure as described in TS23.682\[6\] clause5.13) , the NEF
associates the NIDD connection with the PDU Session. Otherwise, the NEF
rejects the procedure. NEF provides connection setup response to SMF
including the C-Plane address of NEF and the Create NEF Session
Response.

6\. The SMF sends the Namf\_Communication\_N1N2MessageTransfer to AMF
including PDU Session Establishment Accept message and the received
C-Plane address of NEF and the Create NEF Session Response.

7\. After receiving the C-Plane address of NEF and the Create NEF
Session Response, the connection between AMF and NEF are setup. The PDU
Session Establishment Accept NAS message is sent to UE.

### 6.2.5 Impacts on existing entities and interfaces

The following nodes are impacted:

AMF:

\- support the user plane Nx tunnel between AMF and UPF including Nx
tunnel info allocation.

\- support the header compression function.

SMF:

\- support the the Nx tunnel info transfer between AMF and UPF.

### 6.2.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.3 Solution 3: Infrequent small data transmission with no PDU session available
--------------------------------------------------------------------------------

### 6.3.1 Introduction

This solution applies to address the Key Issue 1: Support for infrequent
small data transmission.

The solution assumes that the UE does not establish a PDU session before
sending small data packet and addresses. This solution is only used for
non-IP data delivery.

### 6.3.2 Functional Description

Editor\'s note: This clauseoutlines solution principles and documents
any assumptions made.

The infrequent small data transmission procedure for a scenario where
the user data is forwarded to application server via control plane is
illustrated in Figure 6.4-1.

### 6.3.3 Support of EPC interworking

Editor\'s note: This clausedescribes if and how EPC-5GC interworking is
supported by this solution.

The solution 3 does not support EPC-5GC interworking. This solution is
only used for the UEs which only support 5GC-NAS.

### 6.3.4 Procedures

#### 6.3.4.1 Registration Procedure

During the Registration procedure, the AMF determines whether the user
data are allowed to be delivered without PDU session.

Figure 6.3.4.1-1: Small data transmission procedure

1\. The UE provides Non Session Data Delivery (NSDD) indication in the
Registration Request message. The UE provides NSDD indication only for
non IP data delivery.

2\. Authentication/Security procedure is performed.

3\. The AMF retrieves the UE subscription from the UDM; the UE
subscription data may indicate whether the NSDD is allowed or not for
the UE; The AMF determines whether the NSDD is activated for the UE
according to UE subscription;

4\. The AMF request NEF (as described in sub-clause6.4.2) or SMF to
create NSDD context for the UE, which may include UE ID, AMF ID, DNN
etc.; The RDS Configuration procedure as described in sub-clause6.4.4.2
between NEF and AF/AS may also be performed.

If the NSDD Context is established at the SMF, the SMF selects UPF and
initiates N4 session establishment procedure; the UPF establishes a
point-to-point tunnelling via the N6 between the UPF and the SCS/AS The
tunnel parameters are determined based on pre-configuration and/or the
NSDD context.

If the NSDD Context is established at the NEF, the NEF determines what
SCS/AS is associated with the context based on the user identity and the
DDN.

5\. The AMF indicates the UE that NSDD is activated in Registration
Accept message.

#### 6.3.4.2 MO NSDD procedure

If the NSDD is activated, the UE may send small data via NAS without PDU
session establishment.

Figure 6.3.4-1: MO NSDD

0\. The UE was in CM-IDLE state.

1\. The UE transmits the NAS Data PDU to the AMF.

2\. The AMF checks the integrity of the incoming NAS PDU and decrypts
the user data it contains.

If the NSDD Context is established at SMF, step 3 to step 6 are
performed. If the NSDD Context is established at NEF then MO delivery
mechanism described in sub-clause6.4.4.3 is used and step3 to step6
are skipped.

3\. The AMF determines the SMF based on the NSDD context for the UE and
forwards the user data to the SMF with the UE identity via N11 message.

4\. The SMF determines the corresponding N4 session for the user data
based on the UE identity received in step3, then the SMF forwards the
user data to the UPF via N4 message.

5\. The UPF receives the DL user data and forwards the user data to the
SMF based on the local association information between N4 session and
point-to-point tunnelling in N6.

6\. The SMF receives the DL user data and forwards the user data to the
AMF based on the local association information between the N4 session
and NSDD context.

7\. If downlink data is received, the AMF encrypts and integrity
protects the NAS transport message with downlink user data.

8\. The AMF transmits the DL NAS Data PDU to the UE.

#### 6.3.4.3 MT Small data transmission procedure

Figure 6.3.4.3-1: MT NSDD procedure

If the NSDD Context is established at SMF, step 1 to step 3 are
performed; if the NSDD Context is established at NEF, the MT delivery
mechanism described in clause6.4.4.4 is used and step1, step2 are
skipped.

1\. Upon receiving DL data from the N6 tunnel, the UPF forwards the DL
data to the SMF;

2\. The SMF forwards the user data to the AMF with the UE identity via
N11 message.

3\. The AMF forwards the user data container to the UE via NAS message.

### 6.3.5 Impacts on existing entities and interfaces

UE:

\- Non Session Data Delivery negotiation with the AMF during the
Registration procedure;

\- Support sending/receiving small data via NAS message without PDU
session available.

AMF:

\- Establish NSDD context with SMF/NEF for the UE if NSDD is enabled;

\- Forwarding small data between the SMF/NEF and the UE.

SMF:

\- Establish NSDD context and corresponding N4 session;

\- Forwarding small data between the UPF and AMF.

NEF:

\- Establish NSDD context with AMF;

\- Forwarding small data between the SCS/AS and AMF.

### 6.3.6 Evaluation

The solution proposes the small data are delivered via NAS message
without available PDU sessions. The proposed NSDD procedure is based on
the same principles as the PDN Connection to the SCEF in EPC and
addresses the NSDD context is established in the core network for small
data delivery and the UE sends/receives small data via NAS message
to/from the AMF without PDU session establishment procedure.

In this solution, 5GC stores NSDD context for the small data delivery.
There is not any PDU session context stored in the UE side and there is
no PDU session establishment procedure performed by the UE, therefore,
this solution can save the storage and power for the CIoT equipment.

6.4 Solution 4: Reliable Data Service Support
---------------------------------------------

### 6.4.1 Introduction

This solution addresses the Key Issue 1 - \"Support for infrequent small
data transmission\" and Key Issue 8 - \"Support of the Reliable Data
Service\".

### 6.4.2 Functional Description

#### 6.4.2.1 Support of Reliable Data Service

The Reliable Data Service is used by the UE and NEF for reliable small
data delivery of unstructured PDU. The service provides a mechanism for
the NEF to determine if the data was successfully delivered to the UE
and for UE to determine if the data was successfully delivered to the
NEF. When a requested acknowledgement is not received, the Reliable Data
Service retransmits the packet. Support for Reliable Data Service (RDS)
incurs the following functionality:

\- Use of NAS transport between UE and AMF for small data delivery. This
applies to both 3GPP and non-3GPP accesses.

\- Support for AMF determining the NEF for a given UE.

\- Support for subscription checking and actual transmission of MO/MT
small data delivery by the NEF to the AF/UE.

\- Support for MO/MT small data delivery for both roaming and
non-roaming scenarios.

\- Support for unstructured PDU.

\- Support for API exposure for Reliable Data Service towards 3rd party
application provider.

During registration procedure, a UE that wants to use RDS provides \"RDS
supported\" indication over NAS signalling indicating the UE\'s
capability for support of RDS. \"RDS supported\" indication indicates
whether UE can support reliable small data delivery over NAS via 3GPP
access or via both 3GPP and non-3GPP access. If the core network
supports RDS functionality, the AMF includes \"RDS supported\"
indication to the UE, and whether RDS delivery over NAS via 3GPP access
or via both the 3GPP and non-3GPP access is accepted by the network.

RDS packets are transmitted over NAS without the need to establish data
radio bearers, via NAS transport message, which can carry RDS payload.
PDU session establishment is not needed. UE and Network supports RDS
protocol as specified in TS24.250\[8\]. When the RDS is enabled, a
protocol is used between the end-points, i.e. between UE and NEF. The
protocol uses a RDS header to identify if the packet requires no
acknowledgement, requires an acknowledgement, or is an acknowledgment
and to allow detection and elimination of duplicate PDUs at the
receiving endpoint. Also Port Numbers in the header are used to identify
the application on the originator and to identify the application on the
receiver. This solution supports RDS over unstructured PDU only.

#### 6.4.2.2 Architecture to support RDS over 5GC

Figure 6.4.2.2-1 shows the non-roaming architecture to support RDS using
the Service-based interfaces within the Control Plane.

Figure 6.4.2.2-1: Non-roaming System Architecture for RDS

Figure 6.4.2.2-2 shows the non-roaming architecture to support RDS using
the reference point representation.

Figure 6.4.2.2-2: Non-roaming System Architecture for RDS in reference
point representation

Figure 6.4.2.2-3 shows the roaming architecture (Home Routed scenario)
to support RDS using the Service-based interfaces within the Control
Plane.

![](media/image21.wmf){width="4.670138888888889in"
height="1.9180555555555556in"}

Figure 6.4.2.2-3: Roaming architecture for RDS over NAS - Home Routed
scenario in service-based interface representation

Figure 6.4.2.2-4 shows the roaming architecture for NEF using the
reference point representation.

![](media/image22.wmf){width="3.701388888888889in"
height="2.7916666666666665in"}

Figure 6.4.2.2-4: Roaming architecture for NEF in reference point
representation

NOTE1: For the sake of clarity, SEPPs are not depicted in the roaming
figures6.4.2.2-3, and6.4.2.2-4.

NOTE 2: IWK-NEF is located in the VPLMN for inter-connection with the
NEF of the HPLMN. IWK-NEF (similar to IWK-SCEF in EPC) relays data
between AMF in VPLMN to NEF in HPLMN for home routed scenario.

### 6.4.3 Support of EPC interworking

The principles of Solution 13 are followed for interworking with EPC.
The S-NSSAI and DNN are used to determine if the Reliable Data Service
is used. When interworking with EPC is required, the RDS endpoint is an
SCEF+NEF. When the UE moves between EPC and 5GC, RDS state is recreated.
When the UE moves from EPC to 5GC and PDN Connections with RDS are
active, the PDN connections are released by the UE and the UE will
configure the RDS between the UE and NEF as described in the
Registration Procedure in clause6.4.2.1. In EPC, RDS state is
maintained for the lifetime of the PDN Connection to the SCEF. In 5GC,
RDS state is maintained for the lifetime of the UE Registration or NIDD
Configuration.

When RDS PDUs are sent via NAS,Serving PLMN rate control will apply.
Since RDS PDUs are not sent over a connection, APN rate control need not
apply.

### 6.4.4 Procedures

#### 6.4.4.1 Registration procedure supporting reliable small data delivery over NAS

![](media/image23.wmf){width="5.508333333333334in"
height="5.688194444444444in"}

Figure 6.4.4.1-1: Registration procedure supporting reliable small data
delivery over NAS

1\. During Registration procedure in 5GS defined in Figure4.2.2.2.2-1
of TS23.502\[7\], to enable reliable small data delivery, the UE
includes an \"RDS supported\" indication in Registration Request in step
1-3 indicating the UE\'s capability for RDS. The \"RDS supported\"
indication indicates whether the UE supports reliable small data
delivery over NAS via current access.

2\. Step4 to step14 of the Registration procedure in
Figure4.2.2.2.2-1 if TS23.502\[7\] are performed. When AMF relocation
happens during the Registration procedure, the old AMF transfers NEF
address to the new AMF as part of UE context in step5 of
Figure4.2.2.2.2-1.

3\. If the \"RDS supported\" indication is included in the Registration
Request, the AMF checks subscription from the UDM for the UE on whether
the RDS service is allowed to the UE. If yes and the UE context doesn\'t
include an available NEF of the serving PLMN, the AMF discovers and
selects an NEF to serve the UE. The NEF discovery is based on the
following methods:

\- NEF address preconfigured in the AMF (i.e. NEF FQDN); or

\- NEF address received from the UDM; or

\- The AMF invokes Nnrf\_NFDiscovery service operation from NRF to
discover the NEF address as described in clause5.2.7.3.2 of
TS23.502\[7\].

For roaming scenario, the AMF discovers and selects an NEF in VPLMN.

4\. Step15 to step20 of the Registration procedure in
Figure4.2.2.2.2-1 of TS23.502\[7\] are performed.

5\. The AMF invokes Nnef\_RDS\_Activate service operation from the NEF.
The invocation includes AMF address, Access Type, GPSI (if available)
and SUPI. AMF uses the NEF address derived from step 3.

6\. The NEF discovers a UDR as described in TS23.501\[5\],
clause6.3.9.

7a-7b. If the UE context already exists in the NEF, the NEF shall
replace the old AMF address with the new AMF address. Otherwise NEF
retrieves RDS related subscription data using Nudm\_UDM\_Query and
subscribes to be notified using Nudr\_UDM\_Notify when the RDS related
subscription data is modified.

NEF also creates an UE context to store the RDS subscription information
and the AMF address that is serving this UE.

8\. The NEF responds back to the AMF with Nnef\_RDS\_Activate service
operation response message. The AMF stores the NEF address received as
part of the UE context.

9\. The AMF includes the \"RDS supported\" indication to the UE in the
Registration Accept message of step21 of Figure4.2.2.2.2-1 of
TS23.502\[7\] only after step 8 in which the AMF has received a
positive indication from the selected NEF.

The \"RDS supported\" indication in the Registration Accept message
indicates to the UE whether the network allows the reliable small
message delivery over NAS via 3GPP access or via both the 3GPP and
non-3GPP access.

#### 6.4.4.2 RDS Configuration procedure between NEF and AF/AS

Figure 6.4.4.2-1 illustrates the procedure of configuring necessary
information at the NEF and UDR.

In order to avoid MO reliable small data delivery failure, the RDS
configuration procedure should be performed by the AF/AS prior to the UE
requesting send MO reliable small data delivery.

Figure 6.4.4.2-1: RDS Configuration procedure between NEF and AF/AS

1\. The AF/AS used Nnef\_RDS\_Config\_Request service operation to
establish routing information in UE context at NEF. AF/AS provides
external identifier for UE message and reliable data service
configuration information (e.g. application port number) to the NEF.

3\. The NEF used Nudr\_UDM-Query\_Request service operation to check if
RDS configuration request for the received External Identifier is
authorized, and to receive necessary information for RDS, if required.

4\. The UDR examines the Nudr\_UDM-Query\_Request, e.g. with regard to
the existence of External Identifier and maps the external identifier to
SUPI. The UDR sends Nudr\_UDM\_Query\_Response (SUPI, Result) to the NEF
to acknowledge acceptance of the RDS Authorization.

6\. The NEF usese Nnef\_RDS\_Config\_Response service operation to
acknowledge acceptance of the RDS Configuration Request to the AF/AS. If
the RDS Configuration was accepted, the NEF will create an association
between the External Identifier and SUPI in UE context. In the MT
reliable small data delivery procedure, the NEF will use External
Identifier to determine the SUPI and receiver port number. In the MO
reliable small data delivery procedure, the NEF will use the SUPI, to
determine AS/AF address and application port number from the UE context.

#### 6.4.4.3 MO reliable small data delivery procedure

![](media/image25.wmf){width="6.691666666666666in"
height="3.3715277777777777in"}

Figure 6.4.4.3-1: MO reliable small data delivery procedure

It is assumed that the UE is registered with the network.

1\. The UE sends an integrity protected NAS PDU to the AMF via AN node.
The NAS PDU carries the UL RDS PDU data and indication for reliable
small data delivery.

2\. The AMF checks the integrity of the incoming NAS PDU and decrypts
the PDU data.

3\. The AMF determines the NEF based on the UE context and
Namf\_RDSTransfer service operation to send RDS PDU to NEF along with UE
identity (e.g. SUPI).

4\. The NEF sends the data PDU to the AF/AS according to UE context
using Nnef\_DataTransfer service operation.

5\. The NEF sends RDS acknowledgement to AMF using
Namf\_Communication\_N1N2\_message\_transfer service operation.

6\. The AMF encrypts the RDS Acknowledgement PDU and send to UE in DL
NAS message.

#### 6.4.4.4 MT reliable small data delivery procedure

![](media/image26.wmf){width="6.686805555555556in" height="4.175in"}

Figure 6.4.4.4-1: MT reliable small data delivery procedure

It is assumed that the AF/AS has performed RDS configuration procedure.

1\. The AF/AS request reliable small data delivery using
Nnef\_dataTransfer service operation. AS/AF provides External
Identifier, DL data PDU, and Reliable Data Configuration.

2\. The NEF based on UE context derive determines UE identity from UE\'s
External identifier. NEF determines if AF/AS requested reliable small
data delivery and adds RDS header to data PDU. NEF sends RDS PDU to AMF
using Namf\_Communication\_N1N2\_message\_transfer service operation.

3\. If the UE is in CM-IDLE, the AMF will buffer the RDS PDU and sends
paging message to AN nodes. Then the UE is paged by the AN nodes.
Otherwise, step 3 and step 4 are skipped.

4\. UE responds to paging with initial NAS message.

5\. The AMF performs integrity protection and encryption to the RDS PDU.

6\. The AMF sends encrypted NAS PDU with RDS PDU to the AN node in DL
NAS message.

### 6.4.5 Impacts on existing entities and interfaces

UE:

\- Support the RDS protocol as defined in TS24.250\[8\].

AMF:

\- Support of initial NAS message to carry NAS payload (if not supported
in Rel-15).

\- Support of service operation with NEF for MO/MT data transfer. Re-use
of existing services provided by AMF may be possible.

NEF:

\- Support the RDS protocol as defined in TS24.250\[8\].

\- Support of service operation with AMF for MO/MT data transfer. Re-use
of existing services provided by AMF may be possible.

\- Support of service operation with AS/AF for MO/MT data transfer.
Re-use of existing services provided by NEF may be possible.

\- Support of service operation with UDM/UDR for RDS configuration.

AS/AF:

\- Support of service operation with NEF for MO/MT data transfer and RDS
configuration.

### 6.4.6 Evaluation

This solution relies on use of the RDS protocol (already defined for
EPS) for reliable delivery of small data unstructured PDUs. It does not
require establishment of a PDU session as the RDS header contains the
routing information for the small data transfer between UE and AF. This
solution transmit small data over NAS-MM between UE and AMF and then
from AMF to NEF directly.

6.5 Solution 5: Small Data Fast Path communication
--------------------------------------------------

### 6.5.1 Introduction

This solution addresses the Key Issue 1: Support for infrequent small
data transmission.

The Small Data Fast Path (SDFP) solution targets to optimize small data
transmission for CIoT UEs in CM-IDLE mode. It describes how small data
can be passed in a fast path of the user plane without the overhead
amount of signalling caused by CM-IDLE / CM-CONNECTED mode transitions.

The SDFP solution has the following specifics:

\- UP security is between UE and UPF. The security information is
configured by AMF during UE registration or PDU session setup.

\- The UE passes information required for the RAN to forward the small
data to the UPF in the RRC message. The RAN derives the UPF information
from the information provided by the UE. The UPF information should be
abstract and hide the internal network architecture.

\- One or several QoS flows can be enabled for SDFP. UE will indicate
QoS information of the packet over radio interface, the RAN will forward
the QoS information for verification by the UPF (i.e. that the UE is
authorized to use a certain QoS flow).

\- The solution support DL data using CN paging. (e)DRX parameters etc.
is configured during UE registration. The solution can also support PSM
if defined.

\- Uses a UP connected to NEF, e.g. according to solution 35, to support
NIDD API(s) to AF/SCS/AS for the Indirect Model of communication.

### 6.5.2 Functional Description

#### 6.5.2.1 General

The Small data fast path is intended as an add-on function handled in a
separate PDU session. It does not replace any existing system function,
but it can be used if both the network and UE support it. This should
also keep the impact on the system lower and simplify the introduction
in Low Power Wide Area Networks (LPWAN).

Figure 6.5.2.1-1: E2E SDFP transmission

The SDFP is realized by providing relevant UPF or PDU session related
information to the UE from the network, which the UE would later provide
to the RAN. The UPF or PDU session relevant information enables the RAN
to derive the path over N3 to the UPF. At UL data arrival the UE passes
the data together with the UPF or PDU session relevant information to
the RAN. The RAN forwards the data on the N3 interface. Since info
required to determine the forwarding of the data is received from the
UE, the RAN does not need to signal to the AMF or have any UE context
information stored.

The UPF or PDU session relevant information is provided to the UE as
part of the Session Management (SM) procedures or UE Registration
procedures. The SMF may enable one (or more) of the QoS flows for SDFP.

The AMF derives SDFP security information and provides it to the SMF.
The SMF stores the SDFP security information for the PDU session,
enables indicated QoS flows and acknowledges to the AMF that they have
been SDFP enabled.

Header compression is supported in the UE and the UPF.

#### 6.5.2.2 Mobility

Mobility is support as for normal UEs in IDLE mode. When the UE enters a
new TA currently not part of the UE registration area, the UE will
initiate a registration update. During the UE registration update, the
AMF notifies the SMF about the UE location and the SMF may decide to
relocate the UPF. When UPF is to be relocated, the SMF activates the PDU
session so UPF N3 UL TEID is sent to RAN. The RAN then updates the new
UPF index and the UPF N3 UL TEID to UE. SSC mode 2 mobility is probably
appropriate for infrequent small data.

The solution assumes the Rel-15 5G baseline that the SMF can be used
throughout the PLMN (e.g. a specific CIoT slice may be used), but UPF
can be changed as of above if needed.

In roaming cases, a UPF in the VPLMN is used for SDFP support.

#### 6.5.2.3 Security

In the SDFP the UE sends traffic without having set up the regular AS
security.

In the described solution the security protection is done by security
contexts in the UE and the AMF/SMF/UPF. These are established as part of
existing signalling, hence keeping the signalling overhead for small
data to a minimum. The SDFP security information is stored in the SMF,
UPF and the UE as part of the PDU Session Resource Request information.
It is kept regardless if the SDFP is active or not, i.e. the security
information is kept as long as the SFDP remains enabled. When the SDFP
security information is updated for the UE, the AMF also updates the
SMF/UPF with new SDFP security information.

If AMF is changed e.g. due to mobility, a new SDFP security information
is established by AMF during the Registration Update procedure and
provided to the SMF/UPF and to the UE.

The security protocol between the UE and the UPF consists of the same or
similar protocols to the E-UTRA PDCP layer, i.e. with integrity
protection and ciphering functionality.

Editor\'s note: The security aspects of the solution need to be checked
by SAWG3.

#### 6.5.2.4 UPF and PDU Session information in the UE

The UPF information provided to the UE should not disclose the internal
network architecture and addressing. RAN therefore has a list of UPFs
that support SDFP, with an index and an IP address for each UPF in the
list. The list of UPFs supporting SDFP is preconfigured in the RAN and
each RAN node in the same UPF service area has the same information.

When a PDU Session is created for SDFP, or activated by SMF, RAN
receives from the AMF/SMF a UPF Tunnel information and a SDFP
indication. Based on the IP address in the UPF Tunnel information and
the RAN list of UPFs with SDFP support, RAN determines the UPF index.
RAN sends the UPF index and the UPF N3 UL TEID to UE.

### 6.5.3 Support of EPC interworking

**Mobility from EPC to 5GC:**

At mobility from EPC to 5GC, the PDU Session needs to be activated and
the UPF information is provided to the UE by RAN as part of the
registration procedure.

**CIoT support capability detection:**

During mobility through N26 interface, the source AMF(SMF)/MME detects
the target side CIoT support capability through DNS/NRF query or
location configuration. See TS29.303\[17\] and TS29.510\[18\]. Based
on the CIoT support capabilities, source side determines if CIoT related
PDU sessions or PDN connections shall be transferred.

During Idle mobility through N26 interface, the new AMF(SMF)/MME
indicates CIoT support capability at the new side. Based on the
capability at the new side, the old AMF(SMF)/MME determines if CIoT
related PDU sessions or PDN connections shall be transferred.

**Unstructured PDU type vs Non-IP PDN type:**

For PDU session with unstructured PDU type, SMF shall set the PDN type
to Non-IP during transfer to EPC. When Non-IP PDN type PDN connection is
received from EPC side, SMF shall set the PDU session type to
Unstructured. This is specified in TS23.502\[7\], clause4.11
(Rel-15).

**Selection of control plane or user plane CIoT optimization:**

When SDFP PDU session is transferred to EPS side, it can either use the
control plane CIoT optimization or user plane CIoT optimization based on
preferred and supported network behaviour between UE and EPC.

### 6.5.4 Procedures

#### 6.5.4.1 UE requested SDFP PDU session establishment

Figure 6.5.4.1-1: UE-requested PDU Session Establishment for SDFP

The procedure assumes that the UE has already registered on the AMF.
Below are some modifications for SDFP compared to the existing PDU
Session Establishment procedure. The SDFP information is kept in the UE
for the duration of the PDU Session. The SDFP information can be updated
as part of the registration update procedure, e.g. to reflect UPF
changes.

1\. UE provides an indication it wants to establish a SDFP PDU session.
Additionally, the UE could provide NSSAI indicating a specific network
slice for SDFP which could be used by the RAN to select an AMF that
supports SDFP.

2\. AMF selects an SMF that supports SDFP.

3\. The AMF generates SDFP security information with same or similar
information as normally is provided to RAN for PDCP when SDFP is not
used. The SDPF security information is forwarded to the SMF/UPF (and to
RAN/UE in step 12-13).

Editor\'s note: SAWG3 should check if the SDFP security information
could be derived in the RAN based on the existing AS security
information available in the RAN (might avoid change to step 12).

...

8\. SMF selects a UPF that supports SDFP.

...

10\. SMF performs N4 Session Establishment including setting up the SDFP
security context in the UPF. During this procedure the UE UPF and PDU
Session information will be generated.

12\. The SDPF security information is sent to the RAN.

13\. RAN determines the UPF index based on the UPF Tunnel information
received in step 12. RAN sends the UPF index, the UPF UL TEID and the
SDPF security information to the UE.

15-16a. The SDPF security information is sent to the SMF/UPF.

#### 6.5.4.2 SDFP transfer initiated by UL data

The following figure shows an example of how MO small data packet is
passed from the UE in UL. The term \"SDFP session\" is used in the text
below meaning the time from a fast path is established (e.g. DRB is
created) until it is released (e.g. inactivity timeout).

Figure 6.5.4.2-1: SDFP transfer initiated by UL data

1\. The UE establishes an RRC for SDFP transfer. Parameters for
selection of UPF for the PDU Session for the UE are passed to the RAN
i.e. the UPF index and the UPF UL TEID.

Editor\'s note: The detailed solution for this part should be discussed
in RAN WGs. An alternative would be to transfer the parameters as part
of the UL data PDU.

1a/b. In case AMF trigger paging towards RAN (e.g. due to N1 CP
signalling) during an ongoing \"SDFP transfer initiated by UL data\",
RAN may set up N2 UE association using the 5G S-TMSI received in step 1
and provide the AMF with NGAP RAN UE ID. AMF replies with NGAP AMF UE
ID.

NOTE: This step may be performed at any time between step 1 and 6.

2\. The UE encrypts, and integrity protects an UL data PDU and sends it
to RAN.

3\. RAN forwards the UL data PDU on the N3 tunnel to the selected UPF.
RAN selects the UPF and the N3 tunnel based on the SDFP information
provided by the UE (i.e. UPF index and the UPF UL TEID) and the RAN
preconfigured list of UPFs supporting SDFP. RAN will also provide the
UPF with RAN N3 DL Tunnel Info for the SDFP session.

4\. The UPF checks integrity protection and decrypts the UL data PDU. If
passed the check, the UPF forwards the UL data on the N6/N9 interface.
In addition, the UPF enables subsequent DL data transmissions to the RAN
node it received the UP data PDU from N6/N9 interface.

5\. A DL data packet may arrive on N6/N9 shortly after, e.g. an
acknowledgement.

6\. The UPF encrypt and integrity protects the DL data PDU and passes it
to the RAN node, which was enabled in step 3-4.

7\. RAN forwards the DL data PDU to the UE.

8-9. Based on a UP Activity Timeout timer in RAN and UPF the SDFP
information context in RAN is released and DL data transmission in the
UPF is disabled by setting the SDFP in a non-active state. RAN releases
the RRC connection.

#### 6.5.4.3 Alternative 1: SDFP transfer initiated by DL data

Small data initiated in DL on a QoS flow where fast path is enabled but
not active (i.e. the RAN N3 DL TEID is unknown or expired), is handled
as described in the figure below. It should be noted that compared to
when small data is initiated UL, an additional paging of the UE is
required.

Figure 6.5.4.3-1: SDFP transfer initiated by DL data

1\. DL data arrives in the UPF for a PDU Session that is SDFP enabled
but not currently active (i.e. the RAN N3 DL TEID is unknown or
expired).

2-5. The PDU Session is in CM\_IDLE and the UPF notifies the SMF about
DL data. SMF notifies the AMF using the Namf\_MT\_EnableUEReachability
service including a Fast Path indicator for DL SDFP transfer. The AMF
sends a paging message to the RAN with a Fast Path indicator included.
The RAN pages the UE with a FP indicator included.

6\. UE responds to the paging with a RRC establishment including a NAS
Service Request. The Fast Path indicator in the received paging triggers
the UE to also include the UPF Index and UPF UL TEID and PDU Session ID.
As part of the RRC establishment, the RAN and the UE establishes a Data
Radio Bearer (DRB) with default parameters for SDFP transmissions.

7\. RAN understands based on the included UPF index and UPF UL TEID that
a SDFP shall be established. RAN allocates a RAN N3 TEID, maps it to the
DRB and establishes a N3 tunnel based on the SDFP information provided
by the UE (i.e. UPF index and the UPF UL TEID) and the RAN preconfigured
list of UPFs supporting SDFP. RAN sends an Initial UE message (NAS:
Service Request, RAN N3 TEID, PDU Session ID) to AMF.

8\. The AMF takes the received NAS Service Request as a response to the
paging request. AMF sends a Nsmf\_PDUSession\_UpdateSMContext Request
message with the NAS Service Request, RAN N3 TEID, PDU Session ID
included to the SMF which handles the PDU Session.

9\. The SMF understands based on the included RAN N3 TEID that the PDU
Session shall be moved to active SDFP state. SMF sends a N4 Session
Modification Request (RAN N3 TEID, PDU Session, Fast Path indicator) to
the UPF. The UPF stores the RAN N3 TEID for the PDU Session and opens
the PDU Session for SDFP transmissions. UPF acknowledges to SMF by
sending a N4 Session Modification Response message. The SMF keeps the UE
in CM-IDLE but may keep a record of the SDFP transmission, e.g. in
charging information, or statistics.

10\. SMF acknowledges to AMF by sending a
Nsmf\_PDUSession\_UpdateSMContext Response to AMF.

11\. UPF forwards any buffered DL data to the RAN.

12\. RAN forwards DL data to the UE.

13\. Any additional uplink and downlink small data may be transmitted.

14-15. The UP Activity Timeout timer expires in UPF and RAN. RAN
releases the RRC connection.

#### 6.5.4.3a Alternative 2: SDFP transfer initiated by DL data

This is alternative solution for DL data transfer on a QoS flow where
fast path is enabled but not active (i.e. the RAN N3 DL TEID is unknown
or expired), as described in the figure below. In this solution, if the
UE has PDU session for SDFP and receives paging from the network, it
always establishes the DRB for PDU session for SDFP. The RAN can send
dummy uplink packets to UPF to establish the tunnel between RAN and UPF.

Figure 6.5.4.3a-1: SDFP transfer initiated by DL data

1\. DL data arrives in the UPF for a PDU Session that is SDFP enabled
but not currently active (i.e. the RAN N3 DL TEID is unknown or
expired).

2-5. The UE is in CM\_IDLE and the UPF notifies the SMF about DL data.
SMF notifies the AMF using the Namf\_MT\_EnableUEReachability service
for SDFP transfer. The AMF sends a paging message to the RAN. The RAN
pages the UE.

6\. UE responds to the paging with a RRC establishment for SDFP
transfer. Parameters for selection of UPF for the PDU Session for the UE
are passed to the RAN i.e. the UPF index and the UPF UL TEID. As part of
the RRC establishment, the RAN and the UE establishes a Data Radio
Bearer (DRB) with default parameters for SDFP transmissions.

7\. RAN set up N2 UE association using the 5G S-TMSI received in step 4
and provide the AMF with NGAP UE ID. AMF replies with NG AMF ID. This
step is same as step 1b in MO case.

8\. RAN understands based on the included UPF index and UPF UL TEID that
a SDFP shall be established. RAN allocates a RAN N3 DL TEID, maps it to
the DRB and establishes a N3 tunnel based on the SDFP information
provided by the UE (i.e. UPF index and the UPF UL TEID) and the RAN
preconfigured list of UPFs supporting SDFP. The RAN then passes the
uplink small data (can be dummy packets) sent by the UE in step 6 to the
selected UPF.

9\. The UPF stores the RAN N3 TEID for the PDU Session and forwards any
buffered DL data to the RAN.

10\. RAN forwards DL data to the UE.

11\. Any additional uplink and downlink small data may be transmitted.

12-14. The UP Activity Timeout timer expires in UPF and RAN. RAN
releases the RRC connection.

### 6.5.5 Impacts on existing entities and interfaces

Editor\'s note: This clausedescribes impacts to existing entities and
interfaces.

New parameter with SDFP security information on N1, N11, N4 and N2.

New parameters UPF index and UPF UL TEID in RRC message to the UE.

New parameter RAN N3 TEID in GTP-U message to UPF.

SDFP function in UE, RAN, UPF, AMF and SMF.

### 6.5.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.6 Solution 6: Small Data Communication based on Data PDU routed over the User Plane.
--------------------------------------------------------------------------------------

### 6.6.1 Introduction

#### 6.6.1.1 General

This solution applies to Key issue 1 and Key issue 2. The main idea of
the solution is to provide a simple migration for the 5G-IoT UE
implementation building on the CP CIoT optimization and at the same time
keep the user data separated from the Control Plane within the Core
Network.

To overcome the drawback of routing user data via the Core Networks
control plane function(s) AMF and SMF, a new proxy function is
introduced that includes the functionality needed for handling of the
user data in a Data PDU sent over Uu using Signalling Radio Bearer.

Similar to CP CIoT optimization and NB-IoT RAT, the Data PDU is embedded
in an RRC message (Signalling Radio Bearer, SRB). The Data PDU is
transparent to the RRC layer, similar legacy NB-IoT. The difference
compared to legacy is that the Data PDU shall not be passed to the NAS
upper layer, instead passed to the new function/proxy that performs i.e.
integrity protection, ciphering and header compression.

NOTE 1: This solution does not address congestion issues related to the
usage of Signalling Radio Bearers in RAN when an IoT device uses e.g.
NB-IoT RAT and 5G CP CIoT optimization.

NOTE 2: It is assumed that if this solution is selected for 5GS, then
the UE will detect the 5G PLMN and support for small data communication
by decoding the System Information Broadcasted in e.g. MIB-NB, SIB1-NB.

#### 6.6.1.2 Protocol stack for User data

The figure below shows the protocol stack for user data including the
new function/proxy here called New Upper layer.

Figure 6.6.1.2-1: Protocol stack for User plane data

#### 6.6.1.3 Architecture reference models

Figure 6.6.1.3-1: Architecture for small data delivery via UPF to DN and
NEF

### 6.6.2 Functional Description

The following principles apply:

\- Small data using encapsulated Data PDU:

\- Small data is exchanged between the UE and the Proxy function using
encapsulated Data PDU in both uplink and downlink direction.

\- The proxy function is implemented in the UPF used as PDU Session
Anchor (PSA) for the small data session.

Figure 6.6.2-1: The location of the proxy function

\- RAN detects the message type is of Data PDU type. RAN forwards the
Data PDU to the proxy function in the UPF.

NOTE: The detection that the message type is of Data PDU type could be
based on an indicator in the RRC message e.g. utilizing
*criticalExtensionsFuture*. Details to be decided by RAN WG2.

\- The proxy function extracts or encapsulates the user data from/in the
Data PDU. This includes e.g. the security operations and header
compression.

\- The proxy function forwards/receives the user data over the UPF
to/from the PDU session anchor point.

\- PDU Session Establishment:

\- The PDU session establishment reuse the procedure in TS23.502\[7\],
clause4.3.2.2.1 with the difference that the UPF node will be
configured with security parameters to be stored in the UE context. The
AMF provides the security parameters via the SMF to the UPF and the UPF
stores the UE Context as long as the PDU Session is established.

\- Supported PDU session types:

\- Small data transfer supports IP and unstructured data.

\- Integrity protection, ciphering and header compression:

\- Integrity protection and ciphering for small data are performed by a
proxy function (Similar to existing NAS PDU integrity protection and
ciphering functionality may be re-used in the proxy function).

Editor\'s note: Detailed security solution for the proxy function is FFS
and shall be selected and specified by SAWG3. Example of a possible
solution could be to use the same NAS key but different packet counters
for the different \"flows\", meaning that NAS signalling terminating in
the AMF would have it\'s own packet counters and the user data packets
terminating in the proxy will have it\'s own packet counters. Another
possible solution could be to generate new key and packet counters for
the User data communication between the UE and the proxy function.

\- UE and proxy function may perform header compression for IP data.

\- Roaming:

\- In case of home routed roaming the proxy is in the V-PLMN. The data
is delivered from the UPF in V-PLMN, on the N9 interface, via the UPF in
the H-PLMN to the Data Network.

\- In case of roaming of NIDD via NEF an IWK-NEF located in the V-PLMN
is used for providing inter-connection with the NEF in the H-PLMN. The
IWK-NEF (similar to IWK-SCEF in EPC) relays data between UPF/proxy
function in V-PLMN to NEF in H-PLMN.

\- Early Data Transmission may be initiated by the UE and the NG-RAN
node may indicate to the PSA that the connection is triggered for EDT.
EDT can be combined with AS based Release Assistance Information.

\- AS based Release Assistance Information (RAI) can be used by the UE
to indicate whether it is a single UL packet and if a single consecutive
DL packet is expected.

\- The RAN node will forward the RAI to the PSA and wait for receiving
an End Indication and optionally DL Data PDU from the PSA. After
receiving the End Indication, the RAN will send RRC message to the UE
allowing the UE to re-enter RRC\_IDLE. The RRC message will include the
optional DL Data PDU.

### 6.6.3 Support of EPC interworking

The UE supports EPC interworking by supporting both EPC NAS and 5G NAS
plus the support for small data over NAS in both 4GS and 5GS. From a UE
perspective the solution can be almost identical, only difference may be
in the 5G solution where the UE might need to mark the Data PDU.

### 6.6.4 Procedures

#### 6.6.4.1 Small Data via UPF

##### 6.6.4.1.1 General

Compared to EPC, 5GC requires that the UE first performs registration
and then PDU Session Establishment for setting up all required PDU
sessions. Before any procedures below, it is assumed that a successful
registration procedure has been performed that included the UE\'s
Preferred Network Behaviour information.

##### 6.6.4.1.2 Assumptions

\- A UE that shall send or receive small data is assumed to have
established a PDU session for small data. The PDU Session Anchor (PSA)
stores the specific UE security parameters for the small data PDU
session in the UE context.

\- For a RAN node, there may be one specific UPF that acts as the PDU
Session Anchor for all small data PDU sessions from multiple UEs.

\- The small data from any UE, connected to that RAN node, is then
forwarded via a common N3 tunnel towards this UPF. The tunnel is
configured either when configuring the RAN node, or when the first small
data PDU session is established (as in solution29 in clause6.29).

\- The small data from the UPF to a UE is sent via the common N3 tunnel,
for all small data UEs, connected to the RAN node that the UE is
connected with. The RAN identifies the UE and the corresponding RRC
Connection based on the UE ID (e.g. 5G-GUTI) and PDU session ID.

\- If the RAN does not have a common N3 tunnel for small data PDU
session when receiving small data from a UE, then the RAN node will
trigger the establishment of a common N3 tunnel by sending an N2 message
requesting the SMF to configure such.

\- The UPF may keep track of the RRC connection to the UE by a UE
Location Freshness Timer as proposed in solution29 in clause6.29. The
timer is reset when the UPF receives UL traffic from the UE. As long as
the UE Location Freshness Timer has not elapsed, the UPF sends a DL Data
PDU to the same RAN node from which it last received UL traffic from
this UE. When the DL Data PDU shall be delivered to the UE and the UE
Freshness Activity timer has elapsed the UPF requests the AMF to page
the UE by sending a Downlink Data Notification to the SMF.

\- When the DL Data PDU cannot be delivered to the UE, the RAN node
deletes the Data PDU and notifies the UPF that the UE is not reachable.
Then the UPF may requests the AMF to page the UE.

\- Once the common N3 tunnel is established for small data
communication, there is no need to release it as long as the Common UPF
node for small data is not changed.

##### 6.6.4.1.3 PDU Session Establishment

Figure 6.6.4.1.3-1: PDU Session Establishment enabling Data over UPF

1\. The UE sends a PDU session establishment request message that
includes the PDU session ID, PDU type, DNN and S-NSSAI. Based on e.g.
the Preferred Network Behaviour and S-NSSAI the AMF selects an SMF and
invokes the Nsmf\_PDUSession\_CreateSMContext request to trigger the PDU
session establishment.

2\. Steps 2-12 are executed according to TS23.502\[7\],
clause4.3.2.2.1 with the following changes:

\- The AMF provides UE specific security parameters to the SMF.

\- In step 10, the SMF includes required security parameters for the
proxy function located in the UPF node that acts as the PDU Session
Anchor (PSA).

\- A common N3 tunnel is established for the requested PDU session, if
the N3 tunnel was not already established.

3\. The AMF forwards the PDU session establishment accept message to the
UE.

4\. Steps 14-16 are executed according to TS23.502\[7\]
clause4.3.2.2.1

##### 6.6.4.1.4 Mobile Originated Data Transport

Figure 6.6.4.1.4-1: Mobile Originated Data Transport

0\. The UE is in CM-IDLE and has an established small data PDU session.

1\. The UE establishes an RRC connection and sends an integrity
protected Data PDU as part of this. The Data PDU carries encrypted
uplink data as payload and the corresponding PDU session ID.

2\. RAN detects that the transport message from the UE is for the Proxy
in the PSA. The RAN node associates the UE ID (e.g. 5G-GUTI) with the
RRC connection in case of DL data forwarding in step 8.

3\. RAN forwards the Data PDU together with the PDU session ID and UE ID
on the N3 Tunnel to the UPF node acting as PSA and to the proxy function
in the UPF node.

If the RAN does not have a common N3 tunnel for small data PDU session,
then the RAN node will trigger the establishment of a common N3 tunnel
by sending an N2 message requesting the SMF to configure such.

4\. The proxy function in the UPF node verifies the integrity of the
incoming Data PDU and decrypts the data in the payload and decompresses
the IP header if header compression was applied in the UE on the IP
data.

5\. UPF forwards the data to the Data Network (DN).

6\. \[Conditional\] If there is data available in UPF, the proxy within
UPF applies integrity protection, encryption and header compression for
the transport to the UE.

7\. \[Conditional\] The UPF forwards the Data PDU together with the PDU
session ID and UE ID over the N3 tunnel to the RAN.

8\. \[Conditional\] RAN identifies the receiver and sends the Data PDU
to the UE over DL RRC signaling message.

9\. Based on RAN specified inactivity conditions, the RAN releases the
UE\'s RRC connection and corresponding CN connections according to AN
release procedure in TS23.502\[7\], clause4.2.6.

##### 6.6.4.1.4b Mobile Originated Data Transport, using EDT and AS based RAI

Figure 6.6.4.1.4b-1: Mobile Originated Data Transport

0\. The UE is in CM-IDLE and has an established small data PDU session.

1\. The UE sends RRCEarlyDataRequest message including an integrity
protected Data PDU. The UE may also include an AS based Release
Assistance Information (RAI), that indicates whether a DL message is
expected or this was a single uplink data packet. The Data PDU carries
encrypted uplink data as payload and the corresponding PDU session ID.

2\. RAN detects that the transport message from the UE is for the Proxy
in the PSA and check the RAI if such was included. The RAN node
associates the UE ID (e.g. 5G-GUTI) with the RRC connection in case of
DL data forwarding in step 8.

3\. RAN forwards the Data PDU together with the PDU session ID, UE ID,
EDT indicator and RAI over the N3 Tunnel to the UPF node acting as PSA
and to the proxy function in the UPF node.

If the RAN does not have a common N3 tunnel for small data PDU session,
then the RAN node will trigger the establishment of a common N3 tunnel
by sending an N2 message requesting the SMF to configure such.

4\. The proxy function in the UPF node verifies the integrity of the
incoming Data PDU and decrypts the data in the payload and decompresses
the IP header if header compression was applied in the UE on the IP
data.

Furthermore, if RAI was included the UPF node should either:

\- send an End Indicator, set to \"No Further Data\", to the RAN node if
the RAI single UL data packet and the UPF node does not have any pending
downlink data;

\- or, wait for the expected DL data packet.

If there was no RAI included then the UPF may send an End Indicator, set
to \"No Further Data\", to RAN if the UPF does not have any pending DL
data. This will enable the RAN to quickly send RRCEarlyDataComplete
message to the UE.

5\. UPF forwards the data to the Data Network (DN).

6\. \[Conditional\] If there is data available in UPF, the proxy within
UPF applies integrity protection, encryption and header compression for
the transport to the UE.

7\. The UPF either forwards the Data PDU together with the PDU session
ID and UE ID or send an empty Data PDU together with an End Indicator,
set to \"No Further Data\", and UE ID over the N3 tunnel to the RAN.

8\. The RAN identifies the receiver using the UE ID and sends a
RRCEarlyDataComplete message to the UE. The RRCEarlyDataComplete message
will include the Data PDU to the UE. The UE will return the RRC\_IDLE
after this step.

##### 6.6.4.1.5 Mobile Terminated Data Transport

Figure 6.6.4.1.5-1: Mobile Terminated Data Transport

0\. The UPF receives downlink data for a small data PDU Session to the
UE.

1\. Network Triggered Service request according to TS23.502\[7\]
clause4.2.3.3 step 2-6 is performed. The UE responds on the page with a
Control Plane Service Request NAS message which will not trigger any DRB
establishment.

2\. The proxy function in the UPF node acting as PSA apply header
compression, ciphering and integrity protection.

3\. The UPF forwards available Data PDU together with the PDU session ID
and UE ID to the RAN node over the N3 Tunnel.

4\. RAN delivers the Data PDU over RRC to the UE.

5\. \[Conditional\] The UE sends an integrity protected Data PDU in an
uplink RRC message. The Data PDU carries encrypted uplink data as
payload and corresponding PDU session ID.

6\. \[Conditional\] The RAN detects that the transport message is from
the UE and for the Proxy in the UPF node.

7\. \[Conditional\] The RAN forwards the Data PDU together with the PDU
session ID and UE ID to the proxy function located within the UPF node.

8\. \[Conditional\] The proxy function verifies the integrity of the
incoming Data PDU and decrypts the data in the payload and decompresses
the IP header if header compression was applied in the UE on the IP
data.

9\. \[Conditional\] The UPF forwards the data to the DN.

10\. Based RAN specified inactivity conditions, the RAN releases the
UE\'s RRC connection and corresponding CN connections according to AN
release procedure in TS23.502\[7\], clause4.2.6.

#### 6.6.4.2 NIDD via NEF specific procedures

##### 6.6.4.2.1 General

This clausedetails the additional functionality to support NIDD via NEF
as shown in the architecture reference model in clause6.6.1.3. The
procedures show reuse of T8 and T6 interface, it is possible that stage
3 would decide to use an alternative protocol than T6 for the Nx
reference point.

##### 6.6.4.2.2 Nx Session Establishment

On top of the PDU session establishment procedure in clause6.6.4.1.3
the following applies:

\- Based on either subscription data or DNN with \"invoke NEF
selection\" indicator, the SMF will select an NEF for NIDD based on the
UE subscription profile.

\- The SMF configures the NEF and UPF anchor for data transfer for the
specific UE ID and PDU session ID.

\- The SMF also updates the AMF with the NEF ID with
Nsmf\_PDUSession\_CreateSMContext Response in order for the AMF to
invoke Namf\_EventExposure\_Notify (User Identity) service once the UE
becomes reachable or is about to become reachable.

##### 6.6.4.2.3 Mobile Terminated NIDD procedure

Figure 6.6.4.2.3-1: Mobile Terminated NIDD Transport via NEF

0\. The UE has registered and performed PDU session establishment for
NIDD via NEF.

1\. If SCS/AS has already activated the NIDD service for a given UE, and
has downlink non-IP data to send to the UE, the SCS/AS sends an MT NIDD
Submit Request (External Identifier or GPSI, non-IP data, Reliable Data
Service Configuration, Maximum Latency, Priority, PDU Session
Establishment Option) message to the NEF.

2\. The NEF determines the PDU session Context based on the DNN
associated with the NIDD configuration and the User Identity. If an NEF
PDU session context corresponding to the External Identifier or GPSI
included in step 1 is found, then the NEF checks whether the SCS/AS is
authorised to send NIDD requests and that the SCS/AS has not exceeded
the quota of data submission to the PDU session.

If no NEF PDU session context is found, then the NEF, depending on PDU
session Establishment Option, may either:

\- send a NIDD Submit Response (Cause) with appropriate error cause
value. The flow stops at this step; or

\- perform device triggering towards the UE to establish a PDU session
according to TS23.502\[7\] clause4.13.2.2.

3\. If an NEF PDU session context corresponding to the External
Identifier or GPSI included in step 1 is found, then the NEF sends a
NIDD Submit Request (User Identity, PDU session ID, NEF ID, non-IP data,
NEF Wait Time, Maximum Re-transmission time) message toward the
UPF/proxy function.

4\. If the UPF can immediately deliver the non-IP data to the UE e.g.
when UE is already in RRC\_CONNECTED mode, or UE is in RRC\_IDLE and UPF
is able to initiate paging procedure (see TS23.502\[7\]
clause4.2.3.3), the procedure proceeds at step 8

If the UE is determined not reachable within the NEF Wait time the UPF
sends NIDD Submit Response (Cause, Requested Re-Transmission Time) to
the NEF.

The AMF may indicate in Requested Re-Transmission time IE the time when
the NEF is expected to re-transmit the DL data to the currently
unreachable UE. In this case the NEF buffers the DL data and wait for
the notification that the UE becomes reachable.

5\. The NEF may send an MT NIDD Submit Response (Requested
Re-Transmission time, Cause) to the SCS/AS informing of the received
results. The flow stops at this step.

6\. When the AMF detects that the UE is reachable (e.g. by performing
periodic registration, or when the UE is about to become reachable e.g.
extended idle mode DRX cycle expiring, AMF anticipating MO communication
pattern for the UE etc.), and the AMF has the Not Reachable for NIDD
flag set, then the AMF invokes Namf\_EventExposure\_Notify (User
Identity) service. The NIDD Submit Indication (User Identity) message
could also come from the UPF if the UE initiated MO communication,

7\. If the data has not been purged, the NEF sends a NIDD Submit Request
(User Identity, PDU session ID, NEF ID, non-IP data, NEF Wait Time,
Maximum Re-transmission time) message toward the UPF/Proxy function.

8\. UPF/proxy function performs MT data transport according to
clause6.6.4.1.5

9\. If the UPF/proxy function was able to initiate step8, then the UPF
sends a NIDD Submit Response (cause) message towards the NEF
acknowledging the NIDD Submit Request from NEF received in step3 or
step7

10\. The NEF sends an MT NIDD Submit Response to acknowledge the MT NIDD
Submit Request.

##### 6.6.4.2.4 Mobile Originated NIDD procedure

Figure 6.6.4.2.4-1: Mobile Originated NIDD Transport via NEF

0\. The UE has registered and performed PDU session establishment for
NIDD via NEF.

1\. The UE sends MO data according to clause6.6.4.1.4 including the PDU
session ID corresponding to the session for NIDD via NEF.

2\. The UPF sends NIDD Submit Request (User Identity, PDU session ID,
NEF ID, non-IP data, MO Exception data counter) message to the NEF.

3\. When the NEF receives the non-IP data, and finds an NEF PDU session
context and the related T8 Destination Address, then it sends the non-IP
data to the SCS/AS that is identified by the T8 Destination address, in
a MO NIDD Indication (External Identifier or GPSI, non-IP data, Reliable
Data Service Configuration).

4\. The SCS/AS responds to the NEF with a MO NIDD Acknowledgement.

5\. The NEF sends NIDD Submit Response to UPF.

### 6.6.5 Impacts on existing entities and interfaces

UE:

\- The handling of user data to/from the application.

\- Support for new indication in the RRC Layer used for routing data PDU
to and from the UPF.

RAN:

\- New indication in the RRC Layer used for routing small data to and
from the UPF.

\- Support the common N3 tunnel for all small data in DL and UL.

AMF:

\- Provide the UE specific security parameters to UPF and UE.

Editor\'s note: Details are FFS and depends on SAWG3 design.

SMF:

\- Selection and configuration of UPF based on the small data routing.

UPF:

\- Adding the Proxy function to the UPF that includes functionalities as
e.g. integrity protection, encryption and header compression.

\- Sending small Data PDUs over the common N3 tunnel.

### 6.6.6 Evaluation

Even though the signalling radio bearer is still used it would not
impact the available radio resources blocks for NB-IoT since both
SRB1bis and DRB use same scheduled NPUSCH and NPDSCH resources.

This solution supports UE mobility and roaming.

This solution enables the RAN to provide different priority to NAS
messages and small data PDU messages if needed.

This solution supports delivery of pending DL SMS after paging or
combined with other NAS signaling e.g. Periodic Registration or
registration due to mobility.

Pros:

\- Only impacting RRC relating to the indication of small data PDU
message, UE NAS layer and the handling of user data to/from the
application via the new upper layer functionality that used to be in the
NAS layer for Control plane CIoT EPC optimisation.

NOTE: UE NAS layer anyway needs to be updated to support 5GC, so part of
the above mentioned change is in any case needed.

\- User data is separated from the control plane, which is an
architectural principle for the 5GC.

\- Core Network Congestion due to the user data handling in the control
plane is avoided, since the user data is routed in the user plane.

\- SCS/AS API is not affected.

\- UE\'s lower layer and application functionality is not affected.

Cons:

\- New function is introduced in the UPF that includes functionalities
as e.g. integrity protection, encryption and header compression.

\- New security endpoint in the new UPF function is introduced.

\- A new indication is introduced in the RRC layer for routing purposes,
indicating whether it is a NAS message or data PDU message.

\- New routing solution in RAN for the user data PDU.

6.7 Solution 7: Small data frequent communication
-------------------------------------------------

### 6.7.1 Introduction

This solution addresses the key issue \#2, Frequent Small data
communication.

The solution allows the UE used for frequent small data communication to
use the eDRX power saving method as investigated in KI\#4. This allows
UE power efficiency for traffic patterns for frequent small data
communication with gaps between transmissions.

This solution uses combinations of RRC Inactive, EDT, power saving
methods, and HLCOM (see key issue 3 High latency communication) to meet
the architecture requirement on both resource-efficiency and UE power
efficiency. The solutions have two options for data buffering at MT data
transmissions:

a\) DL data buffering in RAN (solution in clause6.7.4.2.2).

b\) DL data buffering in CN (solution 6.7.4.2.1).

c\) DL data buffering in CN (moving the UE to IDLE).

Option a), with DL data buffering in RAN, is preferably used when a UE
is not using eDRX (or eDRX with quite short sleep cycle e.g. a minute).
In these cases, the RAN buffering can be very efficient. Option b), with
DL data buffering in CN, is preferred when a UE is using eDRX (with
longer sleep cycles e.g. a minute or more). In such cases, the CN has
efficient buffer handling possibilities also considering full UE
mobility. Alternatively, option c) with DL data buffering in CN with UE
moved to CM-IDLE can be used for UE using longer sleep cycles.

CN buffering is also used when SCS/AS has requested UE reachability
Monitoring Events, except in case of option a). CN is able to send UE
reachability event reports for SCS/AS that has requested notification
when the UE wakes up from its power saving state. The RAN does not
handle such reporting.

### 6.7.2 Functional Description

This solution for frequent small data communication supports the
following functions:

\- Small data is transmitted with reduced signalling using the RRC
Inactive state. For single and dual packet transmissions (UL+DL), even
further reduction of signalling over the radio is achieved using the
Early Data Transmission (subject to RAN decision).

\- Fast release of the RRC connection at single and dual packet
transmissions is supported, hence maximizing the UE power efficiency.

\- Support for delivery of IP data and Unstructured (NIDD) data.

\- Support for MT data transmission to power saving devices (KI 4
functions e.g. eDRX) using extended buffering and UE reachability event
notifications (KI 3 functions).

\- The existing UP security mechanisms in 5G system are supported.

\- Support for charging, roaming, and policy control. Further 5G CIoT
support for charging of messages are supported.

### 6.7.3 Support of EPC interworking

***General:***

For DL data buffering, interworking between 5GC and EPC is achieved by a
combined PGW/SMF and PGW-U+UPF. If a SMF/UPF has data buffered for a UE
when the UE moves to EPC and becomes reachable then buffered data will
get delivered in EPC (and vice versa).

***When interworking with EPC with N26, the source side may also based
on CIoT capability at target side decide if the PDU session or PDN
connection shall be transferred during mobility.***

**EPC to 5GC:**

For a UE using CP CIoT EPS Optimization based PDN connection, CM-IDLE
mode mobility is used from EPC to 5GC, and 5GC decides during mobility
or next MO/MT data if the RRC Inactive optimization is used. Mobility
from EPC to 5GCcan also be made in CM-CONNECTED mode for a UE using UP
CIoT EPS Optimization based PDN connection, by a handover in
CM-CONNECTED mode.

**5GC to EPC:**

Mobility from5GC to EPC, can either be made as CM-IDLE mode mobility,
or as 5GC to EPS CM-CONNECTED mode handover procedure if UP is supported
on the EPC side (if not supported only CM-IDLE mode mobility is used to
EPC). On the EPS side it is decided if either the UP CIoT EPS
Optimization or the CP CIoT EPS Optimization shall be applied.

### 6.7.4 Procedures

#### 6.7.4.1 MO transmissions

##### 6.7.4.1.0 General

MO transmissions for frequent small data communication uses RRC Inactive
and Early Data Transmission to reduce the signalling. RRC Inactive with
MO transmission saves a UE context in the RAN at an initial small data
transmission. All subsequent MO small data transmissions can then
benefit of MO UL and DL transmission of small data without any 5G CP
signalling. The RAN simply forwards any UL data on the existing N3
interface. And any subsequent DL data and additional UL data can be
forwarded in the same optimized way.

NOTE: Unlike CP-data in the EPS, there is no limit or break even for how
much subsequent DL&UL data can be forwarded during a single RRC
connection with this solution before there is a signalling penalty i.e.
before the optimization becomes less optimized compared to sending the
small data without any optimization at all.

Early Data Transmission with RRC Inactive and MO transmission makes even
further signalling optimization over the radio by piggy back the first
UL data potentially the first DL data to the RRC establishment
signalling. This would save an additional one or potentially two
messages over the radio.

Editor\'s note: Whether existing AS RAI can be re-used when the UE is
aware of potential pending DL data in the CN is FFS.

##### 6.7.4.1.1 MO transmission with RRC Inactive

An optimized data transmission for small data can be achieved using the
RRC Inactive state for the UE connected to the 5GS. RRC Inactive is
supported in 5GS from Rel-15 when NG-RAN is used. This solution proposes
to use RRC Inactive also when NB-IoT and LTE-M are used.

The RRC\_INACTIVE feature can transmit small data without necessarily
performing a full state transition to RRC\_CONNECTED (see
TR38.804\[15\], Annex G).

NOTE: RRC Inactive for NB-IoT & LTE-M connected to 5GC is work in
progress in RAN and coordination with RAN is needed.

Figure 6.7.4.1.1-1: RRC Inactive with MO transmission

The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is
used) and it is a UPF in the Direct Model case.

1-3. The RRC connection is moved from inactive to active.

4-5. The UE sends a UL data PDU with small data to the RAN. The RAN
forwards the UL data PDU to the UPF.

If UE provided an AS RAI in step4 which indicated single packet, or if
the Expected UE Behaviour stored in the UE context in RAN contains a
Release Assistance Information which indicates single packet (and the AS
RAI is not present), then RAN continues to step9 and immediately
suspends the RRC connection unless there is pending DL data in RAN by
which the pending DL data is sent to the UE and the RRC connection may
be kept for potential subsequent UL (as a response to the pending DL
data).

6\. For the Direct Model case the UPF forwards data to/from the AF (i.e.
SCS/AS). For the Indirect Model case this step is the NIDD API. See for
example the UPF-NEF solution35.

7-8. The receiver may respond with a DL data PDU, e.g. an
acknowledgement, which is forwarded to the UE by the RAN.

If UE provided an AS RAI in step4 which indicated dual packets, or if
the Expected UE Behaviour stored in the UE context in RAN contains a
Release Assistance Information which indicates dual packets (and the AS
RAI was not present), then RAN continues to step9 and immediately
suspends the RRC connection unless there were both pending DL data in
RAN and DL data received in step7 by which all DL data is sent to the
UE and the RRC connection may be kept for potential subsequent UL (as a
response to the pending DL data).

9\. The RAN suspends the RRC connection to inactive mode after a RAN
specific timeout.

10\. UE enters RRC Inactive mode.

##### 6.7.4.1.2 MO transmission with Early Data Transmission and RRC Inactive

A very efficient data transmission can be achieved for one of the most
frequent small data transmissions scenarios, i.e. one UL message
(acknowledged or unacknowledged). Acknowledgements, if used, are often
generated by a protocol layer such as Small data transmission function
(see solution35). The Small data transmission function is assumed to be
dimensioned for low latency response of small data communications,
allowing the potential acknowledgement to be included as Early Data
Transmission in the RRC Command message. This enables low delay
communication and reduced UE power consumption with a minimum
signalling.

Figure 6.7.4.1.2-1: MO transmission with Early Data Transmission and RRC
Inactive

The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is
used) and it is a UPF in the Direct Model case.

NOTE: EDT has been agreed in RAN for R15. Work with EDT in R16 will be
started.

0\. A UE decides to send a small data sensor value to the SCS/AS.

1\. The UE is in RRC Inactive and before the UL data PDU can be
transmitted a resume of the radio connection is invoked.

2\. The UL data PDU is included as Early Data Transmission with the RRC
Resume Request.

3\. The RAN finds the UE context using the Resume ID and forwards the UL
data PDU on the N3 interface to the UPF.

If UE provided an AS RAI in step2 which indicated single packet, or if
the Expected UE Behaviour stored in the UE context in RAN contains a
Release Assistance Information which indicates single packet (and the AS
RAI was not present), then RAN immediately suspends the RRC connection
unless there is pending DL data in RAN by which RAN instead sends a RRC
Connection Resume to the UE (to keep the RRC connection for potential
subsequent UL and DL data) with a pending DL data packet included as
Early Data Transmission. Normal inactivity will in that case trigger the
suspension of the RRC Connection.

4\. For the Direct Model case the UPF forwards data to/from the AF (i.e.
SCS/AS). For the Indirect Model case this step is the NIDD API. See for
example the UPF-NEF solution.

5\. The receiver may respond with a DL data PDU, e.g. an
acknowledgement.

6\. The RAN receives the DL data PDU before the RRC respond timer
expires in the RAN and the UE provided AS RAI indicated dual packets or
if the Expected UE Behaviour stored in the UE context in RAN indicates
dual packets and the AS RAI was not present, then RAN expects no further
data and includes the DL data PDU as Early Data Transmission with the
RRC Connection Release with suspend indication sent to the UE.

If the RRC respond timer expires without any received DL data and RAN
expects further data (i.e. UE provided AS RAI indicated dual packets, or
if the Expected UE Behaviour stored in the UE context in RAN indicates
dual or multiple packets and the AS RAI was not present), then RAN sends
an RRC Connection Resume to the UE to allow DL data that may have been
delayed. Normal inactivity will in that case trigger the suspension of
the RRC Connection.

If AS RAI was not present and the Expected UE Behaviour stored in the UE
context in RAN indicates multiple packets or does not include any
Release Assistance Information, then RAN determines that further packets
*can be* expected and instead moves the UE to RRC\_CONNECED state by
sending an RRC Connection Resume to the UE. Normal inactivity will in
that case trigger the suspension of the RRC Connection.

7\. The UE and RAN enter RRC Inactive mode.

#### 6.7.4.2 MT transmissions

##### 6.7.4.2.0 General

MT transmissions are typically less frequent in massive IoT scenarios,
but nevertheless they need to be handled.

The procedure in clause6.7.4.2.2 describes RRC Inactive with option a)
DL data buffering in RAN as listed in clause6.7.1.

The procedure below (clause6.7.4.2.1) describes RRC Inactive with
option b) DL data buffering in CN as listed in clause6.7.1.

Some details on availability notifications, are left for KI 3 solutions.

##### 6.7.4.2.1 MT transmission with CN extended buffering at RRC Inactive

This procedure describes option b) DL data buffering in CN as listed in
clause6.7.1.

Figure 6.7.4.2.1-1: MT transmission with CN extended buffering at RRC
Inactive

The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is
used) and it is a UPF in the Direct Model case.

0\. Extended Data Buffering is established when RAN transition a UE
using eDRX to RRC Inactive state, the RAN sends a N2 Notification to
AMF. RAN provides buffering support information if there is any. AMF
uses the Nsmf\_PDUSession\_UpdateSMContext service to pass the buffering
info (i.e. buffering duration) to SMF. SMF uses N4 messages to remove
UPF N3 DL tunnel, activate extended buffering of DL data and set the
Buffering duration.

1\. DL data arrives.

2\. DL data is buffered in the UPF based on step 0b.

3\. The SMF requests a UE reachability report via
Namf\_MT\_EnableUEReachability, based on N4 data notification from UPF.

The SMF may optionally just wait for the next MO data from UE in step 6
to trigger the sending of downlink data without invoke enabling the UE
reachability reporting.

4\. The AMF may use the N2 Notification procedure to retrieve UE
reachability info. RAN may provide new buffering support information, if
there is any.

5\. The AMF notifies the SMF with the latest reachability info (either
UE is reachable or still not reachable with potentially new buffering
duration). The SMF uses N4 data request to update buffering duration for
the UPF DL Tunnel if needed.

6\. The UE contacts the network and the AMF either receives an N2
notification triggered by an RRC resume or an N2 Path Switch Request (if
the RRC resume triggers a RAN node change). The AMF notifies the SMF/UPF
of the UE reachability.

7\. UPF delivers the buffered DL data to the UE.

8\. For the Indirect Model, the interaction with the AF is according to
the NIDD API. See for example the UPF-NEF solution.

9\. RAN moves the UE to RRC Inactive state after a user inactivity
timeout or based on Release Assistance Information if available in
Expected UE Behavior. Depending on sleep cycle length and local
configuration the RAN may then execute step0 above and re-establish the
CN extended data buffering in SMF/UPF, otherwise RAN buffering is used
at next DL data event.

NOTE: If the UE does not contact the network before expiry of the
extended buffering duration timer, the buffered data may be discarded in
the SMF/UPF.

##### 6.7.4.2.2 MT transmission with RAN buffering at RRC Inactive

Figure 6.7.4.2.2-1: Mobile Terminated data with RAN buffering at RRC
inactive procedure

1\. The UPF sends a DL data PDU towards the UE. RAN buffer the DL data
during RAN paging (if necessary) or during the UE sleep cycle (if power
saving method is used).

NOTE: The AMF may use CN buffering (clause6.7.4.2.1 or 6.7.4.2.3) if
the UE uses eDRX with sleep cycles longer than e.g. one minute.

2\. RAN delivers to UE when UE becomes reachable.

3\. RAN moves the UE to RRC Inactive state after a user inactivity
timeout or based on Release Assistance Information if available in
Expected UE Behavior.

### 6.7.5 Impacts on existing entities and interfaces

This solution uses and is dependent on the solution in clause6.38. In
addition, the following impacts to existing entities and interfaces
exists:

RAN:

\- Send buffering info with remaining eDRX interval to AMF.

\- Support for EDT is optionally needed.

\- RAN paging with extended unreachable cycles.

\- N2 notifications procedure of UE reachability.

AMF:

\- New parameter in the Nsmf\_PDUSession\_UpdateSMContext service to
pass buffering info (i.e. buffering duration) to SMF.

\- Handling of \'Availability after DDN failure\' monitoring event based
on N2 Notification of DL data failure at RRC Inactive.

\- N2 notifications procedure of UE reachability.

SMF:

\- Send buffering info (i.e. buffering duration) to UPF.

UPF:

\- Extended buffering while UEs are sleeping.

### 6.7.6 Evaluation

The solution uses the CM-CONNECTED with RRC\_INACTIVE state and the
Early Data Transmission optimization when applicable, to transmit MO and
MT small data in a resource efficient system signalling manner,
especially over the radio interface.

The solution supports delivery of IP data and Unstructured (Non-IP)
data.

The solution can be used to convey small data over N6, i.e. the Direct
Model case, and over a northbound API at NEF, i.e. the Indirect Model
case. In the latter case the solution can use e.g. solution35 to
provide the API.

The solution uses the 5GS user plane security mechanisms, has minimum AS
impacts and can use the charging, roaming and policy control that exists
in the 5GS.

6.8 Solution 8: Enhancing MICO for Mobile terminated data/signaling
-------------------------------------------------------------------

### 6.8.1 Introduction

#### 6.8.1.1 General

This solution applies to Key issue 4: Power Saving Functions, Track 2.
The solution is based on keeping a UE, using MICO mode, in CM\_CONNECTED
and RRC\_CONNECTED state until at least all pending downlink data and/or
signalling has been delivered to the UE.

### 6.8.2 Functional Description

The following principles apply:

\- For mobile terminated data while a UE is in MICO mode, functions for
Key Issue 3: High latency communication are used.

\- When the AMF knows there may be MT data, MT SMS, network originated
signaling or any other DL message pending, the AMF maintains the N2
connection and provides a Connected time value to the RAN.

\- The Connected time value indicates the minimum time the RAN should
keep the UE in RRC\_CONNECTED state regardless of inactivity. The
Connected time value is provided in N2 Request carrying:

\- NAS Registration Accept message; or

\- NAS Service Accept message.

\- If the RAN node receives a Connected time value, the RAN shall keep
the UE in RRC\_CONNECTED for at least the indicated duration. Once the
Connected time has elapsed and the RAN inactivity timer has also
expired, the RAN releases the UE\'s RRC connection.

NOTE 1: The RAN node may release the RRC connection after the Connected
time has elapsed and the RAN inactivity timer has also expired.
Alternatively, the RAN node may set the RAN inactivity timer to the
value of the Connected time, and release the RRC connection after the
RAN inactivity timer has expired.

NOTE2: The C-DRX is assumed to be configured to similar value as I-DRX
e.g. 1.28s, 2.56s, 5.12s or even 10.24s.

\- The AMF takes the Maximum Response Time if provided by the UDM, and
any local AMF configuration into account for determining the Connected
time value.

\- On the UE side, in MICO mode, if the UE moves to CM-IDLE for any
reason other than a successful RRC release procedure, e.g. due to RLF,
the UE shall initiate NAS recovery, even if the registration procedure
has been completed successfully.

NOTE3: This is current Rel-15 UE behavior, i.e. this does not imply
additional UE impacts.

### 6.8.3 Support of EPC interworking

Rel-15 MICO and PSM interworking applies according to TS23.501\[5\]
clause5.17.2.1, as this solution has no additional NAS impacts.

On the T8 and Nnef reference points the same parameter Maximum Response
Time is used in EPC (e.g. for PSM) and 5GS for MICO, respectively.

### 6.8.4 Procedures

No modification to procedure call flows, only Connected time information
is added to N2 Request from AMF to RAN node.

### 6.8.5 Impacts on existing entities and interfaces

In AMF:

\- Decide on a Connected time to be provided to RAN based on Maximum
Response Time if available and local configuration, and provide value to
RAN.

In RAN:

\- Maintain RRC connection for at least the received Connected time, if
received from the AMF.

In UE:

\- No impacts identified.

### 6.8.6 Evaluation

The solution proposes an enhancement for mobile terminated
data/signalling by introducing a minimum time to keep the UE in
RRC\_CONNECTED (the Connected time). There are no modifications to the
procedure call flows, only the Connected time information is added to N2
Request from AMF to RAN node. RAN WGs may provide a more precise
analysis of actual power saving based on the UE power consumption in the
different RRC states.

The solution addresses the following architectural requirements for Key
Issue\#4:

\- Solutions shall enable UE power savings while also supporting
delay-sensitive mobile terminating communications triggered by mobile
originated communications.

6.9 Solution 9: Enhanced MICO mode with Active Time
---------------------------------------------------

### 6.9.1 Introduction

This solution addresses Key Issue \#4 (Power Saving Functions). The
proposal is to enable a PSM (Power Saving Mode) equivalent feature from
EPS in 5GS. In order to do so, the Mobile Initiated Connection Only
(MICO) mode (see TS23.501\[5\] clause5.4.1.3) is enhanced with an
optional Active Time to realize power saving. Active Time is meant to be
only used in combination with MICO mode. This solution is a NAS based
solution with no RAN impact that allows for deep sleep periods of up to
similar duration as in EPS PSM.

### 6.9.2 Functional Description

As the 5GC has a different architecture and some new functionality
compared to EPC, some adaptions are needed compared to PSM in EPS:

**Handling of Active Time and interaction with MICO mode:**

In EPC if the UE wants to use the PSM, it shall request an Active Time
value during every Attach and TAU/RAU procedures. If the network
supports PSM and accepts that the UE uses PSM, the network confirms
usage of PSM by allocating an Active Time value to the UE. In EPS the UE
and the MME/SGSN starts the Active timer with the Active Time value
allocated by the network when transitioning from ECM\_CONNECTED to
ECM\_IDLE.

The same principles can be used on 5GC, with the difference that in 5GS
the MICO mode is a new feature not supported in EPS.

A UE in MICO mode need not listen to paging while in CM-IDLE. A UE in
MICO mode may stop any access stratum procedures in CM-IDLE, until the
UE initiates transition from CM-IDLE to CM-CONNECTED. When the AMF
indicates MICO mode to a UE, the AMF considers the UE always unreachable
while the UE CM state in the AMF is CM-IDLE and the Active timer
expires. The AMF rejects any request for downlink data delivery for UE
in MICO mode and whose UE CM state in the AMF is CM-IDLE with an
appropriate cause. The proposal is therefore to apply PSM functionality
on MICO mode terminals if applicable: the **UE may indicate its
preference for MICO mode and optionally request an Active Time value
during Initial Registration or Registration Update procedure. The AMF,
based on local configuration, Expected UE Behaviour if available, UE
indicated preferences, UE subscription information and network policies,
or any combination of them, determines whether MICO mode is allowed and
optionally an Active Time value for the UE, and indicates it to the UE
during Registration procedure. If the UE does not indicate preference
for MICO mode during Registration procedure, the AMF shall not activate
MICO mode for this UE. When the AMF allocates the active time, the AMF
should not allocate all PLMN Registration Area to the UE.**

**The UE and AMF start the Active timer with the Active Time value
allocated by the network when transitioning from CM\_CONNECTED state to
CM\_IDLE state. When the Active timer expires, the UE enters the MICO
mode. The UE and the AMF re-negotiate the MICO mode and the Active Time
value at every subsequent Registration procedure. When the UE is in
CM-CONNECTED, the AMF may deactivate MICO mode by triggering
Registration Update procedure through UE Configuration Update
procedure.**

**Mobile terminated data:**

As indicated in Key Issue \#4, the reachability and buffering aspects
will be addressed in the key issue on high latency communication.

**SCS/AS influencing the configuration of the power savings functions:**

In EPS the SCS/AS may issue network parameter configuration requests to
the network, via the SCEF, to suggest parameter values that may be used
for Maximum Latency, Maximum Response Time and Suggested Number of
Downlink Packets. By suggesting values for these parameters, the SCS/AS
may influence certain aspects of UE/network behaviour such as the UE\'s
PSM, extended idle mode DRX, and extended buffering configurations.\
In 5GC the support for SCS/AS influencing the configuration of the power
savings functions shall at least be at the same level as in EPS. The
solution for this will be handled in the key issue \"Network Parameter
Configuration API via NEF\" (see NOTE1 in Key Issue \#4).

### 6.9.3 Support of interworking

Interworking when a UE is in MICO mode (defined in TS23.501\[5\]
clause5.17.2.1) is reused, where the UE shall locally disable MICO mode
and perform the TAU or Attach procedure as defined in TS23.501\[5\]
clause5.17.2 which may include PSM (re-)negotiation. When the UE moves
back to 5GC from EPC it locally disables PSM and MICO mode with or
without Active Time can be renegotiated during the (re-)registration
procedure.

### 6.9.4 Procedures

The existing procedures in 5GC will be reused to handle the Active Time
signalling between the AMF and UE, by considering also subscription
data. In particular, the negotiation procedure of enhanced MICO mode
with Active Time is depicted as follows.

Figure 6.9.4-1: Negotiation procedure of enhanced MICO mode with Active
Time

1\. UE may indicate preference for MICO mode and optionally request an
Active Time value during Initial Registration or Registration Update
procedure.

2\. The AMF may retrieve the UE subscription information from the UDM.

NOTE: The UE subscription information may include the Expected UE
behaviour (see Solutions for Key Issue\#13).

3\. The AMF, based on local configuration, Expected UE Behaviour if
available, UE indicated preferences, UE subscription information and
network policies, or any combination of them, determines whether MICO
mode is allowed and optionally an Active Time value for the UE.

4\. The AMF indicates the MICO mode indication and optional an Active
Time value to the UE in the Registration Accept message. The AMF may
also provide a Periodic registration timer in the Registration Accept
message to decide the power saving interval for the UE.

5\. After the Registration procedure completed, the UE and AMF start the
Active timer with the Active Time value allocated by the network when
transitioning from CM\_CONNECTED state to CM\_IDLE state. When the UE
and the AMF enter CM-CONNECTED state from CM-IDLE state during the
Active timer is running, the UE and the AMF stops the Active timer.

6 After the Active timer expires, the UE enters the MICO mode. The AMF
considers the UE is not reachable for paging.

### 6.9.5 Impacts on existing entities and interfaces

AMF:

\- Determines Active Time value and indicates it to the UE in the
Registration Accept message.

UE:

\- Indicates the preferred Active Time value to the AMF in the
Registration Request message.

\- Runs the Active timer as received from the AMF.

### 6.9.6 Evaluation

The solution proposed to enhance MICO mode with an Active Time. The UE
and network can negotiate MICO mode and Active Time during Registration
procedure. The solution is based on the same principle as Power Saving
Mode in EPS.

The solution addresses the following Architectural Requirements for Key
Issue\#4:

\- Solutions shall enable UE power savings while also supporting mobile
terminating communications with a delay governed by the duration of the
UE\'s sleep cycles.

\- Sleep cycle durations supported by 5GC should be the same as
supported by eDRX and PSM in EPC.

6.10 Solution 10: Solution for supporting High Latency Communication
--------------------------------------------------------------------

### 6.10.1 Introduction

This solution addresses the Key Issue 3 - \"High Latency
Communication\".

### 6.10.2 Functional Description

Functions for High latency communication can be used to handle mobile
terminated (MT) communication with UEs being unreachable while using
power saving functions in 5GS.

High latency communication is handled by notification procedures
requested by NFs, e.g. AF, SMF, UPF, when a UE wakes up from its power
saving state and sends downlink data to the UE when the UE is reachable.
This notification procedure is based on notification service operations
including UE Reachability, and Availability after DDN (downlink data
notification) failure.

For UE allowing high latency communication, the following two
notification service operations can be used to optimize system resources
and reduce signaling overhead:

\- UE reachability notification for MT communication.

\- UE availability notification procedure after DDN failure.

### 6.10.3 Support of interworking

The same principle of solution24 applies.

### 6.10.4 Procedures

#### 6.10.4.1 Support for UE Reachability Notification for Mobile Terminated Communication

The network can accommodate the UE with scheduled MT communication, e.g.
the AF/SMF subscribes the notification service from the AMF for the UE
reachability.

For AF requesting event exposure from the AMF for the UE reachability
notification, the AF can buffer the packets for MT communication before
receiving the notification.

Further, the SMF can request event exposure from the AMF for the UE
reachability. There are two alternatives to handle DDN due to MT
communication when the UPF receives the MT packets.

**Alternative 1:**

1\. The UPF notifies the SMF for the downlink packets by sending DDN.

2\. The SMF checks the UE\'s reachability and determines if it needs to
send the DDN to the AMF or not.\
\
If the UE is in power saving mode, the SMF notifies the UPF to buffer
the packets and indicates the buffer size, expected time for UE\'s
availability, e.g. next time to be in idle state.\
\
If the UE is in idle mode, the SMF further sends the DDN to the AMF.

**Alternative 2:**

1\. The SMF has notified the UPF about the buffering information
according to the UE reachability.

2\. The UPF buffers the packets accordingly and sends the DDN only after
reaching the maximum size of the buffering.

Further, if the UE is in CM-CONNECTED mode with RRC INACTIVE, extended
buffering may be done at RAN. If RAN based paging fails or if RAN
notification update guard timer expires RAN initiates AN release and
send buffered data to AMF. AMF can then initiate CN based paging and
take further action as specified in clause6.10.4.2 step4 onwards.

#### 6.10.4.2 Support for UE Availability Notification Procedure after DDN Failure

The AF/SMF/UPF can subscribe to UE availability notification after DDN
failure.

For the AF requesting event exposure from the AMF for the UE
availability notification after DDN failure, the AF buffers the packets
for MT communication before receiving the notification for UE
availability.

For the SMF subscribing UE availability notification after DDN failure,
the UPF buffers the packets for MT communication until receiving the
notification for UE availability from the AMF or reaching the buffering
criteria indicated by the SMF/AMF.

For the UPF subscribing UE availability notification after DDN failure,
the UPF buffers the packets for MT communication until receiving the
notification for UE availability from the AMF/SMF or reaching the
buffering criteria indicated by the AMF/SMF.

Figure 6.10.4.2-1 shows the notification procedure subscribed by the SMF
for UE availability after DDN failure.

Editor\'s note: It is FFS for the notification procedure subscribed by
UPF/AF for UE availability notification after DDN failure.

Figure 6.10.4.2-1: Notification procedure for UE availability after DDN
failure

1\. The UPF receives downlink data packets from data network.

2\. The UPF sends downlink data notification message to the SMF.

3\. When a SMF sends DDN (downlink data notification) to the AMF, it
indicates also if it subscribes the notification service from the AMF
for the UE availability when DDN failure.

4\. The AMF may initiate paging procedure.

5\. The DDN failure may be of many causes: paging failure, the paging
suspension due to activated MICO mode, the UE activates high latency
communication. If the DDN failure happens, the AMF replies to the SMF
for the DDN failure with an indication for confirming the notification
service for the next UE availability. Further, the AMF may base on UE\'s
reachability information to calculate buffering info and then include
the following information in DDN response message: the buffer size
(number of packets), buffering time, expected UE reachable time.

6\. The SMF forwards the buffering information to the UPF. The UPF
starts to buffer packets according to the received buffering info.

7\. The UE contacts the AMF via registration update procedure.

8\. The AMF notifies the SMF/UPF for the UE availability.

9\. The UPF starts to deliver buffered downlink packets.

### 6.10.5 Impacts on existing entities and interfaces

Impacts on AMF:

\- Support for UE Reachability Notification from AF and SMF;

\- Support for UE Availability Notification Procedure after DDN Failure
from AF/SMF/UPF.

Impacts on SMF:

\- Support subscribing to UE availability notification after DDN
failure, and indicate buffering information to UPF.

\- Requesting event exposure from the AMF for the UE reachability,
checking the UE\'s reachability and determining if it needs to send the
DDN to the AMF or not, and notification to the UPF to buffer packets and
indicate the buffer size, expected time for UE\'s availability, if
necessary;

Impacts on UPF:

\- Support subscribing to the UE availability notification after DDN
failure;

\- Buffer the packets for MT communication until receiving the
notification for UE availability from the AMF/SMF or reaching the
buffering criteria indicated by the AMF/SMF.

### 6.10.6 Evaluation

The solution proposes two notification procedures for mobile terminated
communication, UE reachability notification and UE availability
notification procedure after DDN failure. The solution also combines the
downlink packet buffering function with the notification procedure,
increasing the complexity of MT communication handling for AMF/SMF/UPF.

The solution addresses the architectural requirements of key issue3 to
\"provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable)\".

6.11 Solution 11: Extended buffering in SMF and NEF
---------------------------------------------------

### 6.11.1 Introduction

This solution addresses Key Issue 3 (High latency communication).

High latency communication is handled by extended buffering of downlink
data in the SMF. The AMF indicates to the SMF when the UE is expected to
wake up from its power saving state. Based on such indication, the SMF
triggers extended buffering. Buffering may be performed by the SMF or
the UPF as currently defined in TS23.501\[5\]. This solution focuses
on when extended buffering is performed in the SMF.

### 6.11.2 Functional Description

**The handling is specified in the Network Triggered Service Request
procedure. When the downlink data is received, the UPF sends the data
notification to the SMF, and the SMF indicates the AMF to page the UE.**

**The AMF then detects that the UE is in a power saving state (e.g.
MICO) and cannot be reached by paging at the moment. The AMF optionally
indicates to the SMF together with the expected time radio bearers can
be established to the UE** and a DL Buffering Suggested Packet
Count**.**

### 6.11.3 Support of interworking

Interworking with EPC is achieved by a combined PGW-C+SMF. If an SMF has
data buffered for a UE when the UE moves to EPC and becomes reachable
then buffered data will get delivered in EPC via the P-GW-U. If an S-GW
has data buffered for a UE when the UE moves to 5GC and becomes
reachable then the buffered data will be sent to the PGW-U+UPF by the
S-GW and will be delivered in 5GC via the UPF.

Editor\'s Note: The details of how buffered data is forwarded in the
interworking case are FFS.

### 6.11.4 Procedures

#### 6.11.4.1 Data Transfer via N6 interface

The procedure of extended buffering for Data Transfer via N6 interface
is depicted as following.

Figure 6.10.4.1-1: Extended buffering for Data Transfer via N6 interface

0\. The UE is assumed to be temporarily unavailable (i.e. in some power
saving state).

1\. When the first downlink data packet is received, the UPF sends a
Data Notification message to the SMF. The SMF replies with a Data
Notification Ack message to the UPF. The UPF forwards the downlink data
packets towards the SMF.

2\. The SMF determines that Extended Buffering is possible.

3\. The SMF contacts the AMF and invokes the
Namf\_Communication\_N1N2MessageTransfer to the AMF. Based on PCC rules,
the SMF indicates to the AMF whether extended buffering is possible or
not.

**4. The AMF detects that the UE is in a power saving state (e.g. eDRX
or MICO) and cannot be reached by paging at the moment**.

5\. Based on the status of the UE of step4, the AMF sends a
Namf\_Communication\_N1N2MessageTransfer response to the SMF indicating
that the DL buffering is requested due to the UE in power saving state
and temporarily unreachable and the maximum wait time**.**

6\. The SMF stores the DL Data for the maximum wait time and does not
send any additional Data Notification if subsequent downlink data
packets are received.

NOTE: The DL Buffering Suggested Packet Count is derived from the
subscription information which is provided by the SCS/AS via T8 API.

Editor\'s Note: Whether the AMF or SMF determines the DL Buffering
Suggested Packet Count is FFS.

7a or 7b. The UE triggered Service Request procedure or Periodic
Registration procedure may occur.

8\. When receiving UE reachable indication in step 6, the SMF sends the
buffered downlink data to the UE.

#### 6.11.4.2 Data Transfer via API

For MT Data that is sent via the NEF, the buffering should happen in the
NEF. The same principle of clause6.11.4.1 applies to DL data buffered
in the NEF in case of data transfer via APIs. For data transfer via NEF,
the NEF uses the same interactions with the SMF as the UPF uses in
Figure6.11.4.1-1.

### 6.11.5 Impacts on existing entities and interfaces

AMF:

\- Indicates DL buffering requested and maximum wait time to the SMF.

SMF:

\- Based on indication of AMF that the DL buffering is requested, it
triggers extended buffering.

\- Buffers downlink data.

### 6.11.6 Evaluation

Solution 11 proposes extended buffering for high latency communication.
The SMF triggers extended buffering locally based on the indication of
unreachable UE sent by the AMF. The solution meets the following
Architectural Requirement of Key Issue3: \"Send DL data to UEs at the
earliest possible opportunity when the UEs are applying power saving
functions\".

6.12 Solution 12: Solution for Management of Enhanced Coverage for 5GC
----------------------------------------------------------------------

### 6.12.1 Introduction

This solution addresses the Key Issue 6 - \"Management of Enhanced
Coverage\".

### 6.12.2 Functional Description

#### 6.12.2.1 Support of Enhanced Coverage

The UE shall indicate its capability of support for Enhanced Coverage
(i.e. CE mode B capability support) in the Initial Registration or
Registration Update Request message to the AMF. The AMF stores UE
capability of support for enhanced Coverage in the UE context in AMF.

#### 6.12.2.2 Support of restriction of use of Enhanced Coverage

The usage of Enhanced Coverage may require use of extensive resources
(e.g. radio and signalling resources) from the network. Specific
subscribers can be restricted to use Enhanced Coverage feature through
Enhanced Coverage Restricted information that is stored in UDM as part
of subscription data and specifies per PLMN whether the Enhanced
Coverage functionality is restricted or not for the UE. Enhanced
Coverage Restricted information indicates whether CE mode B is
restricted for the UE, or both CE mode A and CE mode B is restricted for
the UE, or both CE mode A and CE mode B is not restricted for the UE.

The AMF receives Enhanced Coverage Restricted information from the UDM
during registration procedure. AMF based on local configuration, UE
Usage setting, UE subscription information and network policies, or any
combination of them, determines whether Enhanced Coverage (i.e. CE mode
B or both CE mode B & CE mode A) is restricted for the UE and stored
updated Enhanced Coverage restriction information in the UE context in
AMF. If the UE usage setting indicated that UE is \"voice centric\" then
the AMF shall set CE mode B restricted for the UE in Enhanced Coverage
restriction information.

The AMF sends Enhanced Coverage Restricted information to the UE in the
Registration Accept message. The UE shall use Enhanced Coverage
Restricted information to determine if Enhanced Coverage is restricted
or not. The AMF provides an Enhanced Coverage Restricted information to
the RAN via N2 signalling whenever the UE context is established in the
RAN, e.g. during N2 Paging procedure, Service Request procedure, initial
Registration and periodic Registration procedure.

For roaming UEs, if the UDM doesn\'t provide any Enhanced Coverage
Restricted information or the provided Enhanced Coverage Restricted
information is in conflict with the roaming agreement, the AMF uses
default Enhanced Coverage Restricted information locally configured in
the VPLMN based on the roaming agreement with the subscriber\'s HPLMN.

The UE that indicates its support Enhanced coverage over N1 interface
shall also support restriction of the Enhanced Coverage over N1
interface. The UE shall assume that restriction for use of Enhanced
Coverage is same in the equivalent PLMNs.

### 6.12.3 Support of EPC interworking

#### 6.12.3.1 IDLE Mode aspects

\- When UE moves from 5GS to EPS, the UE context information sent by AMF
to MME includes the Enhanced Coverage Restricted information. MME
determines Enhanced Coverage Restricted parameter and CE mode B
restricted parameter from Enhanced Coverage Restricted information and
stores it in MME\'s MM context.

\- When UE moves from EPS to 5GS, the MME\'s MM context information sent
by MME to AMF includes the Enhanced Coverage Restricted parameter and CE
mode B restricted parameter. AMF determines Enhanced Coverage Restricted
information from CE mode B restricted parameter and Enhanced Coverage
Restricted parameter and stores it in the UE context at AMF.

#### 6.12.3.2 CONNECTED Mode aspects

\- When a UE is CM-CONNECTED in 5GC and a handover to EPS occur, source
NG-RAN provides Enhanced Coverage Restricted information to the target
eNB.

\- When a UE is CM-CONNECTED in EPS and a handover to 5GC occur, source
eNB provides Enhanced Coverage Restricted information to the target NG
RAN.

### 6.12.4 Procedures

#### 6.12.4.1 Procedure for restriction of use of Enhanced Coverage

![](media/image48.wmf){width="6.136805555555555in"
height="3.126388888888889in"}

Figure 6.12.4.1-1: Procedure for restriction of use of Enhanced Coverage

1\. The UE sends N1 registration Request message to AMF with UE Enhanced
Coverage (EC) support capability indication.

2\. The AMF retrieves the subscription data for the UE from the UDM
using Nudm\_SDM\_Get service operation. UDM may retrieve this
information from UDR by Nudr\_UDM\_Query (Access and Mobility
Subscription data). This includes also the E*nhanced Coverage
Restriction information* (i.e. CE mode B is restricted for the UE, or
both CE mode A and CE mode B is restricted for the UE, or both CE mode A
and CE mode B is not restricted for the UE).

3\. AMF based on local configuration, UE Usage setting, UE subscription
information and network policies, or any combination of them, determines
whether Enhanced Coverage (i.e. CE mode B or both CE mode B & CE mode A)
is restricted for the UE and stored updated Enhanced Coverage
restriction information in the UE context in AMF*.*

4\. The AMF sends Enhanced Coverage Restricted information to the UE in
the Registration Accept message. The AMF also provides an Enhanced
Coverage Restricted information to the RAN via N2 signalling.

5\. The UE shall use the Enhanced Coverage Restricted information to
determine if Enhanced Coverage is restricted or not.

#### 6.12.4.2 Enhanced Coverage Restriction Control and via NEF

The support for Enhanced Coverage Restriction Control via NEF enables
3rd party service providers to query status of, enhanced coverage
restriction or enable/disable enhanced coverage restriction per
individual UEs.

![](media/image49.wmf){width="5.909027777777778in"
height="4.795833333333333in"}

Figure 6.12.4.2-1: Procedure for Enhanced Coverage Restriction Control
and via NEF

1\. The AF/AS uses Nnef\_ECRestriction\_Update ( ) request service
operation in order to enable/disable Enhanced Coverage restriction or
Nnef\_ECRestriction\_Status\_Get ( ) service operation to query the
status of enhanced coverage restriction. Both service operation includes
External Identifier or MSISDN and AS/AF Identifier as required input.
Enhanced Coverage Restriction Data provides an indication to either
enable or disable the enhanced coverage restriction and is required
input for Nnef\_ECRestriction\_Update ( ) request service operation
only.

2\. If either the AS/AF is not authorized to perform this request (e.g.
if the SLA does not allow for it), or the AS/AF has exceeded its quota
or rate of submitting Enhanced Coverage requests, the NEF indicates
service operation failure to AS/AF with appropriate cause code and flow
stops here. Otherwise the flow continues to step 3.

3\. The NEF uses Nudm\_SDM\_Update ( ) service operation to update the
subscription data for Enhanced Coverage restriction. The NEF uses
Nudm\_SDM\_Get ( ) service operation to query the status of for Enhanced
Coverage restriction. UDM may retrieve this information from UDR by
using Nudr\_UDM\_Query ( ) service operation.

4\. For Nudm\_SDM\_Update ( ) when the subscriber data for Enhanced
Coverage restriction is updated at the UDM, serving NF (i.e. AMF in this
case) is notified with the updated Enhanced Coverage restriction
information in the subscription data. AMF may subscribe for the
notification for Enhanced Coverage restriction information change.

In case of Nudm\_SDM\_Get ( ) service operation steps 5 & 6 are skipped.

5\. The UDM uses Nudm\_SDM\_Notification ( ) service operation and
provide AMF with updated Enhanced Coverage restriction information.

6\. The AMF updates Enhanced Coverage restriction information stored in
the UE context at AMF. The AMF will transfer the Enhanced Coverage
Restricted Information stored as part of its UE context during AMF
change.

NOTE: UE is informed of the updated Enhanced Coverage Restricted
information at the next Registration procedure, or based on the local
policy the network can de-register the UE indicating re-registration is
required.

7\. The UDM sends response of Nudm\_SDM\_Update ( ) / Nudm\_SDM\_Get ( )
service operation to the NEF.

8\. The NEF sends response of Nnef\_ECRestriction\_Update ( ) /
Nnef\_ECRestriction\_Status\_Get ( ) service operation to the AS/AF.

### 6.12.5 Impacts on existing entities and interfaces

UE:

\- Indicate Enhanced Coverage support capability indication to the AMF.

\- Receives Enhanced Coverage Restriction Information as part of N1
procedure (i.e. Initial and periodic Registration Accept).

\- Stores Enhanced Coverage Restriction Information per PLMN and use
Enhanced Coverage mode based on Enhanced Coverage restriction
Information provided by the AMF.

RAN:

\- Receives an Enhanced Coverage Restricted information from the AMF via
N2 signalling whenever the UE context is established in the RAN, e.g.
during N2 Paging procedure, Service Request procedure, initial
Registration and periodic Registration procedure.

\- Determines if UE is restricted to operate in Enhanced Coverage mode
based on the Enhanced Coverage Restriction information provided by the
AMF.

AMF:

\- Receives Enhanced Coverage Restriction information as part of
subscription data from the UDM.

\- Based on local configuration, UE Usage setting, UE subscription
information and network policies, or any combination of them, determines
whether Enhanced Coverage (i.e. CE mode B or both CE mode B & CE mode A)
is restricted for the UE.

\- Stores Enhanced Coverage Restriction information as part of UE
context in AMF.

\- The AMF provides an Enhanced Coverage Restricted information to the
UE via N1 signalling (i.e. during N2 during initial Registration and
periodic Registration procedure.)

\- Provides an Enhanced Coverage Restricted information to the RAN via
N2 signalling whenever the UE context is established in the RAN, e.g.
during N2 Paging procedure, Service Request procedure, initial
Registration and periodic Registration procedure..

UDM/UDR:

\- Contains Enhanced Coverage Restriction information as part of
subscription data. UDM may retrieve it from the UDR.

\- Support new Nudm\_SDM\_Update ( ) service operation with NEF as
consumer to update the subscription data for Enhanced Coverage
restriction.

\- Interface with NEF to provide status of Enhanced Coverage restriction
using updated Nudm\_SDM\_Update ( ) service operation with NEF as
consumer.

NEF:

\- Support new Nnef\_ECRestriction\_Update ( ) request service operation
with AS/AF as consumer in order to enable/disable Enhanced Coverage
restriction.

\- Support new Nnef\_ECRestriction\_Status\_Get ( ) service operation
with AS/AF as consumer to query the status of enhanced coverage
restriction.

### 6.12.6 Evaluation

The solution is based on the same principles as in EPS. Main difference
is in terms of messages carrying the EC related information for 5G
system.

The solution addresses all Architectural Requirements for the key
issue\#6 - Management of Enhanced Coverage.

6.13 Solution 13: SCEF+NEF Node
-------------------------------

### 6.13.1 Introduction

This clausepresents a solution for Key Issue 9 - Support of common
north-bound APIs for EPC-5GC Interworking.

The following principles apply to this solution:

\- As a general architecture principle, the 3GPP network topology should
be hidden from the AF (corresponding to SCS/AS in EPS); thus, we should
avoid a situation where the AF needs to be aware of whether the UE is
served by EPC or 5GC. The AF should not have to change the network node
that it contacts when a UE moves between 5G and EPC.

\- Configuration of common services that are supported by EPC and 5GC
should not be dependent on whether the UE is attached to 5GC or EPC,
thus the APIs that are used by the AF or SCS/AS to access a given
service should not depend on whether the UE is attached to EPC or 5GC.
Using 3rd party APIs an AF however maybe able to find the access
technology the UE is currently connected. Consequently, an AF can access
the available 3rd party services with the expected level of support
available under that technology.

\- If the availability or expected level of support of a service API
associated with a UE changes, for example due do to a mobility between
5GC and EPC, the AF or SCS/AS can be made aware of the change. Note that
the same principle already applies in EPC where the SCEF is notified if
the UE switches to being served by an MME that does not support a
configured monitoring event.

\- For a given UE, the node that the AF or SCS/AS contacts for some
services is configured in the network. The same is already true in EPC.
For example, with respect to NIDD, the SCEF ID associated with the UE
for a NIDD PDN Connection is provided to the MME by the HSS during T6a
connection establishment. For other features (e.g. Device Triggering,
Group Message Delivery MBMS, and NIDD) TS23.682\[6\] recommends that
the SCS/AS may determine the IP address(es)/port(s) of the SCEF
associated with a UE by performing a DNS query using the External
Identifier or using a locally configured SCEF identifier.

\- A UE can be associated with different exposure nodes for each
service. The same is already true in EPC. For example, one SCEF might be
used for monitoring, another SCEF instance might be used for NIDD to one
APN, and yet another SCEF instance might be used for NIDD to another
APN.

### 6.13.2 Functional Description

When a UE is capable of switching between EPC and 5GC, it shall only be
associated with combined SCEF+NEF node(s) for Service Capability
Exposure. The SCEF+NEF hides the underlying network topology from the AF
(i.e. SCS/AS) and hides whether the UE is served by 5GC or EPC. Figure
6.13.2-1 shows the SCEF+NEF architecture.

![](media/image50.wmf){width="6.683333333333334in"
height="3.341666666666667in"}

Figure 6.13.21: Architecture view of the SCEF+NEF node

Interaction between the SCEF and NEF within the combined SCEF+NEF is
required. For example, when the SCEF+NEF supports monitoring APIs, the
SCEF and NEF need to share context/state information about a UE\'s
configured monitoring events in case the UE between from EPC and 5GC.
This interaction between the SCEF and NEF shall not be standardized. The
common state information is characterized as information that needs to
be maintained by the combined SCEF+NEF node in order to meet the
external interface requirements of the combined node.

The common state information includes at least the following data that
needs to be identical in a combined SCEF+NEF:

\- SCEF+NEF ID (must be the same towards the AF / SCS/AS).

\- SCEF+NEF common IP address and port number.

\- Monitoring state for any ongoing monitoring request.

\- Configured set of APIs supported by SCEF+ NEF.

\- PDN Connection/PDU Session State and NIDD Configuration Information,
including Reliable Data Service state information.

\- Network Parameter Configuration Information (e.g. Maximum Response
Time and Maximum Latency).

If a configured service becomes unavailable or its level of support
changes because of change of access network for a UE, the SCEF+NEF will
notify the SCS/AS. A configured service may become unavailable because
the UE is now being served by a node (e.g. MME) or NF (e.g. AMF) that
does not support the configured service.

If the service exposure function that is associated with a given service
for a UE is configured in the UE\'s subscription information, then an
SCEF+NEF identity shall be used to identify the exposure function. For
example, if a UE is capable of roaming between EPC and 5GC, then the
SCEF ID that is associated with any of the UE\'s APN configurations
should point to an SCEF+NEF node.

In EPC, the SCEF is part of the HPLMN. This solution assumes that an NEF
or SCEF+NEF that exposes API\'s to 3rd party AFs (i.e. SCS/AS) is part
of the HPLMN.

### 6.13.3 Support of EPC interworking

As noted above, interaction between the SCEF and NEF in the SCEF+NEF
need not be standardized, even though the architectural data
requirements implied by the external interfaces are specified.

Consistent with existing EPS-5GS interworking scenarios in
TS23.501\[5\], the subscriber data base is managed by a combined
HSS+UDM node. Thus, SCEF+NEF implementations need not perform the same
procedures with the HSS+UDM twice. For example, monitoring events only
need to be configured by the SCEF+NEF one time, by using either EPC or
5GC procedures. In other words, when a monitoring event has been
configured by the SCEF procedures towards the HSS, the NEF need not
repeat the same monitoring event configuration towards the UDM, and vice
versa. Whether the SCEF+NEF uses SCEF or NEF procedures for monitoring
event configuration is an implementation decision.

### 6.13.4 Procedures

Refer to clause6.14.4 for procedures that show how the SCS/AS or AF
subscribes and unsubscribes to the SCEF+NEF to be notified of service
changes when a UE\'s serving CN Type changes, how the SCEF+NEF notifies
the SCS/AS or AF of service changes when a UE\'s serving CN Type
changes, and how the SCS/AS or AF queries the SCEF+NEF of supporting
service.

### 6.13.5 Impacts on existing entities and interfaces

In terms of the CAPIF, the SCEF+NEF should be viewed as a single node.

The API interface that is exposed by the SCEF+NEF interface is an N33 /
Nnef interface that supports the T8 APIs.

### 6.13.6 Evaluation

The solution shows how the API termination point(s) associated with the
UE can remain consistent even when the UE switches between EPC and 5GC.

If the level of support of a given service changes (e.g. due to the
UE\'s mobility between EPC and 5GC), the SCEF+NEF will notify the
SCS/AS.

Since the solution continues the EPC assumption that the exposure
function(s) that serve a UE will not change, there is no need to provide
a way for the AF to detect API termination point changes and there is no
need to specifty how the exposure functions to exchange UE context.

6.14 Solution 14: APISupportCapability service
----------------------------------------------

### 6.14.1 Introduction

This clausepresents a solution for Key Issue 9 - Support of common
north-bound APIs for EPC-5GC Interworking, in particular it addresses
the issue of how the AF becomes aware of the availability/the expected
level of a given service when the UE changes between EPC and 5GC.

This solution assumes that the combined SCEF+NEF node provides a newly
defined service called APISupportCapability. This service relies on a
new Event Id and a new Query service provided by HSS+UDM. The SCEF+NEF
node subscribes to this Event Id or consumes this Query service in order
to retrieve the CN Type (e.g., 5GC or EPC or 5GC/EPC or None) that has
most recently served the UE. With this CN Type information, the
APISupportCapability service determines the availability or expected
level of support of common north-bound APIs, this can be further
informed to the north-bound applications via a response to the request
of the applications or via a notification to the subscription of the
applications.

### 6.14.2 Functional Description

When the IoT UE is capable of moving between 5GC and EPC, the UE shall
be associated with a combined HSS+UDM node and a combined SCEF+NEF node
for Service Capability Exposure. The SCEF+NEF hides the underlying
network topology from the AF (i.e. SCS/AS) and whether the UE is served
by 5GC or EPC. The HSS+UDM supports a new CN Type Change Event Id or CN
Type Query. Figure 6.14.2-1 shows the proposed architecture when CAPIF
function is not supported for the solution. Figure6.14.2-2 shows the
proposed architecture when CAPIF function is supported for the solution.

NOTE: The purpose of Figure 6.14.2-1/6.14.2-2 is to simply show the
interaction between the AMF, MME, HSS+UDM, and SCEF+NEF with respect to
CN Type queries, CN Type Change subscriptions, and CN Type Change
notifications; although not shown in the figure, the SCEF+NEF interacts
directly with the AMF and MME in other procedures which are not related
to this solution.

If the Service Capability Exposure that is associated with a given
service for a UE is configured in the UE\'s subscription information,
then an SCEF+NEF identity shall be used to identify the exposure
function. For example, if a UE is capable of roaming between EPC and
5GC, then the SCEF ID associated with any of the UE\'s APN
configurations should point to an SCEF+NEF node, if the SCEF ID is
stored in the UE\'s subscription.

Figure 6.14.21: Combined NEF+SCEF NF without CAPIF support

Figure 6.14.22: Combined NEF+SCEF NF with CAPIF support

Interactions between the SCEF and NEF within the combined SCEF+NEF node
is not required to be standardized.

In the case of architecture without CAPIF support, the AF is locally
configured with the API termination points for each service. In case of
architecture with CAPIF support, the AF obtains the service API
information from the CAPIF core function via the Availability of service
APIs event notification or Service Discover Response as specified in
TS23.222\[20\].

For each UE, a service API may become unavailable because the UE is
being served by a node (e.g. MME) or NF (e.g. AMF) even if the service
is exposed by SCEF+NEF.

If a service API provided by SCEF+NEF becomes unavailable or its level
of support changes because of the change of CN Type serving the UE, the
SCEF+NEF node may inform the change to the related AF per the AF\'s
subscription to the API supported Change event.

HSS+UDM supports CN Type Change Event Id. When the HSS+UDM detects that
the UE switches between being served by a MME and an AMF, the CN Type
Change Event is triggered. HSS+UDM supports CN Type Query. When the UE
or all members of a UE Group are being served by a MME, EPC is
determined as CN type. When the UE or all members of a UE Group are
being served by an AMF, 5GC is determined as CN type. When the UE is
operating in dual registration mode, i.e. the UE is registering both in
EPC and 5GC, or some members of a UE Group are registering in EPC while
some members are registering in 5GC, 5GC/EPC is determined as CN type.

SCEF+NEF supports APISupportCapability service, which will be configured
on AF without CAPIF support or discovered by AF with CAPIF support. This
service consists of Subscribe/Unsubscribe/Notification/Get service
operations.

SCEF+NEF determines the CN Type locally in the following conditions:

\- The Freshness Timer of last query request is not expired. The
Freshness Timer is a parameter that is configured based on local SCEF
policy. When an APISupportCapability\_Query Request is received, the
SCEF checks if it recently retrieved the CN Type for the indicated UE ID
or External Group ID. If the elapsed time since the last retrieval of
the CN Type for the indicated UE ID or External Group ID is less than
the Freshness Timer, then the SCEF may respond to the AF with the CN
Type that was last retrieved, thus avoiding repeated HSS+UDM requests.

\- The SCEF+NEF has established a direct connection with MME or AMF or
SMF for Non-IP data transfer.

Otherwise, SCEF+NEF gets the CN Type serving the UE from HSS+UDM. With
the CN Type information, the SCEF+NEF can determine the availability or
expected level of support of a given service. The third party
applications will be informed of such information.

For the subscription to APISupportCapability service, the subscription
may include the duration of subscription. If the duration of
subscription is expired, the SCEF deletes the subscription to the
APISupportCapability service without any explicit signalling
interaction. For the CN type Change event subscription, the subscription
may include the duration of subscription. If the duration of
subscription is expired, the related NF locally unsubscribe the CN type
change event without any explicit signalling interaction.

### 6.14.3 Support of EPC interworking

Consistent with existing EPS-5GS interworking scenarios in
TS23.501\[5\] and TS23.502\[7\].

### 6.14.4 Procedures

#### 6.14.4.1 Subscribe and Notify service operations information flow

![](media/image53.wmf){width="6.311805555555556in" height="3.40625in"}

Figure 6.14.4.1-1: APISupportCapability\_Subscribe and Notify operations

1\. The AF subscribes to APISupportCapability service for a UE or a
group of UEs by sending APISupportCapability\_Subscribe (UE ID or
External Group ID, callback URI, Duration of Reporting) message to the
SCEF+NEF node.

The callback URI parameter is optional and is used in step 8a if
provided.

The Duration of Reporting is optional and is used to indicate when the
subscription is invalid.

2\. If the SCEF+NEF has not established connection with MME/AMF/SMF for
Non-IP data transfer, he SCEF+NEF subscribes the CN Type Change event to
HSS+UDM by sending Event Subscribe or Monitoring Request (CN Type
Change, UE ID or External Group ID, Duration of Reporting) message.
Otherwise, Step 2 \~ Step 6 are omitted, the SCEF+NEF determines the CN
type based on the active type of connection for Non-IP data transfer.

If Monitoring Request is used, it shall include Reference ID as a
parameter. If Duration of Reporting is received at Step 1, it shall
include Duration of Reporting as a parameter.

3\. HSS+UDM stores the CN Type Change Event subscription for the UE or a
group of UEs indicated in step 2.

4\. UE changes between being served between EPC and 5GC. If UE changes
to EPC from 5GC, the AMF will invoke Nudm\_UECM\_Deregistration service
operation to HSS+UDM, the MME will send Update Location Request message
to HSS+UDM. If UE changes to 5GC, the AMF will invoke
Nudm\_UECM\_Registration service operation to HSS+UDM.

5\. Upon reception of the messages at step 4, the HSS+UDM will detect
that the UE is switching between EPC and 5GC. If the UE or the group the
UE belongs to is indicated in the CN Type Change Event subscription at
step 3, then the HSS+UDM determines the CN Type that is serving or going
to serve the UE or the group. If the UE is operating in dual
registration mode, the HSS+UDM determines the 5GC/ECP as CN Type. If
some members of the group are registering in EPC while some members are
registering in 5GC, the HSS+UDM determines the 5GC/ECP as CN Type.

6\. The HSS+UDM informs SCEF+NEF of the CN Type information by sending
Event Notify or Monitoring Response or Indication (CN Type, UE ID or
External Group ID).

The CN Type denotes the 5GC or EPC or 5GC/EPC serving the UE or the
group.

If Monitoring Response or Indication is used, it shall include Reference
ID indicated in step 2.

7\. According to the CN Type received and local configuration, the
SCEF+NEF node determines the availability or expected level of support
of common north-bound APIs for the UE or the group.

8\. SCEF+NEF inform AF of the availability or expected level of support
of common north-bound APIs for the UE or the group by sending
APISupportCapability\_Notify (API Indication, UE ID or External Group
ID) message.

API Indication can either be the list of available north-bound API or
the list of pair (north-bound API, status). The status indicate whether
the north-bound API is available or unavailable.

8a. \[Conditional\] If callback URI is provided at step 1, then SCEF+NEF
will send the APISupportCapability\_Notify (API Indication, UE ID or
External Group ID) message to the node addressed by callback URI.

9\. Upon reception of the messages at step 8, the AF obtains and stores
the availability or expected level of support of a given service for the
UE or the group. If required later, the AF can select the valid
north-bound API based on availability or expected level of support of a
given service for the UE or the group.

#### 6.14.4.2 Unsubscribe service operation information flow

If the AF invokes APISupportCapability\_Subscribe service to SCEF+NEF
node with the Duration of Reporting parameter, the subscription on the
SCEF+NEF and HSS+UDM are implicitly unsubscribed if the Duration of
Reporting expires, i.e. the explicit unsubscribe service operation is
not needed.

In case the explicit unsubscribe operation is needed, the information
flow is as following:

![](media/image54.wmf){width="4.24375in" height="2.0993055555555555in"}

Figure 6.14.4.21: APISupportCapability\_Unsubscribe operations

1\. The AF unsubscribes to APISupportCapability service API for a UE or
a group of UEs by sending APISupportCapability\_Unsubscribe Request(UE
ID or External Group ID) message to the SCEF+NEF node.

2\. The SCEF+NEF unsubscribes the CN Type Change event from HSS+UDM by
sending Event Unsubscribe or Monitoring Request (CN Type Change, UE ID
or External Group ID) message.

If Monitoring Request is used, it shall include the Reference ID for
Deletion.

3\. HSS+UDM deletes the CN Type Change Event subscription for the UE or
a group of UEs indicated in step 2.

4\. HSS+UDM responses to the SCEF+NEF by sending Event Unsubscribe
Response or Monitoring Response or Indication (result indication)
message to SCEF+NEF.

5\. If result indication indicates the operation is successful, the
SCEF+NEF deletes the APISupportCapability subscription.

6\. .SCEF+NEF acknowledges the operation result by sending
APISupportCapability\_Unsubscribe Response (Result Indication) to AF.

#### 6.14.4.3 Query service operation information flow

![](media/image55.wmf){width="5.278472222222222in"
height="2.7263888888888888in"}

Figure 6.14.4.31: APISupportCapability\_Query operation

1\. The AF requests the availability or expected level of support of a
service API for a UE or a group of UEs from SCEF+NEF by sending
APISupportCapability\_Query Request (UE ID or External Group ID) message
to the SCEF+NEF node.

2\. If the Freshness Timer of last query is not expired, the SCEF+NEF
determines the CN type locally, Step 2 \~ Step 4 are omitted. Otherwise,
the SCEF+NEF gets the CN Type serving the UE or the group from UDM+HSS
by sending Nudm\_UE ContextManagement\_Get Request (CN Type, UE ID or
External Group ID) message.

CN Type indicates that this request is for the serving CN Type of the
indicated UE or group.

3\. Upon reception of the request at step 3, the HSS+UDM determines the
CN Type that is serving the UE or the group based on the registered MME
or AMF.

4\. The HSS+UDM informs SCEF+NEF of the CN Type by sending Nudm\_UE
ContextManagement\_Get Response (CN Type, Freshness Timer) message. The
Freshness Timer is set per operator\'s policy, e.g. based on the
statistics of UE activity.

5\. According to the CN Type received and local configuration, the
SCEF+NEF node determines the availability or expected level of support
of common north-bound APIs for the UE or the group.

6\. SCEF+NEF inform AF of the availability or expected level of support
of common north-bound APIs for the UE or the group by sending
APISupportCapability\_Query Response (API Indication) message.

API Indication can either be the list of available north-bound API or
the list of pair (north-bound API, status). The status indicate whether
the north-bound API is available or unavailable.

7\. Upon reception of the messages at step 7, the AF obtains the
availability or expected level of support of a given service for the UE
or the group. If required, the AF can select the valid north-bound API
based on availability or expected level of support of a given service
for the UE or the group.

### 6.14.5 Impacts on existing entities and interfaces

Enhancements on HSS+UDM include the following:

\- CN Type Change Event, it should provide the subscription and
notification for CN Type Change Event Id to SCEF+NEF;

\- CN Type Information Retrieval, it should support the query request
for CN Type from SCEF+NEF;

Enhancements on SCEF+NEF include the following:

\- APISupportCapability service, it supports informing AF of the
availability or expected level of support of a given service via a
response to the request of the applications or via a notification to the
subscription of the applications.

\- CN Type Change Event Subscribe/Notify, it should support the
subscription to CN Type Change Event to HSS+UDM and receive the
notification for CN Type Change Event from HSS+UDM.

\- CN Type Information Retrieval, it should support the request for CN
Type from HSS+UDM.

Enhancements on AF include the following:

\- APISupportCapability service, it supports obtainment of the
availability or expected level of support of a given service by
requesting or subscribing to the SCEF+NEF via APISupportCapability
service.

The API interface that is exposed by the SCEF+NEF interface is an N33 /
Nnef interface that supports the T8 APIs.

In terms of the CAPIF, the SCEF+NEF should be viewed as a single node.

### 6.14.6 Evaluation

The solution describes how, if the level of support of a given service
changes (e.g. due to the UE\'s movement between EPC and 5GC), the
SCEF+NEF will notify the SCS/AS.

6.15 Solution 15: External parameter provisioning in the 5GC
------------------------------------------------------------

### 6.15.1 Introduction

This solution applies to Key issue 10 (Network Parameter Configuration
API via NEF) and to Key issue 13 (Support for Expected UE Behaviour).

The solution attempts to generalize the handling of external parameter
provisioning in the network for the available northbound APIs.

The \"external parameters\" are used as general term for the parameters
which can be provisioned via different northbound APIs, e.g.
Communication Pattern parameters (described in TS23.682\[6\]
clause5.10.1), Network Configuration parameters (described in
TS23.682\[6\] clause4.5.21), or Expected UE Moving Trajectory
(described in TS23.502\[7\] clause4.15.6).

New Communication Pattern parameters to assist network/UE configuration
for CIoT features are described in Solution26 (see clause6.26).

### 6.15.2 Functional Description

The main principles of the solution are:

\- Certain external parameters are specific to the PDU Session
behaviour. Such parameters are classified as session management (SM)
parameters and these are provisioned to the SMF (i.e. SMF-Associated
parameters).

\- Certain external parameters are specific to the UE mobility
management (MM) configuration and these parameters are provisioned to
the AMF (i.e. AMF-Associated parameters).

\- Another external parameters may be specific to the Policy Control
(PC) and can be appropriately stored in the UDR for access by the PCF
(i.e. PCF-Associated parameters).

\- The UDM/UDR classifies the external parameters into AMF- Associated
parameters, SMF- Associated parameters and possibly PCF- Associated
parameters. The SMF- Associated parameters are further associated with a
particular subscribed DNN and/or S-NSSAI.

While processing the external parameters, the UDM/UDR consider whether
the concerned UE has subscribed DNN(s). If there is no subscribed DNN
(e.g. the UE uses SMS only) or S-NSSAI in the user subscription, the
UDM/UDR classifies all external parameters as AMF- Associated
parameters. If there is at least one subscribed DNN or S-NSSAI, the
UDM/UDR determines the DNN and the S-NSSAI to which the sending AF is
associated with.

It is a subject of local policy in the UDM/UDR which external parameters
are classified as AMF- Associated, SMF- Associated, and PCF- Associated
parameters.

NOTE: It may be possible for parameters to be classified as being
associated with multiple NFs.

Each external parameter set may be associated with a validity time. The
validity time is stored at the UDM/UDR and in each of the NFs, to which
parameters has been provisioned (e.g. in AMF or SMF). Upon expiration of
the validity time, each node deletes the parameters autonomously without
explicit signalling. This processing is similar to the handling of
validity time in EPS as described in TS23.682\[6\] clause5.10.1.

### 6.15.3 Support of EPC interworking

The support of interworking in this solution depends on the conclusions
for Key Issue 9 (Support of common north-bound APIs for EPC-5GC
Interworking).

Assuming that for EPC interworking a co-located SCEF+NEF entity and
co-located HSS+UDM entity are deployed, then the enhancement proposed in
this solution to the UDM and NEF would be applicable to the co-located
entities. During mobility to/from EPC the entities in the target CN
(e.g. MME in EPC; or AMF and/or SMF in 5GC) need to download the
\"external parameters\" from the HSS+UDM. The HSS+UDM sends the
\"external parameters\" in the corresponding format to be processed in
the target CN entity.

A possible mapping table between EPS Communication Pattern parameters
and 5GS Expected UE Behaviour is shown in solution26 (see
clause6.26.3).

The mapping of the EPS Network Configuration parameters and 5GS Network
Configuration parameters is one to one.

### 6.15.4 Procedures

In this clausethe procedure for external parameter provisioning is
described.

Figure 6.15.4.1-1: External parameters provisioning to AMF and to SMF

> 1\. The AF(s) may use various APIs to provide parameters specific to a
> given UE application (or the UE as such if a single application is
> used in the UE) in order to help the network for efficient
> configuration. The AF(s) may add/modify/delete the parameters to the
> network (e.g. to NEF).
>
> 2\. NEF/SCEF discovers a UDM/UDR based on the UE\'s External ID.
> Similar to step 2 in TS23.682\[6\] clause5.10.2.
>
> 3\. NEF to UDM: Nudm\_ParameterProvision\_Update (GPSI, AF ID, NEF
> Transaction Reference ID(s), external parameter set(s), validity
> time(s)).
>
> 4\. In step 4a the UDM/UDR may categorizes the external parameters
> into AMF- Associated and SMF- Associated parameters. The SMF
> parameters are further associated with a particular subscribed DNN
> and/or S-NSSAI. The UDM/UDR uses the AF ID to determine the
> corresponding DNN and S-NSSAI.
>
> In step 4b the UDM/UDR updates the corresponding fields in the UE
> subscription.
>
> 5\. - 6. Steps similar to steps 5, 6 in TS23.682\[6\] clause5.10.2.
>
> 7\. UDM to AMF: Nudm\_ SubscriberDataManagement (SDM)\_Notification
> (SUPI, AMF- Associated parameters, etc.).
>
> The AMF stores and uses the received AMF parameters to derive the
> appropriate UE configuration. The AMF-Associated parameters can be
> e.g. \"Stationary indication\", \"Battery Indication\" or \"Expected
> UE Moving Trajectory\", \"Maximum Latency\", \"Maximum Response
> Time\", \"Suggested Number of Downlink Packets\". For example, the AMF
> may determine a Registration area based on parameters \"Stationary
> indication\" or \"Expected UE Moving Trajectory\". The AMF identifies
> whether there are overlapping parameter set(s) and merges the
> parameter set(s), if necessary.
>
> 8\. PDU Session Establishment procedure steps 1-3 from TS23.502\[7\]
> clause4.3.2.2.1.
>
> In step 8a, the PDU Session Establishment procedure is triggered.
>
> In step 8b, UDM to SMF: the UDM performs service operation Nudm\_
> SubscriberDataManagement (SDM)\_Notification (SUPI, SMF-Associated
> parameter set, DNN/S-NSSAI, etc.). See step4 of PDU Session
> Establishment in TS23.502\[7\], clause4.3.2.2.1

The SMF stores the received SMF-Associated parameters and associates
them with a PDU Session based on the DNN and S-NSSAI included in the
message from UDM. The SMF identifies whether there are overlapping
parameter set(s) and merges the parameter set(s), if necessary. The
SMF-Associated parameters can be e.g. Communication Duration Time,
Periodic Time, Scheduled Communication Time, Suggested Number of
Downlink Packets. The SMF uses the SMF-Associated parameters to also
appropriately configure the UPF. For example, the SMF can use the
Scheduled Communication Type to configure the UPF how many downlink
packets to buffer. The SMF may use e.g. the Communication duration time
to determine to deactivate UP connection after the Communication
duration time expires and the SMF performs the procedure CN-initiated
selective deactivation of UP connection of an existing PDU Session as
described in TS23.502\[7\] clause4.3.7.

Step 8c: If the PDU session uses NAS-SM to transfer PDUs, the SMF
forwards to the AMF all parameters in step 8b of the PDU Session
Establishment procedure. The AMF may identify whether there are
overlapping SMF parameter set(s) and merge the parameter set(s), if
necessary e.g. when the UE context is provided to the NG-RAN after RRC
msg \#3.

NOTE1: If the PDU sessions uses NAS-SM to transfer PDUs, the delivery
of the UE Expected Behavior parameters to the NG-RAN is done by the AMF.
If the PDU session does not use NAS-SM to transfer PDUs, the delivery of
the UE Expected Behavior parameters to the NG-RAN is done by the SMF.
See Solution28 for more details.

Step 8d: the remaining steps of the PDU Session Establishment procedure
are executed.

NOTE2: The SMF can update the parameters in the AMF during the PDU
Session Modification procedure. In that case, Steps 8a-8d of this
message flow would coincide with the steps of Figure4.3.3.2-1 of
TS23.502\[7\]; in particular, Step 8c would match Step 3a of the PDU
Session Modification Procedure.

The deletion or modification of external parameters is performed
similarly to the descriptions in TS23.682\[6\] clause5.10.2.

### 6.15.5 Impacts on existing entities and interfaces

Enhancements to UDM/UDR (or potentially to co-located HSS+UDM) include
the following:

\- The external parameters are categorized into AMF-Associated,
SMF-Associated -specific and PCF-Associated parameters. The SMF
parameters are further associated with a particular subscribed DNN
and/or S-NSSAI.

Enhancements to SMF include the following:

\- The SMF uses the SMF-Associated parameters to appropriately configure
the UPF;

\- The SMF provides the SMF-Associated parameters to the AMF when a PDU
session is created.

Enhancements to the AMF include the following:

\- The AMF takes into account the SMF associated parameters from all
SMFs when deriving CN Assistance Information provided to NG-RAN.

### 6.15.6 Evaluation

This solution allows multiple AFs to provide the CN with set of external
parameters (e.g. Communication Pattern parameters, Network Configuration
parameters) to be used for network configuration and UE configuration.

6.16 Solution 16: UE assisted Inter-UE QoS Support for Data over NAS
--------------------------------------------------------------------

### 6.16.1 Introduction

This solution addresses Key Issue 14: QoS Support for NB-IoT for the
case of Data over NAS. It can also be applied to WB-E-UTRA (eMTC) when
Data over NAS is used.

### 6.16.2 Functional Description

The solution is based on the UE providing a QoS index during RRC
connection procedure for the case of Data over NAS.

The following applies to the solution:

\- During registration procedure, if Data over NAS is set-up, the AMF
provides a QoS index to the UE. The AMF receives the QoS index from the
UDM during the exchange as defined in TS23.502\[7\].

\- When the UE decides to send data over NAS, during the RRC connection
establishment procedure, the UE provides the QoS index in RRC connection
request message.

\- The RAN determines how to handle the connection based on the UE
provided QoS index, i.e the RAN can prioritise resource allocation
between different UEs when some of the UEs are using data over NAS based
on the received QoS index.

\- If the RAN decides to go ahead and establish the RRC connection and
the UE sends the data over NAS payload, the RAN sends the UE provided
QoS index to the AMF in the N2 message carrying the Data over NAS
payload.

\- The AMF can check whether the QoS index provided by the UE and the
QoS index configured by the network are the same. In case they are
different, the AMF has detected a misbehaving UE, i.e. a UE that is not
compliant with 3GPP specifications. The AMF may then back-off or
deregister the UE with a corresponding cause code.

### 6.16.3 Support of EPC interworking

### 6.16.4 Procedures

#### 6.16.4.1 QoS Index configuration during Registration Procedure

![](media/image57.wmf){width="6.865277777777778in" height="3.8125in"}

Figure 6.16.4.1-1: QoS index configuration during Registration procedure

All steps from TS23.502\[7\] clause4.2.2.2.2 are followed with the
following differences.

1\. If the UE wants to use Data over NAS, it indicates this to the AMF
in NAS Registration request message.

2\. (Steps 4-13 from TS23.502\[7\] clause4.2.2.2.2 unchanged).

3\. In Step 14, the UDM includes the QoS index in the Access and
Mobility Subscription data.

4\. (Steps 15-21 from TS23.502\[7\], clause4.2.2.2.2 unchanged).

5\. The AMF provides with the QoS Index to the UE in the Registration
accept message. The UE stores this value, and only uses it if Data over
NAS is set up with SMF, and the UE decides to send a data packet over
NAS.

#### 6.16.4.2 Using QoS index in MO Data over NAS

The following call flow is based on Solution 1 (clause6.1) for Data
Transport over NAS-SM, but can easily be used for other possible data
over NAS solutions.

![](media/image58.wmf){width="5.365277777777778in"
height="3.6680555555555556in"}

Figure 6.16.4.2-1: Use of QoS index in MO data over NAS

0\. The solution applies when the UE initiates data transport over
NAS(-SM) from CM-IDLE state.

1\. If the UE has been configured with QoS index and decides to send
data over NAS(-SM), then the UE includes the QoS index in RRC connection
request.

Editor\'s note: The exact mechanism by which the QoS index will be
provided to RAN will be defined by RANWG2.

2\. The RAN node considers the UE provided QoS index to prioritise
resource allocation between different UEs when some of the UEs are using
data over NAS.

3\. RAN node sends RRC connection setup.

4\. UE sends RRC connection Complete(NAS transport(SM data transfer, PDU
Session ID)) as per Solution 1.

5\. The RAN node sends the UE provided QoS index in the Initial UE
message to AMF together with the NAS transport message.

6\. AMF can check if the UE is misbehaving by comparing the UE provided
QoS index with the NW configured QoS index. If the AMF detects the UE is
misbehaving it may take multiple actions, e.g. deregister the UE with
specific cause code, or reject ANS transport with a back-off timer.

7\. Completion of data transport over NAS-SM as per Solution 1.

### 6.16.5 Impacts on existing entities and interfaces

The solution has impacts on the following network functions:

1\. AMF: Provision of QoS index to the UE, and a potential a-posteriori
check on whether the UE is providing the correct QoS Index.

2\. UDM: QoS index storage in subscription information.

3\. RAN: Receive QoS index from UE and perform prioritization based on
it.

4\. UE: configuration of QoS index and providing QoS index in RRC
connection request for Data over NAS.

### 6.16.6 Evaluation

Advantages:

\- Support QoS differentiation among UEs that use NAS to delivery data.

\- Support any types of data, IP, Ethernet, unstructured data.

Disadvantages:

\- Does not support QoS differentiation if the UE send only one UL
message in Early Data Transmission over NAS.

\- Increase the size of some RRC messages to carry QoS index.

6.17 Solution 17: UE-Driven Packet Classification
-------------------------------------------------

### 6.17.1 Introduction

This solution is proposed for Key Issues 14, QoS Support for NB-IoT. The
NB-IoT devices may use UP solutions to send frequent and small data in
the UP. The UE may establish a PDU Session as described in
TS23.502\[7\], clause4.3.2. The NB-IoT devices may require 5GS to
support multiple QoS flows in one Unstructured PDU Session. For example,
one QoS Flow may be used to carry low priority data such as regular
sensor data. Another QoS Flow may be used to carry the emergent
messages, such as high temperature alarm, high heart beat rate.

### 6.17.2 Functional Description

The NB-IoT devices request PDU Session Establishment to send
unstructured data. Based on the UE Subscription information in the
UDM/UDR, the UE may support multiple QoS Flows in one unstructured PDU
Session and based on the SLA, the SMF can assign multiple QoS Rules to
the UE. Each QoS Rule is associated with one QoS Flow Identifier (QFI),
but there is no Packet Filter Sets. The local policy handling function
in the UE can understand the QoS parameters in the QoS rule(s) (such as
5QI, and bit rate). The UE may have non-standardized packet filtering
mechanisms for CIoT protocols. Based on the QoS requirements and the QoS
parameters in the QoS rule(s), the UE has its own logic to perform
packet classification and map the UL PDU to QoS Flows.

During the PDU Session Establishment, the SMF also sends multiple QoS
Profiles to the (R)AN, each QoS Profile has a unique QFI for one QoS
Flow the UE may use.

During the PDU Session Establishment, the SMF also sends multiple N6
Service Data Flow (SDF) templates to the UPF. Each N6 SDF template has
an N6 Packet Filter Set (PFS) and each N6 PFS is mapped to one N3/N9
QFI. In case of N6 IP tunnel, the SMF may assign one unique IP
address/prefix for each QoS Flow. Alternatively, the SMF may assign the
same IP address/prefix for all QoS Flows, but each QoS Flow uses a
unique UDP port, or unique Flow Label, or Traffic Class as part of SDF
template. The UPF establishes IP tunnel(s) with the AS using the
assigned IP address(es)/prefix(es) or UDP port(s).

When the UE sends an UL PDU, the UE uses its own logic to map the UL PDU
to QoS Flow. The UE may add a QFI to the UL PDU and sends to the (R)AN.
The (R)AN receives the UL PDU, adds a QFI as part of N3 header and sends
the N3-encapsulated PDU to the UPF. The UPF removes the N3
encapsulation, adds the N6 tunnel header to the PDU. Different QoS Flows
can be associated with a unique N6 IP address/prefix and/or unique UDP
port of UPF. The UPF sends the PDU with unique N6 IP packet header to
the Application Server (AS).

The UPF can classify DL unstructured PDUs received from N6 interface
into multiple QoS Flows with different QFI. The AS may send downlink
packets to the UE. The AS uses the source information in the N6 tunnel
header that the UPF used to send the UL PDU for sending DL packet to the
UPF. The UPF receives the DL PDU, uses the mapping between N6 PFS and
QFI to classify the PDUs into QoS Flows and send the DL PDU to the
(R)AN. The (R)AN sends the DL PDU to the UE using a data radio bearer
(DRB) assigned to the QoF Flow.

### 6.17.3 Support of EPC interworking

Not applicable.

### 6.17.4 Procedures

The high-level procedure for sending UL unstructured PDU is described in
Figure 6.17.4-1.

![](media/image59.wmf){width="5.8909722222222225in"
height="4.454166666666667in"}

Figure 6.17.4-1: High level description of UL unstructured PDU delivery

1\. During PDU Session Establishment procedure, the SMF sends QoS Rules
to the UE. The QoS Rules do not contain Packet Filter Sets.

2\. During PDU Session Establishment procedure, the SMF assigns tunnel
parameters for N6 interface. In case of IP/UDP tunnel, the SMF assigns
IP address(es) and UPD port number for QoS Flow(s).

Some other steps are required but not shown in the procedure. For
example, the SMF sends QoS Profiles to the (R)AN, the (R)AN establish
DRB(s) for QoS Flows.

If required, one of the QoS Flows may be assigned to carry high priority
data, and another QoS Flow is assigned to carry low priority data.

The SMF assigns corresponding QoS Rules to the UEs, QoS Profiles to the
(R)AN, QoS and charging policies to the UPF to reflect the Priority
Level, Packet Delay Budget requirements, bit rate requirements and other
QoS parameters for QoS Flows.

3\. The UE may have non-standardized packet filtering mechanisms. When
the UE wants to send UL PDUs, based on the QoS requirements and the QoS
parameters in the QoS rule(s), the UE has its own logic to map UL
unstructured PDUs into QoS Flows.

4\. The UE sends UL unstructured PDU to the (R)AN using the assigned
DRB. The (R)AN performs bit rate control for the UL of unstructured PDU
Session according to the QoS Profile(s).

5\. The (R)AN receives the UL PDU. The (R)AN encapsulates the UL PDU
with N3 tunnel header.

6\. The (R)AN sends to the N3-encapsulated PDU to the UPF.

7\. The UPF reads the UL QFI, removes the N3 tunnel header. The UPF uses
the mapping between UL QFI and N6 tunnel header (e.g. N6 IP source
address/prefix) to encapsulate the UL PDU into N6 tunnel PDU format.

8\. The UPF sends UL PDU in the N6 tunnel.

### 6.17.5 Impacts on existing entities and interfaces

In the UE:

\- Since no Packet Filter Sets are specified for unstructured PDU data,
the UE uses its own logic to classify PDUs into QoS Flows in the uplink.
The QoS Rules for unstructured QoS Flows do not have Packet Filter Sets.

\- For downlink, the (R)AN uses the assigned DRB(s) for each QoS Flow as
the current (R)AN specifications.

In the UPF:

\- The UPF uses the mapping between N3/N9 QFI and N6 tunnel Packet
Filter Sets to send UL PDU to the AS. In case of IP/UDP tunnel, each N6
PFS has a unique set of source IP address/prefix, source UDP port
number(s), Flow Label.

\- In the downlink, the AS uses the information in the N6 tunnel header
to send the DL packets to the UPF. The UPF uses the mapping between
N3/N9 QFI and N6 tunnel Packet Filter Sets to classify DL packets into
QoS Flows and send to the (R)AN.

### 6.17.6 Evaluation

Solution 17 supports QoS differentiation among QoS flows, among PDU
Sessions, and among UEs for unstructured data. This solution allows
multiple QoS flows in one unstructured PDU Session, which helps to
reduce the air interface and CN signaling for PDU Session establishment,
modification, handover, AF influence traffic routing and other related
procedures.

In case of MT data, the solution assumes that the AS selects the
appropriate tunnel when sending DL data. For MT initiated data it is
unclear for the AS which DL tunnel to initially use.

Impacts to UE:

\- The solution requires changes in the UE to support proprietary packet
classification for unstructured PDUs into QoS flows.

\- In Rel. 15, one Unstructured PDU Session supports only one QoS Flow.
Using Solution 17, one Unstructured PDU Session supports multiple QoS
Flows. An application software in the UE may use proprietary methods to
classify UL PDUs into multiple QoS flows of the same Unstructured PDU
Session.

Impacts to UPF:

\- There is no impacts to the packet classification method of the UPF.
The packet classification in the UPF uses the existing packet filtering
mechanism based on N6 tunnel header, such as IP tunnel header. After
classifying downlink packets, the UPF sends the downlink PDUs to the N3
or N9 QoS flows as it does for the IP or Ethernet traffic.

\- In Rel. 15, one N6 tunnel header is mapped to one unstructured PDU
session. Using Solution 16, one N6 tunnel header is mapped to one QoS
flow of an Unstructured PDU Session.

Impacts to QoS Model:

\- In Rel. 15, the Unstructured PDU Session type supports only one QoS
flow. The IP or Ethernet PDU Session types support multiple QoS Flows by
using packet filters in the UE and UPF.

\- Solution 17 allows one Unstructured PDU Session to support multiple
QoS Flows. A new feature of Solution 17 is that there is no standardized
packet filtering methods to be applied in the UE for unstructured data.
For Unstructured PDU Sessions having multiple QoS flows, the QoS Rules
sent from the SMF to the UE does not contain packet filters for
unstructured data. The UE uses its own logic to classify PDUs into QoS
Flows in the UL.

\- For the UPF, the SMF sends a mapping between QFI of N3 or N9 tunnel
to N6 tunnel header. The UPF uses existing N6 tunnel packet filtering to
classify DL PDUs into N3 or N9 QoS flows. This is different from the
current mapping in Rel. 15, where one N6 tunnel header is mapped to one
Unstructured PDU Session.

6.18 Solution 18: QoS control for unstructured PDU sessions
-----------------------------------------------------------

### 6.18.1 Introduction

This solution addresses Key Issue \#14, QoS Support for NB-IoT by
introducing a mechanism to to differentiate traffic flows within a
single unstructured PDU session.

### 6.18.2 Functional Description

#### 6.18.2.1 QoS Flow mapping for unstructured PDU Session

Similar to the QoS model defined in TS23.501\[5\],the SMF performs
the binding of Service Data Flows (SDFs) to QoS Flows based on the QoS
and service requirements (e.g. the received PCC rules). The SMF assigns
the QFI for a new QoS Flow and derives its QoS profile from the
information provided by the PCF. When applicable, the SMF provides the
QFI together with the QoS profile to the (R)AN. The SMF provides the SDF
template, i.e. Field Position based Packet Filter (see clause6.18.2.2)
associated with the SDF received from the PCF) together with the SDF
template precedence value included in the PCC rule , the QoS related
information, and the corresponding packet marking information, i.e. the
QFI to UPF. For each SDF, when applicable, the SMF generates a QoS rule.
Each of these QoS rules contain the QoS rule identifier, the QFI of the
QoS Flow, the Field Position based Packet Filter of the UL part of the
SDF template, optionally the Field Position based Packet Filter for the
DL part of the SDF template, and the QoS rule precedence value set to
the precedence value of the PCC rule from which the QoS rule is
generated. The QoS rules are then provided to the UE.

The principle for classification and marking of User Plane traffic and
mapping of QoS Flows to AN resources is illustrated in
Figure6.18.2.1-1.

![](media/image60.wmf){width="6.653472222222222in"
height="3.3541666666666665in"}

Figure 6.18.2.1-1: Principle for classification and User Plane marking
for QoS Flows and mapping to AN Resources for Unstructured PDU Session

In DL, incoming data packets are classified by the UPF based on SDF
templates according to the precedence of the PCC rule authorizing the
service data flow, (without initiating additional N4 signalling). The
UPF conveys the classification of the User Plane traffic belonging to a
QoS Flow through an N3 (and N9) User Plane marking using a QFI. The AN
binds QoS Flows to AN resources (i.e. Data Radio Bearers of in case of
3GPP RAN). For PDU Session types used by NB-IoT (i.e. IPv6, IPv4, and
Unstructured), dedicated bearers are not supported in NB-IoT, so
multiple QoS Flows can be band to one AN resource. It is up to the AN to
establish they AN resources that QoS Flows can be mapped to, and to
release it.

If no match is found and all QoS Flows are related with a DL Field
Position based Packet Filter, the UPF shall discard the DL data packet.

In UL, the UE evaluates UL packets against the Packet Filter in the QoS
rules for Unstructured PDU Session based on the precedence value of QoS
rules in increasing order until a matching QoS rule (i.e. whose packet
filter matches the UL packet) is found. The UE uses the QFI in the
corresponding matching QoS rule to bind the UL packet to a QoS Flow. The
UE then binds QoS Flows to AN resources.

If no match is found and the default QoS rule contains an UL Packet
Filter, the UE shall discard the UL data packet.

#### 6.18.2.2 QoS Rule for Unstructured PDU Session

The QoS rules for unstructured PDU sessions are the extension of the QoS
rules used for structured PDU sessions. A generic filtering component
type is defined that can fit into the existing QoS rules as defined by
clause9.8.4.9 of TS24.501\[10\].

The packet filter content is made of a variable number of packet filter
components. Each packet filter component has a type followed by a value.
clause9.8.4.9 of TS24.501\[10\] dictates that each filter component
type can appear in a filter only once.

In order to extend the filtering capability, a new component type
\"Generic filter type\" is added to the list of supported components. In
addition, the Generic filter type component is exempt from the rule to
appear only once in a filter. The generic filter component type can be
realized using the field position based packet filter or any variation
thereof.

To construct a filter that matches more than one field in the packet,
multiple such Generic filter components are used in a manner similar to
the other components. In addition, this Generic filter component can
also be used along with other pre-defined filter components.

#### 6.18.2.2.1 Achieving Reflective QoS

Reflective QoS for IP and Ethernet traffic is enabled by setting rules
for the UE to construct an uplink filtering rule from the downlink
packet. These rules only support UDP/TCP/ESP as the upper layer
protocols for IP type traffic.

In order to achieve reflective QoS for any traffic type, including
unstructured PDU sessions, the following procedures are defined:

\- Install QoS rules with filter direction set as \"Reflective\". This
reflective filter acts as a template that the UE can use to create the
uplink filter:

\- Only one filter per QFI can be installed as a reflective filter. This
is to prevent any ambiguity in picking the filter needed to construct
the uplink filter;

\- The presence of a reflective filter supersedes the construction rules
specified in clause6.2.5.1.4.2 of TS24.501\[10\];

\- Packet filter components apart from the Generic filter component can
be included in reflective filter. When included, the value indicated in
these components are ignored;

\- When the filter is marked as a reflective filter, the \"value\" field
in the packet filter component of the Generic filter is omitted.

#### 6.18.2.3 Field position based Packet Filters

The Field position based Packet Filters is used in the QoS rules or SDF
template for Unstructured PDU Session to identify a QoS Flow. The Field
position based Packet Filter may contain one or more fields position
information and their matching value. The information to generate Field
position based Packet Filters can be either provided by an AF or
preconfigured in the network.

Figure 6.18.2.3-1 represents the format of an example of unstructured
protocol over non-IP.

+-------------+-------------+-------------+-------------+-------------+
| Field 1     | Field 2     | Other       | Field 3     | Other       |
|             |             | field(s)    |             | field(s)    |
| (Value: A1) | (Value: A2) |             | (Value: A3) |             |
|             |             | (Value:     |             | (Value:     |
| (Length: a  | (Length: x  | ...)        | (Length: z  | ...)        |
| bit)        | bit)        |             | bit)        |             |
|             |             | (Length: y  |             | (Length:    |
|             |             | bit )       |             | ...)        |
+-------------+-------------+-------------+-------------+-------------+

Figure 6.18.2.3-1: Format of An Example Unstructured Protocol over
non-IP

As shown in the figure below, Field Position 1, Field Position 2 and
Field Position 3 respectively represent the header field that contain in
the Example Unstructured Protocol over non-IP in Figure 6.18.2.3-1. The
field positions are defined by two attribute, the offset and the length
\< O, L \>. The offset is defined as the starting position in the
packet, in number of bits, and the length field is defined as the number
of bits in this field. In addition, a matching value for the referenced
part of the unstructured PDU and an operation for the comparison of the
set of bits is given. Fields that including in the Field Position based
Packet Filters might be any field in the Unstructured Protocol.

+-------------+-------------+-------------+-------------+-------------+
| Field       | Field       | Field       | Operatio    | Matching    |
| Position    | Position    | Position    | n=,\>,\<, | Value       |
|             | Offset      | Length      | o           | Example     |
|             |             |             | r,and,xor), |             |
|             | (bit)       | (bit)       |             |             |
+-------------+-------------+-------------+-------------+-------------+
| Field       | 0           | a           | =           | A1          |
| Position 1  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| Field       | a           | x           | =           | A2          |
| Position 2  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| Field       | a+x+y       | z           | =           | A3          |
| Position 3  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

Figure 6.18.2.3-2 Field Position based Packet Filters for An Example
Unstructured Protocol

### 6.18.3 Support of EPC interworking

Editor\'s note: This clausedescribes if and how EPC-5GC interworking is
supported by this solution.

### 6.18.4 Procedures

The high-level procedure for sending UL unstructured PDU is described in
Figure 6.18.4-1.

![](media/image61.wmf){width="5.8902777777777775in"
height="4.454166666666667in"}

Figure 6.18.4-1: High level description of UL unstructured PDU delivery

1\. During PDU Session Establishment procedure, the SMF sends QoS Rules
for Unstructured PDU Session to the UE. The QoS Rules contain Field
Position based Packet Filter Sets.

2\. During PDU Session Establishment procedure, the SMF sends SDF
Templates with Field Position based Packet Filter Sets and tunnel
parameters for N6 interface. In case of IP/UDP tunnel, the SMF assigns
IP address(es) and UPD port number for QoS Flow(s).

3\. When the UE wants to send UL PDUs, the UE evaluates UL packets
against the Field Position based Packet Filter in the QoS rules for
Unstructured PDU Session based on the precedence value of QoS rules in
increasing order until a matching QoS rule (i.e. whose packet filter
matches the UL packet) is found. The UE uses the QFI in the
corresponding matching QoS rule to bind the UL packet to a QoS Flow.

4\. The UE sends UL unstructured PDU to the (R)AN using the assigned
DRB. The QFI is attached to the UL PDU.

5\. The (R)AN receives the UL PDU. The (R)AN encapsulates the UL PDU
with N3 tunnel header.

6\. The (R)AN sends to the N3-encapsulated PDU to the UPF.

7\. UPF verifies whether QFIs in the UL PDUs are aligned with the QoS
Rules for Unstructured PDU Session provided to the UE. The UPF removes
the N3 tunnel header and encapsulate UL unstructured PDU with N6 Tunnel
Header.

8\. The UPF sends UL PDU in the N6 tunnel.

The high-level procedure for sending DL unstructured PDU is described in
Figure 6.18.4-2.

![](media/image62.wmf){width="5.8902777777777775in"
height="4.454166666666667in"}

Figure 6.18.4-2: High level description of DL unstructured PDU delivery

1\. During PDU Session Establishment procedure, the SMF sends QoS Rules
for Unstructured PDU Session to the UE. The QoS Rules contain Field
Position based Packet Filter Sets.

2\. During PDU Session Establishment procedure, the SMF sends SDF
Templates with Field Position based Packet Filter Sets and tunnel
parameters for N6 interface. In case of IP/UDP tunnel, the SMF assigns
IP address(es) and UPD port number for QoS Flow(s).

3\. DN sends DL PDUs carried in N6 Tunnel. The QoS requirements may be
embedded in the fields of unstructured PDU and the N6 tunnel parameters.

4\. The UPF Classifies DL Unstructured PDU according to SDF templates
with Filed Position based Packet Filter and N6 tunnel parameters for
Unstructured PDU Session.

5\. The UPF sends DL Unstructured PDU with QFI to RAN.

6\. The (R)AN binds QoS Flows to AN resources.

7\. The (R)AN sends DL Unstructured PDU to UE.

### 6.18.5 Impacts on existing entities and interfaces

In the UE:

\- In UL, for unstructured PDU Session, the UE determines and bind the
UL packet to a matching QoS rule based on the Field Position based
Packet Filter in the QoS rules.

In the UPF:

\- In DL, for unstructured PDU Session, the UPF classifies the incoming
data packets based on SDF templates with Field Position based Packet
Filters.

### 6.18.6 Evaluation

Solution 18 supports QoS differentiation among QoS flows, among PDU
Sessions, and among UEs for unstructured data. This solution allows
multiple QoS flows in one unstructured PDU Session, which helps to
reduce the air interface and CN signaling for PDU Session establishment,
modification, handover, AF influence traffic routing and other related
procedures.

Impacts to QoS Model:

\- Solution 18 requires new standardization of field position based
(FPB) packet filters to be used in the UE and UPF.

\- The SMF sends FPB packet filters to the UE and UPF, in the same way
as the SMF sends IP or Ethernet packet filters to the UE and UPF.

Impacts to UE:

\- The NB-IoT UEs need to be designed to support FPB packet filters. In
the uplink, the UE uses FPB packet filter to classify UL PDUs into QoS
flows of the same Unstructured PDU Session.

Impacts to UPF:

\- In Rel. 15, in the downlink the UPF uses N6 tunnel header to classify
DL PDUs into Unstructured PDU Session to be sent over N3 or N9 tunnel by
using the mapping of one N6 tunnel header and one unstructured PDU
Session.

\- Using Solution 18, the UPF uses N6 tunnel header and FPB packet
filters to classify PDUs into QoS flows of N3 or N9 interface; one N6
tunnel header may support multiple QoS flows of a single unstructured
PDU session.

6.19 Solution 19: 5GS UP Optimization for Infrequent Small Data Transmission
----------------------------------------------------------------------------

### 6.19.1 Introduction

This solution addresses the Key Issue 1: Support for infrequent small
data transmission. This solution has commonality with RRC procedure for
RRC-Inactive, which can resolve Key issue 2: Frequent small data
communication.

This solution is to optimize small data transmission for theUEs from
CM-IDLE mode. It enables transfer of user plane data without need for
the Service Request procedure. It is proposed to keep AS context in the
NG-RAN including information the UPF connection and relevant QoS flow(s)
to be used for the connection, even when UE moves into CM-IDLE. When UE
resumes the connection, the NG-RAN uses the information to activate DRB,
AS security and User Plane connectivity over N3 for the small data
packet delivery to the UPF. The UPF also keeps N3 tunnel information for
the PDU session to allow UL data transmission.

This solution has following characteristics:

\- The AS context contains information related to the N3 tunnel, N2AP
association, UE context and DRB context, AS security information, Header
Compression context, and any necessary for RRC resume. The AS context is
configured during PDU session establishment or registration.

NOTE1: The content of the AS Context is expected to be further
confirmed by RAN WGs.

\- UE and NG-RAN may perform header compression for IP data based on the
Header Compression context.

\- The AS context is kept in NG-RAN and UE after the connection suspend
procedure.

\- AS security context is established between the NG-RAN and the UE.
Therefore, existing AS security mechanism is re-used.

\- NG-RAN performs Connection Suspend procedure to suspend the
connection for the UE. NG-RAN indicates release cause set to
RRC-suspend, and includes the resume ID which is stored by the UE.

NOTE2: RAN WGs are expected to confirm that RRC Connection Release
procedure is used for connection suspend.

\- UE performs Connection Resume procedure using resume ID from
CM-IDLE/RRC-IDLE state. So this solution is also applicable to MICO mode
UE.

NOTE3: RAN WGs are expected to confirm whether to re-use Connection
Resume procedure that is used for RRC-Inactive in NR.

\- After the UE performs RRC resume procedure, if NG-RAN determines if
the AS context for the UE is valid, then the NG-RAN derives the AS
security information, DRB, QoS flow and N3 tunnel information for the
UE. The NG-RAN activates AS security, related DRB(s) and N3 tunnel(s).

\- As NG-RAN keeps N3 Uplink Tunnel Endpoint ID in the AS context, user
plane for uplink transmission is maintained. Also UPF keeps N3 Uplink
Tunnel Endpoint ID to allow UL data.

\- In case of serving NG-RAN is changed, new NG-RAN sends N3 Downlink
TEID to SMF, and SMF updates this information to UPF so that path for
downlink data transmission becomes available.

\- In case of selective activation of UP connections during service
request procedure or CN-initiated selective deactivation of UP
connection (see TS23.502\[7\]), when the UE enters CM-IDLE via
Connection Suspend procedure the AS context only contains the PDU
session(s) that are active. When there is MO Data, the procedure is as
follows:

\- The UE performs Connection Resume procedure at RRC layer. The UE and
NG-RAN resume the PDU sessions that were active during Connection
suspend procedure.

\- RRC layer notifies NAS the change of state to RRC connected and the
PDU session(s) that are active. The NAS needs to be aware that all PDU
session(s) that were active during Connection suspend procedure will be
reactivated at the next RRC resume procedure, regardless of whether NAS
needs this or not. If the NAS requires to further activate PDU
session(s) that is/are not active, the UE initiates service request from
CM connected, i.e. after Conenction resume procedure is complete, to
activate the necessary PDU session(s).

NOTE4: Given that IoT devices are not likely to have a large number of
PDU sessions, to reduce power consumption and signalling it is
recommended that selective activation/deactivation of UP connection(s)
is not used and all PDU sessions are activated when the UE is in
CM-CONNECTED.

### 6.19.2 Functional Description

#### 6.19.2.1 General

The AS context is stored in NG-RAN and it includes the relevant UPF or
PDU session related information for the UE, which has been provided
during PDU session establishment. During PDU Session establishment
procedure, SMF provides N2 SM information which is stored in the NG-RAN
in the AS Context. The UE and the NG-RAN use Resume ID to identify AS
context.

When NG-RAN suspends the RRC connection to the UE, NG-RAN notifies the
AMF with the AS context to be kept in the AMF as transparent. If new
serving NG-RAN fails to retrieve the AS context from the old NG-RAN, the
NG-RAN asks to the AMF to retrieve the AS context stored in the AMF.

When UE in CM-IDLE to send UL data or the UE receives paging message,
the UE request to resume RRC Connection, if there is suspended AS
context stored in the UE. During resume procedure, the NG-RAN derives
necessary information to activate AS security, DRB and the path over N3
to the UPF. After RRC connection established, the UE can send UL data,
and then the RAN forwards the data on the N3 interface. Given all
information required to forward UL data is derived from the AS context
for the UE, the NG-RAN does not have to signal to the AMF before sending
UL data. The NG-RAN conditionally (e.g. if a DL tunnel is expected to be
needed based on AS RAI) notifies AMF of UE\'s connection resume without
depending on timing of UL data forwarding.

#### 6.19.2.2 Mobility

Connected mode mobility is supported by existing handover procedures.

When the UE requests RRC resume and if the NG-RAN doesn\'t have valid AS
context to resume the UEs connection, the NG-RAN performs context fetch
to retrieve the valid AS context that is kept in the last serving
NG-RAN.

If there is Xn connectivity, the new NG-RAN performs NGAP procedure for
context fetch with the last serving NG-RAN. If there is no Xn
connectivity, the new NG-RAN requests the context from the last serving
NG-RAN.

NOTE: For the case that the old NG-RAN is not within Xn connectivity
area, RANWG3 need to study whether indirect context retrieval via AMF
or another NF is to be defined.

If the NG-RAN node fails to fetch the valid AS context, the NG-RAN
should reject resume and UE follows procedures that will be defined in
stage-3.

When the UE enters a new TA currently not part of the UE registration
area, the UE requests RRC resume and will initiate a NAS registration
update. The SMF shall subscribe UE location change to the AMF in order
to determine UPF re-allocation and update N3 tunnel information. The SMF
may subscribe change of serving NG-RAN node to the AMF in order to
determine update of N3 tunnel information.

#### 6.19.2.3 Security

This solution allows existing AS security mechanism as it is.

### 6.19.3 Support of EPC Interworking

Support and use of UP optimization is negotiated independently in EPC
and 5GC. Existing interworking procedures can therefore be reused.

### 6.19.4 Procedures

#### 6.19.4.1 PDU Session Establishment

![](media/image63.wmf){width="6.489583333333333in" height="8.56875in"}

Figure 6.19.4-1: UE-requested PDU Session Establishment for 5GS UP
Optimization

It is assumed that the UE has already registered in the 5G system.

When UE requests PDU session establishment, the UE indicate to use 5GS
UP optimization to the AMF, and the AMF indicates the request of 5GS UP
optimization to the SMF. During PDU Session establishment procedure, the
SMF informs NG-RAN of the established PDU session is used for 5GS UP
Optimization. The SMF needs to know usage of 5GS UP optimization for the
PDU session for keeping N3 UL TEID. The NG-RAN needs to know usage of
5GS UP optimization for determining to apply RRC suspend/resume and
store the information for the PDU Session in the AS context.

1\. The UE provides an indication that it wants to use 5GS UP
Optimization (e.g., use of Resume/Suspend procedure) to the AMF.

NOTE1: It is assumed that NG-RAN broadcasts system information will
indicate the support of resume/suspend.

2\. AMF selects an SMF that supports the use of 5GS UP Optimization.

3\. The AMF indicates the support of 5GS UP Optimization in the
Nsmf\_PDUSession\_CreateSMContext Request operation. Then the SMF
considers this PDU session establishment message is for 5GS UP
Optimization, and can determine the UP connection for this PDU session
should not be de-activated.

The AMF provides the registration area of the UE to the SMF in order to
assist that the SMF selects the UPF which can be maintained while UE
mobility happens within the registration area.

NOTE2: It is assumed UPF would not be changed in the registration area.
If UE moves out of the registration area, UPF can be re-allocated during
mobility registration procedure, by invoking
Nsmf\_PDUSession\_UpdateSMContext.

...

8\. SMF selects a UPF that supports the 5GS UP optimization.

...

11\. SMF includes the indication of 5GS UP Optimization in N2 SM message
to the NG-RAN so that NG-RAN can decide to perform RRC suspend procedure
to the UE, and to store information for the PDU session in the AS
context.

...

#### 6.19.4.2 UL data transmission from CM-IDLE

The following figure shows an example of how MO small data packet is
delivered from the UE.

Figure 6.19.4.2-1: MO data Transmission using 5GS UP Optimization

1a/1b. The UE triggers RRC Connection Resume procedure including Resume
ID which identifies the AS context stored in the NG-RAN. Using the valid
AS Context for the UE, the NG-RAN performs AS security check, DRB is
established, and NG-RAN enables N3 UL TEID for data delivery.

If the Resume ID indicates another NG-RAN within Xn connectivity, i.e.
old NG-RAN, the NG-RAN performs direct context fetch via Xn.

NOTE1: For the case that the old NG-RAN is not within Xn connectivity,
RANWG3 need to study whether indirect context fetch via AMF or another
network function is to be defined.

If NG-RAN fails to get valid AS context, it rejects RRC Connection
Resume with an appropriate cause, so that the UE performs the related
NAS procedure.

UE can send UL data right after successful RRC Connection Resume
procedure. The NG-RAN forwards the UL data received from the UE to the
UPF by using N3 UL TEID in the AS context.

2\. If NG-RAN expect no DL data e.g. based on AS RAI indicating single
packet or based on the Expected UE Behavior (with Release Assistance
Information/Traffic Pattern/Traffic Profile available in the UE context
in NG-RAN) indicating single packet (and the AS RAI is not present),
NG-RAN immediately suspends the RRC connection and this procedure stops
here. If NG-RAN expect DL data, the NG-RAN notifies the AMF that UE
connection has been resumed by sending N2AP message which includes N2 SM
info and PDU Session ID. The NG-RAN includes N3 DL TEID for the PDU
session in the N2 SM message.

3\. The AMF enters CM-Connected state. The AMF identifies the UE
context, and forwards N2 SM message to the SMF.

4\. The SMF identifies the UE and the PDU session. If there is N2 SM
message in the Nsmf\_PDUSession\_UpdateSMcontext request message, the
SMF performs N4 Session Modification to update N3 DL TEID to the UPF.

If there is DL data arrived for the UE, the UPF forwards the data to the
NG-RAN using N3 DL TEID.

5\. The SMF sends Nsmf\_PDUSession\_UpdateSMcontext response. If there
is any change for the PDU session e.g., in case of the QoS targets
cannot be fulfilled for a QFI, the SMF informs this information in the
N2 SM information.

6\. The AMF acknowledges the connection resume to the NG-RAN. If there
is change of PDU session as received in N2 SM message from the SMF,
NG-RAN can perform RRC reconfiguration. The AMF shall also provide the
indication of single or dual packet information to NG-RAN (e.g. by
including the Expected UE Behavior) in case the NG-RAN does not already
have this information).

NOTE2: Handling of pending DL data/signalling for the UE resuming RRC
connection with AS RAI will be discussed during the normative phase, if
this solution is agreed for conclusions.

#### 6.19.4.2b UL data transmission from CM-IDLE with Early Data Transmission

The following figure shows a single MO small data delivered from the UE
using Early Data Transmission.

NOTE1: For Early Data Transmission with dual or multiple packet
transmission, or unknown number of packets, the procedure continues
after step 1a as in previous clause6.19.4.2 except that first UL data
packet does not require a specific UL message from UE to RAN.

Figure 6.19.4.2b-1: Single MO data Transmission using 5GS UP
Optimization and EDT

1a. The UE sends RRC Connection Resume Request with the UL data included
as Early Data Transmission with the RRC Connection Resume Request. Using
the valid AS Context for the UE, the NG-RAN enables N3 UL TEID for data
delivery.

1b. Either based on the AS Release Assistance Indication (RAI) included
by the UE in step 1a indicating single packet transmission, or if the
Expected UE Behavior is available and stored in the UE context in RAN
(with a Release Assistance Information present) indicating single packet
(and the AS RAI is not present in step 1a), then NGRAN immediately
suspends the RRC connection (to minimize UE power consumption).

2\. The NG-RAN forwards the UL data received from the UE to the UPF by
using N3 UL TEID in the AS context.

3\. UE and RAN remain suspended.

NOTE2: Handling of pending DL data/signalling for the UE resuming RRC
connection with AS RAI will be discussed during the normative phase, if
this solution is agreed for conclusions.

#### 6.19.4.3 DL data transmission

The following figure shows an example of how MT small data packet is
delivered to the UE in CM-IDLE.

![](media/image66.wmf){width="6.690277777777778in"
height="4.194444444444445in"}

Figure 6.19.4.3-1: MT data Transmission using 5GS UP Optimization

1\. At arrival of DL data, UPF notifies to SMF.

2a. The SMF determines the AMF serving the UE, and invokes
Namf\_Comm\_N1N2MessageTransfer to the AMF including PDU Session ID.

2b. The AMF responds to the SMF.

3\. The AMF send a paging message to the NG-RAN.

4\. The NG-RAN performs paging to the UE.

5\. The UE triggers RRC Connection Resume procedure including Resume ID
which identifies the stored AS context in the NG-RAN. Using the valid AS
Context for the UE, the NG-RAN performs security check, DRB is
established, and NG-RAN enables N3 DL TEID for data delivery.

If the Resume ID indicates another NG-RAN within Xn connectivity, i.e.
old NG-RAN, the NG-RAN performs direct context fetch via Xn.

NOTE: For the case that the old NG-RAN is not within Xn connectivity,
RANWG3 need to study whether indirect context fetch via AMF or another
network function is to be defined.

If the NG-RAN fails to retrieve valid AS context, it rejects the RRC
connection Resume with an appropriate cause, so that the UE performs
Service Request.

6\. The NG-RAN notifies the AMF that UE connection has been resumed by
sending N2AP message which includes N2 SM message and PDU Session ID.
The NG-RAN includes N3 DL TEID for the PDU session in the N2 SM message.

7\. The AMF enters CM-Connected state after receiving the N2AP message.
The AMF determines the SMF based on the PDU Session ID received from
step 2a and 6, and the AMF sends N2 SM message to the SMF.

8\. The SMF identifies the UE and the PDU session. Based on the received
N2 SM message, the SMF performs N4 Session Modification to update N3 DL
TEID to the UPF. The UPF forwards the data to the NG-RAN using N3 DL
TEID.

9\. The SMF sends Nsmf\_PDUSession\_UpdateSMcontext response.

10\. The AMF acknowledges the connection resume to the NG-RAN.

#### 6.19.4.4 Connection Suspend procedure

This procedure is used by the NG-RAN to suspend the connection if 5GS UP
Optimization is supported.

![](media/image67.wmf){width="6.694444444444445in"
height="2.6958333333333333in"}

Figure 6.19.4.4-1: Connection Suspend procedure

1\. The NG-RAN initiates the Connection Suspend procedure to the AMF. In
the N2 message, the NG-RAN includes all PDU Session ID(s) that have been
activated.

2\. The AMF sends Nsmf\_PDUSession\_UpdateSMContext Request to inform
connection suspend of the PDU Session, based on the PDU session ID(s) in
step 1.

3\. The SMF determines to disable N3 DL TEID for the PDU session as UE
goes to RRC suspended while SMF keeps N3 UL TEID to allow uplink data
transmission when UE resumes the connection. The SMF performs N4 Session
Modification procedure with UPF to disable N3 DL TEID. The UPF enables
Downlink Data Notification.

4\. The SMF sends Nsmf\_PDUSession\_UpdateSMContext Response to the AMF.

5\. The AMF sends UE Context suspend response to the NG-RAN to
successfully complete the connection suspend procedure.

6\. The NG-RAN sends RRC message to suspend the RRC Connection toward
the UE with including the Resume ID to be used for identifying the AS
context for the RRC connection resume. The UE keeps the AS context.

#### 6.19.4.5 CN-initiated UP Deactivation procedure

For UE in CM-CONNECTED with multiple active PDU sessions, when SMF
decides deactivation of a PDU session for the UE, it may decide also
whether UP optimization will be applied for the PDU session based on
triggering condition for PDU session deactivation (e.g. UPF reports
inactivity for the PDU session). When the SMF decides to apply UP
optimization for the PDU session which will be deactivated, it informs
RAN to store corresponding AS context for 5G UP optimization support
when UE in CM-IDLE tries to transmit UL data.

Editor\'s note: It is FFS whether selective PDU Session deactivation
needs to be applied for CIOT in 5G System.

Editor\'s note: The need for CN-initiated UP Deactivation procedure will
be separately evaluated and concluded from other part of the solution
19.

Figure 6.19.4.5-1: CN-initiated UP Deactivation procedure

0\. It assumes that UE established multiple PDU sessions with 5GS UP
Optimization which includes uplink session.

1\. During UE in CM-CONNECTED state, the SMF determines that UP
connection of the PDU session needs to be deactivated. And SMF also
determines whether whole UP connection will be deactivated (for example,
for the case that UE is reported as out of allowed area or our of LADN
service area) or uplink UP connection will be maintained for 5G UP
optimization (for example, UPF\'s report of inactivity case).

2\. The SMF performs N4 Session Modification procedure with UPF to
disable N3 DL and UL TEIDs or disable only N3 DL TEID while keeping N3
UL TEID.

3\. The SMF may send an N11 message containing N2 SM Session Release
Request to release the (R)AN resources associated with the PDU session
and may include indication of 5G UP optimization.

4\. The AMF forwards the N2 SM Session Release Request to the RAN.

5\. RAN releases AS resource for the PDU session as indicated N2 SM
Session Release Request. When 5G UP optimization is indicated in the
message, RAN stores AS context of the PDU session for 5G UP optimization
support when UE transmits UL data from CM-IDLE. The RAN may issue NG-RAN
specific signalling (e.g. RRC connection reconfiguration) to the UE.
After deactivation of the PDU Session, if the PDU session needs to be
activated, UE and 5G CN will follow Service Request procedure as
specified in subclause4.2.3 of TS23.502\[7\] until UE transits to
CM-IDLE state.

6\. The RAN acknowledges the N2 Session Release Request by sending an N2
PDU Session Response to the AMF.

7\. The AMF sends an N11 message to acknowledge the SM request received
in step4.

8\. After UE entered CM-IDLE state through Connection Suspend procedure
specified in subclause6.19.4.4, UE may trigger RRC Resume procedure
including Resume ID for uplink data transmission.

9\. RAN may respond RRC Resume request with updated AS context including
the AS context saved at step5 in addition to the AS context saved
during Connection Suspend procedure specified in subclause6.19.4.4.

10\. UE may transmit uplink data according to the AS context after
receiving response from RAN at step9. And other following procedure as
specified in subclause6.19.4.2 will proceed.

### 6.19.5 Impacts on existing entities and interfaces

UE:

\- Support of connection suspend and resume procedures.

\- Storing the relevant AS information at transition to CM-IDLE.

RAN:

\- Support of connection suspend and resume procedures.

\- Storing the relevant AS information at transition to CM-IDLE.

AMF:

\- Support of connection suspend and resume procedures.

The following additional impact results from the CN-initiated UP
Deactivation procedure in clause6.19.4.5:

UE:

\- Support for reactivation of PDU session that was previously
deactivated during connection resume procedure.

RAN:

\- Support keeping AS context for PDU sessions that have been
deactivated.

SMF:

\- Decision whether to apply 5G UP otimization for the deactivated PDU
session; protocol impact to include indication of 5G UP optimization to
AMF.

### 6.19.6 Evaluation

This solution introduces 5G UP optimization similar to EPS UP
optimization, i.e. enables the RAN to suspend the UE\'s RRC connection,
to store the AS context in the RAN and to resume the RRC connection when
small data needs to be sent (after fetching the AS context from a
different RAN node if needed).

In comparison to EPS UP optimization an additional enhancement has been
proposed: avoiding to resume the RRC connection if the UE sends a single
UL packet only (indicated by AS Release Assistance Indication). As the
UE is in CM-IDLE state when its RRC connection has been suspended, the
solution can be easily combined with eDRX with long sleep cycles and the
related HLCom mechanisms for CM-IDLE.

The key benefit of the solution is that the UE can send data from
CM-IDLE without having to perform a full service request. This saves
over-the-air signaling since the RRC connection can be resumed and the
already negotiated AS security context can be reused. Since the UPF N3
information is also stored in the AS context, another benefit is that
small data sent by the UE can be forward to the UE immediately. The
additional enhancement proposed in comparison to EPS UP optimization,
namely to avoid resuming the RRC connection if the UE sends a single UL
packet only (indicated by AS Release Assistance Indication), has the
additional benefit that N2, N11 and N4 signaling for re-establishing an
N3 tunnel can be completely avoided. The solution has impact to UE, RAN
and CN.

With respect to the CN-initiated UP Deactivation procedure in
clause6.19.4.5: Storing the AS context for deactivated PDU sessions may
save signaling in case the UE may want to send UL data from CM-IDLE
(with suspended RRC connection) for a PDU session that was deactivated
before the RRC connection was suspended. However, this proposal has
additional system impact to UE, RAN and SMF. These impacts do not appear
justified given that CIoT devices are unlikely to have many PDU sessions
active in parallel. Therefore it is recommended to not pursue the part
of the solution described in clause6.19.4.5.

6.20 Solution 20: NIDD API support by SMF for infrequent small data transfer via NAS-SM
---------------------------------------------------------------------------------------

### 6.20.1 Introduction

#### 6.20.1.1 General

This solution applies to Key issue 1 (support for infrequent small data
transmission), builds on top of solution 1 (as documented in clause6.1)
and adds support for the NIDD API to the SMF.

#### 6.20.1.2 Architecture reference models

##### 6.20.1.2.1 General

In addition to the architecture reference models in clause6.1.1.2 the
following clauses provide the reference models to support the NIDD API
for small data transfer via NAS-SM.

##### 6.20.1.2.2 Non-roaming reference architecture

![](media/image69.wmf){width="5.694444444444445in"
height="2.2569444444444446in"}

Figure 6.20.1.2.2-1: Architecture for small data delivery via NAS and
NIDD API (non-roaming)

##### 6.20.1.2.3 Roaming reference architectures

![](media/image70.wmf){width="6.279166666666667in"
height="2.6569444444444446in"}

Figure 6.20.1.2.3-1: Architecture for small data delivery via NAS and
NIDD API (home-routed roaming)

### 6.20.2 Functional Description

In addition to clause6.1.2, the following principles apply:

\- Support of NIDD API:

\- The NIDD API is supported for PDU sessions of type unstructured.

\- The SMF supports the NIDD API towards the SCS/AS for non-roaming
scenarios. In case of home-routed roaming, the H-SMF supports the NIDD
API.

\- Whether or not the NIDD API shall be invoked for a PDU session is
determined by a per DNN per S-NSSAI Invoke NIDD API indication in the
subscription.

\- If the subscription includes an Invoke NIDD API indication and an SMF
ID for the S-NSSAI / DNN requested by the UE, then the AMF selects that
SMF for the small data PDU session.

\- The SMF ID for a given S-NSSAI / DNN in the subscription can be
updated by means of the NIDD configuration procedure.

\- The SMF can provide a Maximum Packet Size for unstructured PDU
Session to the UE via PCO.

\- The SMF performs buffering for unstructured DL data received via the
NIDD API while the UE is unreachable.

\- SMF subscribes to UE reachability event reporting from the AMF. AMF
informs SMF how long a UE is expected to be unreachable (if known to the
AMF).

Editor\'s note: Interactions with CAPIF are FFS.

### 6.20.3 Support of EPC interworking

EPC interworking is enabled by the principles documented in clause6.1.3
with the following differences:

\- NIDD API is terminated on a co-located SMF (capable of small data
transfer via NAS) and SCEF, referred to as SMF+SCEF.

\- Idle-mode mobility from 5GS to EPS is performed as per the procedure
described in TS23.502\[7\] clause4.11.1.3.2 with the following
differences:

\- Step 5b: SMF+SCEF maps the PDU session for Data over NAS-SM to an
SCEF PDN Connection and sets the Control Plane Only PDN Connection
Indication.

\- Idle-mode mobility from to EPS to 5GS is performed as per the
procedure described in TS23.502\[7\] clause4.11.1.3.3 with the
following differences:

\- AMF indicates support of CIoT Optimizations when requesting the UE
context from the MME via N26;

\- for a PDN connection for which Control Plane Only PDN Connection
Indication is set:

\- (H-)SMF does not select a (H-)UPF;

\- in the case of home-routed roaming:

\- Step 14: the AMF selects a V-SMF supporting small data over NAS-SM;

\- Step 14: V-SMF does not select a V-UPF.

Editor\'s note: How the same IP address can be used with SCEF is FFS.

### 6.20.4 Procedures

#### 6.20.4.1 PDU Session Establishment (non-roaming)

This procedure replaces the PDU session establishment procedure
described in clause6.1.4.1 for non-roaming scenarios. It takes the PDU
Session Establishment procedure as described in TS23.502\[7\],
clause4.3.2.2.1 as the baseline.

![](media/image71.wmf){width="6.688888888888889in"
height="3.386111111111111in"}

Figure 6.20.4.1-1: PDU Session Establishment enabling Data over NAS-SM
and NAS API

1\. The UE sends a PDU session establishment request message as SM
payload of a NAS transport message. The NAS transport message contains
PDU session ID and a \"Data transfer over NAS-SM preference\" indication
along with other regular information e.g. DNN, S-NSSAI, etc. if
applicable.

2\. If the subscription includes an Invoke NIDD API indication and an
SMF ID for the DNN and S-NSSAI requested by the UE, then the AMF selects
the SMF identified by the SMF ID.

If the subscription includes an Invoke NIDD API indication but no SMF ID
for the DNN and S-NSSAI requested by the UE, then the AMF rejects the
PDU session establishment request.

Otherwise, the AMF takes the received \"Data transfer over NAS-SM
requested\" indication received from the UE into account to select an
SMF that supports Data over NAS-SM if available for the requested DNN,
and S-NSSAI if it applies. The AMF stores the association of the PDU
Session ID and the selected SMF ID in the UE context.

3\. The AMF forwards the Data transfer over NAS-SM requested indication
to the SMF by invoking Nsmf\_PDUSession\_CreateSMContext request. The
SMF replies with an Nsmf\_PDUSession\_CreateSMContext Response.

4\. The SMF registers with the UDM and retrieves the Session Management
Subscription data for the corresponding SUPI, DNN and S-NSSAI).

If the subscription includes an Invoke NIDD API indication for the DNN
and S-NSSAI requested by the UE and if an SCS/AS has performed the NIDD
Configuration procedure (see clause6.20.4.5) with the SMF for this UE,
then the procedure continues with step7.

If the subscription includes an Invoke NIDD API indication for the DNN
and S-NSSAI requested by the UE but no SCS/AS has performed the NIDD
Configuration procedure with the SMF for this UE, then the SMF rejects
the PDU session establishment with an appropriate cause code.

Editor\'s note: Need for support and procedures for Secondary
authorization/authentication are FFS.

5\. \[Conditional\] The SMF selects a UPF.

6\. \[Conditional\] The SMF configures the UPF for data transfer via N4.

7\. The SMF sends a PDU Session Establishment Accept providing
indication that Data Over NAS-SM is enabled for this PDU session without
including the N2 SM container.

8\. The AMF forwards the NAS message to the UE.

#### 6.20.4.2 PDU Session Establishment (home-routed roaming)

This procedure takes the PDU Session Establishment procedure as
described in TS23.502\[7\], subclause4.3.2.2.2 as the baseline.

![](media/image72.wmf){width="6.692361111111111in"
height="4.406944444444444in"}

Figure 6.20.4.2-1: PDU Session Establishment enabling Data over NAS-SM
and NAS API

1\. The UE sends a PDU session establishment request message as SM
payload of a NAS transport message. The NAS transport message contains
PDU session ID and a \"Data transfer over NAS-SM preference\" indication
along with other regular information e.g. DNN, S-NSSAI, etc. if
applicable.

2\. If the subscription includes an Invoke NIDD API indication and an
SMF ID for the DNN and S-NSSAI requested by the UE, then the AMF selects
the SMF identified by the SMF ID. If the subscription includes an Invoke
NIDD API indication but no SMF ID for the DNN and S-NSSAI requested by
the UE, then the AMF rejects the PDU session establishment request.
Otherwise, the AMF takes the received \"Data transfer over NAS-SM
requested\" indication received from the UE into account to select an
SMF that supports Data over NAS-SM if available for the requested DNN,
and S-NSSAI if it applies. The AMF stores the association of the PDU
Session ID and the selected SMF ID in the UE context.

3\. The AMF forwards the Data transfer over NAS-SM requested indication
and the Invoke NIDD API indication (if included in the subscription) to
the SMF by invoking Nsmf\_PDUSession\_CreateSMContext request. The SMF
replies with an Nsmf\_PDUSession\_CreateSMContext Response.

4\. \[Conditional\] If the V-SMF has not received the Invoke NIDD API
indication, the SMF selects a UPF.

5\. \[Conditional\] If the SMF has not received the Invoke NIDD API
indication, the SMF configures the UPF for data transfer via N4.

6\. The V-SMF sends the Nsmf\_PDUSession\_CreateSMContext request
including the Data transfer over NAS-SM requested indication to the
H-SMF. If the V-SMF has configured a V-UPF in step 5, the V-SMF includes
V-CN-Tunnel-Info towards the H-SMF.

Editor\'s note: Need for support and procedures for Secondary
authorization/authentication are FFS.

7\. The SMF registers with the UDM and retrieves the Session Management
Subscription data for the corresponding SUPI, DNN and S-NSSAI). If the
subscription includes an Invoke NIDD API indication for the DNN and
S-NSSAI requested by the UE and if an SCS/AS has performed the NIDD
Configuration procedure (see clause6.20.4.5) with the SMF for this UE,
then the procedure continues with step 10. If the subscription includes
an Invoke NIDD API indication for the DNN and S-NSSAI requested by the
UE but no SCS/AS has performed the NIDD Configuration procedure with the
SMF for this UE, then the SMF rejects the PDU session establishment with
an appropriate cause code.

8\. \[Conditional\] If the subscription does not includes an Invoke NIDD
API indication for the DNN and S-NSSAI requested by the UE, then the
H-SMF selects a H-UPF.

9\. \[Conditional\] If the subscription does not includes an Invoke NIDD
API indication for the DNN and S-NSSAI requested by the UE, then the
H-SMF configures the H-UPF.

10\. The H-SMF sends a Nsmf\_PDUSession\_CreateSMContext response to the
V-SMF including an indication that Data Over NAS-SM is enabled for this
PDU session without including the N2 SM container. If the H-SMF has
selected and configured a H-UPF in steps 8 and 9, then the H-SMF also
includes H-CN Tunnel Info.

11\. The SMF sends a PDU Session Establishment Accept providing an
indication that Data Over NAS-SM is enabled for this PDU session without
including the N2 SM container.

12\. The AMF forwards the NAS message to the UE.

#### 6.20.4.3 Mobile Originated Data Transport via NAS-SM and NIDD API

![](media/image73.wmf){width="6.6930555555555555in"
height="4.023611111111111in"}

Figure 6.20.4.3-1: Mobile Originated NIDD procedure

1\. Steps 1-3 of Figure 6.1.4.2-1.

2\. AMF forwards the data to the (V-)SMF handling the PDU session
identified by the PDU session ID contained in the NAS transport message.
In case of home-routed roaming, the V-SMF forwards the data to the
H-SMF.

3\. When the (H-)SMF receives the uplink data and finds a related NIDD
configuration, the (H-)SMF sends the data in an MO NIDD Indication
(External Identifier or MSISDN, non-IP data,) to the SCS/AS. If no NIDD
configuration is associated with the UE\'s PDU session, the data is
discarded, MO NIDD Indication is not sent, and the flow continues at
step4.

Editor\'s note: Whether the PDU session is released is FFS.

4\. The SCS/AS responds to the H-(SMF) with a MO NIDD Acknowledgement
(Cause).

5\. If downlink data is available then the MT NIDD procedure as per
clause6.20.4.4 is executed. Otherwise, if no uplink data is available,
clause6.1.4.2 steps 11-14 are executed.

#### 6.20.4.4 Mobile Terminated Data Transport via NAS-SM and NIDD API

Figure 6.20.4.4-1 illustrates how SCS/AS sends unstructured (non-IP)
data to a given user as identified via External Identifier or MSISDN.
This procedure assumes that the NIDD configuration procedure has been
completed before.

![](media/image74.wmf){width="6.6930555555555555in"
height="7.189583333333333in"}

Figure 6.20.4.4-1: Mobile Terminated NIDD procedure

1\. The SCS/AS sends a MT NIDD Submit Request (External Identifier or
MSISDN, , non-IP data, Priority, PDN Connection Establishment Option)
message to the (H-)SMF. The Maximum Latency is an optional field that is
used to indicate maximum delay acceptable for downlink data and may be
used to configure the buffer duration; a Maximum Latency of 0 indicates
that buffering is not allowed. If Maximum Latency is not provided, the
(H-)SMF determines the acceptable delay based on local polices. Priority
is an optional field that is used to indicate the priority of the non-IP
data packet relative to other non-IP data packets. PDN Connection
Establishment Option is an optional field that is used to indicate what
the (H-)SMF should do if the UE has not established the PDU session
(wait for the UE to establish the PDU session, respond with an error
cause, or send a device trigger; see step2). If PDN Connection
Establishment Option is not provided with the non-IP packet, the (H-)SMF
uses the PDN Connection Establishment Option that was provided during
NIDD Configuration to decide how to handle the absence of a PDU Session.

2\. The (H-)SMF determines the PDU session based on the S-NSSAI and DNN
associated with the NIDD configuration and the user identity. If a PDU
session context has been found but the non-IP packet size is larger than
the Maximum Packet Size that was provided to the SCS/AS during NIDD
Configuration, the (H-)SMF sends a NIDD Submit Response (Cause) with a
cause value indicating the reason for the failure condition and the flow
stops at this step. Otherwise, the flow continues with step3.

If no PDU session is found, then the (H-)SMF, depending on PDN
Connection Establishment Option, may either:

\- send a NIDD Submit Response (Cause) with appropriate error cause
value. The flow stops at this step; or

\- perform device triggering towards the UE (via NEF) to establish a PDU
session. The (H-)SMF may use Priority to configure the priority of the
device trigger and may use Maximum Latency to configure the validity
period of the device trigger.

In this case, the (H-)SMF sends a NIDD Submit Response (Buffered
Indication, Trigger Indication, cause) with an appropriate cause value.
The Buffered Indication indicates if the (H-)SMF buffered the non-IP
data. The Trigger Indication is used to indicate that a trigger was sent
in order to establish the PDU session.

If data is not buffered, the flow stops at this step, otherwise, it
proceeds to step2d; or

\- accept the NIDD Submit Request, and execute step2c with an
appropriate cause value, and wait for the UE to establish a PDU session
to this (H-)SMF (step 2d). If data is not buffered, the flow stops at
step2b.

NOTE2: The duration for which the (H-)SMF may wait for establishment of
a PDU session to the (H-)SMF for the given UE is implementation
dependent.

3a. If a PDU session context corresponding to the External Identifier or
MSISDN included in step1 is found but the UE is currently not
reachable, then the (H-)SMF informs the SCS/AS about the unreachability
of the UE. The (H-)SMF may include information when the transmission may
be attempted again (re-requested re-transmission time) based on how long
the UE is expected to be unreachable.

3b. The (H-)SMF buffers the data and waits for the UE to become
reachable.

4\. If the UE is reachable, the (H-)SMF encapsulates the downlink data
as payload in an SM data transfer message. In case of home-routed
roaming, the (H-)SMF forwards the SM data transfer message and the PDU
session ID to the AMF (via V-SMF in case of home-routed roaming) using
the Namf\_Communication\_N1N2MessageTransfer service operation.

5\. Downlink data is delivered to the UE as per clause6.1.4.3, steps
3-9.

6\. The (H-)SMF sends an MT NIDD Submit Response to the SCS/AS.

7\. Uplink data, if available, is sent according to clause6.20.4.3.
Otherwise, clause6.20.4.3, steps 15-18, is executed.

#### 6.20.4.5 NIDD configuration procedure

Figure 6.20.4.5-1 illustrates the procedure for configuring necessary
information at SMF and UDM for data delivery via the NIDD API. The
procedure can also be used for replacing and deleting configuration
information.

NOTE1: In order to avoid MO NIDD failure, the NIDD configuration
procedure should be performed by the SCS/AS prior to the UE establishing
a PDU session that is served by the SMF. MT non-IP data from the SCS/AS
can be contained in the NIDD Configuration Request message.

![](media/image75.wmf){width="4.403472222222222in"
height="2.3555555555555556in"}

Figure 6.20.4.5-1: NIDD configuration procedure

1\. The SCS/AS sends an NIDD Configuration Request (External Identifier
or MSISDN, SCS/AS Identifier, NIDD Duration, T8 Destination Address,
Requested Action, PDN Connection Establishment Option) message to the
SMF. T8 Destination Address is an optional parameter included by the
SCS/AS to indicate that the non-IP data is to be delivered to an address
different from the address of the requesting SCS/AS. PDN Connection
Establishment Option an optional field that is used to indicate what the
SMF should do if the UE has not established the PDU session and MT
non-IP data needs to be sent (wait for the UE to establish the PDU
session, respond with an error cause, or send a device trigger via the
NEF; see step2 of the MT NIDD Procedure in clause6.20.4.4). When PDN
Connection Establishment Option is included in the Configuration of NIDD
procedure, the SMF will use the value as the default preference from the
SCS/AS when handling all MT non-IP packets associated with the NIDD
connection.

When MT non-IP data is included in the NIDD Configuration request
message, the SMF can send the MT non-IP data to the UE only after a PDU
session to the SMF is established as defined in clause6.20.4.1 or
6.20.4.2. In such cases, upon successful completion of step6 of the
NIDD Configuration procedure, clause6.20.4.4 is executed.

NOTE2: It is up to the SCS/AS to determine whether and if NIDD Duration
can be set to never expire.

NOTE3: The SCS/AS is expected to be configured to use the same SMF as
the one selected by the AMF during the UE\'s attachment to the network.

NOTE4: A relative priority scheme for the treatment of multiple SCS/AS
NIDD Configuration Requests, e.g. for deciding which requests to serve
under overload condition, can be applied. This priority scheme is an
implementation option that is used locally by the SMF, i.e. it is
neither used nor translated in procedures towards other functions.

2\. If the Requested Action is set to \"Cancel\" it indicates the
purpose of the request is to cancel the transaction and the flow
proceeds to step6. If the Requested Action is set to \"Update\", the
purpose of the transaction is to update the parameters associated with
the configuration (i.e. PDN Connection Establishment Option). Otherwise,
the request is for a new NIDD configuration and the SMF stores the
External Identifier or MSISDN, SCS/AS Identifier, T8 Destination
Address, PDN Connection Establishment Option, and NIDD Duration. If
either the SCS/AS is not authorized to perform this request (e.g. based
on policies, if the SLA does not allow for it) or the NIDD Configuration
Request is malformed, the SMF performs step6 and provides a Cause value
appropriately indicating the error. Depending on the configuration, the
SMF may change the NIDD Duration.

3\. The SMF sends an NIDD Authorization Request (External Identifier or
MSISDN, S-NSSAI, DNN) message to the UDM to authorize the NIDD
configuration request for the received External Identifier or MSISDN,
and to receive necessary information for NIDD, if required.

NOTE5: The SMF uses the SCS/AS Identifier and External Identifier or
MSISDN that was obtained in step1 to determine what S-NSSAI and DNN
will be used to enable transfer of non-IP data between the UE and the
SCS/AS. This determination is based on local policies.

4\. The UDM examines the NIDD Authorization Request message, e.g. with
regard to the existence of External Identifier or MSISDN and maps the
external identifier to SUPI and/or MSISDN. If this check fails, the UDM
follows step5 and provides a result indicating the reason for the
failure condition to the SMF.

5\. The UDM sends an NIDD Authorization Response (SUPI and MSISDN or
External Identifier, Result) message to the SMF to acknowledge
acceptance of the NIDD Authorization Request. The SUPI and, if
available, the MSISDN (when NIDD Configuration Request contains an
External Identifier) or if available, External Identifier(s) (when NIDD
Configuration Request contains an MSISDN) are returned by the UDM in
this message. This allows the SMF to correlate the SCS/AS request
received in step1 of this procedure with the PDU session established
for this subscriber.

6\. The SMF sends an NIDD Configuration Response (Maximum Packet Size,
and Cause) message to the SCS/AS to acknowledge acceptance of the NIDD
Configuration Request and the deletion of the identified NIDD
configuration, if it was requested. If the NIDD Configuration was
accepted, the SMF will create an association between the T8 instance ID,
External Identifier or MSISDN, SUPI, and PDU Session ID of the
unstructured PDU Session. In the MT NIDD procedure, the SMF will use T8
instance ID and External Identifier or MSISDN to determine the SUPI and
PDU Session ID of the unstructured PDU Session. In the MO NIDD
procedure, the SMF will use the SUPI and PDU Session ID to obtain the T8
instance ID, External Identifier or MSISDN. The Maximum Packet Size is
the maximum NIDD packet size that was transferred to the UE by the SMF
in the PCO. If no maximum packet size was provided to the UE by the SMF,
the SMF sends a default configured max packet size to SCS/AS.

### 6.20.5 Impacts on existing entities and interfaces

Editor\'s note: This clausedescribes impacts to existing entities and
interfaces.

### 6.20.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.21 Solution 21: NIDD service activation
-----------------------------------------

### 6.21.1 Introduction

This solution addresses the Key Issue 1 and 8 in perspective of NIDD
API(s) for infrequent small data transmission and capability exposure to
AF.

In this solution, NIDD via NEF is called as NIDD service. And making
association between NF (e.g., AMF or SMF) and NEF for NIDD service is
called NIDD service activation.

This solution proposes procedure for NIDD service activation between
AMF/SMF and NEF. NIDD service means non-IP data delivery service between
UE and AS/AF via NEF. This solution also optimizes NIDD service
activation for a group of UEs, as massive number of devices are expected
in the IoT service.

Editor\'s note: This solution allows both AMF or SMF for NIDD services.
The NF which can be used for NIDD will be decided as part of other
solution.

This solution has the following characteristics:

\- NEF subscribes NIDD service activation to NFs e.g., AMF or SMF. When
the AMF/SMF determines the UE begins to use NIDD (based on negotiation
via MM-NAS or SM-NAS procedure), AMF/SMF informs NEF of the NIDD service
activation.

\- During this subscribe-notify operation, AMF/SMF and NEF exchanges
necessary information for NIDD service activation.

\- As follows bulk subscription in TS23.502\[7\], NEF can subscribe
NIDD service activation to all NFs that support NIDD service. When AMF
or SMF begin to serve the UE that request NIDD, it notifies the NEF that
the NIDD service activation for the UE is detected.

\- This subscribe-notify service operation for NIDD service activation
is independent with NAS procedure.

\- After NIDD service activation, the NEF notifies to the AS/AF that the
NIDD service is activated.

### 6.21.2 Functional Description

#### 6.21.2.1 General

The NEF can subscribes to the NF that provides necessary services, e.g.,
NIDD via NEF. NEF can determine target NF by querying to NRF or UDM. Or
the NEF can provision the subscription for NIDD service activation to
the UDM, and the UDM provides this information to the serving NF as
UE\'s subscription data. Upon receiving the event subscription for NIDD
service activation from the NEF, the NF stores this information. When
the corresponding event occurs for the requested subscription, the NF
notifies the NEF with requested information.

For a group of UEs, NEF can perform bulk subscription for NIDD service
activation. When the NEF performs bulk subscription for any UE (i.e. all
UEs), group of UE(s), it subscribes to all the NFs that provide the
necessary services e.g. In a given PLMN, NEF may subscribe to all AMFs
or SMFs that support NIDD service. Upon receiving bulk subscription from
the NEF, the NFs store this information. Whenever the corresponding
event(s) occur for the requested UE(s) as in bulk subscription request,
NFs notify the NEF with the requested information.

During this subscribe-notify service operation, necessary information
for NIDD service activation is exchanged.

Editor\'s note: It is for further study whether NEF can use Nudr
services for this procedure.

#### 6.21.2.2 Mobility

When serving NF changes, it retrieves the UE context from the old NF. In
the UE context, there is information for the subscription of NIDD
service activation so that the new serving NF determines NIDD service
activation is required. The serving NF notifies NEF with the necessary
information for the NIDD, so that connection between NF and NEF for NIDD
can be maintained. It also can be achieved by Nudm services for SDM
Subscription-Notification which allows to notify change of serving NFs.

Editor\'s note: It is FFS to consider roaming scenario.

### 6.21.3 Support of EPC Interworking

Editor\'s note: This clausedescribes if and how EPC-5GC interworking is
supported by this solution.

### 6.21.4 Procedures

#### 6.21.4.1 NIDD service activation for AMF based solution

In this solution, based on the presence of the serving AMF for the UE,
the NEF performs invoking either Namf\_NIDDservice\_Subscribe to the AMF
or Nudm\_ParameterProvision\_Update to the UDM in order to provision the
information for NIDD service activation to the AMF.

After the AMF receives the information for NIDD service activation to
the UE that has registered, the AMF may perform UE configuration Update
procedure to inform availability of NIDD service to the UE.

Editor\'s note: It is FFS whether the service operation can be re-named
or can re-use existing service operation.

Figure 6.21.4.1-1: NIDD service Activation for AMF based solution

1\. NEF and AS/AF performs NIDD configuration procedure. The AS/AF
requests NIDD configuration to the NEF. The AS/AF provides External
Identify of UE and necessary information to the NEF for NIDD. The NEF
creates UE context for the NIDD service based on the received
information from the AS/AF. During this operation, NEF can retrieve the
information of serving AMF for the UE from the UDM, if the UE has
already registered in the network.

2a. If the NEF cannot retrieve the information of the serving AMF in the
step 1, which means there is no serving AMF for the UE, the NEF
provisions the information for NIDD service activation to the UDM In
this information, External ID of UE, NEF ID, and Reference ID are
included. The UDM stores this information in the UE\'s subscription
data. This information can be considered as event subscription for NIDD
service activation to the serving AMF.

2b. If the NEF retrieves the information of the serving AMF in the step
1, the NEF subscribes the AMF with information for NIDD service
activation. In this message, External ID of UE, NEF ID, and Reference ID
are included. The reference ID is used as correlating identifier when
the AMF notifies to NEF for this request. In addition, necessary
information for NIDD service can be included in this message, e.g.
maximum latency for NIDD, communication pattern.

3\. After Step 2a, as the UE hasn\'t registered yet to the network, the
UDM provides UE\'s subscription data when UE performs initial
registration procedure.

4\. If the UE has already registered and the UE has requested NIDD
service, the AMF may trigger UE Configuration Update procedure after
step 2b in order to inform the UE of availability of NIDD service.
During Registration procedure, the AMF determines whether to provide
NIDD service to the UE based on the received information from step 2b or
step 3. The UE indicates use of NIDD service in Registration request
message, and the AMF responds with the permission of NIDD service for
the UE.

5\. After AMF decides to provide NIDD service to the UE, the AMF
notifies the NEF with the reference ID, NEF ID, and AMF ID. The
reference ID and NEF ID are the received one in the step 2b or step 3.
With this information, the NEF determines this notification is related
with the NIDD service activation.

6\. The NEF notifies to the AS/AF that the NIDD service for the UE is
activated. The AS/AF can send downlink data to the UE.

#### 6.21.4.2 NIDD service activation for SMF based solution

In this solution, based on the presence of the serving SMF for PDU
session for the UE, the NEF performs invoking either
Nsmf\_NIDDservice\_Subscribe to the SMF or
Nudm\_ParameterProvision\_Update to the UDM in order to provision the
information for NIDD service activation to the SMF.

If NIDD configuration has taken place prior to the PDU session
establishment from the UE, the SMF can retrieve the information for the
NIDD service activation from the subscription information during PDU
session establishment procedure. In this case, the SMF can complete PDU
session establishment for NIDD and activation of NIDD service
successfully. The NEF notifies to the AS/AF of NIDD service activation.
After the AS/AF receives the notification for NIDD service activation,
it can send downlink non-IP data to the UE.

If NIDD configuration hasn\'t taken place prior to the PDU session
establishment from the UE, the SMF cannot retrieve the information for
the NIDD service activation. In this case, the SMF rejects the PDU
session establishment request from the UE. The AS/AF may decide to
perform device triggering for PDU session establishment if there is no
NIDD service activation notification from the NEF for a certain
duration, which is based on local configuration in the AS/AF.

Editor\'s note: It is FFS whether the service operation can be re-named
or can re-use existing service operation.

Figure 6.21.4.2-1: When PDU session establishment after NIDD
configuration

1\. NEF and AS/AF performs NIDD configuration procedure. The AS/AF
requests NIDD configuration to the NEF. The AS/AF provides External
Identify of UE and necessary information to the NEF for NIDD. The NEF
creates UE context for the NIDD service based on the received
information from the AS/AF. During this operation, NEF cannot retrieve
the information of serving SMF for the UE from the UDM, as the UE
hasn\'t established the PDU session for the NIDD.

2\. The NEF provisions the information for NIDD service activation to
the UDM. In this information, External ID of UE, NEF ID, and Reference
ID are included. The UDM stores this information in the UE\'s
subscription data. This information can be considered as event
subscription for NIDD service activation to the serving SMF.

3\. When the UE requests PDU Session Establishment for NIDD, the SMF
retrieves the UE\'s SM subscription data which includes the information
for NIDD service activation as provisioned in the step 2. The SMF
determines to provide NIDD service to the UE based on this information.

4\. The SMF notifies the NEF with the External ID, reference ID, NEF ID,
and SMF ID. The reference ID and NEF ID are the received information in
the step 3. With this information, the NEF determines this notification
is related with the NIDD service activation.

5\. The NEF notifies to the AS/AF that the NIDD service for the UE is
activated. The AS/AF can send downlink data to the UE.

#### 6.21.4.3 Bulk subscription of NIDD service activation

![](media/image78.wmf){width="6.316666666666666in"
height="4.683333333333334in"}

Figure 6.21.4.2-1: Bulk NIDD service activation

1\. NEF and AS/AF performs NIDD configuration procedure. The AS/AF
requests NIDD configuration to the NEF. The AS/AF provides External
Group Identify and necessary information to the NEF for NIDD. The NEF
creates UE context for the NIDD service based on the received
information from the AS/AF.

2\. NEF subscribes the NRF for registered NF with NIDD service
capability.

3a/3b. When NF instantiates, it registers itself to the NRF along with
the NIDD service capability. NRF acknowledge the registration.

4\. NRF notifies the NEF with the registered NFs along with the NIDD
service capability.

5a/5b. NEF subscribes with the corresponding NFs for group of UEs based
on the NIDD configuration at step 1. The NEF subscribes NFs with
information for NIDD service activation. In this message, External group
ID of UE, NEF ID, and Reference ID are included. The reference ID is
used as correlating identifier when the NFs notify to NEF for this
request. In addition, necessary information for NIDD service can be
included in this message, e.g., maximum latency for NIDD, communication
pattern.

The NEF may subscribe for a single UE with External ID if it has
resolved the External Group ID to External IDs from the UDM during step
1.

6\. The NFs determine whether to provide NIDD service to the UE based on
NAS level negotiation. The UE indicates use of NIDD service in the NAS
request message, and the NF responds with the permission of NIDD service
for the UE. The NF detects the subscription for the NIDD service
received in step 5, based on the External Group ID or External ID for
the UE in the UE context.

Editor\'s note: Detail operation of step 6 depends on how AMF/SMF
establishes connection for NIDD via NEF to the UE.

7a/7b. After NFs determine to provide NIDD service to the UE, the NFs
notify the NEF with the External Group ID, External ID, reference ID,
NEF ID, and NF ID. The reference ID and NEF ID are the received one in
the step 5. With this information, the NEF determines this notification
is related with the step 5.

### 6.21.5 Impacts on existing entities and interfaces

Editor\'s note: This clausedescribes impacts to existing entities and
interfaces.

### 6.21.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.22 Solution 22: eDRX for CM-IDLE state in 5GS
-----------------------------------------------

### 6.22.1 Introduction

The proposal is to enable an eDRX equivalent feature from EPS in 5GS. It
addresses Key Issue 4, Power saving functions.

### 6.22.2 Functional Description

The proposal is to enable an eDRX equivalent feature from EPS in 5GS.

As the 5GC has a different architecture and some new functionality
compared to EPC some adaptations are needed compared to eDRX in EPS. The
following adoptions are needed:

\- eDRX sleep cycle negotiation:

In EPC the UE requests extended idle mode DRX parameters during attach
procedure and RAU/TAU procedure and the SGSN/MME may reject or accept
the UE request for enabling extended idle mode DRX.

In case the SGSN/MME accepts the extended idle mode DRX, the SGSN/MME
based on operator policies and, if available, the extended idle mode DRX
cycle length value in the subscription data from the HSS, may also
provide different values of the extended idle mode DRX parameters than
what was requested by the UE. If the SGSN/MME accepts the use of
extended idle mode DRX, the UE applies extended idle mode DRX parameters
either as received or modified by SGSN/MME.

The same principles can be used on 5GC but the procedures used by the UE
to request extended idle mode DRX parameters will be Registration and
Registration Update.

In EPS the UE and the SGSN/MME handles the request in 5GS the UE
handling shall be the same but in 5GC it will be the AMF instead of
SGSN/MME.

\- Subscription information:

Extended idle mode DRX cycle length value needs to be added in the
subscription data from the UDM using the same principles as in EPS.

\- Hyper SFN, Paging Hyperframe and Paging Time Window:

Same handling as in EPC but in 5GC the AMF will assign the Paging Time
Window. The AMF will include the Paging Time Window in the extended DRX
parameters to the UE and in the paging eDRX information to the (R)AN.

NOTE1: Whether the solution for Hyper SFN and Paging Hyperframe in
NB-IoT and WB-E-UTRAN in the 5GS Rel16 will look the same as extended
idle mode DRX (eDRX) in E-UTRAN depends on RAN further work.

\- For WB-E-UTRAN (eMTC) the ng-eNB broadcasts an indicator for support
of eDRX in 5GC in addition to the existing indicator for support of eDRX
in EPC as defined in TS36.331\[23\].

NOTE2: This solution is also applicable for CM-IDLE with Suspend (i.e.
Solution19).

### 6.22.3 Support of EPC interworking

eDRX depends on UE provided parameters in Attach/TAU and Registration
Request, respectively, as well as subscription information and local
policies in the MME and AMF, respectively. Therefore eDRX handling can
be kept separate in EPC and 5GC and no specific interworking is
required.

### 6.22.4 Procedures

The existing procedures in 5GC will be reused to handle the eDRX
signalling between AMF, (R)AN, UDM and UE.

### 6.22.5 Impacts on existing entities and interfaces

The UE shall send request for extended idle mode DRX parameters to the
AMF. The UE will also receive the extended DRX parameters and utilize
this information for extended DRX handling.

The AMF shall handle the request from the UE and reject, modify or
accept the request. If accepted (as is or with modification) the AMF
shall set the extended idle mode DRX parameters and supply relevant
parameters to UE and (R)AN.

The UDM may include the extended idle mode DRX cycle length value in the
subscription data to the AMF.

The (R)AN will receive the paging eDRX information from the AMF.

### 6.22.6 Evaluation

This solution enables extended DRX equivalent to eDRX support in EPS to
ensure battery efficiency while UEs are in CM-IDLE state. The solution
addresses the architectural requirements of key issue4 track1 (\"5G
NAS/5GC support of extended idle mode DRX\").

6.23 Solution 23: MICO Mode Management for Expected Application Behaviour
-------------------------------------------------------------------------

### 6.23.1 Introduction

This solution addresses Key Issue 4: Power Saving Functions.

A UE in MICO mode need not listen to paging while in CM-IDLE and is only
reachable for DL data or signalling when the UE is in CM-CONNECTED. A UE
in MICO mode may stop any access stratum procedures in CM-IDLE, until
the UE initiates transition from CM-IDLE to CM-CONNECTED. In order to
minimize UE power consumption, the UE should be put into the MICO mode
whenever possible, i.e. when there is no DL data for the UE.

This solution assumes that Expected UE behaviour (communication pattern)
information is available and may indicate scheduled DL communication.
Expected UE behaviour provisioning is provided by the solution to Key
Issue 13 Support for Expected UE Behaviour. It manages MICO mode for the
UE according to the communication pattern information.

When the communication pattern information indicates scheduled DL
communication, the UE may be put into MICO mode between the scheduled DL
communications. In this case, the AMF allocates a periodic registration
timer value for the UE such that the UE performs Periodic Registration
Update upon expiry of the periodic registration timer and exits MICO
mode, at or before the scheduled DL communication time, and thus
allowing DL communication according to the schedule.

If the DL communication is scheduled between 13:00 and 14:00, the AMF
may request the UE in MICO mode to perform Periodic Registration Update
to exit MICO mode at or ahead of the example 1 hour window through the
allocation of the periodic registration timer value. The synchronisation
of the periodic registration timer expiry relative to the scheduled DL
communication time is implementation specific. This synchronisation
should be loose enough to tolerate time inaccuracy and signalling delay
when exiting MICO mode.

In order to prevent the synchronization from being broken by UL
transmissions the AMF may provide a *\"do not reset the timer for
Periodic Registration\"* indication together with the periodical
registration timer value to the UE. If the *\"do not reset the timer for
Periodic Registration\"* indication is provided, once started the UE
keeps its periodic registration timer running all the way to the expiry
and only restarts it when it expires, even if it enters and leaves
CM-CONNECTED or MICO mode is enabled or disabled. When the timer
expires, the UE performs registration update.

If the periodic registration timer value is renegotiated during a
Registration procedure, e.g., a mobility registration procedure, the
periodic registration timer is stopped and restarted using the
renegotiated value even when the *\"do not reset the timer for Periodic
Registration\"* indication was provided by the AMF. The AMF should
ensure the renegotiated timer value to be aligned with the DL
communication schedule.

### 6.23.2 Functional Description

**During registration (update), the AMF may disallow/deactivate MICO
mode for the UE if the communication pattern parameters indicate
uncertainty of DL communication, or that DL communication is happening
soon, e.g. within a preconfigured time window**. The AMF may
allow/activate MICO mode in the other cases for UE power saving.

For a UE in MICO mode, if the communication pattern parameters indicates
the absence of DL communication, the AMF may allocate a large periodic
registration timer value so that the UE can enter deep sleep between
Periodic Registration Updates for power saving. If the communication
pattern parameters indicate scheduled DL communication the AMF should
allocate a periodic registration timer value such that the UE performs
Periodic Registration Update to renegotiate MICO mode before or at the
scheduled DL communication time from the Expected UE Behaviour.

The AMF may provide a *\"do not reset the timer for Periodic
Registration\"* indication to the UE together with the periodic
registration timer value. If the *\"do not reset the timer for Periodic
Registration\"* indication is provided by the AMF, the UE keeps its
periodic registration timer running while in CM-CONNECTED and performs
periodic registration update when the timer expires, in order to
re-negotiate MICO mode and its parameters. The periodic registration
timer is only restarted on expiry. If the periodic registration timer
value is renegotiated during a Registration procedure the periodic
registration timer is stopped and restarted using the renegotiated value
even when the *\"do not reset the timer for Periodic Registration\"*
indication was provided by the AMF. When the periodic registration timer
is started is not changed by this solution.

### 6.23.3 Support of interworking

The periodic Registration timer in 5GS is equivalent to the periodic TAU
timer in EPS, and the MICO UE behaviour is equivalent to the PSM UE
behaviour in EPS.

Mobility from 5GS to EPS:

\- The MICO UE will not receive the \"*do not reset the timer for
Periodic Registration*\" from the EPC. After performing an Attach
procedure or a TAU procedure in the EPS, the MICO UE therefore considers
that the indication is removed.

Mobility from EPS to 5GS:

\- Only if the UE receives the \"*do not reset time timer for Periodic
Registration*\" from 5GC in a Registration procedure (e.g. due to
periodic registration or mobility registration), does the UE start to
behave accordingly, as described in clause6.23.2.

### 6.23.4 Procedures

Figure 6.23.4-1 illustrates the procedure of obtaining communication
pattern parameters and managing MICO mode based on them.

![](media/image79.wmf){width="6.654166666666667in"
height="3.3833333333333333in"}

Figure 6.23.4-1: Communication pattern based MICO mode management

1\. The UE performs the Registration procedure, with any Registration
type (Initial Registration, Mobility Registration Update, or Periodic
Registration Update) with the AMF, which includes MICO mode preference.

2\. The AMF obtains communication pattern parameters from the UDM. This
step is optional if the AMF has valid communication pattern information
in local configuration.

3\. The AMF determines MICO mode, periodic registration timer value and
the *\"do not reset the timer for Periodic Registration\"* indication
for the UE according to the communication pattern parameters and
operator policy.

4\. The AMF informs the UE that the Registration is accepted, including
the accepted MICO mode and *\"do not reset the timer for Periodic
Registration\"* indication.

5\. The UE keeps the periodic registration timer running, even while in
CM-CONNECTED, i.e. even if unscheduled UL data transmissions occur, and
is only restarted when it expires.

### 6.23.5 Impacts on existing entities and interfaces

In the AMF:

\- determining MICO mode and periodic registration timer value for the
UE taking into to account communication pattern information and
providing a *\"do not reset the timer for Periodic Registration\"*
indication to the UE, if required.

In the UE:

\- receiving *\"do not reset the timer for Periodic Registration\"*
indication from the AMF and, according to the indication, keeping its
periodic registration timer running to expiry even if it enters and
leaves CM-CONNECTED.

### 6.23.6 Evaluation

The solution addresses the following Architectural Requirements for Key
Issue\#4:

\- Solutions shall optimize UE power savings according to expected and
desired UE and application behaviour (e.g. communication pattern) if
such information is available.

When the communication pattern information indicates scheduled DL
communication, the UE may be put into MICO mode between the scheduled DL
communications, where the UE does not listen to paging and therefore
saves power, while still becoming reachable according to the
communication pattern schedule.

The use of MICO mode management is not applicable to all application
scenarios and may cause additional signalling and power consumption in
the cases where scheduled downlink communication with longer intervals
is not required.

The combination of non-stoppable periodic registration timer (as
indicated by the *\"do not reset the timer for Periodic Registration\"*
indication) and MICO mode management are used together to support
different ways the AS prepares DL traffic:

\- The AS prepares DL traffic during a specific time window, however
when in the time window is not known. Once the DL traffic becomes
available, the DL traffic should be delivered to the UE.

\- The AS can either prepare the DL traffic ahead of the communication
pattern window and queue it in the network, or use (if available)
monitoring events to get notification that DL traffic can be sent to the
UE.

MICO mode management with the non-stoppable periodic registration timer
can save power for a UE while allowing the network to maintain control
of the wake up schedule and therefore optimising UE power according to
the expected and desired UE and application behaviour.

6.24 Solution 24: High latency communication with extended buffering and event notifications
--------------------------------------------------------------------------------------------

### 6.24.1 Introduction

This clauseaddresses the high latency communication key issue \#3.

### 6.24.2 Functional Description

Functions for High latency communication may be used to handle mobile
terminated (MT) communication with UEs being unreachable while using
power saving functions e.g. UE Power Saving Mode, extended idle mode DRX
or MICO. \"High latency\" refers to the initial response time before
normal exchange of packets is established. That is, the time it takes
before a UE has woken up from its power saving state and responded to
the initial downlink packet(s).

High latency communication is handled by extended buffering of downlink
data in the UPF/SMF. Optionally High latency communication can also be
handled by notification procedures.

High latency communication by extended buffering of downlink data in the
UPF/SMF is controlled by the AMF/SMF. The AMF asks the SMF/UPF, to
buffer downlink data until the UE is expected to wake up from its power
saving state, see clause6.24.4.1. If a SMF/UPF change is invoked, the
buffered packets are forwarded and will not be lost. The number of
packets to buffer is decided by the SMF/UPF, but the AMF may optionally
provide supporting information. Optionally, a suggested number of
packets to buffer may also be provided by the SCS/AS as input to the
SMF/UPF, see key issue 10.

An SCS/AS may optionally use notification procedures to handle High
latency communication (see clause6.24.4.2). The SCS/AS requests to
receive notification when a UE wakes up from its power saving state to
be able to send downlink data to the UE when the UE becomes reachable.
Especially, for long latencies (e.g. infrequent mobile terminated
communication) this is suitable. This notification procedure can be
triggered based on following monitoring events (see clause4.15.3.1 in
TS23.502\[7\]):

\- Monitoring event: UE Reachability; or

\- Monitoring event: Availability after DDN failure.

An SCS/AS may request a one-time \"UE Reachability\" notification when
it wants to send data to the UE. Alternatively, the SCS/AS may request
repeated \"Availability after DDN failure\" notifications where each
notification is triggered by a DDN failure, i.e. the SCS/AS sends a
downlink packet which is discarded by SMF/UPF but which triggers the AMF
to send an event notification to the SCS/AS next time the UE wakes up.

If CM-CONNECTED with RRC inactive state is activated for the UE with
power saving state for long time, the downlink data handling (i.e. CN
extended buffering) and notification is handled in the 5GC in the same
way applied for CM-IDLE state, with additional support of information
from RAN side. The RAN support information for high latency
communication is provided through the N2 notification procedure, see
clause4.8.3 in TS23.502\[7\].

The tools for High latency communication make the behaviour of the 3GPP
network predictable when sending mobile terminated data to UEs applying
power saving functions. The network will deliver downlink packets with
high reliability for both stationary and mobile UEs when the UE wakes up
from its power saving state. Therefore, SCS/AS can adapt its
retransmissions to reduce the load on both the SCS/AS itself and the
network.

### 6.24.3 Support of EPC interworking

Interworking between 5GC and EPC is achieved by a combined P-GW/SMF and
P-GW-U+UPF. If a SMF/UPF has data buffered for a UE when the UE moves to
EPC and becomes reachable then buffered data will get delivered in EPC
(and vice versa).

### 6.24.4 Procedures

#### 6.24.4.1 Extended buffering

##### 6.24.4.1.1 General

Functions for High latency communication may be used to handle mobile
terminated (MT) communication with UEs being unreachable while using
power saving functions (see KI\#4). \"High latency\" refers to the
initial response time before the delivery of MT packets is possible.
That is, the time it takes before a UE has woken up from its power
saving state and responded to the initial downlink packet(s).

The High latency communication includes invoking extended buffering of
MT data at the UPF when the UE is in a power saving state and not
reachable. The handling shall be specified in the Network Triggered
Service Request procedure. Establishing the user plane for delivering
the buffered data when the UE contacts the AMF by signalling shall be
specified in the Registration procedure. The AMF uses its parameter DL
Data Buffer Expiration Time in the MM context information to know if
there is buffered DL data to be delivered when the UE becomes reachable.
When set, the DL Data Buffer Expiration Time shall be cleared at any
user plane setup to the RAN when the buffered DL data can be delivered.
At Registration procedure with AMF change, the old AMF shall indicate in
the context response to the new AMF that buffered DL data is waiting and
hence the new AMF shall establish the user plane for delivery of the
buffered DL data. When the DL Data Buffer Expiration Time has expired,
the AMF considers no DL data to be buffered and no indications of
Buffered DL Data Waiting are sent during context transfers at
Registration procedure. At Registration procedure with UPF change, the
buffered DL data is forwarded to the new UPF.

For UE in CM-CONNECTED with RRC-Inactive mode, it is operator configured
local policies in the network that decides if and when CN extended
buffering or RAN buffering is used and for what sleep cycle lengths.

For HLCOM, it\'s the SMF/UPF that provides CN extended buffering, and
the AMF provides buffering related support information towards SMF/UPF.

For UE in CM-IDLE mode and UE in CM-CONNECTED RRC-Inactive mode, AMF
provides buffering support information to SMF/UPF based on the NAS level
information negotiated between UE and AMF based on the following:

\- MICO related parameters.

\- Other UE sleep cycle related parameters (related to KI\#4).

\- eDRX related parameters (related to KI\#4). A UE using MICO mode is
assumed to be able to benefit from Extended buffering. Any DL data being
buffered for the UE can be delivered to the UE when it contacts the
network.

Editor\'s note: The details for the handling of extended buffering is
FFS and is dependent on KI\#4 Power saving functions.

##### 6.24.4.1.2 DL data in CM-IDLE mode

For UE in CM-IDLE mode, the figure below shows the call flow of AMF
providing buffering related support information to SMF/UPF and downlink
data handling. Extended buffering is used for UE that is using a power
saving method (see KI\#4). Extended buffering should not be used for a
UE which has a monitoring event, \'UE Reachability\' or \'Availability
after DDN failure\', configured.

![](media/image80.wmf){width="6.209027777777778in" height="4.625in"}

Figure 6.24.4.1.2-1: Data Buffering in SMF/UPF for CM-IDLE mode

The Network Triggered Service Request procedure as specified in
TS23.502\[7\] clause4.2.3.3 would be updated based on the description
below.

1\. The application sends downlink data to UPF.

2\. The UPF sends a Downlink Data Notification (DDN) message to the SMF
if there is no N3 tunnel.

3\. The SMF initiates Namf\_Comm\_N1N2MessageTransfer\_Reqeust service
towards AMF to setup N3 tunnel.

4\. The AMF checks the UE reachability in CM-IDLE mode, and UE not
reachable due to power saving. If UE is not reachable due to eDRX/DRX,
the AMF schedules a paging.

5\. The AMF sends Namf\_Comm\_N1N2MessageTRansfer Response to indicate
the UE is unreachable. If the UE is unreachable due to power saving, the
AMF also indicates DL Buffering Requested and provides buffering
supporting information (e.g. DL Buffering Duration time and optionally a
DL Buffering Suggested Packet Count).

The AMF stores a new value for the DL Data Buffer Expiration Time in the
MM context for the UE based on the DL Buffering Duration time. The DL
Data Buffer Expiration Time is used for UEs using power saving state and
indicates that there are buffered DL data waiting in the UPF. When the
DL Data Buffer Expiration Time has expired, the AMF considers no DL data
to be buffered and no indications of Buffered DL Data Waiting are sent
during context transfers at Registration procedure.

NOTE: If AMF is configured to support Notify on availability after DDN
failure as specified in clause6.24.4.2.3, Extended data buffering is
not invoked.

6\. The SMF sends DDN failure with DL Buffering Requested indication and
buffering supporting information to UPF. The SMF includes the DL
Buffering Duration time and optionally a DL Buffering Suggested Packet
Count.

7\. The UPF starts extended data buffering based on the buffering
support information. The UPF stores a new value for the DL Data Buffer
Expiration Time based on the DL Buffering Duration time and does not
send any additional Data Notification if subsequent downlink data
packets are received in the UPF before the DL Buffer Expiration Time has
expired for the UE.

8\. When UE enters CM-CONNECTED mode, the AMF notifies the same SMF that
received the UE unreachable indication in step5.

At, for example, periodic or mobility registration update as specified
in TS23.502\[7\] clause4.2.2.2 extended buffering is handled with the
following addition to step22 (Registration Accept). If the DL Data
Buffer Expiration Time for the UE in the AMF has not expired, the user
plane setup procedure is activated. The message sequence should be
similar for the UE triggered Service Request procedure specified in
clause4.2.3.2 of TS23.502\[7\] from the stepwhen AMF activates the
User Plane connections of the PDU Session(s).

9\. SMF/UPF trigger the setting of N3 tunnel and delivery the buffered
data packets.

##### 6.24.4.1.3 DL data in CM-CONNECTED mode without CN extended buffering

The figure below shows the handling of downlink data in CM-CONNECTED
mode without extended buffering in CN but with temporary buffering in
the RAN . This procedure is used for UEs not applying any power saving
method or the power saving time is limited. For UEs that do apply power
saving methods (i.e. potentially very long buffering times), see
clause6.24.4.1.4.

![](media/image81.wmf){width="6.688194444444444in"
height="1.7805555555555554in"}

Figure 6.24.4.1.3-1: DL data in CM-CONNECTED mode without extended
buffering

1\. DL data arriving in UPF is forwarded on the N3 towards RAN.

2a. If the RRC connection is in RRC Inactive mode, RAN pages the UE. DL
data is temporarily buffered in the RAN. If the UE does not respond to
paging, e.g. may be temporarily unreachable, the RAN discards the DL
data.

2b. If the RRC connection is in active mode, or transitions to active
mode, the DL data is sent to the UE.

##### 6.24.4.1.4 DL data in CM-CONNECTED mode with CN Extended buffering

This procedure shows how DL data in CM-CONNECTED mode with Extended
buffering is handled. Extended buffering is used for UE that is using a
power saving method (see KI\#4). Extended buffering should not be used
for a UE which has a monitoring event, \'UE Reachability\' or
\'Availability after DDN failure\', configured. For a UE in RRC inactive
mode, the AMF provides buffering related support information to SMF/UPF
and downlink data handling.

The figure shows the Direct Model case. For the Indirect Model case the
UPF may be replaced by a UPF-NIMF.

NOTE1: This solution assumes eDRX with long sleep sycles with RRC
Inactive is supported (see KI\#4 and KI\#2).

Figure 6.24.4.1.4-1: DL Data Buffering in SMF/UPF for RRC\_Inactive mode

0\. Depending on local configuration, Data Buffering is established when
RAN transition a UE using eDRX to RRC\_Inactive state, the RAN sends a
N2 Notification to AMF. RAN provides buffering support information if
there is any. The AMF notifies SMF/UPF that the PDU session is subject
for extended data buffering and includes buffering support info.

1\. The application sends downlink data to UPF, and UPF will start to
apply extended data buffering when N3 tunnel exists based on the
indication received in step 0b above e.g. using the buffering
information for the extended buffering.

2\. \[conditional\] The SMF may request UE reachability report via
Namf\_MT\_EnableUEReachability, based on notification from UPF which can
either be similar to the DDN in CM-IDLE mode or a modification of the
existing DDN message.

The SMF may optionally just wait for the next MO data from UE in step 5
to trigger the sending of downlink data without invoke enabling the UE
reachability reporting above.

3\. The AMF may use the N2 Notification procedure to retrieve UE
reachability info. If UE is currently in RRC inactive state and not
reachable, the RAN may provide new buffering support information, if
there is any. RAN schedules a paging at next possible UE paging occasion
and marks that a notification to AMF is required when the UE contacts
the network next time. RAN also indicates to AMF that it has scheduled a
paging for the next possible UE paging occasion.

NOTE2: The N2 request message that can trigger the RAN paging can be N2
UE Notification Request.

4\. The AMF notifies the SMF/UPF with the latest reachability info
(either UE is reachable or still not reachable with new buffering
support information). If the UE is reachable, step 5 is skipped and the
procedure continues in step 6.

5a. RAN may perform paging when the UE becomes reachable for paging.

5\. When UE contacts with the network, either due to RAN paging or due
to a UE triggered procedure before the RAN paging, and the AMF receives
either a N2 notification triggered by a RRC resume, or an N2 Path Switch
Request if a RRC resume triggers a RAN node change, the AMF notifies the
SMF/UPF of the UE reachability.

6\. UPF thus can deliver buffered downlink data to UE.

7\. If the UE does not contact with the network before expiry of the
timer set in the SMF/UPF for the extended buffering duration, the
buffered data is discarded in the SMF/UPF.

8\. RAN moves the UE to RRC Inactive state after a user inactivity
timeout or based on Release Assistance Information if available in
Expected UE Behaviour. Depending on sleep cycle length and local
configuration the RAN may then execute step0 above and re-establish the
CN extended data buffering in SMF/UPF, otherwise RAN buffering is used
at next DL data event.

#### 6.24.4.2 Notification procedures

##### 6.24.4.2.1 General

If SCS/AS selects to send downlink data when UE becomes reachable, it
can use one-time UE-Reachability notification (see clause6.24.4.2.2).
SCS/AS may also select the Notification of UE availability after
downlink data delivery failure (see clause6.24.4.2.3).

If AMF or RAN receives MT control plane signalling for a UE which is not
reachable currently, the AMF activates a UE availability notification to
the originating NF (see clause6.24.4.3).

##### 6.24.4.2.2 Event Subscription and Notification of UE reachability

If an SCS/AS wants to send downlink packet(s) when UE becomes reachable,
the SCS/AS can subscribe for one-time \"UE Reachability\" monitoring
event by following either Event Exposure using NEF specified in
TS23.502\[7\] clause4.15.3 (the figure below is a copy of the figure
in TS23.502\[7\] clause4.15.3.2.3). The SCS/AS sends the packet data
when it receives notification that the UE is reachable.

![](media/image83.wmf){width="6.654166666666667in"
height="2.738888888888889in"}

Figure 6.24.4.2.2-1: TS23.502\[7\]: Event Subscription of UE
reachability notification

If UE is in CM-CONNECTED and RRC state is unknown (i.e. N2 notification
procedure is not activated yet), the AMF shall trigger N2 Notification
procedure to retrieve UE reachability information from RAN as shown
below ( see also TS23.502\[7\] clause4.8.3 for details).

Figure 6.24.4.2.2-2: Event Subscription and Notification for UE
reachability

1\. Same as the Figure6.24.4.2.2-1 step 3a, AF (i.e. SCS/AS) subscribe
to AMF for UE reachability report through
Namf\_EventExposure\_Scubscriber Request service operation, when there
is pending DL data towards UE.

2\. If UE is in CM connected state, AMF send N2 Notification Request to
the RAN to retrieve UE reachability info. If UE is in RRC inactive state
and it is not currently reachable, RAN responds back to AMF indicating
UE is not reachable. RAN schedules a paging at next possible UE paging
occasion and also indicates to AMF that paging is scheduled for the next
possible UE paging occasion. RAN marks that a notification to AMF is
required when UE contacts the network next time.

NOTE: The N2 request message that can trigger the RAN paging can be N2
UE Notification Request.

3a. RAN may perform paging when the UE becomes reachable for paging.

3b. UE contacts the network with RRC resume, either due to RAN paging or
due to UE triggered procedure before the RAN paging.

4\. RAN reports, either a N2 notification, or an N2 Path Switch Request
if a RRC resume triggers a RAN node change, to the AMF that UE is RRC
connected and reachable.

5\. Same as the Figure6.24.4.2.2-1 step6b, AMF notifies NEF/AF/SCS/AS
that UE is reachable.

6\. AF/SCS/AS sends downlink data to UE.

Editor\'s note: There are dependencies to KI Power saving.

If the SCS/AS optionally wants to fine-tune the delivery of the downlink
data within the time-window when the UE is reachable, the SCS/AS can
configure optional parameters with proper value (as described in
clause6.24.4.5.3).

##### 6.24.4.2.3 Notification of Availability after DDN failure

If an SCS/AS wants to get notifications when the UE becomes reachable
after a proceeding downlink data delivery failure, the SCS/AS can
subscribe for the \"Notification of availability after DDN failure\"
monitoring event.

This is a different monitoring event from the \"UE Reachability\"
monitoring event specified in 6.24.4.2.2. This information is provided
to the AMF at registration through subscription data, see
clause6.24.4.2.4. The AMF notes this and sets a
Notify-on-available-after-DDN-failure flag after a DDN failure. If the
flag is set when the UE next contacts the network, the serving node
notifies the NEF that the UE is reachable and clears the flag.

An important use case for this feature is the application that wants to
communicate with a UE that sleeps for a long time. If downlink packets
from the application are not delivered, the application recognizes that
the UE is not available by lack of response within a reasonable time
from the UE, and then await notification from the network (i.e. from the
AMF via the NEF) of UE reachability.

For UE in CM-IDLE mode, the figure below shows the flow of AMF providing
UE availability to NEF/AF after DDN failure.

![](media/image85.wmf){width="6.469444444444444in" height="4.31875in"}

Figure 6.24.4.2.3-1: Notification - Availability Notification after DDN
Failure (CM-IDLE)

1\. AMF is provisioned with \"Availability Notification after DDN
failure\" related information during registration (e.g. via UDM), and
the application sends downlink data to UPF.

NOTE1: See notification parameter provisioning flows in
clause6.24.4.2.4 below.

2\. The UPF sends a Downlink Data Notification (DDN) message to the SMF
if there is no N3 tunnel.

3\. The SMF initiates Namf\_Comm\_N1N2MessageTransfer\_Reqeust service
towards AMF to setup N3 tunnel.

4\. The AMF checks the UE reachability in CM-IDLE mode. If UE is not
reachable, i.e. due to a power saving method (see KI\#4) or paging
fails, The AMF send Namf\_Comm\_N1N2MessageTRansfer Response to indicate
the failure.

5\. The SMF sends DDN failure to UPF and the UPF discards data packets.

6\. The AMF shall set the \"Notify on availability after DDN failure\"
flag. The AMF also schedules a CN paging for next possible UE paging
occasion.

7\. When UE enters CM-CONNECTED mode, the AMF notes that UE is available
and that the Notify-on-availability-after-DDN-failure flag for the UE is
set.

8\. The AMF triggers Namf\_EventExposure\_Notification towards the
NEF/Application.

9\. The AMF also clears the Notify-on-availability-after-DDN-failure
flag for the UE.

10\. The application realizes the UE is reachable and re-sends data.

For UE in RRC-Inactive state where the N3 tunnel exists, RAN can discard
the data if UE is not reachable. But it shall indicate to AMF that
downlink data is discarded, and AMF shall set the \"Notify on
availability after DDN failure\" flag. At next N2 notification with
change to RRC-Connected (assuming N2 notification is already activated
during configuration in 6.24.4.2.4) or Patch Switch Request, AMF
triggers notification to application.

The figure below shows the flow of AMF providing UE availability to
NEF/AF after DDN failure.

Figure 6.24.4.2.3-2: Notification - Availability Notification after DDN
Failure (CM-CONNECTED / RRC-Inactive)

1\. AMF is provisioned with \"Availability Notification after DDN
failure\" related information during registration (e.g. via UDM), and
the application sends downlink data to UPF/RAN.

NOTE2: See notification parameter provisioning flows in
clause6.24.4.2.4 below.

2\. The RAN check the UE reachability in RRC\_Inactive mode. If UE is
not reachable, i.e. due to KI\#4 (such as eDRX) or RAN paging fails, RAN
sends a N2 Notification to indicate the failure. RAN schedules a RAN
paging at next possible UE paging occasion. The RAN also marks that a
notification to AMF is required when the UE contacts the network next
time The RAN also indicates if RAN paging is scheduled for next possible
UE paging occasion.

NOTE3: The N2 request message that can trigger the RAN paging can be N2
UE Notification.

3\. The AMF shall set the \"Notify on availability after DDN failure\"
flag.

4\. AMF may optionally send an event notification to the NEF and SCS/AS
as a confirmation that the DL data in step 1 was received and that an
\'Availability after DDN failure\' notification will be sent as soon as
the UE becomes available.

5a. RAN may perform paging when the UE becomes reachable for paging.

5b. When UE contacts the network with RRC resume, either due to RAN
paging or due to a UE triggered procedure before the RAN paging, the RAN
notifies AMF either through N2 notification, or Path Switch Request in
case of RRC resume triggering RAN node change).

6\. When the AMF receives the notification about UE availability from
RAN and the AMF has a Notify-on-availability-after-DDN-failure flag set
for the UE (set by step 3), the AMF clears the
Notify-on-availability-after-DDN-failure flag for the UE and sends a
Namf\_EventExposure\_Notification towards the NEF/AF/SCS/AS.

7\. The application realizes the UE is reachable and re-sends downlink
data.

8\. RAN moves the UE to RRC Inactive state after a user inactivity.
Depending on sleep cycle length and local configuration, RAN may
establish CN extended data buffering in SMF/UPF by executing step 0 in
clause6.24.4.1.4 above. Otherwise RAN buffering is used at next DL data
event.

##### 6.24.4.2.4 Configuration for notification related approaches

##### 6.24.4.2.4.1 General {#general-16 .H6}

For high latency communication, with the UE event notification approach
as defined in 6.24.4.2.2 and UE availability notification after DDN
failure approach as defined in 6.24.4.2.3 above, AF (e.g. SCA/AS) may
need to provide some parameters to serving node (e.g. AMF). Below are 2
different ways of parameters provisioning.

NOTE: Solutions (e.g. solution 15) for key issue10, Network Parameter
Configuration API via NEF, also cover similar approaches.

##### 6.24.4.2.4.2 Configuration of notifications via UDM {#configuration-of-notifications-via-udm .H6}

The figure below illustrates the procedure of configuring monitoring
events parameters at the UDM or the AMF. The procedure is similar to
external parameter provisioning in TS23.502\[7\] clause4.15.6.2

The procedure is also used for replacing and deleting a monitoring event
configuration.

![](media/image87.wmf){width="5.811111111111111in"
height="2.3958333333333335in"}

Figure 6.24.4.2.4.2-1: Monitoring event parameters configuration and
deletion via UDM procedure

1\. AF (SCS/AS) provides one or more configuration parameter(s) related
to monitoring even for HLCOM to be updated in
Nnef\_ParameterProvision\_UpdateRequest to the NEF.

The PUI identifies the UE and the Transaction Reference ID identifies
the transaction request between NEF and AF (SCS/AS).

2\. If the AF (SCS/AS) is authorised by the NEF to provision the
parameters, the NEF requests to update and store the provisioned
parameters as part of the subscriber data via Update Request message,
the message includes the provisioned data and NEF reference ID.

If the requester is not authorised to provision data, then the NEF
continues in step 4 indicating the reason to failure in
Nnef\_ParameterProvision\_Update response.

3\. UDM/UDR resolves the PUI to SUPI and stores the monitoring events
parameters as part of the subscription data and responds with Update
response message.

If the SUPI cannot be derived from the PUI, then the Update Response
indicates the reason in the cause value.

4\. NEF responds the request with Nnef\_ParameterProvision\_update
response. If the procedure failed, the cause value indicates the reason.

5\. UDM/UDR notifies the AMF of the updated subscriber data via
Nudm\_SDM\_UpdateNotification Notify message.

6\. Based on received configuration parameters related to notifications,
the AMF shall trigger the N2 notification procedure to delivery info to
RAN (e.g. info related to Notification after DDN failure) and also
retrieve the RRC state and reachability info and act accordingly as
specified in the notification based approaches, if UE is in CM-CONNECTED
mode.

##### 6.24.4.2.4.3 Configuration directly at AMF {#configuration-directly-at-amf .H6}

The current event exposure functionality specified for AMF in
TS23.502\[7\] is considered as sufficient for AF to do monitoring
related configuration towards AMF via NEF.

#### 6.24.4.3 Notification of Availability after MT control plane signalling

The intention with this procedure is to describe how MT CP signalling is
handled when CM-CONNECED with RRC\_INACTIVE is used in combination with
eDRX with long sleep cycles. The handling can be applied by other
procedures such as MT SMS, NW initiated NAS signalling etc. Briefly RAN
returns a NAS-Non-delivery notification back to AMF (indicating UE is
unreachable). RAN and AMF remember the unreachability state and RAN
reports to AMF at next RRC resume.

If the network invokes any MT control plane signalling delivery to a UE
when UE is not reachable due to a power saving state (e.g. MICO, eDRX
etc), the AMF activates a UE availability notification to the
originating NF.

For UE in CM-IDLE mode, the figure below shows the flow of AMF providing
UE availability to NF after MT control plane signalling delivery
failure.

Figure 6.24.4.3-1: Notification - Availability Notification after MT
control plane signalling failure (CM-IDLE)

1\. Any NF, e.g. SMF, in 5GC may trigger MT control signalling to UE
through Namf\_Communication\_N1N2MessageTransfer Service Operation ().
The N1N2TransferFailure Notification Target Address is included to
subscribe to unreachability event in step 5. The MT control signalling
may for example be SMF that triggers MT control signalling due to DL
data.

2\. If the UE is currently not reachable due to a power saving method
(see KI\#4), the AMF returns a
Namf\_Communication\_N1N2TransferFailureNotification with cause to
indicate power saving as the failure and indicate that AMF will send a
notification as soon as the UE becomes reachable. If the UE is currently
not doing power saving, the AMF initiates the network triggered service
request procedure and responds to the consumer NF with a result
indication, If the AMF detects that the UE fails to respond to paging,
the AMF invokes the Namf\_Communication\_N1N2TransferFailureNotification
to indicate the failure to the consumer NF with a result indication and
indicate that AMF will send a notification as soon as the UE becomes
reachable. The AMF sets the \"Notify on availability after MT control
plane signalling failure\" flag if not already set and schedules a CN
paging if not MICO mode and if not already scheduled. The AMF remembers
the NF to notify.

3\. When eDRX is used, the AMF may perform paging when the UE becomes
reachable i.e. in PTW.

4\. When UE enters CM-CONNECTED mode, either due to AMF paging or due to
a UE triggered procedure before the paging, the AMF notes that UE is
available and that the Notify on availability after MT control plane
signalling flag for the UE is set.

5\. The AMF triggers Namf\_EventExposure\_Notify service towards the
corresponding NF(s) in step 1/2. The AMF also clears the \"Notify on
availability after MT control plane signalling failure\" flag for the
UE.

6\. The NF realizes that the UE is reachable and re-sends the control
plane signalling if needed.

For UE in RRC-Inactive state where the N2 connection exists, the RAN can
indicate the non NAS delivery due to UE not reachable. And the AMF shall
set the \"Notify on availability after MT control signalling\" flag. At
next UE contact to network, AMF is notified and triggers a notification
towards corresponding NF.

The figure below shows the flow of AMF providing UE availability to NF
after MT control plane signalling delivery failure in RRC inactive
state.

Figure 6.24.4.3-2: Notification - Availability Notification after MT
control plane signalling failure (CM-CONNECTED / RRC-Inactive)

1\. Any NF, e.g. SMF, in 5GC may trigger MT control signalling to UE
through Namf\_Communicaiton\_N1N2messagerTransfer Request () (event
subscription parameters may be included in case the UE is not reachable)
and AMF sends N2 Downlink NAS transport to RAN if AMF considers the UE
in CM-CONNECTED mode. The MT control signalling may for example be SMF
that triggers MT control signalling due to DL data.

2\. The RAN checks the UE reachability if UE is in RRC\_Inactive state.
If UE is not reachable, i.e. due to KI\#4 (such as eDRX) or if RAN
paging fails, the RAN sends a NAS non-delivery message to AMF to
indicate the failure. If UE is not reachable due to eDRX, the RAN
schedules RAN paging for the next possible UE paging occasion (if not
already scheduled). and includes an indication to AMF that a paging has
been scheduled. The RAN marks that a notification to AMF is required
when the UE contacts the network next time.

NOTE: The N2 request message that can trigger the RAN paging can be N2
UE Notification Request.

3\. AMF sends Namf\_Communication\_N1N2messageTransfer Response to the
corresponding NF in step 1 and indicating that AMF will send a
notification as soon as the UE becomes reachable. The AMF sets the
\"Notify on availability after MT control plane signalling failure\"
flag if not already set. The AMF remembers the NF to notify.

4\. RAN may perform paging when the UE becomes reachable i.e. in PTW.

5\. When UE contacts the network with RRC resume, either due to RAN
paging or due to a UE triggered procedure before the RAN paging, the RAN
notifies AMF (either through N2 notification, or Path Switch Request in
case of RRC resume triggering RAN node change).

6\. When the AMF receives the notification about UE availability from
RAN and the AMF has a \"Notify on availability after MT control plane
signalling failure\" flag set for the UE (set by step 3), the AMF sends
Namf\_EventExposure\_Notification towards the corresponding NF(s) in
step 3 and clears the \"Notify on availability after MT control plane
signalling failure\" flag for the UE.

7\. The NF realizes the UE is reachable and re-sends the MT signalling.

8\. RAN moves the UE to RRC Inactive state.

### 6.24.5 Impacts on existing entities and interfaces

AMF:

\- Based on UE power saving state info, and optionally configuration
parameters from UDM, providing DL data buffering information to SMF.

\- Providing/Retrieving necessary information to/from RAN through N2
procedure (e.g. new N2 notification trigger to request to RAN to notify
the AMF when the UE becomes reachable) to support providing DL data
buffering information to SMF for UE in RRC\_INACTIVE/CM-CONNECTED.

\- Event notification to SMF/UPF/NEF with UE reachability, and event
activation after subscription or DDN failure or signalling failure.

\- Paging scheduling based on UE power saving info.

\- Notification related parameter configuration from UDM.

SMF:

\- Forwards part of the policy information to AMF to help it deciding
whether extended buffering needs to be applied or not.

\- Parameter configuration from UDM, if it\'s deployed.

\- Buffers downlink data based on the buffering info received from the
AMF, if SMF buffering is applied.

Support of new Namf\_MT\_EnableUEReacahability procedure for
RRC\_INACTIVE/CM-CONNECTED (only applies for the CN extended buffering).

\- New request to UPF to buffer data even when N3 is still active (only
applies for the CN extended buffering).

UPF:

\- Buffers downlink data based on the buffering info received from the
SMF, if UPF buffering is applied.

\- Support of buffering data when N3 is active (only applies for the CN
extended buffering).

\- Support of new Namf\_MT\_EnableUEReacahability procedure for
RRC\_INACTIVE/CM-CONNECTED (only applies for the CN extended buffering).

UDM:

\- Pass configuration info to AMF (or SMF).

\- Subscriber event request to AMF (or SMF).

NEF:

\- Receives configuration from the AF and passes to the UDM.

RAN:

\- Provide RRC inactive related info to CN, if RRC inactive is applied.

\- Data buffering if RRC inactive without power saving state or if
limited power saving time.

\- RAN paging with extended unreachable cycles.

\- Enhanced N2 notification procedure to indicate to CN that the UE is
unreachable/reachable in RRC\_INACTIVE/CM-CONNECTED.

UE:

\- Extended DRX in CM-CONNECTED with RRC-INACTIVE.

### 6.24.6 Evaluation

The solution proposes the notification procedure triggered by UE
Reachability event or Availability after DDN failure event. The
notification procedure for the UE in CM-CONNECTED with RRC\_INACTIVE
state is also proposed. The proposed notification procedure is based on
the same principles as the notification procedure for HLCOM in EPC, and
addresses the Architectural requirements of key issue3 to \"Provide the
AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable)\".

The solution covers two different ways for SCS/AS to use for handling of
\"sleeping devices\" i.e. high latency communications: a) extended
buffering, and b) availability notifications.

a\) Extended buffering is provided differently depending on CM state and
sleep cycle length:

\- CM-IDLE: An EPS like CN extended buffering made in UPF or in SMF
depending on local configuration.

\- CM-CONNECTED with RRC\_INACTIVE: Two options a) CN extended buffering
made in UPF/SMF or b) no CN extended buffering i.e. buffering in RAN.

b\) Availability notifications:

\- UE Reachability Notification for CM-IDLE mode and for CM-CONNECTED
with RRC\_INACTIVE.

\- Availability Notification after DDN failure for CM-IDLE mode and for
CM-CONNECTED with RRC\_INACTIVE.

The solution also provides a way for the AF to provide configuration
parameters to AMF (or SMF) through NEF/UDM in case UE Reachability
notification or Availability Notification after DDN failure are used.

The drawback with CN extended buffering and availability notifications
for RRC\_INACTIVE and eDRX with sleep cycles longer than the NAS
retransmission timer is that it requires to replicate CM-IDLE behaviour
for CM-CONNECTED mode fully (for CN extended buffering) or partially
(for availability notifications).

6.25 Solution 25: HLCom buffering and event notification support for CM-IDLE
----------------------------------------------------------------------------

### 6.25.1 Introduction

This solution applies to Key issue 3: High Latency Communication, for
the case of extended data buffering at the UPF for mobile terminated
user plane data packets while the UE is unreachable and also support AF
notifications.

### 6.25.2 Functional Description

The following principles apply:

\- When the SMF receives a Data Notification message or downlink data
packet from UPF, the SMF determines whether Extended Buffering applies
for the downlink packet or not, based on:

\- Policy information received from the PCC, which contains:

\- For the PDU session whether Extended Buffering is enabled.

\- Whether the selected UPF supports extended buffering.

If it applies, the SMF including an \"Extended buffering applies\"
indication in Namf\_ Communication\_N1N2MessageTransfer.

\- Whenever an AMF receives a Namf\_ Communication\_N1N2MessageTransfer
including an \"Extended buffering applies\" indication from the SMF for
a UE that is temporarily unreachable due to power saving function as per
Key issue 4, the AMF replies with Namf\_
Communication\_N1N2MessageTransfer Response indicating the UE is
unreachable, and a Maximum estimated wait time for the UE to become
reachable. The AMF stores an indication that MT data may be pending for
the UE (this indication may be used for power saving solutions).

NOTE: How the AMF determines the Maximum estimated wait time for the UE
to become reachable depends on the power saving solution to be
determined in Key issue 4.

\- If the AMF replies with Namf\_ Communication\_N1N2MessageTransfer
Response indicating the UE is unreachable, and a Maximum estimated wait
time for the UE to become reachable, SMF decides the extended buffering
time.

\- If extended buffering is applied at UPF, SMF sends Failure indication
with an indication to the UPF to buffer the downlink data packet
Extended Buffering time to the UPF. The SMF may also indicate to the UPF
to stop sending Data Notifications while the Extended buffering timer is
running.

\- When the UPF receives a Failure Indication with extended buffering
time, the UPF buffers the DL data packet and initiates an extended
buffering timer with the received value. If the extended buffering timer
expires the UPF drops the DL data packet.

\- PCC provides the Policy information for extended buffering to the SMF
during Session Management Policy Establishment/Modification.

### 6.25.3 Support of EPC interworking

Interworking between 5GS and EPC is achieved by a combined P-GW-U+UPF.
If a UPF has data buffered for a UE when the UE moves to EPC and becomes
reachable then buffered data will get delivered in EPC (and vice versa).

### 6.25.4 Procedures

#### 6.25.4.1 Extended data buffering at UPF

Figure6.25.4.1-1 shows the call flow for extended data buffering at the
UPF for user plane mobile terminated data.

Figure 6.25.4.1-1: Extended buffering at UPF for mobile terminated user
plane data

1-2b. As per current Network Triggered Service Request defined in
TS23.502\[7\], clause4.2.3.3, steps 1 to 3a.

2c. For the PDU session established to support small data transfer via
NAS transmission, UPF sends the received downlink data to the SMF.

3\. The SMF determines whether Extended Buffering is available for the
received downlink packet or not, based on:

\- Policy information received from the PCC, which contains:

\- For the PDU session whether Extended Buffering is enabled.

\- Whether the selected UPF supports extended buffering.

\- Subscription information for the UE.

4\. The SMF includes \"Extended buffering available\" indication in
Namf\_ Communication\_N1N2MessageTransfer.

5\. The AMF determines the UE is temporarily unreachable due to power
saving function (see Key issue 4).

6\. The AMF replies with Namf\_ Communication\_N1N2MessageTransfer
Response with a rejection indicating the UE is not reachable due to
power saving function, and a Maximum estimated wait time for the UE to
become reachable. The AMF stores an indication that there may be MT data
pending for the UE.

NOTE1: How the AMF determines the Maximum estimated wait time for the
UE to become reachable depends on the power saving solution to be
determined in Key issue 4.

As per currently specified in TS23.502\[7\], the AMF may include in
the reject message an indication that the SMF needs not send DL data
notifications to the AMF, if the SMF has not subscribed to the event of
the UE reachability. The AMF stores an indication that the SMF has been
informed that the UE is not reachable.

7\. If the AMF replied with Namf\_ Communication\_N1N2MessageTransfer
Response indicating the UE is unreachable due to power saving function,
and a Maximum estimated wait time for the UE to become reachable, and if
the SMF had determined that Extended Buffering applies, the SMF sends
Failure indication with an indication to the UPF to buffer the downlink
data packet Extended Buffering time and **optionally a DL Buffering
Suggested Packet Count** to the UPF. The SMF may also indicate to the
UPF to stop sending Data Notifications while the Extended buffering
timer is running.

NOTE2: The DL Buffering Suggested Packet Count is derived from the
subscription information which is provided by the SCS/AS via T8 API.

Editor\'s note: Whether the AMF or SMF determines the DL Buffering
Suggested Packet Count is FFS.

8\. The UPF based on SMF indication buffers the data packet and starts
an Extended buffering timer.

9a. If the UE moves to CM-CONNECTED before the extended buffering timer
expires, the UPF sends the buffered downlink data packet(s).

9b. If the PDU session is established for Data over NAS, the MT data is
transmitted as described in clause6.1.4.3.

9c. If the Extended buffering timer expires, the UPF drops the buffered
data packets.

#### 6.25.4.1A Extended data buffering at NEF

The same principle of clause6.25.4.1 applies to DL data buffered in the
NEF in case of data transfer via APIs. For data transfer via NEF, the
NEF uses the same interactions with the SMF as the UPF uses in
Figure6.25.4.11.

#### 6.25.4.2 AF notification from AMF

##### 6.25.4.2.1 General

The AF may select to send data to the UE only when the UE is available.
Availability for the UE would depend on the power saving scheme that the
UE is using. For example, if the UE is using MICO, then an availability
indication is sent when the UE transitions to CM-CONNECTED state due to
MO data or other mobile originated signalling e.g., Registration update.
For UEs in eDRX, availability may be triggered just prior to the Paging
Time Window (PTW) of the UE.

If AMF receives MT control plane signalling for a UE which is in
CM-IDLE, the AMF activates a UE availability notification to the
originating NF (see clause6.24.4.3).

##### 6.25.4.2.2 Event Subscription of UE reachability

If an AF (or AS) wants to send downlink packet(s) when UE becomes
reachable, the AF can subscribe for one-time \"UE Reachability\"
monitoring event by following Event Exposure using NEF specified in
TS23.502\[7\] clause4.15.3.2.3. The AF sends DL data when it receives
notification that the UE is reachable.

##### 6.25.4.2.3 MT data transfer with Notification of UE availability

The procedure for MT data transfer with UE reachability information is
shown in Figure6.25.4.2.3-1.

Figure 6.25.4.2.3-1: Procedure for MT data transfer with UE monitoring

1\. AF has data to be sent to the UE.

2\. AF subscribes to one-time \"UE Reachability\" monitoring event using
steps 1 to 4 specified in TS23.502\[7\] clause4.15.3.2.3.

3\. AMF determines that UE is reachable based on the UE power save
scheme. For example, MO data or PTW in case of eDRX.

4\. AMF uses Step 6b of procedure in in TS23.502\[7\]
clause4.15.3.2.3 to notify the NEF.

5\. NEF uses Step 7 of procedure in in TS23.502\[7\] clause4.15.3.2.3
to notify the AF.

6\. AF sends data for delivery to the UE.

##### 6.25.4.2.4 Event Subscription of \"Availability Notification after DDN Failure\"

The AF can subscribe the \"Availability Notification after DNN Failure\"
monitoring event using NEF specified in TS23.502\[7\]
clause4.15.3.2.3. AMF sets a Notify-on-available flag after a DDN
failure or the \"UE is unreachable\" monitoring event. If the flag is
set when the UE next contacts the network, the AMF notifies the NEF that
UE is reachable and then NEF informs AF UE is reachable.

##### 6.25.4.2.5 Notification about \"Availability Notification after DDN Failure\"

The Notification of \"Availability Notification after DDN Failure\" for
CM\_IDLE mode is described in Figure6.24.4.2.3-1 in clause6.24.4.2.3

#### 6.25.4.3 AF notification from SMF

##### 6.25.4.3.1 Application Notification overall procedure

Figure6.25.4.3.1-1 describes the Application Notification about
Extended buffering procedure.

Figure 6.25.4.3.1-1 Application Notification about HLCom Extended
buffering procedure

0\. UE establishes a PDN connection to the DNN.

1\. SCS/AS monitors data delivery status to the 5GC, more details are
described in clause6.25.4.3.2.

2\. DL data is arrived in UPF.

3\. HLCom Extended buffering in UPF is performed as described in
clause6.25.4.1.

4\. UPF pending the DL data as the received information from SMF.

5\. SMF sends the monitoring report to SCS/AS, more details are
described in clause6.25.4.3.3.

6\. SCS/AS may buffer the DL data or send the DL data according to the
received monitoring report.

##### 6.25.4.3.2 Event subscription for data delivery status

Figure6.25.4.3.2-1 is the event subscription procedure for data
delivery status of DL data transmission from SCS/AS.

Figure 6.25.4.3.2-1: Event subscription procedure for data delivery
status

1\. SCS/AS sends Nnef\_EventExposure\_Subscribe Request to NEF
requesting data delivery status. The IP Filter information is included
in the message to identify the IP PDU traffic or the Ethernet packet
filter. The monitoring events may include:

\- Packet(s) in extended buffering and Expected wait time.

\- Packet(s) discarded.

\- Packet(s) transmitted.

2\. NEF sends the Npcf\_EventExposure\_Subscribe Request to PCF. IP
Filter information, monitoring event received from step 1 are included
in the message.

3\. PCF sends the Nsmf\_EventExposure\_Subscribe Request (NEF ID,
Monitoring Event) message to the SMF which is served the PDN connection
to SCS/AS.

4\. SMF sends the Nsmf\_EventExposure\_Subscribe Response message to
PCF.

5\. PCF send sends the response message to NEF.

6\. NEF sends the response to SCS/AS.

##### 6.25.4.3.3 Monitoring report procedure for data delivery status

This procedure, shown in Figure6.25.4.3.3-1, informs the AF if the UE
is not reachable and Extended DL data buffering is applied, or if UE
becomes reachable after the Extended buffering has been applied. SMF
sends the monitoring report to SCS/AS.

Figure 6.25.4.3.3-1: Monitoring report procedure

0\. The UE is unreachable.

1\. When the SCS/AS sends a downlink packet, the SMF determines that
extended buffering applies.

2\. SMF sends the Nsmf\_EventExposure\_Notify (Extended Buffering event)
message to NEF. The following parameters may also be included according
to the monitoring events in clause6.25.4.3.2:

\- Packet(s) in extended buffering; and

\- Expected wait time; and

\- DL Buffering Suggested Packet Count.

3\. NEF transfers the Nnef\_EventExposure\_Notify to SCS/AS. The
information about packet(s) in extended buffering allows the SCS/AS to
not perform retransmission. The expected wait time indicates the
expected pending time before the buffered packet(s) can be transmitted,
i.e. before UE becomes reachable.

> The DL buffering suggested packet count indicates the expected maximum
> amount of data packets that will be buffered in the network. The
> SCS/AS may buffer the DL data or send the DL data according to the
> expected wait time and the DL buffering suggested packet count.

NOTE: The DL Buffering Suggested Packet Count modified by the SMF is
exposed towards the SCS/AS.

4\. If DL data transmission becomes available, for example, UE enters
connected mode, CN delivers the buffered downlink packet(s), step5 and
step6 are perform.

5\. SMF sends the Nsmf\_EventExposure\_Notify (Extended Buffer event)
message to NEF. The following parameter is included:

\- Packet(s) have been transmitted.

6\. NEF sends the Nnef\_EventExposure\_Notify (Extended Buffer event)
message to SCS/AS.

If at any point in time the CN drops the buffered packets, the SMF
initiates the Nsmf\_EventExposure\_Notify (Extended Buffer event)
procedure indicating Packet(s) discarded.

### 6.25.5 Impacts on existing entities and interfaces

PCC:

\- Management of Policies for extended buffering per PDU session.

\- Provide policy information for extended buffering to SMF.

\- Support event exposure for the Monitoring event from NEF.

UPF:

\- Support extended buffering as requested by SMF (for data via N6).

SMF:

\- Receive policies from PCF.

\- Determine whether extended buffering applies, supported extended
buffering for DL data or provide request for extended buffering to UPF.

\- Support event exposure for the monitoring event from PCF.

AMF:

\- Provide Estimated Maximum wait time to SMF.

NEF:

> \- Support extended buffering as requested by SMF (for data via APIs).

### 6.25.6 Evaluation

The solution proposes extended buffering and event notification for high
latency communication. The SMF determines whether Extended Buffering
applies for the downlink packet or not based on the policy information
from the PCC and UPF capability. In addition, two notification
procedures towards the AF are prosed: AF notification from AMF,
including the \"UE Reachability\" event and \"Availability Notification
after DDN Failure\" event; AF notification from SMF, i.e. the \"Extended
Buffering\" event.

The solution addresses the architectural requirements of key issue3 to
\"provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable)\", and \"Send DL data to UEs at the earliest possible
opportunity when the UEs are applying power saving functions\".

6.26 Solution 26: Expected UE Behaviour provisioning for CIoT
-------------------------------------------------------------

### 6.26.1 Introduction

This solution addresses Key Issue \#13 (Support for Expected UE
Behaviour), and partially addresses Key Issue \#4 (Power Saving
Functions) as well as Key Issue \#3 (High Latency Communication) and
indicates which parameters, among the Communication Parameters defined
in TS23.682\[6\], shall be re-used for 5GC, investigating their
relevance and analysing how they can be provided to the AMF and/or the
SMF.

This solution proposes that some of the Communication Pattern parameters
defined in TS23.682\[6\] clause5.10.1 are provided to 5GC to optimize
the resource usage for CIoT. More specifically, the parameters to be
used for 5GS are described in Table 6.26.1-1 below. The differences
between the EPS Communication Pattern parameters and those proposed for
5GS are:

1\. The *Expected UE Moving Trajectory* (which is not present in
TS23.682\[6\] but is described in TS23.502\[7\]) is added to the
list of parameters.

2\. The *Periodic Communication Indicator* is not needed because it can
be implicitly inferred by the usage of the *Periodic Time*.

3\. The *Communication Duration Time* has been generalized to be
applicable not only to periodic communication. In this proposal it
indicates for how long the UE will normally stay in CM-Connected for
data transmission, independently of whether the communication is
periodic or not.

4\. The *Scheduled Communication Type* (which is not present in
TS23.682\[6\]) is added to the list of parameters.

5\. The *Traffic Profile* (see TS23.682\[6\]) is added to the list of
parameters.

Table 6.26.1-1: Description of parameters for Expected UE Behaviour

+----------------------------------+----------------------------------+
| Expected UE Behaviour parameter  | Description                      |
+----------------------------------+----------------------------------+
| Expected UE Moving Trajectory    | Identifies the UE\'s expected    |
|                                  | geographical movement.           |
|                                  |                                  |
|                                  | Example: A planned path of       |
|                                  | movement.                        |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Stationary Indication (see       | Identifies whether the UE is     |
| TS23.682\[6\] clause5.10.1)   | stationary or mobile             |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Communication Duration Time (see | Indicates for how long the UE    |
| TS23.682\[6\] clause5.10.1)   | will normally stay in            |
|                                  | CM-Connected for data            |
|                                  | transmission.                    |
|                                  |                                  |
|                                  | Example: 5 minutes.              |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Periodic Time (see               | Interval Time of periodic        |
| TS23.682\[6\] clause5.10.1)   | communication                    |
|                                  |                                  |
|                                  | Example: every hour.             |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Scheduled Communication Time     | Time and day of the week when    |
| (see TS23.682\[6\]             | the UE is available for          |
| clause5.10.1)                   | communication.                   |
|                                  |                                  |
|                                  | Example: Time: 13:00-20:00, Day: |
|                                  | Monday.                          |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Battery Indication (see          | Identifies power consumption     |
| TS23.682\[6\] clause5.10.1)   | criticality for the UE: if the   |
|                                  | UE is battery powered with not   |
|                                  | rechargeable/not replaceable     |
|                                  | battery, battery powered with    |
|                                  | rechargeable/replaceable         |
|                                  | battery, or not battery powered. |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Traffic Profile (see             | Identifies the type of data      |
| TS23.682\[6\])                 | transmission: single packet      |
|                                  | transmission (UL or DL), dual    |
|                                  | packet transmission (UL with     |
|                                  | subsequent DL or DL with         |
|                                  | subsequent UL), multiple packets |
|                                  | transmission                     |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+
| Scheduled Communication Type     | Indicates that the Scheduled     |
|                                  | Communication Type is Downlink   |
|                                  | only or Uplink only or           |
|                                  | Bi-directional \[To be used      |
|                                  | together with Scheduled          |
|                                  | Communication Time\]             |
|                                  |                                  |
|                                  | Example: \<Scheduled             |
|                                  | Communication Time\>, DL only.   |
|                                  |                                  |
|                                  | \[optional\]                     |
+----------------------------------+----------------------------------+

### 6.26.2 Functional Description

It shall be possible to provide the parameters for CIoT in Table
6.26.1-1 to the AMF and/or to the SMF. The reasons are as follows:

\- *Expected UE Moving Trajectory* and *Stationary Indication*, to
configure the UE with e.g. a Registration Area (TA-list) that includes
the TA(s) along the Expected UE Moving Trajectory. These parameters can
be used by the AMF and SMF.

\- *Communication duration time*, to be used for inferring the end time
of the communication. The end time could be used to initiate the
transition from CM-CONNECTED to CM-IDLE state. With this value, the SMF
can trigger the PDU Session deactivation, and then if there is no more
activated PDU session(s) to the UE, the AMF can trigger AN release. This
parameter can be used by both the AMF and the SMF.

\- *Periodic time*, to be used for determining mobility management
parameters, such as determining the periodic time of registration update
so as to save the signalling. Moreover, the SMF can manage the buffering
time for downlink data to the UE, e.g., in the case of UE is in MICO
mode which has periodic communication parameter, the SMF expects the UE
is supposed to be reachable in the time of periodic communication. This
parameter can be used by both the AMF and the SMF.

\- *Scheduled communication time*, to be used for determining MICO mode
UE so as to save energy consumption of some specific devices. Moreover,
the SMF can determine the inactivity for a certain PDU session, or
trigger the PDU Session release procedure when the time expires and no
ongoing traffic for such PDU session. This parameter can be used by both
the AMF and the SMF.

\- *Scheduled communication type*, to be used for indicating that the
scheduled communication time is DL only or UL only or bi-directional. It
may be used together with the *Scheduled communication time*. This
parameter can be used by both the AMF and the SMF along with the
*Scheduled communication time*.

*- Traffic Profile*, to be used for indicating how many packets are
expected. It may be used together with the *Scheduled communication
time*. This parameter can be used by both the AMF and the SMF along with
the *Scheduled communication time*.

NOTE1: The *Scheduled Communication Type* and the *Traffic Profile*
should not be used by the AMF to release the UE when Release Assistance
Indication from the UE is available.

\- *Battery Indication*, to be used for indicating the power consumption
criticality for the UE. This parameter should be sent to the AMF is
mainly used by the RAN.

NOTE2: How Expected UE Behavior infleunces CM-CONNECTED to CM-IDLE
state transitions, mobility management paramters, and MICO mode may also
be infleunced by the parameters (Maximum Response Time and Maximum
Latency) that are provided by solutions to Key Issue \#10 (Network
Parameter Configuration API via NEF).

The above mentioned parameters are to be forwarded to the RAN to allow
optimisation of Uu resource allocation for NB-IoT UE differentiation.
The *Expected UE Moving Trajectory* is used also for WB-EUTRA.

### 6.26.3 Support of EPC interworking

The support for interworking between EPC and 5GC is based on the
idle-mode mobility procedures defined in subclause4.11.1.3 of
TS23.502\[7\].

When a UE for which the Expected UE Behaviour parameters are used is
moving to/from EPS, the following mapping with the Communication Pattern
parameters applies:

Table 6.26.3-1: mapping between EPS Communication Pattern parameters and
5GS Expected UE Behaviour

  -------------------------------------- --------------------------------------------------------------------------------------------------------
  EPS Communication Pattern parameter    5GS Expected UE Behaviour parameter
  1\) Periodic communication indicator   No explicit equivalent parameter, but it is implicitly indicated by the presence of the Periodic Time.
  2\) Communication duration time        Communication Duration Time (as in EPS)
  3\) Periodic time                      Periodic Time (as in EPS)
  4\) Scheduled communication time       Scheduled communication time (as in EPS)
  5\) Stationary indication              Stationary Indication (as in EPS)
  6\) Battery indication                 Battery Indication (ad in EPS)
  7\) Traffic Profile                    Traffic Profile (as in EPS) and Scheduled Communication Type
  -------------------------------------- --------------------------------------------------------------------------------------------------------

The mapping between parameters is done in the HSS+UDM combined entity.

### 6.26.4 Procedures

The external parameter provisioning procedure defined in TS23.502\[7\]
clause4.15.6.2 (External Parameter Provisioning) can be reused to
provide Communication Pattern parameters to 5GC.

NOTE: How the parameters are provided to ng-eNBs is to be discussed
together with RAN WGs.

### 6.26.5 Impacts on existing entities and interfaces

The following nodes are impacted:

\- NEF to provide the Expected UE Parameters to UDM;

\- AMF/SMF to receive and use the related Expected UE Parameters from
the UDM during registration and/or PDU session establishment;

\- RAN to receive the Expected UE Parameters from the AMF/SMF via N2 and
N11 interface.

### 6.26.6 Evaluation

This solution analysed and identified which new and existing parameters
are to be provided to the AMF, SMF and ng-eNB to optimise the network
behaviour for an effective CIoT operation.

 6.27 Solution 27: Reuse of EPS Overload Control Mechanisms
----------------------------------------------------------

### 6.27.1 Introduction

This solution corresponds to Key Issue 7: Overload Control for small
data.

In EPC there are several solutions for overload control which are
designed to protect various network entities when overload occurs and to
prevent overload occurring in the first place. This solution considers
whether the features identified in KI7: Overload Control for small data
architectural baseline (control plane data back-off timer, control plane
overload start indication and service gap) as applied in EPC can be
applied to protect 5GC. In addition this solution also applies APN rate
control and low access priority from EPC to 5GC.

### 6.27.2 Functional Description

#### 6.27.2.1 Small Data Rate Control

Small Data Rate Control in 5GC, similar to APN Rate Control in EPC, is
to allow operators to offer customers services such as \"maximum of Y
messages per day\" as well as allowing the network operator to protect
the UPF/NEF.

Small Data Rate Control provides 3 settings; \'number of packets per
time unit\', whether exception reports can be sent then the rate control
limit has been reached and if they can the \'number of additional
allowed exception report packets per time unit\' beyond the base small
data rate control limit. The settings for uplink and downlink are
separate. The UE observes the limits and 5GC may enforce the limits.

#### 6.27.2.2 Service Gap Control

Service Gap Control is an optional feature for CIoT UEs to control the
frequency they access the network by providing a minimum gap between
consecutive MO data communication initiated by the UE for delay tolerant
applications. This helps to reduce peak loading in the network and
allows a distribution of these accesses in time.

Service Gap Time should be a subscription parameter stored in the
UDR/UDM, which is used to set the Service Gap timer, and passed to the
UE and AMF.

The UE observes the Service Gap Time restriction and AMF enforces it.
When the timer is running the UE does not initiate connections for MO
data transfer or MO SMS, unless the MO data is exception data in NB-IoT.
The UE can still initiating connections for signalling only and to
respond to paging.

#### 6.27.2.3 AMF and SMF Overload

In 5GC general mechanisms exist, as described in TS23.501\[5\] clauses
5.19.5 and 5.19.6 for the AMF and SMF to manage overload. The AMF can
request an AN node to reject connection requests for various reasons
related to overload control and the AMF and SMF can trigger NAS level
congestion control, for example by the SMF indicating congestion in
Nsmf\_PDUSession service responses, see TS29.502\[26\].

NB-IoT also includes exception reporting which for the purposes of AMF
overload control is considered to be NB-IoTs equivalent of emergency
access.

AMF Overload Control is enhanced to take into account exception
reporting conditions:

\- reject AN signalling connection requests that are for non-exception
reporting; or

\- only permit AN signaling connection requests for exception sessions
and mobile terminated services for that AMF.

The AMF can also signal a percentage value of the amount of signaling
traffic to be rejected.

The RAN node may take the existing and new AMF Overload Control
indications into account when configuring access barring mechanism for
the related access technologies.

If low access priority is supported then AMF Overload Control can
further be enhanced to request the AN reject requests from low access
priority UEs (e.g. UEs using a Delay Tolerant as RRC establishment
cause). The AN node further enable access barring if all AMFs it is
connected to send an N2 overload start message for low access priority
UEs.

NAS level congestion control specified in TS23.501\[5\] clause5.19.7
is reused.

#### 6.27.2.4 Control plane data back-off timer

In EPC the control plane data back-off timer (T3448) can be returned to
the UE in Attach/TAU/Service Accept or Service Reject messages. The UE
then uses this timer to delay any further transmission of user data via
Control Plane CIoT EPS Optimisation.

The control plane data back-off timer and rules for when the UE is
permitted to ignore it (e.g. exception data, response to paging) are
reused in 5GC to prevent the UE from sending data over the control plane
via NAS signalling.

#### 6.27.2.5 Low Access Priority

The UE may be configured with low access priority. When the UE is
configured with a low access priority, when establishing an RRC
connection for MO data it should indicate low access priority or Delay
Tolerant in its RRC establishment cause.

UE provides Low access priority indication (LAPI) in NAS message to the
5GC.

Editor\'s note: It is FFS if LAPI is provided in MM message (e.g.
registration request), or in SM message (e.g. PDU session establishment
request), or in both.

The UE may be configured with permission to override the low access
priority, in which case if any PDU session is configured to use normal
access priority then normal access priority is used instead of low
access priority.

The low access priority indication may be included in charging records
for the UE.

### 6.27.3 Support of EPC interworking

Consistent with existing EPS-5GS interworking scenarios in
TS23.501\[5\] with the following differences:

\- Small Data Rate Control is similar to APN Rate Control in EPC and
share the same configuration;

\- Service Gap timer is a subscription parameter and can be used both in
EPC and 5GC.

### 6.27.4 Procedures

#### 6.27.4.1 Small Data Rate Control

##### 6.27.4.1.1 General

Small Data Rate Control is configured by the UPF or NEF via the SMF. The
configuration is performed when a PDU Session is established using the
procedure in TS23.502\[7\] clause4.3.2.2, with enhancements for Small
Data Rate Control limits.

During PDU Session Establishment the Small Data Rate Control limits are
retrieved from the UPF in step10b and passed to the UE in the PDU
Session Establishment Accept message sent to the UE in steps 11, 12 and
13 of the procedure described in clause4.3.2.2.1 of TS23.502\[7\].

Editor\'s note: If and how the NEF provides the small data rate control
limits is dependent upon solutions for KI\#1 and KI\#2 for data arriving
in the network using an API.

#### 6.27.4.2 Service Gap Control

##### 6.27.4.2.1 General

The Service Gap timer is a subscription parameter and is therefore
stored in the UDR/UDM. When the Registration procedure is performed as
defined in TS23.502\[7\] clause4.2.2.2 the AMF retrieves the Service
Gap Time as part of the Access and Mobility Subscription data and passed
to the UE in the Registration Accept message.

At subsequent accesses the AMF verifies that any Service Gap limitations
have been observed. If the Service Gap limitations have not been
observed then the AMF rejects the UEs request and returns the remaining
time for the Service Gap timer. The UE starts its Service Gap timer with
the value from the AMF and observes the Service Gap control
restrictions.

#### 6.27.4.3 Overload procedure

##### 6.27.4.3.1 General

No enhancements are required to the procedures, however additional code
points maybe required to signal to the AN node the additional
restrictions, described in clause6.27.2.3 for AMF Overload Control.

#### 6.27.4.4 Low access priority

##### 6.27.4.3.1 General

UE needs to provide Low access priority indication (LAPI) in NAS
messages to the 5GC.

Editor\'s note: It is FFS if LAPI is provided in MM message (e.g.
registration request), or in SM message (e.g. PDU session establishment
request), or in both.

For the low access priority indication to be included in charging
records the UE needs to include the priority in the PDU session
establishment request to the SMF. The SMF can then forward the priority
information to other network nodes, for example the PCF.

#### 6.27.4.5 Control plane data back-off timer procedure

The principle on Control Plane data back-off timer specified in
section4.3.7.4.2.7 of TS23.401\[4\] are reused for 5GS. If Release
Assistance Indication in AS information is available to the AMF this can
also be taken into account.

### 6.27.5 Impacts on existing entities and interfaces

Impacts on AMF:

\- Support of Service Gap Control.

\- Support of Control plane data back-off timer.

\- Support of Low Access Priority.

Impact on SMF:

\- Small Data Rate Control is configured by the UPF or NEF via the SMF.

Impact on UPF:

\- Support of Small Data Rate Control.

Impacts on UE:

\- Support of Small Data Rate Control.

\- Support of Service Gap Control.

\- Support of Control plane data back-off timer.

\- Support of Low Access Priority.

Impact on RAN:

\- Reject connection requests for various reasons related to overload
control based on AMF indication.

### 6.27.6 Evaluation

To support the Overload Control for small data, the solution introduces
the Small Data Rate Control, Service Gap Control, AMF/SMF Overload
Control and Control plane data back-off timer. The solution is based on
the same principles as EPS Overload Control.

The solution addresses all the architectural requirements of Key Issue
7.

6.28 Solution 28: SMF assisted NG-RAN information
-------------------------------------------------

### 6.28.1 Introduction

This solution applies to Key Issue 13 (Support for Expected UE
Behaviour), Key Issue 1 (Infrequent small data communication) and to Key
Issue 2 (Frequent small data communication) to assist the NG-RAN
configuration depending on the application behaviour.

In particular this solution partially addresses the KI\#1 requirements
for \"single packet transmission (UL or DL)\" and \"dual packet
transmission (UL with subsequent DL, or DL with subsequent UL)\" when
the SD is transmitted over the User Plane.

### 6.28.2 Functional Description

The main principles of the solution are:

\- The NG-RAN node is provided with PDU Session specific information
(called \'SMF assisted NG-RAN information\') to be used for proper
configuration of the radio interface upon activation of the UP
connection;

\- The SMF determines the SMF assisted NG-RAN information and provides
it to the NG-RAN node within the N2 SM information during the UP
connection activation.

\- In case of PDU Session used for data transmission over user plane,
the SMF may use the SMF-Associated parameters (e.g. Communication
Pattern parameters, Network Configuration parameters) or network
configuration to determine the \'SMF assisted NG-RAN information\'.

> \- In case of PDU Session used for data transmission over control
> plane, the SMF provides the SMF-Associated paramters to the AMF,
> which, in turn, aggregate them and provide them to the NG-RAN.

An AF can provision the 5GS with external parameters (e.g. Communication
Pattern parameters or parameters from the Network Parameter
Configuration API as specified in TS23.682\[6\], but also new
parameters can be specified in Rel-16 as described in solution 26).
During the PDU Session establishment procedure, the SMF is provisioned
with some of the external parameters.

NOTE1: The provisioning of the external parameters to the SMF is
described in solutions 15 and 26 and will be further detailed during the
normative phase.

Based on the SMF-Associated external parameters provisioned in the SMF
from the UDM, network configuration or internal statistics, the SMF may
determine \'SMF assisted NG-RAN information\'. The SMF utilises the
\"SMF assisted NG-RAN information\" in one of the following ways:

\- If the PDU Session uses user plane transport (i.e. data transport via
N3/N9 tunnels), the SMF sends the SMF assisted NG-RAN information to the
NG-RAN node included in the N2 SM Information container during the UP
connection activation for this PDU Session; or

\- If the PDU Session uses control plane transport (i.e. data PDUs are
sent over NAS SM signalling), the SMF sends the SMF assisted NG-RAN
information to the AMF during the PDU Session establishment procedure.
The AMF stores the received SMF assisted NG-RAN information as part of
the UE\'s context and associated PDU Session ID. This enables the AMF to
send the SMF assisted NG-RAN information to the NG-RAN node at the
earliest possible point (e.g. as shown in step1 in clause6.1.4.2 for
MO SD transport for solution1).

The \'SMF assisted NG-RAN information\' is used in the NG-RAN node
mainly for decision for appropriate RRC state, e.g. whether to apply RRC
Inactive state, transition from RRC Connected to RRC Inactive state or
transition from RRC Connected to RRC Idle state. The \'SMF assisted
NG-RAN information\' may include one or more of the following
information:

\- \'Expected Session activity behaviour\' describing the periodicity of
data transmission and/or the duration of data transmission for the PDU
Session (e.g. based on the *Communication Duration Time* and *Periodic
Time* parameters); or

\- The external parameter *Suggested Number of Downlink Packets* (see
Key Issue 10) indicates the expected number of uplink/downlink packets.

NOTE2: \'Expected Session activity behaviour\' can have semantic
similar to the semantic of the \"Expected UE activity behaviour\" (as
specified in TS23.401\[4\] clause4.3.21) but applicable for a Session
activity, i.e. expected pattern of the Session\'s changes between data
Transmission and Non-Transmission.

### 6.28.3 Support of EPC interworking

The support of interworking in this solution depends on the conclusions
for Key Issue 9 (Support of common north-bound APIs for EPC-5GC
Interworking).

Assuming that for EPC interworking a co-located SCEF+NEF entity and
co-located HSS+UDM entity are deployed, then the enhancement proposed in
this solution to the UDM and NEF would be applicable to the co-located
entities. During mobility to/from EPC the entities in the target CN
(e.g. MME in EPC; or AMF and/or SMF in 5GC) need to download the
\"external parameters\" from the HSS+UDM. The HSS+UDM sends the
\"external parameters\" in the corresponding format to be processed in
the target CN entity.

A possible mapping table between EPS Communication Pattern parameters
and 5GS Expected UE Behaviour is shown in Solution26 (see
clause6.26.3).

### 6.28.4 Procedures

In this clausethe procedure for PDU Session activation is described.

Figure 6.28.4-1: PDU Session activation procedure

If the PDU Session is used for data transmission over control plane
(data over NAS SM), the following steps apply:

0a. During the PDU Session establishment procedure, the PDU Session is
configured with (small) data PDU transport over the CP (i.e. Data over
NAS SM transport).

0b. The SMF may receive SMF-Associated external parameters from UDM
during the retrieval of the UE subscription data from UDM.

0c. From SMF to AMF: the SMF replies to the AMF using e.g.
Namf\_Communication\_N1N2MessageTransfer (SMF assisted NG-RAN
information, N1 SM container, etc.).

The SMF derives and sends the \"SMF assisted NG-RAN information\" (e.g.
Communication Duration Time, Periodic Time, Scheduled Communication
Type, Traffic Profile, Suggested Number of Downlink Packets) to the AMF.
The AMF stores this information as part of the UE\'s context and
associated with the particular PDU Session ID. This enables the AMF to
send the \"SMF assisted NG-RAN information\" as UE differentiation info
to the NG-RAN node at the earliest possible point (e.g. as shown in step
1 in clause6.1.4.2 for MO SD transport for solution 1).

If the SMF receives an updated SMF-Associated external parameters from
the UDM, the SMF initiates a service operation towards the AMF to update
the SMF assisted NG-RAN information.

0d. From AMF to UE: the AMF uses NAS transport to send the N1 SM
container to the UE.

0e. The UE initiates RRC Connection establishment with indication for
\'Data over NAS SM transport\'.

0f. The NG-RAN node may query UE context from the AMF. The AMF sends to
the NG-RAN the UE context including AMF assisted information (e.g. RRC
Inactive assistance information), SMF assisted NG-RAN information, etc.

NOTE1: The AMF provides the UE context to the NG-RAN before step 0g
(RRC Connection Setup message) is executed. The exact format of the
RAN-assistance information (including AMF assisted information and SMF
assisted NG-RAN information) sent from the AMF to the NG-RAN node is to
be decided during the normative phase together with RAN WGs.

0g. The NG-RAN node sends RRC Connection Setup message to the UE to
configure the RRC connection according to the AMF assisted information
and SMF assisted NG-RAN information received from the AMF.

NOTE2: The procedure described in steps 0b - 0g can be also applied to
send the UE QoS profile/differentiation information to the NG-RAN node,
but the details are described in solution 52.

As a result, Data PDUs can be transmitted in uplink and downlink over
the NAS SM signalling.

If the PDU Session is used for data transmission over user plane (data
carried over N3), the following steps apply:

1\. During the PDU Session establishment procedure the PDU Session is
configured for UP transport. The SMF may store in the UE\'s context the
external SMF-Associated parameters, e.g. as received from UDM/UDR during
UE SM context retrieval procedure.

2\. Due to mobile originated communication (e.g. step 2a using Service
Request) or due to mobile terminated communication (e.g. step 2b), the
User Plane connection activation for this PDU Session is initiated.

3\. The SMF initiates service operation towards the AMF e.g.
Namf\_Communication\_N1N2MessageTransfer (N2 SM information (PDU Session
ID, QoS, SMF assisted NG-RAN information (*Communication Duration Time*,
*Periodic Time*, *Scheduled Communication Type*, *Traffic Profile,
Suggested Number of Downlink Packets*))).

The SMF may include within the N2 SM container the SMF assisted NG-RAN
information. The SMF assisted NG-RAN information may contain one or more
of the following parameters: *Communication Duration Time*, *Periodic
Time*, *Scheduled Communication Type*, *Traffic Profile, Suggested
Number of Downlink Packets*.

4-7. Similar to the steps 12 - 14 in TS23.502\[7\] clause4.2.3.2.

8\. The NG-RAN node may use the information received in the N2 SM
information together with information received from the AMF to configure
the radio interface. For example the NG-RAN node may receive e.g., RRC
inactive assistance information from AMF and \'SMF assisted NG-RAN
information\' from one or more SMFs. The NG-RAN node may use the \"RRC
inactive assistance information\" from AMF to determine the RRC inactive
state configuration, and use the *Communication Duration Time* and
*Periodic Time* to decide whether to configure the RRC Inactive state
and/or the duration of the RRC Connected state.

If the NG-RAN node receives *Scheduled Communication Type*, *Traffic
Profile or Suggested Number of Downlink Packets*, the NG-RAN node may
determine whether the data transmission has been completed and the
NG-RAN node may determine the transition from RRC Connected to \[RRC
Idle or RRC Inactive states\] without waiting for the UE inactivity time
to expire; or the NG-RAN node may initiate selective UP connection
deactivation (if there are additional PDU Sessions activated).

> As a result, Data PDUs can be transmitted in uplink and downlink over
> the NAS SM signalling.

### 6.28.5 Impacts on existing entities and interfaces

Enhancements to SMF include the following:

\- Derive the SMF assisted NG-RAN information and sends it:

\- to the NG-RAN node within the N2 SM information if UP transport is
used; or

\- to AMF over N11 if CP transport is used.

Enhancements to AMF include the following:

\- storing the SMF assisted NG-RAN information received from the SMF and
associated with a PDU Session ID in the UE context.

\- sending and aggregating the SMF assisted NG-RAN information to the
NG-RAN node together with the UE context.

Enhancements to NG-RAN node include the following:

\- Using the SMF assisted NG-RAN information 1) from the N2 SM
Information container or 2) from the UE context sent from AMF, in
addition to \"RRC Inactive assistance information\" from the AMF, to
fine-tune the configuration of the Uu interface, e.g. RRC Inactive
state.

### 6.28.6 Evaluation

This solution allows to send to the NG-RAN node \"SMF assisted NG-RAN
information\" specific for a particular PDU Session. The following uses
cases are covered:

\- In cases of PDU Session using UP transport, during connection
activation the SMF sends the \"SMF assisted NG-RAN information\" to the
NG-RAN node within the N2 SM Information container.

\- In case of PDU Session using data transport over control plane
(Data-over-NAS transport), the SMF sends the \"SMF assisted NG-RAN
information\" to the AMF during the PDU Session establishment procedure.
The \"SMF assisted NG-RAN information\" is stored as part of the UE\'s
context and sent to the NG-RAN within the UE\'s context.

The \"SMF assisted NG-RAN information\" is used in the NG-RAN node to
fine-tune the configuration of the Uu interface, e.g. RRC Inactive
state.

6.29 Solution 29: User Plane data transmission with ConnectionLess signalling
-----------------------------------------------------------------------------

### 6.29.1 Introduction

This solution addresses primarily Key Issue 1: Support for infrequent
small data transmission, Secondarily, it can provide improvements in the
area of Key Issue 5: UE TX Power Saving Functions, Key Issue 7: Overload
Control for small data. The Solution may also be applicable to Key Issue
2: Frequent small data communication, and ConnectionLess (CL) solution
can be used alongside ConnectionOriented (CO) data solution.

Solutions design to address Key Issue 3: High latency communication, Key
Issue 4: Power Saving Functions, Key Issue 9: Support of common
north-bound APIs for EPC-5GC Interworking, Key Issue 12: Inter-RAT
mobility support to/from NB-IoT may be used in combination with this
solution.

It is assumed that solution35 or some other means to provide the T8 API
for NIDD service via user plane is supported.

### 6.29.2 Functional Description

The solution aims to cover at least following use cases:

\- (Massive) IoT UE that may move and need to send sporadic (potentially
small amount) data: in this case the UE sends data to the 5GC via the
user plane path without requiring more signalling in the network (RAN
and Core) than the amount of user data to be transferred.

In such situations, the following architectural concepts are proposed in
order to support a fast switch from IDLE state to a CL-data state where
data transfer occurs:

\- The service itself is not connectionless:

\- The UE needs to register to the network and set-up a PDU session that
is indicated for CL signalling.

\- When the UE exchanges MM or SM related signalling with the network a
N2 connection is set-up. Once the MM or SM transaction(s) are over the
N2 connection for the UE is released.

\- The MM procedures (e.g. Registration, authentication, Registration
Update, etc.) are independent from whether the UE will activate a PDU
session used in ConnectionLess (CL) mode on the interface between RAN
and Core. Thus an UE needs to Register to the network before being able
to activate a PDU session to be used in ConnectionLess (CL) mode on the
interface between RAN and Core.

\- The UE is tracked at Registration Area level and performs
Registration Updates as specified.

\- The UE uses the same SM procedures to manage (set-up, release, etc.)
a PDU session regardless of whether this PDU session is to be used in a
Connection Oriented (CO) or in a ConnectionLess (CL) mode on the
interface between RAN and Core.

\- During the PDU session set-up procedure some parameters specific to
the CL data transfer are nevertheless exchanged between the UE and the
network.

\- The solution is not technically dependent on any particular UE
category. A UE that supports CL user plane and the additional CL
parameters exchanged during the establishment of a PDU session may
request CL PDU Session establishment, and the SMF authorises the request
based on subscription data.

\- A PDU session that has been established with CL data option may also
be alternatively used as a CO PDU session. It would be technically
possible to prevent this, but it would require additional logic to
reject the UE request for DRB on CL PDU Session.

\- The RAN-Core interface works in ConnectionLess (CL) mode for UP (User
Plane) delivery: once the PDU session has been established, the UE is
able to send and to receive data without any need to first set-up a
connection on N2 or N3. All user plane traffic is carried over an N3
tunnel that can be shared by all active connectionless mode UEs that are
currently being served by the same RAN node and the same PDU session
type on the same UPF. The shared N3 tunnel works as follows:

\- If there is no shared N3 tunnel between the UPF and the RAN node
serving the UE when the N3 tunnel is established, then the SMF
establishes a shared N3 tunnel and identifies it as a shared tunnel that
can be re-used by other CL UEs served by the same RAN node.

\- If there is already a shared N3 tunnel between the UPF and the RAN
node when the N3 tunnel is established, then the SMF re-uses the
existing shared N3 tunnel.

\- The (re-)use of the shared N3 tunnel is determined based on the UE
requesting CL PDU session, which implicitly indicates the UE capability
to send and receive CL data.

\- AN Release procedure related with one of the UEs using the shared N3
tunnel does not release the shared N3 tunnel, but only removes the
affected UE from the users of the shared N3 tunnel.

\- AN Release procedure related with the last remaining UE using the
shared N3 tunnel releases the shared N3 tunnel.

\- The CL procedure is only used over N3. The existing N9 procedures are
re-used without any modification related with CL procedures.

\- The support of the ConnectionLess (CL) mode on the interface between
RAN and Core is independent of the nature of the data being carried in a
PDU session (IPv4, IPv6, non IP).

\- When the UE needs to send data (assuming the UE is already registered
to the network and has established a PDU session):

\- There is no N2 signalling exchange dedicated to the UE between the
RAN and the Core.

\- There is no N3 data plane connection dedicated to the UE between the
RAN and the Core.

\- As there is no signalling exchange dedicated to the UE between the
RAN and the Core, the RAN gets no security material dedicated to the UE.
Thus the security and the header (de)compression of the user plane
traffic are handled in the 5GC (in the UPF part of the 5GC). The
corresponding parameters (e.g. security algorithms, compression
algorithms, etc.) are negotiated between the UE and the AMF/SMF at PDU
session set-up.

Editor\'s note: Any potential security impacts on signalling exchanges
between the RAN and the UE in order to re-use of the security parameters
in the stored UE context is to be studied by SAWG3.

\- As the Core network User plane Function (UPF) needs to decipher data
received from a UE via the RAN, the UL (uplink) data are sent by the UE
together with a non ciphered PDU session identifier allowing the UPF to
retrieve the deciphering context of the PDU session.

\- As the RAN needs to route Uplink (UL) traffic from the UE towards the
UPF, the UE needs to put packet forwarding information in its UL traffic
allowing the RAN to determine the relevant UPF.

\- The 5GC provides via NAS signalling UPF CL Service information
(UCLSI) to the UE: For DL traffic, UCLSI is associated with the UE RAN
identifier and for UL traffic, it indicates the packet forwarding
information allowing the RAN to determine the UPF. This information is
provided on a per PDU session basis.

\- The 5GC provides UCLSI information to the UE at least upon UE request
for a PDU session set-up. This information needs also to be provided to
the UE when the UPF that supports the PDU session of the UE has been
changed.

\- If UPF indicated by UCLSI is not known by RAN, then RAN uses a DNS
procedure based on the UCLSI prefix to determine forwarding information
to the UPF.

\- When the UPF receives UL traffic with a PDU session identifier for
which it has no corresponding context, the UPF fetches the corresponding
information from the AMF/SMF.

\- The UPF keeps track of the RAN from which it last received UL traffic
from a UE and associates this information with a UE Location Freshness
Timer. As long as the UE Location Freshness Timer has not elapsed, the
UPF sends DL (Downlink) traffic for an UE towards the RAN from which it
last received UL traffic from this UE. The DL data are sent by the UPF
towards the RAN together with a non ciphered UE identifier. If the RAN
can\'t deliver the PDU (the UE may have moved in the mean time) the RAN
deletes the PDU and notifies the UPF that removes the relationship
between the UE and the RAN.

\- The network may use the expiry of the UE Location Freshness Timer as
a trigger to re-authenticate the UE.

\- When the UPF needs to send DL data towards an UE, and the UE Location
Freshness Timer has elapsed, the UPF may request the AMF/SMF to page the
UE. The AMF/SMF pages the UE in the Tracking Area List where it is
registered.

\- The timer values may be set to default timer values. The timer value
of the UE Location Freshness Timer is determined by the network taking
into account the UE subscription.

\- The UE mobility relies on cell reselection, not on network controlled
Hand-Overs and the UE may send a dummy UL data message to the UPF to
refresh the UPF-RAN binding for the UE.

Editor\'s note: The security aspects related with this solution need to
be studied by SAWG3.

The architecture for Data transmission with ConnectionLess RAN-Core
interface consists of the following network elements (fig 6.29.2-1):

\- User equipment (UE).

\- Radio Access Network (RAN).

\- User plane Gateway (UPF).

\- Core control plane (AMF and SMF).

![](media/image96.wmf){width="6.675694444444445in"
height="2.2291666666666665in"}

Figure 6.29.2-1: Architecture to support PDU sessions with
Connectionless mode transfer on the RAN-Core interface

The User plane protocol stack is derived from the baseline connection
oriented protocol stack with the UE-RAN layer PDCP slit between lower
and upper parts:

\- SDAP layer: This layer, placed between IP and access stratum, links
UE and UPF, provides mapping between a QoS flow and a connectionless PDU
session.

\- PDCP Upper: This layer, placed between IP and access stratum, links
UE and UPF, provides encryption and integrity protection between the UE
and the network. The PDCP Upper UP layer takes care to avoid packets
duplication (Sequence Numbering). The PDCP security procedure and
detection of duplicated messages are executed as in CO case with these
PDCP functions located in the UPF.

\- PDCP Lower: This layer, placed between the UE and RAN, provides PDU
session identification at RAN level.

\- Core CLS Relay: This layer, placed between the RAN and UPF, provides
relay of the PDU session identification and multiplexing of multiple PDU
sessions over a N3 link between an UPF and an AN Node.

![](media/image97.wmf){width="5.688888888888889in"
height="2.2708333333333335in"}

Figure 6.29.2-2: User Plane Protocol stack for Connectionless mode
transfer on the RAN-Core interface

Figure6.29.2-2 shows the layers that are involved in CL data transfer.
CL re-uses the existing protocol layers, and it adds the CLS Core Relay
layer. Following layers are to be defined by RAN groups:

\- PDCP Lower.

\- RLC: Radio control sublayer (responsible for segmentation and ARQ).

\- MAC: Media Access control (responsible for connectionless access and
HARQ).

\- PHY: Physical Access.

\- CLS Core relay: CL data relay layer.

Editor\'s note: The protocol stacks over N3 is to be defined together
with RAN groups.

### 6.29.3 Support of EPC interworking

Connectionless (CL) mode is only supported in 5GC, but not in EPC. It is
only possible to initiate CL PDU session in 5GC. Mobility between EPC
and 5GC is supported, but if a CL PDU session is transferred to EPS PDN
connection, it will only work in Connection Oriented (CO) mode The
existing UPF may be maintained as CO anchor and so IP address continuity
would be assured.

### 6.29.4 Procedures

#### 6.29.4.1 Identities

##### 6.29.4.1.1 UPF CL SERVICE Id (UCLSI)

UCLSI is used by UE, RAN and UPF to identify a PDU session with
Connectionless mode data transfer on the RAN-Core interface. This
identifier contains an Identifier of the UPF serving the PDU session and
a local identifier for a specific connectionless PDU session for a
specific UE. RAN uses UCLSI to derive the UPF that should handle Data
exchanged with the UE. A UE may be allocated one or more UCLSI on one or
more UPF, each UCLSI corresponding to a unique PDU session.

#### 6.29.4.2 Assumptions

\- The AMF/SMF has to select an UPF that supports PDU sessions with
Connectionless mode data transfer on the RAN-Core interface. The UPF
selection procedure takes also into account the specific parameters
(e.g. security algorithms, compression algorithms,\...) proposed by the
UE at PDU session set-up.

\- The UPF manages a state per UCLSI. The UCLSI state can be:

\- REACHABLE: The UCLSI is marked as REACHABLE when the UPF knows the
identity of the RAN serving that UCLSI as the last correctly received UL
PDU from the UE has been received by the UPF via this RAN. The UCLSI
REACHABLE state is controlled by a freshness timer at the expiry of
which the UCLSI state becomes IDLE. The Timer is (re)started at the
reception of each UL PDU correctly received from the UE on that UCLSI.

\- IDLE: The UPF does not know the identity of the RAN serving that
UCLSI. Paging is required to send DL PDU for this UCLSI.

\- The RAN is assumed to also run a UE Location Freshness timer for
UCLSI availability. The Timer in the UPF is assumed to be shorter than
the timer in RAN.

\- The RAN and UPF set their UE Location Freshness timer to default
value. The UE receives its timer value at CL PDU session establishment
time.

#### 6.29.4.3 Procedures

##### 6.29.4.3.1 Set-up of a PDU sessions with Connectionless mode data transfer on the RAN-Core interface

This procedure is used to establish PDU sessions with Connectionless
mode data transfer on the RAN-Core interface. Procedure is re-using
TS23.502\[7\] clause4.3.2.2 UE Requested PDU Session Establishment
with the following additions.

![](media/image98.wmf){width="6.489583333333333in" height="8.56875in"}

Figure 6.29.4.3.1-1: UE-requested PDU Session Establishment for
non-roaming and roaming with local breakout

The procedure assumes that the UE has already registered on the AMF thus
unless the UE is Emergency registered the AMF has already retrieved the
user subscription data from the UDM.

1\. Additionally to Step 1 actions in TS23.502\[7\] clause4.3.2.2.1,
the UE may indicate CL PDU session request in the Request Type.

2\. Additionally to Step 2 actions in TS23.502\[7\] clause4.3.2.2.1,
if the Request Type indicates CL PDU Session, then the AMF selects an
SMF that supports CL PDU Sessions.

3\. Additionally to step 3 in TS23.502\[7\] clause4.3.2.2.1, the AMF
includes the CL indication in the request that it forwards to SMF.

4\. Additionally to step 4 in TS23.502\[7\] clause4.3.2.2.1, the SMF
considers also the CL subscription information when authorising the PDU
session set-up, and responds to SMF.

5-7. As in TS23.502\[7\] clause4.3.2.2.1 steps 5-7.

8\. Additionally to the criteria in step 8 of TS23.502\[7\]
clause4.3.2.2.1, the SMF takes also the UPF ability to support CL
signalling into account when selecting UPF. SMF chooses a UPF CL SERVICE
Id (UCLSI) that identifies the PDU session and the UPF and gets from the
AUC the keys to be used on the user plane link between the UPF and the
UE. The UCLSI includes a UPF prefix for DNS query of the UPF IP address.

Editor\'s note: The derivation of the keys to be used between UE and UPF
is to be defined at SAWG3. It should consider the master Key output of
the last authentication as well as the UCLSI and the Direction of the
traffic.

9\. As in TS23.502\[7\] clause4.3.2.2.1 step 9

10\. Additionally to Step 10 actions in TS23.502\[7\]
clause4.3.2.2.1, if the UE requested for CL PDU session in step 1 and
the request is accepted by the network, the SMF includes also the CL PDU
session indication and the UCLSI in the session establishment indication
to the UPF.

11\. Additionally to Step 11 actions in TS23.502\[7\]
clause4.3.2.2.1, the SMF includes the UCLSI to be used in this PDU
session. If shared N3 tunnel does not exist yet, then the SMF creates
it.

12\. Additionally to Step 12 actions in TS23.502\[7\]
clause4.3.2.2.1, the AMF indicates acceptance of CL PDU session and
includes the UCLSI.

13\. Additionally to Step 13 actions in TS23.502\[7\]
clause4.3.2.2.1, RAN selects appropriate RAN connectionless mechanism
and sends associated RRC message to UE along with NAS message from SMF
providing PDU session set-up response.

\- The UE calculates the key for the security association with UPF based
on the same algorithm and on the same input parameters than used by the
Core control plane (SMF) in step 10.

\- UE may use the connectionless service to complete the user plane
configuration (e.g. Router solicitation / IP address assignment, header
compression initiation (if any), etc.).

\- The UE stores the UCLSI for later use.

14-20. As in the corresponding steps in TS23.502\[7\]
clause4.3.2.2.1.

##### 6.29.4.3.2 UE connectionless uplink data transfer

![](media/image99.wmf){width="5.115277777777778in" height="3.8625in"}

Figure 6.29.4.3.2-1: UE triggered uplink connectionless transfer

Pre-conditions:

\- The UE has uplink connectionless data (a PDU) to send on one of its
already established PDU sessions with Connectionless mode data transfer
on the RAN-Core interface.

\- The UE is currently under coverage of a radio cell that supports
current connectionless mechanism configuration.

1\. The UE ciphers the PDU to transmit. The UE then puts the previously
assigned UCLSI in the CLS UP data header and adds an integrity check
signature.

UE access stratum may replace the UCLSI with a shorter identifier if
available from RAN and UE RAN freshness timer has not expired.

\- The UE sends uplink connectionless data transfer to the RAN using
current configured connectionless mechanism.

NOTE1: The integrity check signature is to prevent another UE from
injecting traffic on the PDU session. It is calculated on the UCLSI and
ciphered PDU, not on any shorter RAN identifier possibly used instead
the UCLSI on the air interface.

2\. RAN sends ack to the UE.

RAN resets UE Location Freshness Timer for UCLSI and stores the mapping
between the UCLSI and the UE RAN identifier.

The UE resets the UE UCLSI Location Freshness Timer.

3\. If UPF indicated by UCLSI is not known by RAN then the RAN node
constructs FQDN based on UPF prefix contained in the UCLSI, and obtains
the destination UPF address via DNS procedure.

NOTE2: This step takes place only for the first user served by the RAN
that is handled by a new UPF.

4\. Based on the received UCLSI, the RAN forwards all complete data PDUs
with header including UCLSI and integrity check to UPF over appropriate
transport interface (N3).

5\. Using the UCLSI, the UPF retrieves the context of the PDU Session.
If such context is not available the UPF may send a query to the Core
control plane (SMF).

6\. Using stored key UPF verifies the integrity check signature and
decrypts incoming uplink data.

If the Integrity check is negative the UPF silently discards the data.
Otherwise, (when needed) the UPF decompresses the PDU header.

The UPF learns that UE is available on a given RAN (the UCLSI state is
REACHABLE): the UPF (re)starts UE Location Freshness Timer for the UCLSI
and stores the UCLSI to RAN transport interface mapping.

7 The UPF forwards the PDU towards its destination.

8 Optionally, if requested during PDU session establishment, the UPF may
acknowledge the outcome of the procedure in a DL CL message, see
clause6.29.4.3.3.

##### 6.29.4.3.3 UE connectionless downlink data transfer

![](media/image100.wmf){width="5.115277777777778in" height="3.8625in"}

Figure 6.29.4.3.3-1: Downlink connectionless transfer

Pre-conditions:

\- The UE has previously established a PDU session with Connectionless
mode data transfer on the RAN-Core interface.

1\. The UPF receives downlink incoming data (a PDU).

2\. The UPF retrieves the UCLSI corresponding with the PDU session:

\- if the UCLSI state of the PDU session is marked as \"REACHABLE\", the
UPF uses the last known RAN serving this UCLSI.

\- The UPF compresses the IP header (when needed), encrypts the data,
adds an integrity check signature and selects the appropriate downlink
RAN transport interface for the UCLSI.

\- The UPF restarts UE Location Freshness Timer for UCLSI.

\- if UCLSI state for the PDU session is \"IDLE\" then the UPF may
either drop packet or initiate network page. This behaviour is
controlled by a policy received from Core control plane (SMF) itself
possibly depending on subscription.

\- The UPF sends a paging request for the UCLSI to Core CP, buffers the
data and starts a paging timer. Core CP triggers the corresponding
paging by the RAN. If the page response from UE arrives before the
paging timer times out, then the UPF learns current RAN serving the UE
and forwards the data via this RAN. This is further detailed in
clause6.29.4.3.4.

3\. (assuming UCLSI state is marked REACHABLE) the UPF adds the UCLSI in
the header and forwards the data over the downlink RAN transport
interface for the UCLSI that was selected in step 2. For any downlink
incoming data, RAN matches downlink UCLSI:

\- if UCLSI is known to RAN then RAN transmits the data to UE:

\- if UE transfer is successful, RAN restarts UE Location Freshness
Timer for UCLSI.

\- if UCLSI is not known to RAN (e.g. RAN previously had UE transfer
fail or after RAN UE freshness timer for UCLSI expires) then RAN drops
the data and sends NACK to UPF.

\- if UPF receives NACK from RAN (e.g. the UCLSI was known but transfer
failed or UCLSI was not known) then UPF clears UPF UE freshness timer
and so marks UCLSI state as \"IDLE\" (the UCLSI is no more associated
with any RAN Node).

4\. The RAN transmits the data to UE based on the UE identification
corresponding with the UCLSI.

\- if UE transfer fails, RAN drops packet, sends NACK to UPF and deletes
its context for the UCLSI.

5\. When UE receives connectionless data, it processes the data
(re-assembles, decrypts, etc.), delivers the data to the application and
sends uplink acknowledgement. UE resets UCLSI freshness timer.

6\. If UPF UE freshness timer for UCLSI expires, UPF marks UCLSI state
as \"idle\".

7\. If RAN UE freshness timer for UCLSI expires, RAN deletes UCLSI.

8\. If UE freshness timer for UCLSI expires or UE reselects a new cell,
UE returns to connectionless idle state and stops monitoring downlink
channels for data reception.

##### 6.29.4.3.4 Paging for UE connectionless downlink data transfer

![](media/image101.wmf){width="5.115277777777778in" height="3.8625in"}

Figure 6.29.4.3.4-1: Paging for UE connectionless downlink data transfer

1\. The UPF receives DL data but the corresponding UCLSI state is marked
\"IDLE\" and the policy received from Core CP is to page the UE in that
case (step 2 of clause6.29.4.3.3).

2\. The UPF notifies the SM that it has no RAN context for DL data
related with an UCLSI. SMF requests (Permanent User Id; UCLSI) AMF to
Page the UE corresponding to the permanent UE identifier (IMSI)
associated with the UCLSI. The AMF retrieves the corresponding UE NAS
identifier (GUTI like) for paging.

3\. The AMF requests the RAN to page the UE and the RAN pages the UE.

4\. The UE issues a NAS Page response to the Core CP (AMF).

5\. The Core CP sends a NAS Reactivate CLS (UCLSI) to request the UE to
reactivate the UCLSI.

6\. The UE issues an UL Data request on the UCLSI (according to
clause6.29.4.3.2). The request contains in the UL CLS data Header the
UCLSI as well as an indication that the data is dummy (if the UE has no
data to send and chooses to send a dummy PDU). The UPF drops the data
(if it indicated as a dummy data) and updates the UCLSI context: The UPF
starts UE Location Freshness Timer for UCLSI and stores the UCLSI to RAN
transport interface mapping.

7\. The UPF restarts the DL data transmission according to Figure
6.29.4.3.3-1.

##### 6.29.4.3.5 Mobility support

![](media/image102.wmf){width="5.115277777777778in"
height="2.7104166666666667in"}

Figure 6.29.4.3.5-1: Mobility support

1\. The UE and UPF exchange UL and DL connectionless data.

2\. The UE detects cell change while UCLSI remains valid.

3\. The UE issues an UL Data request on the UCLSI (per
clause6.29.4.3.2). The request contains in the UL CLS data Header the
UCLSI as well as an indication that the data is dummy (if the UE has no
data to send and chooses to send a dummy PDU). RAN stores the mapping
between UCLSI and UE RAN identifier.

4\. Using the UCLSI, the UPF retrieves the context of the PDU Session.

4a. If such context is not available the UPF may send a query to the
Core control plane (SMF).

4b. The UPF verifies the integrity check signature and decrypts incoming
uplink data and drops the data (if it was indicated as a dummy data) and
updates the UCLSI context: the UPF restarts UE Location Freshness Timer
for UCLSI and stores the UCLSI to RAN transport interface mapping.

##### 6.29.4.4.6 UPF Triggered Release and Redirection During UE Connectionless Active Mode

![](media/image103.wmf){width="5.115277777777778in"
height="2.4583333333333335in"}

Figure 6.29.4.4.6-1: UPF Initiated Release and Redirection

1\. The UE and UPF exchange UL and DL connectionless data.

2\. The UPF detects need for session release (security violation, UE
traffic profile violation, gateway overload protection, etc.).

3\. The UPF sends connectionless release request to the Core-CP (SM)
with session identifier UCLSI. The UPF provides a release cause
indication.

4\. The Core-CP (SM) sends connectionless release request to the UE with
session identifier UCLSI. The Core-CP (SM) provides information on the
release cause indication and whether or not the network requires that UE
request re-establishment of the PDU session using CL and/or CO mode.

### 6.29.5 Impacts on existing entities and interfaces

#### 6.29.5.1 Impact on interfaces

The following interfaces are impacted:

N3:

\- Support for a shared N3 tunnel used to transport user data from all
active connectionless UEs on a given RAN that are assigned to the same
UPF.

#### 6.29.5.2 Impact on entities

The following nodes are impacted:

UPF:

\- support for user data encryption and integrity protection using per
UCLSI security key.

\- maintain UCLSI freshness timer and RAN node association.

\- selective trigger paging for incoming traffic addressed to UE with
expired UCLSI freshness timer.

RAN:

\- support for at least one connectionless access mechanism (i.e. data
over msg3, data over msg5).

\- maintain RAN UCLSI freshness timer and UE RAN identifier association.

\- Resolve the target UPF based on UCLSI.

UE:

\- Ability to request ConnectionLess PDU session type.

\- storing the assigned UCLSI for subsequent CL data transport.

\- support for CL data transport using UCLSI.

SMF:

\- Ability to negotiate ConnectionLess PDU session type.

### 6.29.6 Evaluation

6.30 Solution 30: NEF based infrequent small data transfer via NAS-SM
---------------------------------------------------------------------

### 6.30.1 Introduction

#### 6.30.1.1 General

This solution is built on top of Solution 1 in clause6.1 and allows the
exchange of infrequent small data via an API. The Architecture Reference
Models, Functional Description, Interworking with EPS and Procedures of
Solution 1 are taken as baseline and this solution describes the missing
details to support infrequent small data transfer via NAS-SM via NEF
between the SMF and AF.

NOTE: As captured in clause4, it is assumed that the exposure of
network capabilities towards the SCS/AS is done via NEF. In addition, as
captured in clause8.9, *when a UE is capable of switching between EPC
and 5GC, it shall only be associated with combined SCEF+NEF node(s) for
Service Capability Exposure.* Consequently, data towards SCS/AS can be
routed via a NEF+SCEF combined node.

The solution also supports exposing small data APIs for infrequent small
data transmission to the AF. The APIs are based on the NIDD APIs which
are defined for the T8 interface in TS29.122\[9\].

API usage only applies to the case where the PDU Session type is
Unstructured.

The following principles apply to this solution:

\- A PDU Session terminates at NEF.

\- The NEF exposes APIs to the AF for Small Data. The APIs are based on
the T8 APIs that were defined in Release 15.

Support for RDS is provided as described in Solution49.

#### 6.30.1.2 Architecture reference models

##### 6.1.1.2.0 General

This clauseshows the architecture reference models that support API
usage in the cases where a NAS Small Data Delivery PDU Session
terminates at a NEF.

This solution presents no Roaming Reference Architecture for the Local
Breakout case because a Small Data API service will not be exposed by
the visited network. This is in line with the architecture principle
from TS23.501\[5\] which states \"*For external exposure of services
related to specific UE(s), the NEF resides in the HPLMN. Depending on
operator agreements, the NEF in the HPLMN may have interface(s) with
NF(s) in the VPLMN*\".

APIs are exposed to the AF via the N33/Nnef reference point.

The N29 reference point will be used to send and receive small data
packets via the NEF.

##### 6.30.1.2.1 Non-roaming reference architectures

Figure 6.30.1.2.1-1 depicts a simplified service based architecture with
the entities involved in small data transfer via NEF.

![](media/image104.wmf){width="4.6875in" height="2.60625in"}

Figure 6.30.1.2.1-1: Simplified Service Based Architecture for small
data delivery via NEF (non-roaming)

##### 6.30.1.2.2 Roaming reference architectures

Figure 6.30.1.2.2-1: Simplified Service Based Architecture for small
data delivery via NEF (roaming with home routed scenario)

### 6.30.2 Functional Description

In addition to clause6.1.2, the following principles apply:

\- Support of NIDD API:

\- The NIDD API is supported for PDU sessions of type unstructured.

\- The NEF supports the NIDD API towards the SCS/AS for both non-roaming
and home-routed roaming scenarios.

\- Whether or not the NIDD API shall be invoked for a PDU session is
determined by a per DNN per S-NSSAI Invoke NEF Selection indication in
the subscription.

\- If the subscription includes an Invoke NEF Selection indication and
an NEF ID for the S-NSSAI / DNN requested by the UE, then the SMF
selects that NEF for the small data PDU session.

\- The NEF ID for a given S-NSSAI / DNN in the subscription can be
updated by means of the NIDD configuration procedure.

\- The NEF performs buffering for unstructured DL data received via the
NIDD API while the UE is unreachable.

NOTE 1: See Solution 1 for UPF based data transfer.

\- API Exposure for Small Data:

\- The NEF exposes the NIDD Configuration, MT NIDD, and MO NIDD APIs
that are described in TS23.682\[6\] on the N33/Nnef reference point.

\- Routing Unstructured Data Between the NEF and AF:

\- Consistent with the method that is used in EPS and described in
TS23.682\[6\], the NEF uses provisioned policies to map an AF Identity
and UE Identity to a DNN/S-NSSAI combination when the Reliable Data
Service is not enabled. When the Reliable Data Service is enabled, the
NEF determines the association based on RDS port numbers and provisioned
policies that may be used to map AF identities and User identity to an
DNN.

### 6.30.3 Support of EPC interworking

EPC interworking is enabled by the principles documented in clause6.1.3
with the following differences:

\- NIDD API is terminated on a co-located NEF (capable of small data
transfer) and SCEF, referred to as NEF+SCEF.

\- Idle-mode mobility from 5GS to EPS is performed as per the procedure
described in TS23.502\[7\] clause4.11.1.3.2 with the following
differences:

\- Step 5b: NEF+SCEF maps the PDU session for Data over NAS-SM to an
SCEF PDN Connection and sets the Control Plane Only PDN Connection
Indication.

\- Idle-mode mobility from EPS to 5GS is performed as per the procedure
described in TS23.502\[7\] clause4.11.1.3.3 with the following
differences:

\- AMF indicates support of CIoT Optimizations when requesting the UE
context from the MME via N26;

\- for a PDN connection for which Control Plane Only PDN Connection
Indication is set:

\- SMF selects a NEF;

\- in the case of home-routed roaming:

\- Step 14: the AMF selects a V-SMF supporting small data over NAS-SM;

\- Step 14: V-SMF selects a IWK-NEF.

\- When the Invoke NEF Selection flag is present in the UE\'s
subscription information for the PDU Session, the identified NEF will
point to an SCEF+NEF if EPC Interworking is supported.

### 6.30.4 Procedures

#### 6.30.4.1 PDU Session Establishment (non-roaming)

It takes the PDU Session Establishment procedure as described in
TS23.502\[7\], subclause4.3.2.2.1 as the baseline.

Figure 6.30.4.1-1: PDU Session Establishment enabling Data over NAS-SM
via NEF (non-roaming)

1\. The UE sends a PDU session establishment request message as SM
payload of a NAS transport message. The NAS transport message contains
PDU session ID along with other regular information e.g. DNN, S-NSSAI,
etc. if applicable.

2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs.
If the PDU Session will use NAS-SM to transfer PDUs, the AMF selects an
SMF that supports Data over NAS-SM if available for the requested DNN,
and S-NSSAI. The AMF stores the association of the PDU Session ID and
the selected SMF ID in the UE context.

NOTE 1: How the AMF determines if the PDU Session uses NAS-SM to
transfer PDUs will be determined as part of the Key Issue15 conclusion.

3\. The AMF invokes Nsmf\_PDUSession\_CreateSMContext request including
DNN, S-NSSAI, PDU Session ID. The SMF replies with an
Nsmf\_PDUSession\_CreateSMContext Response. The AMF also indicates to
the SMF if the PDU Session uses NAS-SM to transfer PDUs.

4\. The SMF registers with the UDM and retrieves the Session Management
Subscription data for the corresponding SUPI, DNN and S-NSSAI. If the
subscription includes an Invoke NEF Selection indication for the DNN and
S-NSSAI indicated by UE, the SMF retrieves the NIDD information such as
External Group Identifier, External Identifier or MSISDN, AF ID and
decides to transfer data to the DN via NEF. The SMF selects the NEF
based on the UE subscription profile.

5\. The SMF configures the NEF for data transfer. This procedure is
described in clause6.30.4.6.

6\. If NIDD configuration has been performed by the AF with the NEF,
then the procedure continues at step7. If the polices that may be used
to map SUPI, DNN, S-NSSAI and Reliable Data Service Port Numbers (if
applicable) to an AF Identity are provisioned in the NEF then the
procedure continues at step7. If NIDD configuration has not been
performed by the AF with the NEF and AF Identity is configured at NEF
then the NEF may initiate NIDD Configuration as described in
clause6.30.4.7.

If an AF identity is not been provisioned for the procedure of
clause6.30.4.7 then the PDU session establishment fails.

7\. The SMF sends a PDU Session Establishment Accept providing
indication that Data Over NAS-SM is enabled for this PDU session without
including the N2 SM container.

8\. The AMF forwards the NAS message to the UE.

#### 6.30.4.2 PDU Session Establishment (home-routed roaming)

This procedure takes the PDU Session Establishment procedure as
described in TS23.502\[7\], subclause4.3.2.2.2 as the baseline.

Figure 6.30.4.2-1: PDU Session Establishment enabling Data over NAS-SM
via NEF (home-routed roaming)

1\. The UE sends a PDU session establishment request message as SM
payload of a NAS transport message. The NAS transport message contains
PDU session ID along with other regular information e.g. DNN, S-NSSAI,
etc. if applicable.

2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs.
If the PDU Session will use NAS-SM to transfer PDUs, the AMF selectsan
SMF that supports Data over NAS-SM if available for the requested DNN,
and S-NSSAI. The AMF stores the association of the PDU Session ID and
the selected SMF ID in the UE context.

NOTE1: How the AMF determines if the PDU Session uses NAS-SM to
transfer PDUs will be determined as part of the Key Issue15 conclusion.

3\. The AMF invokes Nsmf\_PDUSession\_CreateSMContext request including
DNN, S-NSSAI, PDU Session ID. The V-SMF replies with an
Nsmf\_PDUSession\_CreateSMContext Response. The AMF also indicates to
the V-SMF if the PDU Session uses NAS-SM to transfer PDUs.

4\. The V-SMF sends the Nsmf\_PDUSession\_CreateSMContext request to the
H-SMF. The V-SMF also indicates to the H-SMF if the PDU Session uses
NAS-SM to transfer PDUs.

5\. The H-SMF registers with the UDM and retrieves the Session
Management Subscription data for the corresponding SUPI, DNN and
S-NSSAI. If the subscription includes an Invoke NEF Selection indication
for the DNN and S-NSSAI indicated by UE, the H-SMF informs the V-SMF to
transfer data to the DN via NEF.

6\. The H-SMF responds to the V-SMF.

7\. The V-SMF configures the NEF via the IWK-NEF for data transfer.

8\. The V-SMF sends a PDU Session Establishment Accept providing
indication that Data Over NAS-SM is enabled for this PDU session without
including the N2 SM container.

9\. The AMF forwards the NAS message to the UE.

#### 6.30.4.3 Mobile Originated Data Transport via NAS-SM and N6 (NEF Anchored) 

The Mobile Originated Data Transport Procedure of Solution1 (see
clause6.1.4.2) is used, with the following modifications:

\- The UPF is changed to an NEF.

\- Between steps 5 and 6, the NEF uses the MO NIDD Indication procedure
of TS23.682\[6\], clause5.13.4 to provide the data to the AF.

#### 6.30.4.4 Mobile Terminated Data Transport via NAS-SM and N6 (NEF Anchored)

The Mobile Terminated Data Transport Procedure of Solution1 (see
clause6.1.4.3) is used, with the following modifications:

\- The UPF is changed to an NEF.

\- The NEF may buffer DL data as described in TS23.682\[6\].

\- The procedure is initiated by the AF invoking the MT NIDD Submit
Request as described in TS23.682\[6\], clause5.13.3.

\- If UL Data is included in step 14, then the NEF will uses the MO NIDD
Indication procedure of TS23.682\[6\], clause5.13.4 to provide the
data to the AF.

#### 6.30.4.5 NIDD Configuration for Data Transport via NAS-SM

The NIDD Configuration procedure will take place between the AF and NEF
as described in TS23.682\[6\], clause5.13.2. The NEF uses the UDM/UDR
to authorise the NIDD Configuration.

#### 6.30.4.6 SMF-NEF Connection

Figure 6.30.4.6-1: SMF-NEF Connection Establishment Procedure

1\. UE performs steps 1-4 of PDU Session Establishment Procedure for
Data transfer over NAS-SM described in clause6.30.4.1. The SMF receives
the Session Management Subscription data for the corresponding SUPI, DNN
and S-NSSAI that is associated with an Invoke NIDD API indication, NEF
ID and NIDD information such as External Group Identifier, External
Identifier or MSISDN and AF ID.

2\. If the subscription information corresponding to DNN and S-NSSAI
includes Invoke NIDD API indication, the SMF shall create a PDU session
towards the NEF. The SMF does so by sending a Create NEF Connection
Request (User Identity, PDU session ID, NEF ID, NIDD information,
S-NSSAI, DNN) message towards the NEF. If the IWK-NEF receives the
Create NEF Connection Request message from the SMF, it shall forward it
toward the NEF.

If an AF has performed the NIDD Configuration procedure (see NIDD
configuration procedure of TS23.682\[6\]) with the NEF for User
Identity received in step2, then step3 is executed. If no AF has
performed the NIDD Configuration procedure with the NEF for the User
Identity, then the NEF initiates a NIDD Configuration by NEF procedure
(see clause6.30.4.7) with AF.

3\. The NEF creates an NEF PDU session Context for the user identified
via User Identity and PDU session ID. The NEF sends a Create NEF
Connection Response (User Identity, PDU session ID, NEF ID, S-NSSAI,
DNN) message towards the SMF confirming establishment of the PDU session
to the NEF for the UE. If the IWK-NEF receives the Create NEF Connection
Response message from the NEF, it shall forward it toward the SMF.

#### 6.30.4.7 NIDD Configuration by NEF

Figure6.30.4.7-1 illustrates the procedure for configuring necessary
information triggered by NEF for data delivery via the NIDD API.

Figure 6.30.4.7-1: NIDD Configuration by NEF Procedure

0\. UE performs steps 1-5 of PDU Session Establishment Procedure for
Data transfer over NAS-SM described in clause6.30.4.1. If NIDD
Configuration has not been performed by the AF with the NEF and AF
Identity is configured at NEF then the NEF may initiate NIDD
Configuration.

1\. The NEF sends an NIDD Configuration Trigger (External Group
Identifier, External Identifier or MSISDN, AF ID, NEF ID) message to the
AF for asking the NIDD Configuration Request for the UE identified by
External Identifier or MSISDN.

2\. The AF sends an NIDD Configuration Request message to the NEF as
described in TS23.682\[6\], clause5.13.2. The NIDD Configuration
Request includes the Authorization Token. The Authorization Token is
used for authorizing the AF by the UDM (the Authorization Token is
shared between UDM and AF during SLA).

3\. The NEF sends an NIDD Authorization Request (External Group
Identifier, External Identifier or MSISDN, S-NSSAI, DNN, AF ID,
Authorization Token) message to the UDM to authorize the NIDD
configuration request for the received External Identifier or MSISDN.

4\. The UDM examines the NIDD Authorization Request message with
Authorization Token. If this check fails, the UDM follows step5 and
provides a result indicating the reason for the failure condition to the
NEF.

5\. The UDM sends an NIDD Authorization Response (SUPI and MSISDN or
External Identifier, Result) message to the NEF to acknowledge
acceptance of the NIDD Authorization Request. The SUPI and, if
available, the MSISDN (when NIDD Configuration Request contains an
External Identifier) or if available, External Identifier(s) (when NIDD
Configuration Request contains an MSISDN) are returned by the UDM in
this message. This allows the NEF to correlate the AF request received
in step1 of this procedure with the PDU session to be established for
this subscriber if this procedure takes place during a PDU Session
Establishment procedure.

6\. The NEF sends an NIDD Configuration Response message as described in
TS23.682\[6\], clause5.13.2 to the AF to acknowledge acceptance of
the NIDD Configuration Request. If the NIDD Configuration was accepted,
the NEF assigns a TLTRI to the NIDD Configuration and creates an
association between the TLTRI, External Identifier or MSISDN, SUPI, and
PDU session ID which is received from the SMF in step 5 of the PDU
Session Establishment procedure in clause6.30.4.1. In the MT NIDD
procedure, the NEF will use TLTRI and External Identifier or MSISDN to
determine the SUPI and PDU session ID of PDU session for delivering
non-IP data. In the MO NIDD procedure, the NEF will use the SUPI and PDU
session ID to obtain the TLTRI, External Identifier or MSISDN.

### 6.30.5 Impacts on existing entities and interfaces

The same impacts indicated in clause6.1.5 apply, with the following
differences:

NEF:

\- Support for extended buffering.

\- Support for the NIDD Configuration, MT NIDD, and MO NIDD APIs as
described in TS29.122\[9\] and TS23.682\[6\].

\- Support for services on the N29 interface with the SMF for
Unstructured PDU Sessions (similar to the functionality that is
available on the N4 interface between the SMF and UPF).

### 6.30.6 Evaluation

Solution30 is part of Solution1 and allows the exchange of infrequent
unstructured small data via NIDD API. The NEF supports the NIDD API
towards the AF for both non-roaming and home-routed roaming scenarios.
The same pros and cons of Solution1 apply.

This solution successfully addresses Key Issues1 (Support API(s) for
infrequent small data transmission and capability exposure to AF).

6.31 Solution 31: Deferring of Periodic Registration Update
-----------------------------------------------------------

### 6.31.1 Introduction

This solution applies to Key issue 4 (Power Saving Functions) as
maximize sleeping period of the UE when the UE applies extended idle
mode DRX.

During in idle mode period (i.e. CM-IDLE), UE repeatedly performs paging
monitoring procedure in every Paging Occasion to check incoming call.
Also, UE shall perform periodic Registration Update procedure to update
reachability with AMF. In other words, major jobs of the UE in idle mode
period is that paging reception and periodic Registration Update. It is
clear that maximization of idle period is important for the extreme
power saving requirements. The time for paging reception is an
appointment between UE & eNB (absolute time calculation) so it can\'t be
changed. However, the time for periodic Registration update is an
appointment between UE & AMF. Therefore the time for Registration update
is adjustable if the AMF is aware & allowed of this.

### 6.31.2 Functional Description

When the AMF configures idle mode eDRX via NAS procedure (i.e.
Registration Update), the AMF can additionally provide the applicability
of \"Deferring of Periodic Registration Update\" for further power
saving. If the UE receives the indication, the UE can defer the time for
next Registration Update procedure to the nearest Paging Occasion time
when the periodic Registration Update timer is expired. So the UE can
avoid waking-up twice when the time for paging reception and the time
for execution of Registration Update is adjacent.

If the AMF indicates to use \"Deferring of Periodic Registration
Update\", then the AMF should respect the UE\'s behaviour for deferring
of periodic Registration Update. Therefore the AMF should take the eDRX
period into account when the AMF calculates mobile reachable timer.
Support of the \"Deferring of Periodic Registration Update\" is optional
both for UE and AMF.

Editor\'s note: whether this batching of periodic registration update
and paging reception is covered by implementation is FFS.

### 6.31.3 Support of interworking

Editor\'s note: This clausedescribes if and how EPC-5GC interworking is
supported in this solution.

### 6.31.4 Procedures

Figure 6.31.4-1 illustrates the procedure of configuring of Deferring of
Periodic Registration Update.

![](media/image110.wmf){width="6.468055555555556in"
height="3.4368055555555554in"}

Figure 6.31.4-1: Configuration of Deferring of Periodic Registration
Update

1\. The UE may indicate capability of \"Deferring of Periodic
Registration Update\" while the UE is performing NAS procedures (i.e.
Registration) along with desired idle mode eDRX parameters for power
saving.

2\. If the AMF accepts the usage of Deferring of Periodic Registration
Update, the AMF should indicate this via Registration Accept message.

3a. The UE determines the next periodic Registration Update time. If the
Deferring of Periodic Registration Update indicated by the AMF, the UE
can defer the time for next Periodic Registration Update procedure to
the time for nearest Paging Occasion.

Editor\'s note: Necessity of the indication \"Deferring of Periodic
Registration Update is required\" by a UE is FFS.

3b. The AMF applies eDRX period to set Mobile Reachable Timer and
control of PPF (Paging Proceed Flag).

### 6.31.5 Impacts on existing entities and interfaces

Editor\'s note: This clausedescribes impacts to existing entities and
interfaces.

In the AMF:

\- Considering eDRX period for Mobile Reachable timer handling.

In the UE:

\- Indicating the capability of Deferring of Registration Update to AMF.
Also adjust (defer) the execution time for next periodic Registration
Update to the time for nearest PO.

### 6.31.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.32 Solution 32: MO Data Buffering in the UE
---------------------------------------------

### 6.32.1 Introduction

This clausepresents a solution for Key Issue 5 - UE Tx Power Saving
Functions.

This solution is suitable for UEs whose traffic patterns can be
characterized as non-delay sensitive or high-latency. For example, many
IoT applications are characterised by the fact that they collect data
and send the data to one or more AF(s) (i.e. SCS/AS(s)) in a delay
tolerant manner; e.g. they collect data and it is acceptable if the data
is not sent to the SCS/AS(s) until hours after it is collected.

The premise of the solution is that when a delay tolerant application on
the UE decides to initiate MO traffic and the UE is in RRC Idle Mode,
the UE may decide to delay establishing an RRC Connection and
transmitting the MO data until the UE decides that it can be sent with
relatively low power. For example, when the UE is in good coverage, is
able to use a non-3GPP AN, or is in a particular location.

### 6.32.2 Functional Description

The following principles apply to this solution:

\- In order to minimize UE power consumption, the UE delays establishing
an RRC connection for sending MO data until it is able to transmit with
relatively low power. Thus, MO data might not be sent when the data is
collected. The UE may send the data when conditions are suitable to the
UE and without regard to whether the AF(s) (i.e. SCS/AS(s)) are ready to
receive the data.

Editor\'s note: It is FFS how the UE determines that traffic is delay
tolerant (e.g. it may be implementation dependent and not specified,
configured via OMA DM, OMA LwM2M, UICC Application Configuration, or
configured NAS/AS signalling).

Editor\'s note: It is FFS how and when the UE decides to begin
transmitting (e.g. it may be implementation dependent and not specified
or configuration dependent (e.g. configured signal quality threshold,
configured AN type, configured location)).

### 6.32.3 Support of EPC interworking

Editor\'s note: This clausedescribes if and how EPC-5GC interworking is
supported by this solution.

### 6.32.4 Procedures

Figure 6.32.4-1 shows the procedure for delaying MO data until it can be
transmitted with relatively low power.

Figure 6.32.4-1: Procedure for Buffering MO Data in the UE

1\. An application on the UE collects data.

NOTE: If there are multiple UE applications, they may collect data
separately or in a coordinated manner.

2\. The UE delays initiating MO data because it is in weak coverage. How
the UE ultimately decides when to send the MO data is implementation
and/or application dependent and is not specified.

3\. The UE sends the application data to the AF.

### 6.32.5 Impacts on existing entities and interfaces

Editor\'s note: This clausedescribes impacts to existing entities and
interfaces.

### 6.32.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.33 Solution 33: Delayed Paging Response
-----------------------------------------

### 6.33.1 Introduction

This solution propose a solution for Key Issue 5 - UE Tx Power Saving
Functions.

UE transmitting power is sensitive to the link quality, for example, the
UE\'s transmitting power needed is about 100 times higher when RSRP is
-100dBm compared to when RSRP is 80dBm. In the current mechanisms, when
a page arrives, the UE will attempt to transmit the page response in any
coverage condition, e.g. in good, in weak coverage, or even in enhanced
coverage. When in weak coverage, UE might transmit with maximum TX
power, and maybe try many times; when in enhanced coverage, UE will
repeat the TX signal tens or hundred times, all of which consume
significant amount of UE battery power.

Some IoT devices or applications are delay tolerant i.e. the data
exchange is not urgent, (e.g. IoT device software update, advertisement
push, notification message etc). This solution intends to avoid the UE
responds the paging in a very bad coverage, which would consumes much
more UE battery power.

This solution targeting moving mobile terminals and may not be applied
to stationary mobiles for which coverage is unchanged most of the time.

### 6.33.2 Functional Description

This clausedescribes a solution for delayed response to the paging by
the UE when paged for delay tolerant services. A UE capable of delayed
paging response indicates its capability for delayed paging during
registration and the UE is allocated a delayed paging response window.
The AMF can obtain the delayed paging response window from the specific
AF which UE subscribes. When such a UE is paged with indication for
delayed paging and the radio coverage conditions are poor, the UE may
decide to delay the transmission of the response to the paging until
radio conditions improve, while still within the delayed paging response
window.

Some assumptions and requirements are made:

1\) The AF may subscribe for delayed paging service so that it is
notified when the UE responds to the paging.

2\) The AMF can determine the delayed paging response window from the
subscription data.

3\) The AMF can obtain the delay tolerant information via the
Namf\_Communication\_N1N2MessageTransfer service operation related to
the incoming downlink data.

4\) The AF or the UPF can buffer the downlink data so it is available at
least during the delayed paging response window.

5\) The mechanism to establish the PDU Session and data transmission
depends on the solution defined in other key issues.

6\) The UE monitors all paging occasions (POs) including POs within the
delayed paging response window. In case the UE uses the eDRX feature the
UE monitors only the PO\'s scheduled within the PTW that was received
during eDRX negotiation.

### 6.33.3 Support of EPC interworking

Not applicable since there is no corresponding mechanism specified in
EPC.

### 6.33.4 Procedures

![](media/image112.wmf){width="6.690972222222222in"
height="3.8944444444444444in"}

Figure 6.33.4-1: Paging for delay tolerant UEs and applications

1\. An AF may subscribe with the SMF/UPF/AMF for delayed paging
response, e.g. to be notified when the UE responds to delayed paging.
The AF may also provision the delayed tolerant service level information
via the NEF, this information is used by the AMF to determine the
delayed paging response window.

2\. UE initiates Registration Request, indicating to the AMF that UE is
delayed paging capable.

3\. The AMF obtains UE subscription information to verify the UE
attributes and the subscribed service characteristic information. The
AMF may obtain a delayed paging response service information from the
subscription information.

4\. The AMF accepts the registration request from the UE and returns
delayed paging response window. The AMF shall take into account the
subscription information when determining the delayed paging response
window.

5\. When an AF wants to exchange delay tolerant data with a UE, the AF
invokes downlink Nnef\_DataTransfer (external UE Id,
delayed\_paging\_ind). The delayed\_paging\_ind parameter is present
when the AF request is for delayed paging.

6\. The NEF derives the UE identity from UE\'s External identifier and
triggers Namf\_Communication\_N1N2\_message\_transfer service operation.

7-8. When AMF receives the Namf\_Communication\_N1N2MessageTransfer with
delayed paging indication, the AMF sends paging message to the UE with
delayed paging indicator. The AMF may page the UE in registration area
granularity in order to avoid the case where the UE has moved out of the
paging area, e.g. the last known cell or tracking area. The AMF can also
page the UE within a narrower area (e.g. the cell list) than the
registration area in order to save paging overhead, and if the AMF does
not receive UE paging response during the delayed paging response
window, AMF can re-page the UE in the whole registration area.

9-10. After receiving the paging message with delayed paging indication,
the UE may delay the response to the paging if current radio conditions
are not good (based on UE implementation or radio signal quality
thresholds configured in the UE via OMA DM, for example) until better
radio conditions within the delayed paging response window. If signal
quality thresholds are used for the UE to decide when the radio
condition are good or not good, the operator may configure the UE with
lower signal quality thresholds so that the UE employs the paging delay
behaviour only when the current radio coverage is really bad or the
worst coverage (e.g. the UE is close to cell borders or coverage hole).
This way the UE\'s chances to get better radio coverage conditions
before the delayed paging response window expires are much higher.

NOTE1: If a UE, based on implementation, is determined to be temporary
stationary, then the UE may decide not to delay the page response even
if the radio conditions are not good.

11\. The expected Paging Response/Service Request from the UE is
received within the delayed paging response window. If the paging
response is not received after the delayed paging response window timer
expires, AMF will fall back to normal paging and will re-page the UE
with normal paging.

12\. The AMF notifies the AF about the UE response to the delayed
paging.

NOTE2: If the UE receives a normal paging message during the delayed
paging response window, the UE shall respond to this paging message. All
pending DL data can then be delivered including the DL data that
triggered the delayed paging message.

### 6.33.5 Impacts on existing entities and interfaces

NEF:

\- New API allowing the AF to provision the network via the NEF with
delayed tolerant service requirements.

AMF:

\- AMF to support the new function of delayed tolerant paging response
window e.g. acquire new subscription info, determine the window size,
and provision the delayed paging response window to the UE during
Registration procedure.

RAN:

\- The Uu Paging message need to include one new bit, the \"delayed
paging indicator\", so the UE can differentiate whether the page is for
delay tolerant DL data or not.

UE:

\- UE to support delayed paging capability indication within the
Registration Request message and the new behaviour associated with this
feature.

### 6.33.6 Evaluation

In case the UE can delay the page response and corresponding
communication until the radio channel improves, the UE can save power.
However, there is no guarantee that the radio channel will improve
during the delayed paging window, the radio channel could even
deteriorate and make the power consumption worse. Based on UE
implementation, the UE needs to evaluate the opportunity/risk and
determine whether to perform the delayed page response taking into
consideration e.g. the added power consumption while monitoring the
radio channel and the expected mobility.

6.34 Solution 34: Provisioning of UE TX power saving parameters
---------------------------------------------------------------

### 6.34.1 Introduction

This solution addresses the Key Issue\#5 - \"UE TX Power Saving
Functions\" and Key Issue \#13 - \"Support for Expected UE Behaviour\".

### 6.34.2 Functional Description

UE TX power saving is intended to optimize the power consumption of UE
when in bad or weak coverage. This solution has following feature -

1\. UE applying TX power saving feature are assumed to be Delay Tolerant
UEs. Such UE shall be configured as Delay Tolerant, or for Low Access
Priority, or Unified Access Control Access Priority 1.

2\. UE determines bad/weak coverage based on locally configured minimum
signal quality threshold i.e. if the serving cell signal drops below a
configured minimum signal quality threshold. UEs supporting Enhanced
Coverage may derive configured minimum signal quality threshold from CE
Mode A & B criterion. For NB-IoT UEs CE level 1 or CE level 2 criterion
can be used to determine minimum signal quality threshold.

3\. Such UE is provisioned with the following UE TX power saving
parameters -

\- **MO Data buffering Indicator** - This indicates if MO data buffering
is enabled or disabled in the UE when the UE is in bad or weak coverage
condition.

\- **MO Data Buffer Timer** - Maximum Time for MO data buffering i.e.
maximum time for transmission delay. This timer is started when UE has
MO data to send. If running, this timer is stopped when the UE is in
good coverage. On expiry of this timer UE may transmit buffered MO data
even if coverage condition is not improved.

In addition, following parameters may also be provisioned:

\- **Suggested number of MO PDU to buffer** - Indicated suggested
maximum number of MO PDUs to be buffered by the UE. In absence of this
parameter number of MO PDUs to be buffered is left to the UE
implementation.

\- **Exception Data buffering Indicator** - This indicates whether or
not to also buffer Exception data when the UE is in bad or weak coverage
conditions.

4\. UE TX power saving parameters may be pre-configured in the UE (e.g.
at manufacturing) or by using OTA mechanisms.

5\. UE TX power saving parameters may be included part of Expected UE
Behaviour parameters specified in clause4.15.6.3 of TS23.502\[7\].
Similar to Expected UE Behaviour parameters, UE TX power saving
parameters may be provisioned in AMF from AS/AF via NEF (as specified in
clause4.15.6 of TS23.502\[7\]). AMF provides these parameters to the
UE via Registration or Configuration Update procedure.

### 6.34.3 Support of EPC interworking

No additional impact for EPC interworking. UE that supports connectivity
to both EPC and 5GC can be configured with UE Tx power saving parameters
and can apply those for MO data buffering when in bad/weak coverage.The
UE Tx power saving parameters only apply when the UE is connected to the
5GC.

### 6.34.4 Procedures

5GS may expose the capability of UE TX power saving towards external
AF/AS, NEF may provide APIs that allows external AF/AS to control UE TX
power saving parameters. UE TX power saving parameters may be included
part of Expected UE Behaviour parameters specified in clause4.15.6.3 of
TS23.502\[7\]. Similar to Expected UE Behaviour parameters, UE TX
power saving parameters may be provisioned in AMF from AS/AF via NEF (as
specified in clause4.15.6 of TS23.502\[7\] and Solution 15: External
parameter provisioning in the 5GC). AMF sends UE TX power saving
parameters to the UE via registration or configuration update procedure.
UE TX power saving parameters value provided by the network overrides
any pre-configured value in the UE.

### 6.34.5 Impacts on existing entities and interfaces

UE:

\- Configuration of UE TX power saving parameters for MO data buffering
as specified in clause6.34.2.

NEF:

\- Capability exposure via API to allows external AF/AS to control UE TX
power saving parameters.

AMF:

\- For external parameter provisioning there is no additional impact on
top of solution15.

### 6.34.6 Evaluation

In order to minimize the impact on the network interfaces the solution
allows pre-configuring UE TX power saving parameters in the UE. For the
scenarios that require 3^rd^ party application server /function to have
control, UE TX power saving parameters can be exposed via NEF APIs. It
is expected that NEF APIs are not used to frequently update UE TX power
saving parameters else it may lead to signalling overload in the 5GS.
However this aspect is not specific to this solution and applies in
general to any external parameter provisioning in the 5GC (covered in
solution\#15 and solution\#26).

6.35 Solution 35: Small data delivery
-------------------------------------

### 6.35.1 Introduction

This solution addresses key issue \#1, Infrequent Small data
communication, key issue \#2, Frequent Small data communication, and key
issue \#9 Support of common north-bound APIs for EPC-5GC Interworking.
This solution enables the NEF to support the same NIDD API for both UP
and CP data. If the 3rd party Application Server has to select different
NEFs just because the small data is routed over the UP or the CP path to
the UE, the route inside the 3GPP network would not be transparent to
the Application Server.

### 6.35.2 Functional Description

#### 6.35.2.1 Architecture

The 5GS is assumed to support functions for small data communication
corresponding to EPS. These EPS functions are aka \"NIDD procedures\"
and involves transmission either using the T8 API (see TS23.682\[6\],
clause5.13) or directly over the SGi (see TS23.401\[4\],
clause4.3.17.8.3.3).

To support small data communication using an API corresponding to T8
NIDD API, this solution uses NEF which supports the T8 NIDD API and a
UPF. The UPF supports small data delivery via user plane connectivity to
NEF. Optionally the UPF can be co-located with a NEF. The NEF supports
an NIDD API, common for EPC CIoT and 5G CIoT, on the northbound
interface. The Small data function is also referred to as \"UPF-NEF\" in
figures below.

The figure 1 below shows two approaches to support frequent small data
communication with the SCS/AS, either:

\- using T8 NIDD API; or

\- directly over N6.

The former refers to the NIDD API over T8 interface specified in
TS23.682\[6\].

Roaming is supported by using UPF in VPLMN and in HPLMN connected with
N9 interface as shown in Figure6.35.2.1-2 below.

This solution includes the connectivity between UPF and NEF for Small
Data Communication using T8, and meets the following architecture
requirements:

\- KI 1 and KI 2 architecture requirements of both IP-based and Non-IP
based small data communication. The 5G User Plane is designed to handle
IP communication and Non-IP/Unstructured communication.

\- Both infrequent and frequent small data communication can be
supported with API access for SCS/AS.

\- The SMF manages connectivity between UPF and NEF for Small Data
Communication using T8.

Figure6.35.2.1-1 shows the non-roaming case. In this case, small data
is tunnelled between the UPF and NEF via N6n.

Roaming is supported as shown in Figure6.35.2.1-2 below. For roaming
case, UPF in VPLMN connects to UPF in HPLMN via N9 interface which has
connectivity via N6n with NEF in HPLMN.

The N6n reference point is between UPF and NEF for support of small data
transmission using UP transport. From UPF viewpoint, N6n is like N6 but
using tunnelling between UPF and NEF in the same PLMN e.g. based on IP
encapsulation/decapsulation as shown below in Figure6.35.2.1-1.

Figure 6.35.2.1-1: 5G non-roaming architecture reference model

Figure 6.35.2.1-2: Roaming 5G System architecture

#### 6.35.2.2 Small data delivery

The Small data delivery enables UE - SCS/AS communication. The Small
data delivery is supported by a NEF which supports the NIDD API and a
UPF. The UPF may be dedicated for small data delivery which support N6n
connectivity to NEF.

The UPF-NEF interface for small data communication is assumed to be
inside the operator domain:

Northbound NEF interface:

\- API for NIDD related procedures as specified in the TS29.122\[9\]
clause4.4.5.

\- The Common API Framework (CAPIF).

Southbound NEF interface:

\- N6n interface.

\- Forwarding NIDD received over T8 NIDD API to the UE via user plane.

\- The southbound interface has a PDU session layer which support PDU
Sessions of different types. IPv6 and IPv4 PDU session type shall be
supported. PDU Sessions of Unstructured PDU session type (aka
\"Non-IP\") are also supported.

\- All types of data (IP data and Unstructured data) should be tunnelled
over N6n. NEF is located within the operator network and its interfaces
should not be directly exposed to UEs for security reasons.

\- Higher layer IoT protocols be used towards the UE on top of the PDU
Session layer, but those protocols are outside of the scope of 3GPP.

The UPF N4 interface:

\- PFCP Session Establishment and N6n tunnelling establishment.

\- SMF support for UDM interaction at NIDD Configuration and NIDD
Authorization Update (see TS23.682\[6\]). Stage 3 decision if new
UPCP message are used or if the existing PFCP Session Modification
message is used.

The NEF supports store-and-forward of small data. The northbound API is
terminated in the NEF.

NOTE1: Additional application layer functionality of the NEF is beyond
the scope of 3GPP.

The following principles apply in addition:

Southbound as part of the NEF:

\- N6n tunnelling establishment by Nnef service operation. NEF supports
N6n tunnels between UPF and NEF.

\- The NEF supports Functionalities for Unstructured PDU Session Type
data transfer, i.e. IP encapsulation for downlink data and IP
decapsulation for uplink data.

\- The NEF stores its NEF ID in the UDM during NIDD Configuration.

\- Reliable Data Service between UE and NEF is supported when requested
and authorized. The UE indicates its capability of supporting RDS to the
network using PCO and the SMF indicates its NEF support for RDS to the
UE in the PCO.

SMF:

\- The SMF retrieves the NEF ID from the UDM during PDU Session
establishment procedure, and the SMF provides the N6 PtP tunnel
information (toward NEF) to the UPF or the UE.

\- The SMF allocates UPF N6n PtP tunnel information or uses N4 services
with UPF to allocate UPF N6n PtP tunnel information (if UPF is used to
allocate the end points).

\- The SMF uses Nnef services to provide the UPF N6n PtP tunnel
information (the IPv6 address and the UDP port of the tunnel end at the
UPF) to the NEF and to request NEF to allocate a NEF N6n PtP tunnel
information.

\- The SMF uses Nnef services to negotiate support of RDS and maps this
information with RDS support indication in PCO .

\- The SMF provides the NEF N6n PtP tunnel information to the UPF, as a
separate N4 service or using the same N4 service as the RAN N3 Tunnel
information is provided to the UPF (i.e. the PFCP Session Establishment
Request).

### 6.35.3 Support of EPC interworking

Interworking could be supported via explicit 5GS and EPS specifications,
but it is proposed to re-use the already specified 5GS - EPS
interworking principles.

It is proposed to not add in the EPS specifications the PGW - SCEF
interface corresponding to UPF-NEF interface in 5GC, but the already
agreed 5GS - EPS interworking principles can be re-used to provide
interoperability between EPS and 5GS. TS23.502\[7\] clause4.11.0a.4
specifies that combined SMF+PGW-C can be assigned to a UE that is
indicating 5G NAS capability. The combined SMF+PGW-C can then select a
combined UPF+PGW-U node, as shown in TS23.501\[5\] clause4.3.

The N6n interface is proposed for Rel-16 5GC only, so interoperability
requires network support for combined SCEF+NEF node. For UE moving
between 5GC and EPC, connectivity options supported by UE and combined
SCEF+NEF node may differ.

Editor\'s note: Maintenance of RDS context in the mobility between EPC
and 5GC is FFS.

The capability of tunnelling User Plane small data from UPF to NEF
provides thus the same capability for User Plane small data over the
combined UPF+PGW-U and combined SCEF+NEF (as specified in solution 13)
also when the 5GS + EPS capable UE is served by EPS.

Editor\'s note: How to determine whether APN corresponds to N6 or N6n
DNN after mobility to 5GS is FFS.

Since DNN intended for small data over the user plane is configured in
the network to be associated with NEF supporting T8 services, there is
no need to indicate small data over user plane in the PDU Session or PDN
Connection establishment and the EPS - 5GS mobility does not introduce
any additional requirements on the UE context transfer.

### 6.35.4 Procedures

#### 6.35.4.1 Connection establishment for UPF and NEF

Figure6.35.4.1-1 shows connection setup procedure for user plane small
data delivery using T8 NIDD API. Transport of small data over IP (IPv4,
IPv6) and Unstructured PDU session types is supported. Small data is
tunnelled over the N6n interface, the tunnel is configured at connection
establishment.

Figure 6.35.4.1-1: NIDD configuration and small data transfer path setup
procedure

It is assumed that NIDD configuration between NEF and AF has been
performed already (Step0). During NIDD configuration, the NEF stores
NIDD configuration parameters along with NEF\'s routing information
(e.g., IPv6 address, port number, etc) to the UE\'s SM subscription
data. The data path to the NEF is established by the UE performing PDU
Session Establishment procedure.

The PDU Session Establishment Procedure is performed as defined in
TS23.502\[7\] with the following additions:

1\. The UE includes in PDU Session Establishment Request a specific DNN
per URSP. This DNN is configured in the network to be associated with
NEF supporting T8 NIDD API services.

2\. The AMF selects a SMF based on the specific DNN requested by the UE
along with the other parameters as specified in TS23.502\[7\].

4\. The SMF determines that the PDU Session requires the involvement of
a NEF (i.e. for the T8 NIDD API. The SMF retrieves NEF information from
the UE\'s subscription data in the UDM, i.e. NEF ID.

5\. The SMF selects UPF. The SMF allocates UPF N6n Tunnel information
and UPF N3/N9 Tunnel information. If the UE requests IP PDU session type
(e.g., IPv4, IPv6), the SMF allocates an IP address/prefix for the PDU
Session as described in TS23.501\[5\] clause5.8.1. If the UE requests
Unstructured PDU session type, the SMF allocates an IPv6 prefix for the
PDU Session without involving the UE.

6\. The SMF provides the NEF with the UPF N6n Tunnel information, the
PDU Session Type and optionally the allocated IP address/prefix for the
UE for the N6n UPF-NEF tunnel and with NIDD configuration parameters,
e.g., External Identifier, AF ID (i.e. T8 destination address), and DNN
as retrieved in Step4. The NEF associates the NIDD configuration for
the UE with the UPF N6n Tunnel information and the allocated IP
address/prefix for the UE for the PDU Session. The NEF stores the N6n
Tunnel information in order to route the DL small data towards the UE on
PDU session determined based on DNN associated with the NIDD
configuration and the user identity.

The NEF responds to the SMF including the NEF N6n Tunnel information.
New Nnef service operations that supports the above parameters is used
for the N6n tunnel configuration.

If the UE indicated in the PCO its willingness to support RDS, the SMF
negotiates RDS with the NEF during that step.

7\. SMF includes the APN Rate Control parameters in the PCO. If RDS has
been successfully negotiated with the NEF, the SMF sends a RDS
indication to the UE in PCO;

8-9. Same as the PDU Session Establishment Procedure defined in
TS23.502\[7\]

10\. SMF updates the UPF using N4 Session Modification Request with the
NEF N6n Tunnel information and the RAN N3 Tunnel Information.

#### 6.35.4.2 MO small data transfer

Figure6.35.4.2-1 shows delivery over user-plane procedure.

Figure 6.35.4.2-1: Small Data delivery over User Plane using T8 NIDD API

For uplink data:

1\. The UE sends uplink data via user plane.

2-3. The UL PDU is encapsulated and forwarded on the N6n tunnel.

4\. The NEF receives the small data over the N6n connection and
determines target AF. The NEF performs IP decapsulation (i.e. removes
the IP header).

5\. NEF forwards the received small data as NIDD to the AF via T8 NIDD
API using public user identity.

For downlink data:

1\. NEF receives the NIDD from the AF via T8 NIDD API targeted for
public user identity.

2\. The NEF resolves the 3GPP user identities, determines if UP or CP
shall be used for the received DL packet and determines target N6n
Tunnel and the UE IP address (if any). The NEF performs IP encapsulation
based on the N6n Tunnelling information.

3-4. The NEF transfers downlink data to the UPF. The UPF acting as PDU
Session Anchor performs IP decapsulation for the received data (i.e.
removes the N6n tunnelling headers) and determines the PDU Session for
the UE to deliver the data.

5\. The UPF forwards the small data to the UE.

### 6.35.5 Impacts on existing entities and interfaces

Impacts on SMF: establishment of a N6n tunnel between UPF and NEF.

Impacts on UDM to support UDM Services equivalent to the NIDD
Configuration and NIDD Authorization Update procedures in
TS23.682\[6\]. Provision of NEF ID to the SMF.

The NEF supports tunnelling of small data over N6n with a UPF and new
Nnef service operation needed for the point-to-point tunnel management
between UPF and NEF.

NOTE: In this solution IP tunnelling at N6n is assumed, but the tunnel
type is expected to be specified as part of Stage 3.

Impacts on UPF to support N6n Tunnelling with NEF including
encapsulation/decapsulation.

### 6.35.6 Evaluation

In addition to small data over N6, this solution can support as a new
feature also small data via NEF over user plane.

This solution enables the 5GC to use the same NEF and NIDD API for both
UP and CP data. A 3rd party Application Server can use T8 NIDD API
towards the UE whether the UE supports UP data or CP data for its small
data transmission. That is, the route inside the 3GPP network is
transparent to the Application Server, and the T8 NIDD API is available
also for UEs supporting UP data.

The solution supports UPF and NEF inter-connected via N6n reference
point.

This solution can be deployed via combined node that supports UPF and
NEF functionality in a single node.

6.36 Solution 36: CM-CONNECTED with RRC Inactive state for frequent small data transmission
-------------------------------------------------------------------------------------------

### 6.36.1 Introduction

This solution applies to Key issue 2 (Frequent small data
communication). The key idea of the solution is to introduce
CM-CONNECTED with RRC Inactive for frequent small data transmission.

### 6.36.2 Functional Description

CM-CONNECTED with RRC Inactive is used for frequent small data
transmission with following enhancement to avoid frequent N3 tunnel
switching for UE with mobility within the RNA, especially for frequent
single UL or single UL/DL scenarios:

\- The SMF sends Small Data Information to the RAN to assist the RAN\'s
decision whether the UE can be sent to RRC Inactive state as described
in subclause6.28.2. The Frequent Small Data Information may include
frequent small data indication, communication pattern, etc. The SMF may
retrieve Small Data Information based on network configuration, user
subscription, etc.

\- The UE may send Request for Small amount of Data in RRC Resume
Request.

\- The RAN may decide not to switching N3 path to serving RAN to avoid
unnecessary N2 signalling and UE reconfiguration of RNA due to new
anchor RAN node after the path switch.

Additionally, following enhancement for supporting the UP CN-initiated
deactivation of UP connection procedure specified in clause6.36.4.3:

\- The RAN may remove the PDU session context locally without RAN paging
during the CN-initiated deactivation of UP connection for a UE in RRC
connection inactive state.

### 6.36.3 Support of EPC interworking

There is no interworking with EPC since this solution requires support
for RRC Inactive and EPC does not support RRC Inactive.

### 6.36.4 Procedures

#### 6.36.4.1 Connection Inactive procedure

The serving RAN node may decide to move the UE to RRC Inactive state
based on UE activity, small data Information, etc. as described in
subclause6.28.2, when the UE is in CM-CONNECTED with RRC Connected
state.

NOTE: The details of the procedure will be defined by RAN Group in
Rel-15.

#### 6.36.4.2 Connection Resume procedure

The Connection Resume procedure is used by the UE to perform RRC
Inactive to RRC Connected state transition. After the Resume procedure,
the UE may deliver small data via resumed user plane.

Figure 6.36.4.2-1: Resume procedure for small data transmission

0\. The \"Small Data Information\" has been provided to the old RAN node
at PDU session establishment as PDU Session specific information (called
\'SMF assisted NG-RAN information\') within the N2 SM information, see
clause6.28.2

1\. UE to RAN: RRC Resume Request (Resume ID, Request for Small amount
of Data).

The UE initiates the transition from RRC Inactive state to RRC Connected
state. Optionally, the UE may include Request for Small amount of Data
in the Resume Request.

NOTE1: The details of how the request for \"Small amount of Data\" is
indicated in the RRC Resume request is up to RANWG2 to define.

2\. \[Conditional\] The new RAN node performs UE Context Retrieval.

UE Context Retrieval is performed when the UE Context associated with
the UE attempting to resume its connection is not locally available at
the new RAN. The UE Context Retrieval via radio access network is
specified in TS38.300\[19\].

The new RAN, based on the \"Small Data Information\" received in the UE
Context or Request for Small amount of Data received from the UE, may
decide to establish a forwarding tunnel between target RAN and old RAN
rather than to perform N3 Path switch for frequent small data
transmission.

NOTE2: The old RAN node keep the UE context, since the N3 tunnel is not
switched to the new RAN node.

NOTE3: Is up to RAN to define the mechanisms to establish the
forwarding tunnel between the Old RAN and the target RAN.

NOTE4: How RAN makes decision whether to establish forwarding tunnel or
N3 path switch on receiving both \"Small Data Information\" and Request
for Small amount of Data is up to RAN implementation.

3\. New RAN to UE: RRC Resume message.

The new RAN confirms to the UE that the UE has entered RRC Connected
state.

4\. The UE delivers small data via user plane.

5\. The new RAN may trigger Connection Inactive procedure to move UE to
RRC inactive state. The old RAN node will remain as Anchor RAN node and
the UE will reuse the same Resume ID and RNA as before the transitioning
to RRC\_Connected state. After this procedure, the new RAN removes UE
context and forwarding tunnel and indicates the old RAN that the UE
enters RRC inactive state.

NOTE5: This procedure refers to the Connection Resume Procedure defined
for NG-RAN. The detailed procedure will be aligned to the procedure for
E-UTRA which will be defined by RAN Group in Rel-15.

#### 6.36.4.3 CN-initiated deactivation of UP connection when the UE is in RRC inactive state

The following procedure is used to deactivate UP connection (i.e. data
radio bearer and N3 tunnel) for an established PDU session of a UE in
CM-CONNECTED state and RRC\_Inactive state.

NOTE1: This procedure can be evaluated separately from clauses 6.36.4.1
and 6.36.4.2.

Figure 6.36.4.3-1

1\. The SMF determines that the UP connection of the PDU session needs
to be deactivated.

2\. The SMF initiates an N4 Session Modification procedure indicating
the need to remove (R)AN Tunnel Info for N3 tunnel of the corresponding
PDU session.

3\. The SMF sends an N11 message containing N2 SM Session Release
Request to release the (R)AN resources associated with the PDU session.

4\. The AMF forwards the N2 SM Session Release Request to the RAN.

5\. The RAN removes UP resources for the PDU session(s) received in step
4 and do not perform RAN paging, if the UE is in RRC\_inactive state;

6\. The RAN acknowledges the N2 Session Release Request by sending an N2
PDU Session Response (\"N1 SM Message Not Transferred\") to the AMF.

7\. The AMF sends an N11 message to acknowledge the SM request received
in step 4.

8\. When the UE triggers the Connection Resume procedure, the UE
provides its Resume ID needed by the RAN to access the UE\'s stored
Context;

9\. The RAN confirms the Resume Procedure UE entered RRC Connected
state. The RAN indicates the resumed PDU sessions via PDU session IDs;

NOTE2: The exact mechanism by which the PDU sessions are synchronized
will be defined by RANWG2.

10\. The UE releases locally the UP resources related to the PDU
Sessions not received from the NG-RAN in step 9.

### 6.36.5 Impacts on existing entities and interfaces

RAN:

\- The RAN decides whether the UE can be sent to RRC Inactive state
based on the frequent small data indication received from the SMF.

\- The RAN, based on the \"Small Data Information\" received from the
SMF, may decide establish a forwarding tunnel between target RAN and old
RAN during the Resume procedure.

SMF:

\- The SMF includes \"Small Data Information\" in the N2 SM information
if the SMF determines the PDU session is used for frequent small data.

UE:

\- The UE includes Request for Small Data in the RRC Resume Request.

Additionally, following impacts for supporting the UP CN-initiated
deactivation of UP connection procedure specified in clause6.36.4.3.

RAN:

\- The RAN removes UP resources for the PDU session(s) and do not
perform RAN paging during the CN-initiated deactivation of UP connection
procedure, if the UE is in RRC inactive state.

\- The RAN notifies the available PDU sessions during the Resume
procedure.

UE:

\- The UE releases locally the UP resources related to the PDU Sessions
not received during the Resume procedure.

### 6.36.6 Evaluation

RAN-CN signalling load can be minimized for small data communication for
UEs that have mobility within a RAN Notification Area.

With CN-initiated deactivation of UP connection when the UE is in RRC
inactive state (subclause6.36.4.3), the paging signalling caused by UP
connection deactivation can be avoided. There is minor impact on the RRC
resume message and no additional signalling is introduced.

6.37 Solution 37: Monitoring
----------------------------

### 6.37.1 Introduction

This solution addresses key issue \#11 - \"Monitoring\".

### 6.37.2 Functional Description

The Monitoring Events feature is intended for monitoring of specific
events in 3GPP system and making such monitoring events information
reported via the NEF. It is comprised of means that allow NFs in 5GS for
configuring the specific events, the event detection, and the event
reporting to the requested party.

5GS supports various monitoring events. List of monitoring event already
supported in 5GC are specified in Table4.15.3.1-1 of TS23.502\[7\].

Editor\'s note: It is FFS if any additional Monitoring event is required
to be supported by 5GS.

Support for Monitoring Events can be offered either via AMF (as
described in clause6.37.4.1), or via UDM (as described in
clause6.37.4.2), or via PCF (as described in clause6.37.4.2) and can
be reported via the NEF (as specified in in clause4.15.3 of
TS23.502\[7\]). Based on operator policies, it shall be possible to
configure Monitoring Events such that some Monitoring Event follows
procedures in clause6.37.4.1 while another Monitoring Event follows
procedures in clause6.37.4.3.

### 6.37.3 Support of EPC interworking

#### 6.37.3.1 General

The support of EPC interworking relies on combined SCEF + NEF node as
specified in solution \#13. Interaction between the SCEF and NEF in the
SCEF+NEF need not be standardized.

Monitoring events only need to be configured by the SCEF+NEF one time,
by using either EPC or 5GC procedures. In other words, when a monitoring
event has been configured by the SCEF procedures towards the HSS, the
NEF need not repeat the same monitoring event configuration towards the
UDM, and vice versa.

Consistent with existing EPS-5GS interworking scenarios in
TS23.501\[5\], the subscriber data base is managed by a combined
HSS+UDM node.

#### 6.37.3.2 Interworking with N26 interface

When UE moves from 5GS to EPS, the UE context information sent by AMF to
MME includes the monitoring event configuration information. Similarly
when UE moves from EPS to 5GS, the MME\'s MM context information sent by
MME to AMF includes the monitoring event configuration information.

#### 6.37.3.3 Interworking without N26 interface

When SCEF+NEF performs the procedure of monitoring via the AMF as
described in clause4.15.3.2.4 (\"Exposure with bulk subscription\") in
TS23.502\[7\], if the AMF determines the interworking without N26
interface is supported, the AMF shall subscribe UE\'s mobility from 5GS
to EPS from UDM+HSS on behalf of SCEF+NEF as described in clause7.1.2
of TS23.501\[5\] .When UE\'s mobility from 5GS to EPS happens and
Serving MME sends Update Location Request to the UDM+HSS, the UDM+HSS
sends Serving MME ID to the SCEF+NEF which is the Notification
Consumer.Then the SCEF+NEF performs the procedure of configuring
monitoring at the MME as described in clause5.6.1.1 of TS23.682\[6\].

When SCEF+NEF performs the procedure of monitoring via the UDM+HSS as
described in clause4.15.3.2.2, when UE\'s mobility between 5GS and EPS
happens, the UDM+HSS performs the procedure of configuring monitoring at
the MME as described in clause5.6.1.1 of TS23.682\[6\] and at the AMF
as described in clause4.15.3.2.2 of TS23.502\[7\].

### 6.37.4 Procedures

#### 6.37.4.1 Monitoring events at AMF

Procedure for monitoring via AMF is specified in clause4.15.3.2.1 of
TS23.502\[7\].

#### 6.37.4.2 Monitoring events at UDM

Procedure for monitoring via UDM is specified in clause4.15.3.2.2 of
TS23.502\[7\].

#### 6.37.4.3 Monitoring events at PCF

##### 6.37.4.3.1 General

In EPC Monitoring Events via the PCRF enables the SCEF (or AF/AS) to
retrieve the location information and to report communication failure of
a UE. In 5GC Location reporting and communication failure event
reporting are supported via AMF and PCF.

##### 6.37.4.3.2 PCF service operations information flow

Figure 6.37.4.3.2-1: Npcf\_EventExposure\_Subscribe and Notify
operations

1\. The AS subscribes to one or several Event(s) (identified by Event
ID) and provides the associated notification endpoint of the AS by
sending Nnef\_EventExposure\_Subscribe request.

Event Reporting Information defines the type of reporting requested
(e.g. one-time reporting, periodic reporting or event based reporting,
for Monitoring Events). If the reporting event subscription is
authorized by the NEF, the NEF records the association of the event
trigger and the requester identity. The subscription may also include
Maximum number of reports and/or Maximum duration of reporting IE.

2\. The NEF subscribes to received Event(s) (identified by Event ID) and
provides the associated notification endpoint of the NEF to PCF by
sending Npcf\_EventExposure\_Subscribe request.

3a. \[Conditional\] If the requested event (e.g. monitoring of Loss of
Connectivity) requires AMF assistance, then the PCF sends the
Namf\_EventExposure\_Subscribe to the AMF serving the requested user. As
the PCF itself is not the Event Receiving NF, the PCF shall additionally
provide the notification endpoint of itself besides the notification
endpoint of NEF. Each notification endpoint is associated with the
related (set of) Event ID(s).This is to assure the PCF can receive the
notification of subscription change related event.

3b. \[Conditional\] AMF acknowledges the execution of
Namf\_EventExposure\_Subscribe.

If the subscription in step1 is applicable to a group of UE(s) or any
UE, the PCF sends the Namf\_EventExposure subs request to the
corresponding AMF in case subscripton applied to a UE or a group of
UE(s), or all the AMF in this PLMN in case subscription applied to any
UE.

4\. PCF acknowledges the execution of Npcf\_EventExposure\_Subscribe.

If the subscription is applicable to a group of UE(s) and the Maximum
number of reports is included in the Event Report information in step1,
the Number of UEs is included in the acknowledgement.

5\. NEF acknowledges the execution of Nnef\_EventExposure\_Subscribe to
the requester that initiated the request.

6a. \[Conditional - depending on the Event\] The PCF detects the event
occurs and sends the event report, by means of
Npcf\_EventExposure\_Notify message to the associated notification
endpoint of the NEF.

6b. \[Conditional - depending on the Event\] The AMF detects the event
occurs and sends the event report, by means of
Namf\_EventExposure\_Notify message to associated notification endpoint
of the NEF.

If the AMF has a maximum number of reports stored for the UE or the
individual member UE the AMF shall decrease its value by one for the
reported event if the UE or the individual member UE.

For both step6a and step6b, when the maximum number of reports is
reached and if the subscription is applied to a one UE, The NEF
unsubscribes the monitoring event(s) to the PCF and the PCF unsubscribes
the monitoring event(s) to AMF for the UE.

For both step6a and step6b, when the maximum number of reports is
reached for an individual group member UE, the NEF uses the Number of
UEs received in step4 to determine if reporting for the group is
complete. If the NEF determines that reporting for the group is
complete, the NEF unsubscribes the monitoring event(s) to the PCF and
the PCF unsubscribes the monitoring event(s) to AMF for each individual
UE within that group.

When the Maximum duration of reporting expires in the NEF, the PCF and
the AMF, then each of these nodes shall locally unsubscribe the
monitoring event.

7\. \[Conditional - depending on the Event\] The NEF forwards to the AS
the reporting event received by either Npcf\_EventExposure\_Notify
and/or Npcf\_EventExposure\_Notify.

8\. \[Conditional - depending on the Event\] The AMF detects the
subscription change related event occurs, e.g. Subscription Correlation
ID change due to AMF reallocation, it sends the event report, by means
of Namf\_EventExposure\_Notify message to the associated notification
endpoint of the PCF.

### 6.37.5 Impacts on existing entities and interfaces

PCF:

\- Support of new service operations - Npcf\_EventExposure\_Subscribe,
Npcf\_EventExposure\_Notify.

### 6.37.6 Evaluation

This solution addresses the architectural requirements for the Key Issue
\#11 - \"Monitoring\".

6.38 Solution 38: eDRX RRC\_INACTIVE STATE in 5GS
-------------------------------------------------

### 6.38.1 Introduction

The proposal is to enable an eDRX equivalent feature from EPS in 5GS for
UE in RRC\_INACTIVE. It addresses Key Issue 4, Power saving functions.

### 6.38.2 Functional Description

The proposal is to enable an eDRX equivalent feature from EPS in 5GS for
UE in RRC\_INACTIVE.

As the 5GC has a different architecture and some new functionality
compared to EPC some adaptions are needed compared to eDRX in EPS. The
following adoptions are needed:

\- eDRX sleep cycle negotiation:

In EPC the UE requests extended idle mode DRX parameters during attach
procedure and RAU/TAU procedure and the SGSN/MME may reject or accept
the UE request for enabling extended idle mode DRX .\
In case the SGSN/MME accepts the extended idle mode DRX, the SGSN/MME
based on operator policies and, if available, the extended idle mode DRX
cycle length value in the subscription data from the HSS, may also
provide different values of the extended idle mode DRX parameters than
what was requested by the UE. If the SGSN/MME accepts the use of
extended idle mode DRX, the UE applies extended idle mode DRX parameters
either as received or modified by SGSN/MME.

The same principles can be used on 5GC but the procedures used by the UE
to request extended DRX parameters will be Registration and Registration
Update.

Three alternatives regarding extended DRX parameters are listed:

Alternative 1: The same extended DRX parameters and thus DRX cycle is
used for UE in CM-IDLE as well as in CM-CONNECTED with RRC\_INACTIVE.
This ensures that paging occasions will overlap when UE is paged by the
CN (CM-IDLE) or by NG-RAN (RRC\_INACTIVE).

Alternative 2: The UE requests different extended DRX parameters in the
registration request to be used when in UE is in CM-IDLE and
CM-CONNECTED with RRC\_INACTIVE. The AMF may reject or accept the UE
request for enabling extended DRX for RRC inactive. If the AMF accepts
the use of extended DRX for RRC inactive, the AMF indicates the enabling
of extended DRX for inactive to the UE and passes the requested extended
RRC inactive DRX parameters to RAN. Then the RAN decides and configures
DRX parameters for RRC inactive as specified in TS38.300\[19\].

Alternative 3: The UE requests idle mode eDRX parameters from the AMF.
The AMF passes the UE\'s Accepted idle mode eDRX parameters to the RAN.
If the UE supports eDRX in RRC inactive, the RAN configures the UE with
an eDRX cycle in RRC-INACTIVE up to the value for the UE\'s idle mode
eDRX cycle as provided by the AMF or up to the maximum value allowed
based on the NAS (and SMS) retransmission timers (whichever is lower).
The RAN buffers DL packets up to the duration of the eDRX cycle chosen
by RAN.

NOTE1: The maximum value will be determined by CT groups and is assumed
to be configured in the RAN.

In EPS the UE and the SGSN/MME handle the request. In 5GS the UE
handling shall be the same but in 5GC it will be the AMF instead of
SGSN/MME.

\- Subscription information :

Extended DRX cycle length value needs to be added in the subscription
data from the UDM using the same principles as in EPS. For alternative
2, an RRC\_INACTIVE specific extended DRX cycle needs to be added.

\- Hyper SFN, Paging Hyperframe and Paging Time Window.

Same handling as in EPC but in 5GC the AMF will assign the Paging Time
Window. The AMF will include the Paging Time Window in the extended DRX
parameters to the UE and in the paging eDRX information to the NG-RAN.

NOTE2: Whether the solution for Hyper SFN and Paging Hyperframe in
NB-IoT and WB-E-UTRAN in the 5GS Rel-16 will look the same as extended
idle mode DRX (eDRX) in E-UTRAN depends on RAN further work.

### 6.38.3 Support of EPC interworking

eDRX depends on UE provided parameters in Attach/TAU respective
Registration Requests, plus subscription information and local policies
in the MME respective AMF. This means the eDRX handling can be kept
separate in EPC and 5GC and no specific interworking is required.

### 6.38.4 Procedures

The existing procedures in 5GC will be reused to handle the eDRX
signalling between AMF, NG-RAN, UDM and UE.

### 6.38.5 Impacts on existing entities and interfaces

In alternative 1 the UE shall send request for extended DRX parameters,
that are valid for CM-IDLE and CM-CONNECTED with RRC\_INACTIVE to the
AMF.

In alternative 2 the UE sends RRC\_INACTIVE specific extended DRX
parameters to the AMF. The UE will also receive the extended DRX
parameters and utilize this information for extended DRX handling.

In alternative 3 the UE requests idle mode eDRX parameters from the AMF.
The AMF passes the UE\'s Accepted idle mode eDRX parameters to the RAN.
The RAN configures the UE with an eDRX cycle up to the value for the
UE\'s idle mode eDRX cycle as provided by the AMF or up to the maximum
value allowed based on the NAS (and SMS) retransmission timers
(whichever is lower). For CM-CONNECTED with RRC-INACTIVE, the RAN is
assumed to be able to buffer DL packets for the duration of the eDRX
cycle chosen by RAN.

The AMF shall handle the request from the UE and reject, modify or
accept the request. If accepted (as is or with modification) the AMF
shall set the extended DRX parameters and supply relevant parameters to
UE and NG-RAN.

The UDM may include the extended DRX cycle length value in the
subscription data to the AMF.

The NG-RAN will receive the paging eDRX information from the AMF.

### 6.38.6 Evaluation

This solution uses eDRX for CM-CONNECTED with RRC\_INACTIVE. It allows
eDRX cycles longer than the 2.54 seconds to increase device battery
efficiency while UEs are using CM-CONNECTED with RRC\_INACTIVE. The
length of the eDRX cycle supported in RRC inactive depends on the
alternative chosen during study conclusion.

6.39 Solution 39: UE availability after DDN failure for multiple AFs
--------------------------------------------------------------------

### 6.39.1 Introduction

This solution addresses Key Issue 3 (High latency communication) in case
of multiple Application Functions (AFs).

When multiple AFs communicate with a UE, each of them can subscribe to
the \"Availability after DDN failure\" event. When a Downlink Data
Notification (DDN) failure occurs it should be possible for the CN to
notify only a subset of all the AFs that subscribed to the
\"Availability after DDN failure\" event (e.g., only the AF(s) that
previously sent the data which trigged the DDN failure, or only the
AF(s) that want to be notified for a specific traffic type).

### 6.39.2 Functional Description

**When an AF subscribes to the \"Availability after DDN failure\" event,
the AF includes a Traffic Descriptor to identify the data sent by the
AF. The event is subscribed to UDM through NEF.**

**When the AF sends the downlink data, CN identifies which AF sent the
down link data by using the Traffic description information received
from AF. When the UE becomes available, the CN notifies the AF that has
subscribed to the event and sent the data.**

**The function can be divided into Event Subscription and Activate Event
Report:**

\- Event Subscription:

\- AF subscribe the \"availability after DDN failure event\". The
subscribing event includes traffic description information to identify
the data sent by the AF. The event is subscribed to UDM through NEF. The
NEF generate NEF Reference ID for the event. The NEF Reference ID
identify the correlation between the event and the AF that subscribe the
event.

\- The UDM sends the subscription to AMF including NEF ID, NEF Reference
ID and Event type.

\- Based on Slice information, DNN, and/or AF Service ID, the UDM sends
the subscription to (V-)SMF for existing PDU Session or during PDU
Session establishment. The SMF send traffic filters to detect the
traffics sent by the AF. These traffic filters are designed according to
the traffic description info sent by AF. The (V-)UPF detects the traffic
sent by AF and report to the (V-)SMF in the DDN message.

\- Activate Event Report:

\- After receiving the DDN message for the AF service, the (V-)SMF sends
message to AMF including the NEF Reference ID.

\- AMF activates the event after DDN failure based on the NEF Reference
ID.

\- When the UE become reachable, the AMF notify the corresponding AF
that has subscribed the event and sent the data.

### 6.39.3 Support of EPC interworking

The solution is only applied for 5GC.

### 6.39.4 Procedures

#### 6.39.4.1 Event Configuration

The procedure of Event Configuration is depicted in Figure 6.39.4.1-1.

The procedure supports the non-roaming case, the local breakout (LBO)
case as well as the home routed case.

The procedures\' message flows for the non roaming and LBO cases are the
same. The only difference is that in the latter case the AMF, the SMF,
the UPF are located in the visited network.

In case of home routed roaming, the UDM subscribes the event to the
V-SMF through the H-SMF.

![](media/image120.wmf){width="6.6625in" height="3.6881944444444446in"}

Figure 6.39.4.1-1: Event Configuration - Availability Notification after
DDN Failure

1\. The AF subscribes to the \"Availability after DDN failure\" event by
invoking Nnef\_EventExposure\_subscribe (UE ID/Group ID, AF ID,
Availability after DDN failure, DNN/S-NSSAI/AF-Service-ID, Traffic
Descriptor) service of the NEF. The \"Availability after DDN failure\"
element is used to identify the event type of the subscription.

The Traffic Descriptor is sent by the AF if it wants to be notified of
the availability after DDN failure for a specific traffic type. The
Traffic Descriptor can be e.g. an IP-3-Tuple(destination IP address/IPv6
prefix, port number, protocol in use), an Application ID, a non-IP
descriptor, or an Ethernet traffic descriptor or other descriptor
information that can be used to identify specific AF service. UE ID can
be GPSI and Group ID can be external group ID.

2\. The NEF receives the request from the AF and invokes
Nudm\_EventExposure\_subscribe (UE ID/Group ID, AF ID, Availability
after DDN failure, DNN/S-NSSAI/AF-Service-ID, Traffic Descriptor, NEF
ID, NEF Reference ID) towards the UDM. The NEF Reference ID is used to
identify the correlation between the event and the AF that subscribe the
event.

3\. From UDM to AMF: Namf\_EventExposure\_Subscribe request(Availability
after DDN failure, NEF ID, NEF Reference ID). The AMF responds to the
request.

4\. The UDM determines the (V-)SMF based on the Slice information, DNN,
and/or AF Service ID. From UDM to (V-)SMF:
Nsmf\_EventExposure\_Subscribe(Availability after DDN failure, Traffic
Descriptor, NEF ID, NEF Reference ID). Traffic Descriptor is used to
indicate the traffic corresponding to the event and identify the AF that
provide the service. The (V-)SMF generates a Traffic Indicator that
allows the (V-)SMF to correlate the Traffic Descriptor, NEF ID and NEF
Reference ID for future events.

NOTE1: In the home routed case, the UDM sends the subscription to the
V-SMF via the H-SMF.

5\. The (V-)SMF sends an N4 Session Establishment/Modification Request
to the (V-)UPF and provides Traffic Descriptor and the related Traffic
Indicator to the UPF.

6\. The (V-)SMF acknowledges the execution of
Nsmf\_EventExposure\_Subscribe.

NOTE2: In the home routed case, the V-SMF sends the subscription to the
UDM via the H-SMF.

7\. The UDM acknowledges the execution of
Nudm\_EventExposure\_Subscribe.

8\. The NEF acknowledges the execution of
Nnef\_EventExposure\_Subscribe.

#### 6.39.4.2 Notification

The procedure for notification after DDN failure is depicted if Figure
6.39.4.2-1.

Figure 6.39.4.2-1: Notification - Availability Notification after DDN
Failure

1\. (V-)UPF receives the downlink data sent by AF.

NOTE1: In the home routed case, the data is received by the V-UPF via
the H-UPF.

2\. (V-)UPF sends Downlink Data Notification (DDN) message to the
(V-)SMF, including the Traffic Indicator related to the Traffic
Descriptor that triggered the event so the (V-)SMF can determine which
service the downlink data belongs to. If multiple applications are bound
to the same QoS flow, the UPF sends the DDN message per application to
the (V-)SMF for this QoS flow.

3\. Based on the Traffic Indicator, the (V-)SMF can determine which
Event the downlink data belongs to and determine the NEF ID and the NEF
Reference ID to be sent to the AMF. The (V-)SMF sends
Namf\_CommunicationN1N2MessageTransfer to AMF including the NEF ID and
the NEF Reference ID. This message is sent even if the (V-)SMF had
previously been notified that the UE is unreachable.

4\. If DDN fails (e.g. UE is not reachable), the AMF sends
Namf\_CommunicationN1N2MessageTransfer response to SMF to notify if of
the DDN failure.

5\. The SMF (V-)sends DDN failure indication to (V-)UPF.

6\. The AMF notes the subscription option for notification of
availability after DDN failure for the UE, and sets a
Notify-on-available-after-DDN-failure flag corresponding to the NEF ID
and NEF Reference ID received in step3.

7\. At some later time, the UE contacts the network, e.g., to perform
registration, or as it executes a service request.

8\. If the Notify-on-available-after-DDN-failure flag for the UE is set
then AMF sends Namf\_EventExposure\_Notify (UE ID, NEF Reference ID) to
the NEF to notify that the UE is available.

9\. NEF identifies the corresponding AF based on NEF Reference ID and
sends Nnef\_EventExposure\_Notify to AF to notify that the UE is
available. Only the AFs linked to the Traffic Indicator (and related
Traffic Descriptor) are notified.

### 6.39.5 Impacts on existing entities and interfaces

NEF:

\- Receives the Traffic Descriptor from the AF and passes to the UDM.

UDM:

\- Subscribes to the AMF event \"Availability after DDN failure\",
passing the NEF ID and NEF Reference ID to the AMF.

\- The UDM sends the subscription to \"Availability after DDN failure\"
to the SMF for an existing PDU Session or during PDU Session
establishment including Traffic Descriptor, NEF ID and NEF Reference ID.

(V-)SMF:

\- The SMF sends the Traffic Descriptor to the UPF so it can detect the
traffic sent by the AF along with a Traffic Indicator for UPF to relate
the Traffic Descriptor with the Traffic Indicator.

\- After receiving the DDN message with Traffic Indicator, the SMF sends
a message to AMF including the NEF ID and the NEF Reference ID. The SMF
sends this message even if it had previously been notified that the UE
is unreachable.

H-SMF:

\- Forward messages between V-SMF and UPF in the home routed case.

UPF:

\- The UPF detects the traffic sent by AF and sends to the SMF the DDN
message including the Traffic Indicator. If multiple applications are
bound to the same QoS flow, the UPF sends the DDN message per
application to the SMF for this QoS flow.

AMF:

\- AMF activates the event after DDN failure based on the NEF ID and the
NEF Reference ID.

\- When the UE becomes reachable, the AMF notifies the corresponding AF
that has subscribed the event and sent the data.

### 6.39.6 Evaluation

The Solution proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF
provides the Traffic Descriptor information during the Event
Configuration procedure, and the Traffic Descriptor information can be
used by the network to determine the corresponding AF.

The solution addresses the architectural requirements for key issue3
\"Provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable)\".

6.40 Solution 40: Infrequent small data transmission with temporary PDU session
-------------------------------------------------------------------------------

### 6.40.1 Introduction

This solution applies to address the Key Issue 1: Support for infrequent
small data transmission.

The solution assumes that the UE does not establish a PDU session before
sending small data packet based on the negotiation with network. The
network shall establish a temporary PDU session for the data
transmission. During the lifetime of PDU session, the uplink and
downlink data can be delivered.

The solution is used to specific application scenario, e.g. MO-initiated
infrequent small data transmission.

### 6.40.2 Functional Description

The AMF decides PDU session mode based on UE support and preference for
temporary session, the UE subscription data, local configuration,
**Expected UE Behaviour**, or negotiated MICO mode. To avoid additional
PDU session establishment/release signalling at every MO-initiated small
data transaction, the AMF may take into account the interval time of
small data transaction if available, e.g. the Periodic Time parameter of
Expected UE Behaviour.

The infrequent small data transmission procedure for a scenario where
the user data is forwarded to application server via control plane is
illustrated in figure6.40.4-1.

### 6.40.3 Support of EPC interworking

This solution does not support EPC-5GC interworking. When the UE with a
PDN connection moves from EPC to 5GC, the UE shall release the PDN
connection and deliver small data as shown in6.40.4. When the UE with
temporary PDU session moves from 5GC to EPC, the UE establishes a PDN
connections for small data delivery.

### 6.40.4 Procedures

Figure 6.40.4-1: Small data transmission procedure

0\. During UE Registration procedure, the UE and AMF negotiate the PDU
session mode to determine either temporary PDU session mode or normal
PDU session mode is used. The AMF decides PDU session mode based on UE
support and preference of temporary session, the UE subscription data,
local configuration, Expected UE Behaviour if available, or negotiated
MICO mode.

1\. If the temporary PDU session is applied, the UE transmits the NAS
Data PDU with the related DNN and S-NSSAI to the AMF without any
established PDU session. For IP data, the UE uses a locally created IP
address as the source IP address of the IP packet.

2\. The AMF checks the integrity of the incoming NAS PDU and decrypts
the user data it contains.

3\. If the UE has no PDU Session for this DNN and S-NSSAI and the
temporary PDU session mode is applied, based on one or any combination
of DNN, Network Slice Selection Assistance Information, operator\'s
local configuration or policy and routing information, the AMF selects a
SMF and initiates the PDU session establishment procedure with a
temporary PDU session indication to the SMF.

4\. The SMF selects a specific pre-configured UPF and initiates the N4
session establishment procedure with a temporary PDU session indication
to the UPF.

5\. The SMF sends the response message to the AMF.

6\. The AMF forward the user data to the SMF.

7\. The SMF forward the user data to the UPF and the UPF forward the
user data to the DN via N6 interface. For IP data, if the temporary PDU
session indication is received from the SMF in step 4, the UPF shall
store the source IP address of the IP packet and change it to the IP
address allocated by the SMF.

8\. The UPF receives the DL user data and forwards the user data to the
SMF. For IP data, the UPF changes the destination IP address of external
IP packet to the IP address stored for the UE.

9\. The SMF receives the DL user data and forwards the user data to the
AMF.

10\. If downlink data is received, the AMF encrypts and integrity
protects the NAS transport message with downlink user data.

11\. The AMF transmits the DL NAS Data PDU to the UE.

12\. After the data transmission, the temporary PDU session is released.
The temporary PDU session may be released by the AMF based on the
Release Assistance Indication information from the UE, or by the SMF
based on the expiration of inactivity timer (see TS23.502\[7\]
clause4.3.4.2).

### 6.40.5 Impacts on existing entities and interfaces

Impacts on AMF:

\- Support of the negotiation of PDU session mode with UE;

\- Support of the establishment/release of temporary PDU session;

Impacts on SMF:

\- Support of the establishment of temporary PDU session without N1 SM
message (PDU Session Establishment Request) sent from the UE;

\- Support of the release of temporary PDU session;

Impacts on UPF:

\- Support of IP address translation of UL/DL IP packet for temporary
PDU session;

Impacts on UE:

\- Support of negotiation of PDU session mode with AMF;

\- Support of sending small data packet without PDU session
establishment.

### 6.40.6 Evaluation

The solution proposes that the UE can send small data packets without
having to support a user-plane stack, AS security and without PDU
session establishment between UE and network based on the negotiation
with the network. The temporary PDU session is introduced for the small
data transmission, and established in an on-demand way, which saves
session resource consumption of PDU session in 5GC. The core network
signalling will increase due to establishment and release of temporary
PDU session. The amount of signalling depends on how frequently the UE
sends UL small data and how quickly the network releases the PDU session
based on Release Assistance Indication information from the UE or
expiration of inactivity timer (e.g. determined by interval of data
transmission). There is no support for DL-initiated small data.

The solution avoids the PDU session related signalling between UE and
network and avoids storing a PDU session context in the UE.

In case there is no default DNN and S-NSSAI for the UE and the AMF, the
UE needs to send the DNN and S-NSSAI together with UL small data.

6.41 Solution 41: Combining RRC-INACTIVE and 5G UP optimization
---------------------------------------------------------------

### 6.41.1 Introduction

This solution addresses key issue 2, key issue 4 and key issue 13.

While RRC-INACTIVE could be an appropriate solution to handle frequent
small data, one open question is how to efficiently handle traffic
patterns where the frequent small data occurs in bursts with
significantly long silence periods in-between the bursts. To optimize UE
power consumption during those silence periods, the UE may benefit from
using power saving methods like MICO mode or eDRX.

Given that MICO mode assumes the UE to be in CM-IDLE it anyhow does not
apply to RRC-INACTIVE. However, eDRX may apply to RRC\_INACTIVE (as has
been proposed in solution38).

The latter has led to the question where DL data buffering should be
performed while the UE is in RRC-INACTIVE with eDRX.

One option to address this problem has been proposed in solution7 where
the buffering is performed in the core network while the UE is in
RRC-INACTIVE state, i.e. while the N3 interface is still up and the core
network is thus far - by design - not aware of UE reachability. This
solution proposes an alternative.

### 6.41.2 Functional Description

The following principles apply to this solution:

\- The UE is assumed to request idle mode eDRX parameters from the AMF
taking the delay tolerance of all expected mobile terminating
communication into account. The AMF determines the Accepted eDRX
parameters.

NOTE1: This assumption is in line with similar assumptions made in
23.682\[6\] clause4.5.13.1: \"*A UE should request for extended idle
mode DRX only when all expected mobile terminating communication is
tolerant to delay.*\" and \"*The extended idle mode DRX cycle length
requested by UE takes into account requirements of applications running
on the UE.*\"

\- The AMF also passes the UE\'s Accepted eDRX parameter to the RAN.

\- The RAN configures the UE\'s eDRX parameters while the UE is in
RRC\_INACTIVE as follows:

\- The RAN configures the eDRX cycle up to the UE\'s Accepted eDRX
parameters as provided by the AMF or or up to the maximum value allowed
based on the NAS retransmission timers (whichever is lower).

NOTE2: The maximum value will be determined by CT groups and is assumed
to be configured in the RAN.

\- The RAN shall only configure an eDRX cycle for which the RAN is
capable and willing to buffer DL data.

\- While the UE is in RRC\_INACTIVE with eDRX the buffering is performed
in the RAN.

\- Based on the UE\'s idle mode eDRX cycle as provided by the AMF and
taking the UE\'s inactivity into account the RAN dynamically determines
if:

\- the RAN keeps the UE in RRC\_INACTIVE with an eDRX cycle up to the
UE\'s Accepted eDRX parameters as provided by the AMF or up to the
maximum value allowed based on the NAS retransmission timers (whichever
is lower) (implying that the RAN buffers DL packets up to the duration
of the eDRX cycle chosen by RAN); or alternatively,

\- the RAN uses 5GS UP Optimization (see solution 19), i.e. suspends the
UE\'s RRC connection. In this case the buffering of DL data is performed
in the core network using normal CM-IDLE procedures.

NOTE3: For eDRX cycles requested by the UE that are significantly
longer than the maximum value allowed based on the NAS retransmission
timers, the RAN is assumed to use 5GS UP Optimization (see solution19),
i.e. to suspend the UE\'s RRC connection instead of using RRC-INACTIVE,
after sustained UE inactivity.

### 6.41.3 Support of EPC interworking

Solution does not apply to EPC.

### 6.41.4 Procedures

Existing procedures are reused.

### 6.41.5 Impacts on existing entities and interfaces

General:

\- Support for eDRX in RRC-INACTIVE (see related impacts documented for
solution38) and 5GS UP optimization (see related impacts documented for
solution19).

RAN:

\- Support for buffering up to the maximum value allowed based on the
NAS retransmission timers.

Editor\'s note: This clause describes impacts to existing entities and
interfaces.

### 6.41.6 Evaluation

Solution41 illustrates how RRC-INACTIVE as defined in Rel-15 can be
combined with 5G UP optimization (see Solution19) and eDRX to
efficiently support bursty frequent small data. The key idea is to use
RRC-INACTIVE (combined with short eDRX sleep cycles as needed) while a
frequent small data burst is sent; during a silence period (i.e.
in-between two bursts) the UE\'s RRC connection is suspended and long
eDRX sleep cycles can be applied as needed. To reduce over-the-air
signaling when the next frequent small data bursts begins, i.e. when the
UE sends small data from CM-IDLE, 5G UP optimization (as per
Solution19) is proposed to be used.

In combination with RRC-INACTIVE 5G UP optimization jointly ensures that
bursty frequent small data can be sent with minimal signaling overhead
while extended DRX sleep cycles ranging from a few seconds to hours can
be supported without causing significant system impacts. The impacts are
the same as for Solution19.

6.42 Solution 42: NAS based Redirection between Core Networks
-------------------------------------------------------------

### 6.42.1 Introduction

This NAS based solution applies to Key issue 15 of load balancing the
UEs between the two systems.

### 6.42.2 Functional Description

This solution is a procedure to steer the UE during the
(re-)registration procedure.

In EPC, when UE sends the Attach Request to the MME and MME determines
that the UE need to move to the 5G system, the MME shall reject the
Attach Request and send an appropriate EMM cause indicating the target
CN system to the UE. After, the UE shall disable S1 mode and re-enable
the N1 mode if it was disabled and perform registration in the target 5G
system. Similar, in case of 5GC, the AMF will send a Registration Reject
with a cause indicating to the UE to register in the EPC network. Upon
the indication, the UE shall disable the N1 mode and re-enable the S1
mode if was disabled.

### 6.42.3 Support of EPC interworking

TS23.501\[5\], clause5.17 applies when a registered/connected UE(s)
is moved to 5GC or EPC systems.

### 6.42.4 Procedures

#### 6.42.4.1 Redirection using NAS indication

##### 6.42.4.1.1 General

When a UE triggered registration either in EPC or 5GC network, network
redirects the UE to target system by indication in the NAS layer.

##### 6.42.4.1.2 Redirection from EPC to 5GC network

Figure 6.42.4.1.2-1: Redirection from EPC to 5GC network

1\. The UE sends the Attach or TAU Request as step\#1-2 of
Figure5.3.2.1-1 in TS23.401\[4\]. The UE includes an indication that
it supports N1 mode and its Preferred Network Behaviour. The Preferred
Network Behaviour includes the 5GS/EPS CIoT optimisations the UE
supports and what it would prefer to use. Based on the indication that
the UE supports N1 mode and that Preferred Network Behaviour, the MME
knows the UE can be redirected to 5GC.

2\. If the MME decides to redirect the UE to the 5GC network, then the
MME rejects the UE\'s attach request and sends an Attach / TAU Reject
with appropriate EMM cause to indicating the UE to be registered in the
5GC network.

NOTE: If 5GC is not available for a UE that is redirected from EPC, it
can lead to the UE returning to EPC. This can be avoided by taking the
5GC coverage into account in the redirection policy in the MME.

3\. Upon target CN type indication in the Attach Reject the UE disables
S1 mode and re-enables the N1 mode if disabled, and the UE starts the
5GC Registration procedure, see Figure4.2.2.2.2-1 in TS23.502\[7\].

If the UE cannot find a cell supporting connectivity to 5GC, the UE
re-enables the S1 mode and attempts to attach to EPC.

4\. After, the 5GC will accept the UE registration as described in the
Figure4.2.2.2.2-1 in TS23.502\[7\].

##### 6.42.4.1.3 Redirection from 5GC to EPC network

Figure 6.42.4.1.3-1: Redirection from 5GC to EPC network

1\. The UE sends the Registration Request as step\#1-3 of
Figure4.2.2.2.2-1 in TS23.502\[7\]. This can be initial, mobility or
periodic registration. The UE includes an indication that it supports S1
mode and its Preferred Network Behaviour. The Preferred Network
Behaviour includes the 5GS/EPS CIoT optimisations the UE supports and
what it would prefer to use. Based on the indication that the UE
supports S1 mode and the Preferred Network Behaviour, the AMF knows the
UE can be redirected to EPC.

2\. AMF decides to redirect the UE to the EPC, the AMF rejects the UE\'s
Registration Request and sends a Registration Reject with appropriate MM
cause to indicating to the UE to attempt a registration in the EPC
network.

NOTE: If EPC is not available for a UE that is redirected from 5GC, it
can lead to the UE returning to 5GC. This can be avoided by taking the
EPC coverage into account in the redirection policy in the AMF.

3\. Upon CN type indication in the Registration Reject, the UE disables
the N1 mode and re-enables the S1 mode if disabled, and the UE starts
the EPC Attach or TAU procedure, see Figure5.3.2.1-1 in
TS23.401\[4\].

If the UE cannot find a cell supporting connectivity to EPC, the UE
re-enables the N1 mode and attempts to attach to 5GC.

4\. After, the EPC will accept the UE Attach/TAU as described in the
Figure5.3.2.1-1 in TS23.401\[4\].

##### 6.42.4.1.4 Interaction with Steering of Roaming

If the AMF rejects the registration request and redirects the UE to EPC,
the steering of roaming as described in AnnexC in TS23.122\[21\]
cannot be applied. In this case the UE may be redirected to EPC as
described in this solution.

### 6.42.5 Impacts on existing entities and interfaces

EPC impacts:

\- If a MME determines that the UE needs to be redirected to other
system, then MME needs to use a appropriate EMM cause and notify to the
UE in NAS layer.

5GC impacts:

\- AMF uses an appropriate EMM cause and notifies to the UE over NAS.

UE impacts:

\- UE needs to understand the NAS rejection value and performs actions
accordingly, i.e. disable the S1 or N1 mode.

### 6.42.6 Evaluation

This solution uses a NAS level indication in registration/attach
rejection to indicate to the UE that the N1/S1 mode needs to be
disabled. The UE then disables the N1/S1 mode and performs an
attach/registration to the target CN type. The solution uses existing
procedures.

NOTE: Whether a new cause value needs to be defined for a redirection,
is up to Stage 3.

6.43 Solution 43: RRC based Redirection between Core networks
-------------------------------------------------------------

### 6.43.1 Introduction

This RRC based solution applies to Key issue 15 of load balancing the
UEs between the two systems.

### 6.43.2 Functional Description

This solution provides a procedure to redirect the UE between the 5GC or
EPC by the network over a RRC notification.

Proposed to re-use the \"***target CN indication\"*** in the N2 release
message by the AMF (in Rel-15 specified for Emergency Services) for the
load balancing purpose. In this case, when the AMF is notified (e.g. by
O&M) or determines based on local policy, and UE\'s Preferred Network
Behaviour, then the AMF triggers N2 release with an indication to
redirect the UE to the target CN. After, the UE performs Attach/TAU
procedure in EPC.

In addition, similar indication needs to be introduced in the S1-AP
interface i.e. MME will indicate the RAN to perform the redirection of a
UE to the target 5GC system which will be notified to the UE in the RRC
release. In fact, similar mechanism is defined in TS36.413\[22\]
(cause IE \"Load Balancing TAU Required\") for load balancing between
MMEs within the EPC. Similar, upon determining (e.g. by O&M notification
or by local policy, and UE\'s Preferred Network Behaviour) by the MME
that the UE(s) needs to move to target network, then MME will trigger UE
context release command with a cause IE i.e. target CN information (i.e.
5GC) to the RAN which is notified to the UE in the RRC release, thus UE
can perform the registration procedure in target CN system (i.e. 5GC).
In addition, MME may provide the RFSP Index and handover restriction
list to the RAN which allows the RAN to set proper camping policies to
the UE to ensure the UE stays in 5GC when it returns to Idle mode, and
to prevent handovers to 5GC in Connected mode. After, the UE performs
registration procedure in 5G system.

NOTE: Idle-mode camping policies are not supported for NB-IoT UEs.

Editor\'s note: It is FFS if the target CN needs to know that the UE has
been redirected.

### 6.43.3 Support of EPC interworking

TS23.501\[5\], clause5.17 applies when a registered/connected UE(s)
is moved to 5GC or EPCsystems.

### 6.43.4 Procedures

#### 6.43.4.1 Redirection using RRC indication

##### 6.43.4.1.1 General

The network will redirect the UEs to the target system based on load
balancing determination as below.

##### 6.43.4.1.2 Redirection from EPC to 5GC network

Figure 6.43.4.1.2-1: Redirection from EPC to 5GC network

0\. A UE is attached to the EPC network. As part of Attach / TAU
procedure, the UE includes an indication that it supports N1 mode and
its Preferred Network Behaviour. The Preferred Network Behaviour
includes the 5GS/EPS CIoT optimisations the UE supports and what it
would prefer to use. Based on the indication that the UE supports N1
mode and the Preferred Network Behaviour, the MME knows the UE can be
redirected to 5GC.

1\. If the MME has determined that the UE need to be redirected to the
5GC, when the MME releases the S1 context, the MME includes an
indication of the target CN information (i.e. 5GC) to the Initial
Context Release command.\
\
In addition, MME may provide the RFSP Index to the RAN which allows the
RAN to set proper camping policies to the UE to ensure the UE stays in
5GC when it returns to Idle mode.

NOTE1: Defining the appropriate cause value of indication is up to the
Stage 3.

2\. RAN node will release the RRC connection with an indication of the
target core network type and idle-mode camping policies.

3\. RAN node sends the Release complete to the MME.

4\. After the RRC release, the UE attempts to perform a registration
procedure to the 5G system.

The AS layer in the UE informs the NAS about the CN type. If the UE
finds a cell supporting connection to 5GC, NAS layer sends a
Registration Request to 5GC based on the target CN type from the AS
layer.

The AMF gets the UE context from EPC as described in the clause4.11 in
TS23.502\[7\], if the N26 interface exists.

5\. The AMF sends the Registration Accept to the UE. Afterwards, the AMF
may provide a handover restriction list to the RAN to prevent the
handovers to EPC.

##### 6.43.4.1.3 Redirection from 5GC to EPC network

Figure 6.43.4.1.3-1: Redirection from 5GC to EPC network

0\. A UE is registered in the 5G system. As part of Registration
procedure, the UE includes an indication that it supports S1 mode and
its Preferred Network Behaviour. The Preferred Network Behaviour
includes the 5GS/EPS CIoT optimisations the UE supports and what it
would prefer to use. Based on the indication that the UE supports S1
mode and that Preferred Network Behaviour, the AMF knows the UE can be
redirected to EPC.

1\. If the AMF has determined that the UE need to be redirected to the
EPC, when the AMF releases the N2 connection, the AMF includes an
indication of the target CN information (i.e. EPC) to the N2 release
command.\
\
In addition, AMF may provide the RFSP Index to the RAN which allows the
RAN to set proper camping policies to the UE to ensure the UE stays in
EPC when it returns to Idle mode.

2\. RAN triggers RRC release procedure includes target CN indicated
received in N2 procedure is conveyed to the UE.

3\. RAN sends N2 release acknowledgement to the AMF.

4\. Based on the RRC indication, the UE attempts to perform the
registration procedure i.e. mobility Attach or TAU procedure in EPC.

The AS layer in the UE informs the NAS about the available and target CN
types. If the UE finds a cell supporting connection to EPC, the NAS
layer sends an Attach or TAU Request to EPC based on the target CN type
from the AS layer.

The MME retrieves the UE context from 5GC as described in the
clause4.11 in TS23.502\[7\], if the N26 interface exists.

NOTE: As per current procedures the AS layer indicates the available
core networks to the NAS layer. If the target CN is not available for
the UE, the UE stays registered in the source core network.

5\. After, the MME sends the Attach/TAU Accept message to the UE. The
MME may provide a handover restriction list to the RAN to prevent
handovers to 5GC.

### 6.43.5 Impacts on existing entities and interfaces

EPC impacts:

\- If a MME determines that the UE needs to be redirected to other
system, then the MME needs to create an appropriate cause and notify to
the RAN in S1-AP.

\- RAN needs to provide the redirection indicationin RRC to the UE.

5GC impacts:

none identified.UE Impacts:

\- The UE needs to understand redirection indication and perform actions
accordingly. The existing redirection indication in RRC Connection
Release (cnType) in WB-E-UTRAN can be reused and a similar indication
needs to be added for NB-IoT.

NOTE: Defining the appropriate cause value of indication is up to the
Stage 3.

### 6.43.6 Evaluation

This solution uses an RRC level indication in RRC connection release
after the registration/attach procedure to indicate to the UE that the
target CN type needs to be selected. Such procedure exists for 5GS, but
a similar procedure for EPS would need to be specified. Handovers and
idle-mode mobility to the old CN type are prevented using existing
procedures. The solution is not applicable for NB-IoT UE. Idle-mode
mobility to the old CN type cannot be prevented if the operator uses the
same RAT type(s) and frequencies in both EPS and 5GS.

6.44 Solution 44: C-IoT UE Core Network selection based on S-NSSAIs
-------------------------------------------------------------------

### 6.44.1 Introduction

This solution applies to Key Issue 15: Core Network selection for
Cellular IoT.

### 6.44.2 Functional Description

#### 6.44.2.1 General

The following applies for Whether and how the 5GS C-IoT feature(s) are
indicated to UE:

\- An NG-RAN node that supports access to both EPC and 5G-CN is
configured to broadcast in system information broadcast the **5G
Cellular IoT support information**.

NOTE1: For WB-E-UTRAN/EPS there already exists SIB2 broadcast of
\"up-CIoT-EPS-Optimisation-r13\" and/or \"cp-CIoT-EPS-Optimisation-r13\"
(see TS36.331\[23\]). Therefore the UE receives information on C-IoT
support for both EPC and 5G CN with no impacts to EPS.

The UE supporting both EPC and 5G Cellular IoT and requiring Cellular
IoT services performs CN selection as follows:

\- The UE first checks in SIB whether there is 5G Cellular IoT
information. If the 5G Cellular IoT support is present and consistent
with UE required Cellular IoT feature(s), the UE selects 5G CN.

NOTE2: Whether 5G C-IoT may have incompatible support scenarios is
dependent on the conclusion of other key issues in this TR.

\- If the UE does not find in SIB 5G Cellular support information
consistent with its own requirements, the UE checks the presence of
\"up-CIoT-EPS-Optimisation-r13\" and/or
\"cp-CIoT-EPS-Optimisation-r13\". If the EPC CIoT support is compatible
with UE EPC CIoT support (e.g. UE and EPS support Control Plane CIoT EPS
optimization), the UE selects EPC.

UE Cellular IoT indication of Requested 5G Cellular IoT feature:

\- When the UE initiates RRC connection establishment procedure, the UE
indicates which CN is selected as per Rel15 for E-UTRA.

\- If the UE selected EPS, the UE proceeds as per TS23.401\[4\].

\- If the UE selected 5G CN, the UE further indicates Requested 5G
Cellular IoT support information in RRC. The NG-RAN uses this
information for AMF selection.

\- The UE furthers indicates the Requested 5G Cellular IoT support
information at NAS layer for the AMF to perform SMF selection based on
this information.

#### 6.44.2.2 5G Cellular IoT support information based on S-NSSAIs

The key idea is that 3GPP standardizes S-NSSAI value(s) that correspond
to a specific (set of) 5G Cellular IoT feature(s).

NOTE: This correspondence is dependent on which 5G CIoT features are
selected for normative work.

The 5G Cellular IoT support information as described in clause6.44.2.1
is the S-NSSAI(s). The NG-RAN broadcasts the S-NSSAI(s) corresponding to
5G Cellular IoT features.

In this option, the Requested 5G Cellular IoT support information as per
clause 6.44.2.1 is an S-NSSAI in the Requested NSSAI.

The UE already includes the Requested NSSAI in RRC and in NAS, the
NG-RAN node already performs AMF selction based on Requested NSSAI.
Therefore, this option does not have RRC or NAS signalling impacts, and
no impacts to AMF selection, as it reuses Network slicing feature for
those aspects.

### 6.44.3 Support of EPC interworking

By broadcasting C-IoT support in 5G CN, the UE can select the
appropriate CN type based on C-IoT support before initiating RRC
connection establishment procedures.

### 6.44.4 Procedures

Figure6.44.4-1 shows the call flow for Core Network selection for
Cellular IoT.

Figure 6.44.4-1: Core Network Selection

1\. The NG-RAN broadcasts 5G Cellular IoT support information in SIB via
S-NSSAIs and also broadcasts \"up-CIoT-EPS-Optimisation-r13\" and/or
\"cp-CIoT-EPS-Optimisation-r13\" for EPS CIoT support if it applies.

2\. The UE uses the received broadcasted information to perform CN
selection with the criteria described in clause6.44.4.1.

**A) UE selects 5G CN, use of S-NSSAI.**

3a. The UE initiates Registration procedure including the S-NSSAI
corresponding to the UE 5G CIoT features in the Requested NSSAI in both
RRC and NAS. Registration procedure continues as per TS23.501\[5\]
using regular Network slicing feature for AMF selection, Allowed NSSAI,
etc. The UE receices in the Allowed NSSAI an S-NSSAI corresponding to
the 5G CIoT features enabled by the network.

4b. The NG-RAN takes into consideration the Requested 5G CIoT support
information when selecting the AMF.

5b. Registration procedure continues as per TS23.501\[5\] with the
following modifications. The AMF decides based on the UE Reqeusted 5G
CIoT support information, netowrk support, subscription information
and/or local policies what is the Allowed 5G CIoT support information,
and provides it to the UE in registratrion accept message. UE knows
which features are enabled based on the Allowed 5G CIoT support
information.

**B) UE selects EPC.**

3b**.** Attach/TAU procedure as per TS23.401\[4\]

### 6.44.5 Impacts on existing entities and interfaces

In UE:

\- Receive broadcast information regarding 5G CIoT support.

\- Perform CN selection based on which 5G CIoT features are supported in
5G CN and/or EPC.

\- Know S-NSSAI value corresponds to certain 5G CIoT feature(s).

In NG-RAN:

\- Broadcast in SIB new information for 5G Cellular IoT support.

### 6.44.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.45 Solution 45: Core Network Type and Node Selection for CIoT UE Using Explicit Indications
---------------------------------------------------------------------------------------------

### 6.45.1 Introduction

This clausepresents a solution for Key Issue 15: Core Network selection
for Cellular IoT. It addresses the requirements captured in the key
issue to support core network type selection at UE, core network node
selection at RAN, AMF and MME.

### 6.45.2 Functional Description

When camping on an E-UTRA cell connected to both EPC and 5GC, in order
to support UEs with different capabilities in the same network, the eNB
that supports access to 5GC broadcasts that it can connect to 5GC (as
described in TS23.501\[5\], clause5.17.1). In addition, RAN
broadcasts the 5G CIoT optimisations supported by the 5GS via
NB-IoT/WB-E-UTRA access. The UE AS layer indicates the 5G CIoT
optimisations broadcast to the UE NAS layer as well as the \"E-UTRA
connected to 5GC\" capability. The UE selects a core network type (5GC
or EPC) taking into account the CIoT optimisations broadcast for each
network type and which optimisations the UE supports and prefers.

The UE AS layer is made aware of whether a NAS signalling connection is
to be initiated to 5GC (the existing \"5GC requested\" indication) and
additionally the 5GS CIoT optimisations supported. The UE shall inform
RAN of the \"5GC requested\" and the supported 5GS CIoT optimisations in
an RRC message during the RRC connection establishment procedure. The
RAN will take those optimisations supported by UE and AMF supported
optimizations into account for AMF selection when 5GC is requested.

When the UE performs the registration procedure it includes its
Preferred Network Behaviour in the Registration Request message and the
AMF replies with the Supported Network Behaviour in the Registration
Accept message. The Preferred Network Behaviour indicates the Network
Behaviour the UE can support and what it would prefer to use. The
Supported Network Behaviour indicates the 5G CIoT Optimisations the
network accepts.

### 6.45.3 Support of EPC interworking

The supported CIoT optimisations broadcast for EPC and 5GC allows a UE
to select the CN type before initiating the RRC connection
establishment. The optimisations indicated to the RAN during RRC
connection establishment allows RAN to select an AMF in 5GC.

### 6.45.4 Procedures

#### 6.45.4.1 Registration Procedure

Steps 1-23 are executed according to TS23.502\[7\], clause4.2.2.2.2
with the following changes:

Step 1: The UE includes the Preferred Network Behaviour in the
Registration Request message.

Step 21: The AMF includes the Supported Network Behaviour in the
Registration Accept message.

Editor\'s note: The granularity of CIoT optimisations indicated in the
Preferred and Supported Network Behaviour is FFS.

#### 6.45.4.2 Core network type selection at UE and AMF selection at RAN

Figure 6.45.4.2-1: Core network type selection at UE and AMF selection
at RAN

1\. The RAN is connected to both EPC and 5GC, and broadcasts the
following information:

\- 5GC Connected Indication: indicate that RAN can connect to 5GC (as
described in TS23.501\[5\], clause5.17.1), and

\- EPS CIoT optimisations that the network supports (as described in
TS23.401\[4\], clause5.3.2.1), e.g., *up-CIoT-EPS-Optimisation*,
c*p-CIoT-EPS-Optimisation*, and

\- whether it supports 5GS CIoT optimisations and it can connect to an
AMF that supports 5GS CIoT optimisations.

Editor\'s note: The granularity of 5GC CIoT optimisations to be
broadcasted are for FFS.

2\. The UE selects the core network type (EPC or 5GC) based on the
broadcast indications for both EPC and 5GC, and the UE\'s Preferred
Network Behaviour.

3\. 5GC is selected and the UE indicates the 5GS CIoT optimisations
supported by UE, which is used for AMF selection, to RAN at RRC layer.

Editor\'s note: The granularity of CIoT optimisations to be indicated
over RRC layer are for FFS.

4\. In addition to the existing AMF selection behaviour, the 5GS CIoT
optimisations information supported by UE and AMF is taken into account
when the RAN selects an AMF.

5\. RAN sends Initial UE Message to the selected AMF.

### 6.45.5 Impacts on existing entities and interfaces

Enhancements on UE include the following:

\- Core network type selection based on UE\'s Preferred Network
Behaviour, and CIoT optimisations broadcast by the RAN that connects to
both EPC and 5GC;

\- Indicate the Preferred Network Behaviour to the MME during Attach/TAU
procedure or to AMF during Registration procedure;

\- Indicate the 5GS CIoT optimisations supported by UE, which is for AMF
selection, to RAN during the RRC connection establishment procedure.

Enhancements on RAN include the following:

\- Take the 5GS CIoT optimisations supported information from UE into
consideration in case of AMF selection.

### 6.45.6 Evaluation

This solution addresses the architectural requirements for key issue15
i.e. UE selecting a core network type taking into account:

\- the CIoT optimizations broadcast by the RAN for each network type
(EPC, 5GC); and

\- the CIoT optimizations supported by the UE.

This solution supports Preferred and Supported network behavior based on
the same principles as in EPS. The difference is in terms of the
preferred and supported network behavior parameters information for 5G
system.

6.46 Solution 46: Network controlled UL data transmission delay
---------------------------------------------------------------

### 6.46.1 Introduction

UE transmitting power is sensitive to the link quality, for example, the
transmitting power under -100dBm coverage is about 100 times than the
power under -80dBm. In the current mechanisms, when uplink data arrives,
the UE will attempt to transmit the data in any coverage condition, e.g.
in weak coverage, or in enhanced coverage. When in weak coverage, UE
will transmit the data with maximum TX power, and maybe try many times;
when in enhanced coverage, UE will repeat tens of re-transmission, all
of which consume greatly UE power.

For some IoT applications that do not require urgent transmission; these
applications are very tolerant with transmission delay, e.g. daily
routine data report, etc. This solution allows the UE to choose a time
with better coverage to transmit uplink data under the tolerant time for
more power saving purpose.

The AF shall have some prior knowledge on the maximum delaye time the UE
reports the monitored data, then AF can know the exact time at which AF
can collect the reported data. For example, UE is configured to report
daily routine data to the AF at 8:00 am each day, and this routine data
may contain the data of 24hour (from 8:00 am to 8:00 am). If one hour
delayed time is configured to the UE, the AF knows the UE may not report
the data at 8:00 am and may report at 9:00 pm.

### 6.46.2 Functional Description

This clausedescribes the solution for uplink data. In this solution,
the network authorizes the UE to delay the uplink data transmission
within the configured delay tolerant window. UE can find a better
coverage during the authorized delay tolerant window, when there is
uplink data to be transmitted. Some assumptions and requirements are
made.

1\) The services characteristic can be subscribed, and the AMF/SMF can
obtain the subscribed service characteristic information.

2\) The mechanism to establish PDU Session and data transmission depends
on the solution defined in other key issues.

3\) There is a direct or indirect interface between the SMF and the AF
for information exchange.

### 6.46.3 Support of EPC interworking

Not applicable since there is no corresponding mechanism specified in
EPC.

### 6.46.4 Procedures

This clausedescribes high-level procedures and information flows for
the solution.

Figure 6.46.4-1: Delay UL transmission for MO case

1\. UE initiates PDU Session Establishment Request, indicating to the
SMF that UE is requesting delayed transmission and the identity of the
AF the UE intends to transmit data to in this PDU Session.

2\. After receiving the request, the AMF selects the SMF and send
Nsmf\_PDUSession\_CreateSMContext Request to SMF (with delayed
transmission indication and AF identity).

3\. SMF verifies in the UE subscription information the validity of the
UE request.

4\. Optionally, SMF can interact with AF via direct or indirect
interface to obtain the allowed delay time window from the AF the UE
requests. Or SMF can obtain the allowed delay time window based on UE
subscription information.

Editor\'s note: The way how the SMF identifies the AF in this case is
FFS.

Editor\'s note: Security issues need to be considered for a direct
interaction between SMF and AF. Indirect interaction need to be
detailed.

5-6. The SMF accepts the PDU Session to the UE with the delay time
window.

NOTE: The delayed time window can also be configured in the UE.

7\. When UL data belonging to the PDU Session arrives from the
application, UE can choose to wait for a better coverage to send UL data
within the delay time window. It can be based on UE implementation or
radio signal quality thresholds configured in the UE via device
management, to determine whether the coverage is really bad. Or, the
operator may configure the UE with lower signal quality thresholds so
that the UE employs the transmission delay behavior only when the
current radio coverage is really bad or the worst coverage (e.g. the UE
is close to cell borders or coverage hole).

Editor\'s note: It is FFS how the UE can predict whether the coverage is
likely to improve or degrade during the delayed time window, e.g. if the
UE is close to a coverage hole.

8\. The AF expects the UL data could be received not later than the
allowed delayed time window.

### 6.46.5 Impacts on existing entities and interfaces

\- New API allowing the AF to provision the network via the NEF with
delayed tolerant service requirements.

\- UE, AMF and SMF to support the new function to establish a delay
tolerant PDU Session.

\- Delay tolerant indication needs to be added in PDU Session
Establishment Request.

\- The delay time window is optionally added in PDU Session
Establishment Accept.

### 6.46.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

6.47 Solution 47: Improved Signalling/Data plane separation for Data over NAS small data solutions
--------------------------------------------------------------------------------------------------

### 6.47.1 Introduction

This solution applies to Key Issue 1: Support for infrequent small data
transmission and Key Issue 2: Frequent small data communication.

The solution is applicable as an addition to solutions 1, 2, 3, 6 and
40.

### 6.47.2 Functional Description

To enable more independent scalability of the data plane and signalling
plane security functions for \"Data over NAS\", it is proposed that
different encryption and integrity protection key sequences are used for
\"data\" and for \"signalling\".

This approach was used in 2G-GPRS but was ignored in R13 CIoT
optimisations.

### 6.47.3 Support of EPC interworking

The EPC security mechanisms are used in EPC, e.g. EPC security is
enabled during the TAU to EPC, and 5GC security is enabled during TAU to
NG-RAN.

### 6.47.4 Procedures

These are the same as in the base solution, except that for:

\- Integrity protection, ciphering and header compression:

\- Integrity protection and ciphering for small data are performed by
AMF (existing NAS PDU integrity protection and ciphering functionality
are re-used, except that the \"data over NAS\" PDUs use a per-PDU
session parameter (and which is different to those used for NAS
signaling) for the \"BEARER\" input to the NAS integrity and
confidentiality algorithms).

NOTE: The \"Data over NAS\" PDU already has to carry information on the
PDU session to enable routing towards the correct data network, etc.
However, this information would now need to be sent unencrypted.

TS33.501\[25\] is very closely modelled on TS33.401\[24\] and both
these specifications use a parameter called BEARER as an input into the
generation of the key sequences for the confidentiality and integrity
protection.

However, currently the BEARER parameter is not used fully within the NAS
security. TS33.401\[24\] clause8.1.1 (\"NAS input parameters and
mechanism\") states \"*The BEARER identity is not necessary since there
is only one NAS signalling connection per pair of MME and UE, but is
included as a constant value so that the input parameters for AS and NAS
will be the same, which simplifies specification and implementation
work*\".

This creates the opportunity to use (in a somewhat similar manner to
GPRS) different security streams for signalling and data (and different
security streams per PDN connection) by setting the BEARER parameter
according to the PDU session ID.

As TS33.501\[25\] is still under development, some extracts from
TS33.401\[24\] are copied below:

*Annex B*

/..../

*The input parameters to the ciphering algorithm are a 128-bit cipher
key named KEY, a 32-bit COUNT, a 5-bit bearer identity BEARER, the 1-bit
direction of the transmission i.e. DIRECTION, and the length of the
keystream required i.e. LENGTH. The DIRECTION bit shall be 0 for uplink
and 1 for downlink.*

/.../

Figure B.1-1: Ciphering of data

/..../

Figure B.2-1: Derivation of MAC-I/NAS-MAC (or XMAC-I/XNAS-MAC)

/ end of extracts from TS33.401\[24\] /

### 6.47.5 Impacts on existing entities and interfaces

The UE and the security termination point in the network (e.g. AMF) need
to have a common way to generate the PDU Session ID, and, then need to
use it with their existing implementations of the confidentiality and
integrity algorithms.

### 6.47.6 Evaluation

Editor\'s note: This clauseprovides an evaluation of the solution.

Editor\'s note: This solution needs to be evaluated by SAWG3.

6.48 Solution 48: NB-IoT idle mode inter-RAT mobility reusing EPS features
--------------------------------------------------------------------------

### 6.48.1 Introduction

This solution addresses KI\#12 Inter-RAT mobility support to/from
NB-IoT.

The Key Issue as a baseline assumes the radio capabilities for NB-IoT
are different to those for WB-E-UTRAN and NR, therefore 2 sets of
capabilities are maintained by the AMF. In the KI the SMF is also
responsible for whether a PDU session is maintained, reconnected or
released. Both of these aspects are described in this solution.

In order to support the baseline and architectural requirement from the
key issue, the relevant features are reused from EPS for NB-IoT idle
mode inter-RAT mobility.

### 6.48.2 Functional Description

#### 6.48.2.1 General

Inter-RAT mobility to/from NB-IoT, follows the existing limitations in
EPS and is limited to idle mode mobility only.

#### 6.48.2.2 UE Radio Capability Handling

A UE only provides its NB-IoT radio capabilities to the network over
NB-IoT and these are stored separately from radio capabilities from
other RATs by the AMF.

When the UE Radio Capabilities are sent to the RAN, only the related
capabilities for the RAT type the UE is using are sent to RAN, e.g. if
the UE is using NB-IoT then only the NB-IoT radio capabilities are sent
to RAN.

#### 6.48.2.3 PDU Session Handling

PDU session handling is controlled by \"PDU session continuity at inter
RAT mobility information\" in the UDM, which indicates per DNN/S-NSSAI
whether to:

\- maintain the PDU session;

\- disconnect the PDU session with a reactivation request;

\- disconnect the PDU session without reactivation request;

\- leave it up to local VPLMN policy.

when the UE moves between a \"broadband\" RAT (WB-E-UTRAN or NR) and a
\"narrowband\" RAT (NB-IoT).During PDU session establishment the SMF
retrieves the \"PDU session continuity at inter RAT mobility
information\" (if available) from the UDM. Local SMF configuration is
used when the UDM provides no information.

The AMF informs the SMF at an inter-RAT idle mobility event, e.g.
between NB-IoT connected to 5GC and WB-EUTRAN or NR connected to 5GC
about a RAT type change in the Nsmf\_PDUSession\_UpdateSMContext message
during the Registration procedure. Based on this (h-)SMF handles the PDU
session according to \"PDU session continuity at inter RAT mobility
information\" from the UDM or based on local policy.

NOTE: The \"PDU session continuity at inter RAT mobility information\"
and \"PDN continuity at inter-RAT mobility\" subscription should be the
same so that the PDU sessions/PDN connections are handled the same by
both CN types.

#### 6.48.2.4 Determining RAT Type Change

Dedicated TAIs are used for NB-IoT; AMF ensures that the TAI list that
is allocated either only contains TAIs of NB-IoT or other RAT types.
This approach ensures that a Registration request is triggered when the
UE moves to or from NB-IoT.

As documented in 23.502\[7\], the AMF determines the RAT Type based on
the Global RAN Node ID associated with the N2 interface. In other words,
as per Rel-15 AMF distinguishes WB-EUTRA from NR based on the node type
(gNB vs. NG-eNB).

By additionally considering the dedicated TAIs assigned for NB-IoT, the
AMF distinguishes WB-EUTRA and NB-IoT (which are both served by an
NG-eNB).

For mobility to EPC, the MME can continue to determine whether the RAT
type has changed based on TAIs that can only be assigned to an NB-IoT
RAT type or other RAT types, and a TAI List cannot mix NB-IoT RAT types
with other RAT types.

When the RAT type has changed the SMF(s) are informed to allow them to
update the PDU sessions accordingly. The SMF also stores the last RAT
type to help with the PDU session handling.

### 6.48.3 Support of EPC interworking

Idle-mode mobility from 5GS to EPS and from EPS to 5GS is performed as
per the procedure described in TS23.502\[7\] clause4.11.1.3.2 and
clause4.11.1.3.3 respectively.

For Idle-mode mobility from 5GS to EPS, the \"PDN continuity at inter
RAT mobility\" which is received in the subscription information from
HSS is taken into account by the target MME to decide how to handle the
PDU session.

After the Idle-mode mobility from EPS to 5GS, SMF interacts with UDM to
retrieve the subscription information for the PDU session, the \"PDU
session continuity at inter RAT mobility information\" included in the
subscription is taken into account by the SMF to decide how to handle
the PDU session.

### 6.48.4 Procedures

#### 6.48.4.1 RAT change with mobility between 5GC and EPC with N26

When idle mode inter-RAT mobility includes changing the core network
type, i.e. between EPC and 5GC and vice versa, at the same time as
changing RAT types no additional procedures are required.

The procedure for idle mode mobility towards EPC defined in
TS23.502\[7\] clause4.11.1.3.2 is reused (5GS to EPC handover with
N26). When mobility towards EPC occurs, the MME performs the actions
related to RAT type change defined in TS23.401\[4\], clause5.3.3.1
(tracking area update procedure with S-GW change), i.e. take the \"PDN
continuity at inter RAT mobility\" into account and perform the relevant
actions.

The procedures for idle mode mobility towards 5GC defined in
TS23.502\[7\] clause4.11.1.3.3 (EPS to 5GC Mobility Registration
using N26) are reused. If there is the subscription information for the
PDU session in the SMF, the SMF then subsequently maintains, reconnects
or releases the PDU session according to the \"PDU session continuity at
inter RAT mobility information\". If there is no subscription
information for the PDU session in the SMF, SMF first retrieves the
\"PDU session continuity at inter RAT mobility information\" from the
UDM and then decides how to handle the PDU session.

#### 6.48.4.2 RAT change with mobility between 5GC and EPC without N26

When idle mode inter-RAT mobility includes changing the core network
type, i.e. between EPC and 5GC and vice versa, at the same time as
changing RAT types no additional procedures are required.

The procedure defined in TS23.501\[5\] clause5.17.2.3.2 (Mobility for
UEs in single-registration mode) is reused with the following addition:

\- If the network determines that the UE is changing RAT type, if the UE
requests to relocate the PDU session from EPC to 5GC or 5GC to EPC, the
SMF/MME uses the \"PDU session continuity at inter RAT mobility\" or
\"PDN continuity at inter-RAT mobility\" information, respectively, in
the subscription to determine whether to maintain the PDU session/PDN
connection (if being handed over) or reject the PDU session request,
with the relevant cause.

\- If the UE requested to move the PDU session and the \"PDN continuity
at inter RAT mobility\" information indicated \"disconnect the PDN
connection with a reactivation request\" the network should provide a
suitable cause code to the UE so that it can request a new PDU session.

#### 6.48.4.3 RAT change without mobility between 5GC and EPC

When the UE remains connected to 5GC but is performing idle mode
inter-RAT mobility, the registration procedure defined in
TS23.502\[7\], clause4.2.2.2.2 is reused. As specific TACs are
allocated for NB-IoT, the procedure is triggered by the UE when the UE
moves between NB-IoT and \"broadband\" RAT (WB-E-UTRAN or NR). In this
case the following steps are updated to account for the idle mode
mobility:

\- Steps 4 and 5 fetch the MM context from the old AMF in the case of
AMF change.

\- Step 17 is executed when RAT Type change occurs the
Nsmf\_PDUSession\_UpdateSMContext service is used to inform the SMF(s)
about the RAT type change for all PDU sessions where the UE has not
released them. If any PDU session are released by the UE then the
Nsmf\_PDUSession\_ReleaseSMContext is used instead as currently defined.

Step 17 of the procedure invokes steps 5 onwards, without the N11 and N2
interactions, of TS23.502\[7\] clause4.2.3.2 (UE triggered service
request). In the procedure when the SMF receives the indication that the
RAT Type has changed it uses the stored \"PDU session continuity at
inter RAT mobility\" information to determine whether to maintain the
PDU session (if being handed over) or reject the PDU session request,
with the relevant cause.

#### 6.48.4.4 Determining RAT Type Change

No additional procedures are required to determine RAT type change.

The RAT type the UE is currently using is stored in the UE context so
that the AMF can determine that the RAT type has changed. The SMF also
stores the current RAT type that a PDU session is using so it can
determine whether the RAT type for the PDU session has changed.

### 6.48.5 Impacts on existing entities and interfaces

UDM:

\- The subscription data is updated to include \"PDU session continuity
at inter RAT mobility information\".

SMF:

\- Retrieval and use of \"PDU session continuity at inter RAT mobility
information\" when PDU sessions are created.

\- Handle indication of idle mode inter-RAT mobility and update PDU
Session(s) based on \"PDU session continuity at inter RAT mobility
information\" or local policy.

AMF:

\- Retrieval and separate storage of NB-IoT radio capabilities and
supply only the relevant radio capabilities depending upon the RAT type
in use to RAN.

\- Determine RAT Type change based on Global RAN Node and TAIs.

\- Inform SMF about RAT Type change during the UE triggered registration
procedure.

### 6.48.6 Evaluation

This solution addresses architectural baseline and requirements of Key
Issue \#12 while addressing the open issues for handling PDU sessions at
idle mode inter-RAT mobility. The solution follows the principles use by
EPC to determine the actions (maintain or disconnect, with or without
reactivation request, or left to VPLMN policy) for a PDU session being
stored in the subscription data or in the absence of subscription data
local policy can be used.

6.49 Solution 49: Support for RDS with infrequent small data transmission solutions \#1, 2, 3
---------------------------------------------------------------------------------------------

### 6.49.1 Introduction

This solution for RDS that can be build on top of existing solutions1,
2, 3. Solution4 already has support of RDS so nothing additional is
needed for Solution4 to support RDS.

The following principles apply to this solution:

\- RDS runs between two end-points of an unstructured PDU session i.e.
between UE and UPF, or between UE and NEF.

\- Protocol for Reliable Data Service between UE and SCEF (as defined in
TS24.250\[8\]) is used for RDS.

\- For a PDU Session between UE and NEF, the NEF exposes APIs to the
AF/AS for Small Data transmission. The APIs are based on the NIDD APIs
which are defined for the T8 interface in TS29.122\[9\].

\- For a PDU Session between UE and UPF, the UPF uses Point-to-Point
(PtP) tunnel N6 mechnisms (similar to Point-to-Point SGi tunnel mechnism
for EPS defined in TS23.401\[4\]).

\- RDS is enabled or disabled based on DNN or NSSAI Configuration per
SLA.

\- The UE indicates its capability of supporting RDS to the network.

\- The NEF or UPF indicates its support for RDS to the UE.

### 6.49.2 Functional Description

Protocol stack diagrams for support for RDS are shown below.

![](media/image132.png){width="6.695833333333334in"
height="2.2555555555555555in"}

Figure 6.49.2-1: RDS protocol between UE and NEF (over NAS-SM)

![](media/image133.png){width="6.604166666666667in"
height="2.3854166666666665in"}

Figure 6.49.2-2: RDS protocol between UE and NEF (over NAS-MM)

![](media/image134.png){width="6.691666666666666in"
height="2.5194444444444444in"}

Figure 6.49.2-3: RDS protocol between UE and UPF

Solution1 requires RDS support between UE and NEF and UE and UPF as
shown in Figure6.49.2-1 and Figure6.49.2-3, respectively.

Solution2 requires RDS support between UE and NEF and UE and UPF as
shown in Figure6.49.2-2 and Figure6.49.2-3, respectively.

Solution3 requires RDS support UE and UPF as shown in Figure6.49.2-3.

In addition, Solution1 needs to be updated to have capability to have
PDU session to NEF.

PDU session to NEF can be based on using new flag \"Invoke NEF
selection\" and \"NEF ID\" associated with each DNN, NSSAI and stored as
part of UE subscription data in the UDM. Based on \"Invoke NEF
selection\" flag SMF (for Solution1) or AMF (for Solution2) selects
the identified NEF and establishes the PDU session to NEF.

The UE indicates its capability of supporting RDS to the network using
PCO and the SMF negotiates RDS support with the NEF or UPF. The SMF
indicates network support for RDS to the UE in the PCO. This is similar
to how it is done in EPS with the SCEF or P-GW (as described in
TS23.682\[6\]).

### 6.49.3 Support of EPC interworking

In addition to the EPC Interworking principles that are described for
Solutions1, 2, and 3, the following principles apply:

\- When the \"Invoke NEF Selection\" flag is present in the UE\'s
subscription information for the PDU Session, the identified NEF will
point to an SCEF+NEF if EPC Interworking is supported.

\- When the \"Invoke NEF Selection\" flag is not present in the UE\'s
subscription information for the PDU Session, the identified SMF will
select a PGW+UPF as the PDU Session anchor.

### 6.49.4 Procedures

Same as defined for Solution1, 2, 3 with additional aspects specified
in clause6.49.2 above.

### 6.49.5 Impacts on existing entities and interfaces

Support of RDS protocol (as defined in TS24.250\[8\]) by UE, NEF and
UPF.

### 6.49.6 Evaluation

This solution provides support of Reliable Data Service using same
design priciples as the support of RDS in EPS and using exisiting RDS
protocol as defined in TS24.250\[8\]. RDS runs between two end-points
of an unstructured PDU session, i.e. between UE and UPF, or between UE
and NEF. This solution offers a flexible approach and can be built on
top of exisiting solutions for infrequent and frequent small data.

6.50 Solution 50: AF Notifications after DDN failure
----------------------------------------------------

### 6.50.1 Introduction

This solution addresses Key Issue 3 (High latency communication) in case
of multiple Application Functions (AFs).

When multiple AFs communicate with a UE, each of them can subscribe to
the \"Availability after DDN failure\" event. When a Downlink Data
Notification (DDN) failure occurs it should be possible for the CN to
notify only a subset of all the AFs that subscribed to the
\"Availability after DDN failure\" event (e.g., only the AF(s) that
previously sent the data which trigged the DDN failure, or only the
AF(s) that want to be notified for a specific traffic type).

### 6.50.2 Functional Description

**When an AF subscribes to the \"Availability after DDN failure\" event,
an application ID which identifies the AF is included in the message.
The event is subscribed to UDM through NEF.**

**When the AF send the downlink data, CN identifies the AF by using the
application detection function. When the UE becomes available, the CN
notifies the AF that has subscribed to the event and sent the data.**

**The function can be divided into Event Subscription and Activate Event
Report:**

\- Event Subscription:

\- AF subscribe the \"availability after DDN failure event\" together
with application ID to NEF. The NEF generate NEF Reference for the
event. The NEF Reference ID identify the correlation between the event
and the AF that subscribe the event.

\- The NEF sends the subscription to AMF via UDM including NEF Reference
ID, Event type(\"availability after DDN failure event\"). The AMF stores
the \"availability after DDN failure\" monitoring event.

\- The NEF sends the subscription to (h)SMF via UDM for existing PDU
Session or during PDU Session establishment. The subscription request
includes NEF Reference ID ,Event type(\"application detection event\")
and Application ID. The (h)SMF activates the application detection in
the (h)UPF for the application ID. The (h)UPF detects the traffic sent
by AF and report to the (h)SMF in the N4 Report message.

\- After receives N4 Report message from the (h)UPF, the (h)SMF notifies
the NEF that the traffic sent by AF has been detected. The NEF maintains
the list of AF which has subscribed the \"UE availability after DDN
failure\" event and sent the downlink data, and need to be notified
after the UE becomes available.

\- The NEF further subscribes the \"UE reachability\" event after
receiving application detection notification from (h)SMF. The AMF stores
the \"UE reachability\" event.

\- Event Report:

\- When the UE is reachable, the downlink data will be delivered to UE
successfully. In this case the AMF notifies the \"UE reachability\"
event to NEF. The NEF then removes the AF list and stop storing any new
detected Application ID into the list.

\- When the UE becomes unreachable, the AMF notifies the NEF. The NEF
then starts to store the new detected Application ID into the list.

\- When the UE is not reachable, the AMF remembers the DDN failure. When
the UE becomes reachable again, the AMF notifies the \"UE availability
after DDN failure\" to the NEF. The NEF then notifies the corresponding
AF that has subscribed the event and sent the data.

### 6.50.3 Support of EPC interworking

The NEF+SCEF subscribes the \"availability after DDN failure event\" to
the MME. After it receives notification from the MME about the \"UE
availability after DDN failure\" event, the NEF+SCEF notifies the
corresponding AF that has subscribed the event and sent the data.

The NEF+SCEF subscribes the application detection event in SMF+PGW-C via
the UDM. When the application is detected in SMF+PGW-C, the SMF+PGW-C
then notifies the NEF+SCEF so the NEF+SCEF can add the application ID in
the AF list and subscribe the \"UE reachability\" event with Idle State
Indication to the MME. After the NEF+SCEF receives notification from the
MME that the UE is reachable, the NEF+SCEF removes the AF list and stop
storing any new detected Application ID into the list. Later when the UE
becomes idle state, the AMF notifies the NEF. The NEF then starts to
store the new detected Application ID into the list.

### 6.50.4 Procedures

#### 6.50.4.1 Event Configuration

The procedure of Event Configuration is depicted in Figure6.50.4.1-1.

Figure 6.50.4.1-1: Event Configuration - Availability Notification after
DDN Failure

1\. The AF subscribes to the \"Availability after DDN failure\" event by
invoking Nnef\_EventExposure\_subscribe(UE ID/Group ID, Application ID,
Availability after DDN failure, DNN/S-NSSAI/AF-Service-ID) service of
the NEF. The \"Availability after DDN failure\" element is used to
identify the event type of the subscription. UE ID can be GPSI and Group
ID can be external group ID.

2\. The NEF receives the request from the AF and invokes
Nudm\_EventExposure\_subscribe (UE ID/Group ID, Availability after DDN
failure, NEF ID, NEF Reference ID) towards the UDM. The NEF Reference ID
is used to identify the correlation between the event and the AF that
subscribe the event. The UDM sends Namf\_EventExposure\_Subscribe
request(Availability after DDN failure, NEF ID, NEF Reference ID) to
AMF. The AMF responds to the request.

3\. The NEF invokes Nudm\_EventExposure\_subscribe (UE ID/Group ID,
Application Detection, DDN/S-NSSAI/AF Service ID, NEF ID, NEF Reference
ID) towards the UDM. The UDM determines the SMF based on the Slice
information, DNN, and/or AF Service ID. The UDM invokes
Nsmf\_EventExposure\_subscribe (Application Detection, Application ID,
NEF ID, NEF Reference ID) towards the (h)SMF.

From UDM to (h)SMF: Nsmf\_EventExposure\_Subscribe(Application
Detection, Application ID, NEF ID, NEF Reference ID).

4\. If the (h)SMF has no Packet Flow Description of the Application ID,
it retrieves the corresponding PFD from the NEF. The (h)SMF activates
the application detection function to detect the traffic of the
Application ID in the (h)UPF by using N4 Session
Establishment/Modification Request.

5\. The (h)SMF acknowledges the execution of
Nsmf\_EventExposure\_Subscribe.

The UDM acknowledges the execution of Nudm\_EventExposure\_Subscribe.

6\. The NEF acknowledges to AF.

7\. (h)UPF receives the downlink data sent by AF.

8\. The (h)UPF detects the application traffic and reports start of the
application by N4 Report message to (h)SMF.

9\. The (h)SMF notifies the application detection event to NEF including
the detected Application ID.

10\. The NEF receives the Application ID and puts it into an AF List.
The AF list is composed of Application IDs and indicates who shall be
notified UE availability after DDN failure event. If not subscription
before, the NEF further subscribes the UE reachability event to AMF via
UDM.

#### 6.50.4.2 Notification

The procedure for notification after DDN failure is depicted in
Figure6.50.4.2-1.

Figure 6.50.4.2-1: Notification - Availability Notification after DDN
Failure

1\. (v)UPF receives the downlink data sent by AF.

2\. (v)UPF sends Downlink Data Notification (DDN) message to the (v)SMF,
on arrival of the first downlink data packet for the QoS flow.

3\. The (v)SMF sends Namf\_CommunicationN1N2MessageTransfer to AMF, if
the (v)SMF has not been notified that the UE is unreachable.

4\. If the UE is reachable, the AMF performs network initiated service
request procedure to bring the UE into CONNECTED mode. The AMF then
notifies UE reachability event to NEF. The NEF removes the AF list and
stop storing any new detected Application ID in the list. The procedure
stops.

Later when the UE becomes unreachable, the AMF sends notification to
NEF, the NEF then starts to store the new detected Application ID in the
list.

5\. If DDN fails (e.g. UE is not reachable), the AMF sends
Namf\_CommunicationN1N2MessageTransfer response to (v)SMF to notify the
DDN failure.

6\. The (v)SMF sends DDN failure indication to UPF.

7\. At some later time, the UE contacts the network, e.g., to perform
registration, or as it executes a service request.

8\. The AMF sends Namf\_EventExposure\_Notify(UE ID) to the NEF to
notify that the UE is available after DDN failure.

9\. The NEF checks the list of AF which has subscribed the event and
sent the downlink data, and sends Nnef\_EventExposure\_Notify(UE ID, NEF
Reference ID) to the AF in that list to notify.

### 6.50.5 Impacts on existing entities and interfaces

NEF:

\- Receives the Application ID from the AF and then requests to
subscribe the \"Availability after DDN failure\" event in AMF, and
invokes Application detection on the application in (h)SMF.

\- Receives the application detection report from (h)SMF and requests to
subscribe \"UE reachability\" event in AMF and maintain a AF list.

\- Receives the notification on UE reachable event from AMF and then
remove the AF list and stop storing the new detected Application ID into
the list.

. - Receives the notification on UE unreachable event from AMF and then
start to store the new detected Application ID into the list.

\- Receives the notification on the \"Availability after DDN failure\"
event from AMF and then notify \"Availability after DDN failure\" event
to the AF identified in the AF list.

UDM:

\- The UDM sends the subscription to \"Application Detection\" to the
(h)SMF for an existing PDU Session or during PDU Session establishment
including Application ID, NEF ID and NEF Reference ID.

\- Sends the \"Availability after DDN failure\" monitoring event
subscription to the AMF.

(h)SMF:

\- The (h)SMF receives new subscription event \"Application Detection\"
from UDM to detect the application.

\- The (h)SMF notifies the NEF that the application has been detected.

AMF:

\- When the UE becomes reachable without DDN failure, the AMF notifies
the NEF on the \"UE reachability\" event.

\- When the UE becomes reachable after DDN failure, the AMF notifies the
NEF on the \"Availability after DDN failure\" event.

### 6.50.6 Evaluation

The solution proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF
provides the Application ID during the Event Configuration procedure,
and the (h)SMF use application detection function to detect the
application traffic in the (h)UPF. For PDU Session with home routed it
is the home SMF to active the application detection in the home UPF. The
NEF subscribes the \"Availability after DDN failure\" in the AMF and to
notify the AF that has subscribed the event and has sent packet data.

The solution addresses the architectural requirements for key issue3
\"Provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable)\".

6.51 Solution 51: Core Network steering via CN type selection rules configuration/reconfiguration
-------------------------------------------------------------------------------------------------

### 6.51.1 Introduction

This solution covers the redirection of a C-IoT UE from 5GC to EPC and
viceversa, as per Key issue \#15.

### 6.51.2 Functional Description

The proposed solution is as follows:

\- It is proposed to add a new UE configuration parameter named \"CN
type selection rules\". The CN type selection rules are PLMN specific
and may be provided in USIM (by HPLMN), or provided by the visited PLMN
during registration procedure or via UE configuration update procedure
or during registration in registration accept message.

\- CN type selection rules provided by the HPLMN:

\- The CN type selection rules that apply to the HPLMN are provided by
the HPLMN either in USIM or in ME via a NAS information element in
registration accept message or via UE configuration update. The CN type
selection rules values may be:

\- Prefer 5GC over EPC.

\- The UE shall select 5GC over EPC when 5GC is available for this PLMN.

\- The UE can still select EPC when 5GC not available.

\- Prefer EPC over 5GC.

\- The UE shall select EPC over 5GC when EPC is available for this PLMN.

\- The UE can still select 5GC when EPC not available.

Editor\'s note: How to avoid frequent CN type changes resulting from the
CN type selection rule is FFS.

\- The HPLMN can already from Rel-15 define CN type preference for
VPLMNs in the Operator Controlled PLMN Selector with Access Technology
(see TS23.122\[21\]), where the Access Technology can refer to E-UTRAN
(which refers to EPC) or NG-RAN (which refers to 5GC).

\- The visited PLMN may override the HPLMN provided CN type preference
in Operator Controlled PLMN Selector with Access Technology by providing
its own PLMN specific CN type selection rule.

Editor\'s note: Whether VPLMN specific CN type selection rule always
takes precedence is FFS.

\- The visited PLMN may take into account operator policies or other
considerations when providing the PLMN specific CN type selection rules.

\- When the UE is accessing 5GC the visited PLMN may provide the PLMN
specific CN type selection rules in registration accept message and can
modify them at any time via the UE Configuration Update procedure for
access and mobility management related parameters (TS23.502\[7\]
clause4.2.4.2).

\- When the UE is accessing EPC the visited PLMN may provide the PLMN
specific CN type selection rules in attach/TAU accept message.

\- The UE behaves as follows:

\- In initial CN type selection from RM-DEREGISTERED:

\- In the absence of any CN type selection rules, the UE selects the CN
type that indicates support for Cellular IoT features. If both EPC and
5GC support Cellular IoT features, the CN type selection is
implementation dependent.

\- If the UE is performing PLMN selection the Operator Controlled PLMN
Selector with Access Technology information is used by the UE if
present.

\- If the UE is configured with PLMN specific CN type selection rule by
the V-PLMN, the UE performs CN type selection based on the PLMN specific
CN type selection rules, overriding the Access Technology part of
Operator Controlled PLMN Selector with Access Technology information.

\- When the UE is RM-REGISTERED with 5GC and moves from CM-CONNECTED to
CM-IDLE:

\- If the UE has a CN type selection rule indicating \"Prefer EPC over
5GC\" then the UE shall prioritize cells supporting EPC when performing
cell selection/reselection and shall select EPC if available in the cell
the UE is camping on.

\- If the UE has a CN type selection rule indicating \"Prefer 5GC over
EPC\" then the UE shall prioritize cells supporting 5GC when performing
cell selection/reselection.

Editor\'s note: Prioritizing CN type during cell selection/reselection
needs to be confirmed by RANWG2.

\- When the UE is EMM-REGISTERED with EPC and moves from EMM-CONNECTED
to EMM-IDLE:

\- If the UE has a CN type selection rule indicating \"Prefer 5GC over
EPC\" then the UE shall prioritize cells supporting 5GC when performing
cell selection/reselection and shall select 5GC if available in the cell
the UE is camping on.

\- If the UE has a CN type selection rule indicating \"Prefer EPC over
5GC\" then the UE shall prioritize cells supporting EPC when performing
cell selection/reselection.

Editor\'s note: Prioritizing CN type during cell selection/reselection
needs to be confirmed by RANWG2.

When the network prefers the UE to select 5GC and the UE is in
CM-CONNECTED state with 5GC, the core network may prevent the RAN to
redirect/handover the UE to EPC using the Mobility Restrictions to the
radio access network within Handover Restriction List.

When the network prefers the UE to select EPC and the UE is in
ECM-CONNECTED state with EPC, the core network may prevent the RAN to
redirect/handover the UE to 5GC using the Handover Restriction List.

NOTE: CN type selection rules provided by a PLMN during registration or
using UE configuration update are assumed to be stored in the ME as long
as the UE is registered with that PLMN. This aspect is subject to review
and final decision by CTWG1.

### 6.51.3 Support of EPC interworking

Since the configuration in the UE applies in case of CN type selection,
it is only modifying the rules in the UE for a procedure (CN type
selection) that is already defined in Rel-15, and already takes into
account EPC interworking. The actual procedures of a UE moving between
EPC and 5GC in CM-IDLE mode are not modified.

### 6.51.4 Procedures

No procedures are modified. Only new \"CN type selection rules\" IE is
added to existing messages:

\- Registration accept message (5G NAS);

\- UE configuration update (5G NAS);

\- attach/TAU accept (EPC NAS).

### 6.51.5 Impacts on existing entities and interfaces

On AMF/MME:

\- New \"CN type selection rules\" IE in NAS messages;

\- Configuration for CN steering.

On UE:

\- New \"CN type selection rules\" IE in NAS messages;

\- Modification in CN selection rules based on CN type selection rules;

\- Modification in cell selection/reselection procedures based on the
currently registered CN type.

### 6.51.6 Evaluation

This solution provides the CN type selection rules to the UE either in
USIM or in NAS in attach/registration acceptance. The UE then
prioritizes the cells supporting the preferred CN type in cell
selection/reselection and selects the preferred CN type if available in
the cell the UE is camping on. The solution has an impact to the cell
selection/reselection procedures that needs to be confirmed by 3GPP RAN
WG2.

6.52 Solution 52: Inter-UE QoS differentiation based on retrieval of UE Context
-------------------------------------------------------------------------------

### 6.52.1 Introduction

This solution addresses Key Issue 14: QoS Support for NB-IoT for the
case of Data over NAS. This solution is intended to be used in
combination with Data over NAS solutions (e.g., Solution1 and
Solution30) and allows an ng-eNB to schedule resources for RRC
connection establishment messages 4 and 5, by retrieving the NB-IoT UE
QoS Index from the AMF before message 4 is sent.

### 6.52.2 Functional Description

The solution is based on the following principles.

At UE initial registration:

a\) The UE indicates to the AMF its 5G-S-TMSI.

b\) The AMF retrieves the newly defined NB-IoT UE QoS Index from the UDM
and stores it locally indexing it per 5G-S-TMSI.

At entering CM-CONNECTED:

a\) The UE provides the 5G-S-TMSI in the *RRCConnectionRequest* message.

b\) The ng-eNB uses the combined information to retrieve the UE
information either from the AMF by means of a new N2 procedure.

c\) Based on the retrieved UE information, which includes at least the
NB-IoT UE QoS Index, the ng-eNB is able to differentiate/prioritise the
NB-IoT UEs before replying with the RRCConnectionSetup message and
provide an appropriate configuration to the UE in RRCConnectionSetup.

### 6.52.3 Support of EPC interworking

There is no interworking with EPC required as the ng-eNB only retrieves
information from the CN the UE is already registered with.

### 6.52.4 Procedures

#### 6.52.4.1 Provision of UE Context to AMF

Figure 6.52.4.1-1: Provision of QoS context to AMF at UE registration

1\. During the registration procedure, the UE, based on the Preferred
Network Behaviour indication indicates it wants to send data over NAS
and provides the AMF with the 5G-S-TMSI.

2\. Steps 4-13 of the registration procedure in TS23.502\[7\]
clause4.2.2.2.2.

3\. The AMF retrieves the NB-IoT UE QoS Index from the UDM. The NB-IoT
UE QoS Index is a subscription parameter used to differentiate the QoS
handling among NB-IoT UEs.

4\. Step 15-20 of the registration procedure.

5\. The AMF locally stores the NB-IoT UE QoS Index per 5G-S-TMSI.

6,7. Completion of the registration procedure.

#### 6.52.4.2 Retrieval of UE Context from AMF and Inter-UE QoS differentiation

The existing mechanism in EPC for retrieving QoS parameters is updated
to allow the ng-eNB to determine whether it should retrieve the UE
information from the AMF.

NOTE: As clarified in R3-151181 (and related notes of RANWG3\#88 in
R3-151324), since the MMEC for one MME node must be unique across all
MME nodes connected to the same eNB, similarly the S-TMSI is enough to
select the proper AMF.

Figure 6.52.4.2-1: UE QoS differentiation and context retrieval from the
AMF at CM-IDLE to CM-CONNECTED state transition.

1\) The UE sends RRConnectionRequest message to the ng-eNB which
includes the 5G-S-TMSI and CN indication for which CN the UE is
registered with. The ng-eNB uses the new CN indication to determine
whether to retrieve the UE information from EPC or 5GC.

NOTE1: According to TS36.331\[23\], the *RRCConnectionRequest-NB*
message already includes the 40-bit S-TMSI and has 17 spare bits. To
include the full 48-bit 5G-S-TMSI, assuming the 40 bits of the S-TMSI
are re-used, only 8 bits are needed. For other RRC messages, such as the
*RRCEarlyDataRequest-NB* message for Early Data Transmission, such
limitation does not apply because they use different physical RACH
resources which are larger.

2\) The ng-eNB, based on configuration may send the N2 RETRIEVE UE
INFORMATION (5G-S-TMSI) message to the AMF to retrieve the NB-IoT QoS
Index. The ng-eNB may retrieve additional parameters (e.g., UE Radio
Capabilities).

3\) The AMF replies with the N2 UE INFORMATION TRANSFER (with at least
the NB-IoT UE QoS index) message to the ng-eNB with the UE information.

NOTE2: The retrieval of further information from the SMF depends on the
solution for KI\#13 (see Solution15 for provision of UE Expected
Behaviour to the NG-RAN).

4\) The ng-eNB uses the retrieved UE information to prioritise the UE as
appropriate and determine the configuration for the UE in the
RRCConnectionSetup.

5\) The ng-eNB sends RRConnectionSetup to the UE, including
configuration for optional features the UE supports, if required.

6\) The UE sends RRCConnectionSetupComplete, including the initial
NAS-PDU.

7\) The ng-eNB sends the initial NAS-PDU to the AMF.

### 6.52.5 Impacts on existing entities and interfaces

UE/RRC:

\- For NB-IoT, sends the whole 5G-S-TMSI to ng-eNB in RRC Message 3

\- A new N2 procedure to retrieve UE information from the AMF.

AMF:

\- At registration, retrieve from UDM and store locally the UE QoS
Index.

\- A new N2 procedure to provide UE information to the ng-eNB.

UDM:

\- Addition of UE QoS Index to subscription data.

### 6.52.6 Evaluation

The solution addresses Key Issue14 (QoS Support for NB-IoT for the case
of Data over NAS) since it allows the ng-eNB to prioritize different
NB-IoT UEs before RRC message 4 is sent, therefore allowing to improve
the schedule of resources for RRC connection establishment messages 4
and 5. Similarly to the solution agreed for EPS CIoT Rel-14, the RAN -
AMF interaction will cause a delay in the transmission of RRC msg4,
which results in a higher power consumption in the NB-IoT UE since it
has to constantly monitor the NPDCCH until the msg4 can be decoded.

The solution does not allow to prioritize RRC Message 3 (e.g., in case
of Early Data Transmission with a single UL PDU).

Advantages:

\- Support QoS differentiation among UEs that use NAS to delivery data.

\- Support any types of data, IP, Ethernet, unstructured data.

Disadvantages:

\- Increase the size of some RRC messages to carry 5G-S-TMSI.

7 Evaluation
============

Editor\'s note: This clause will provide a general evaluation of the
solutions.

7.1 Key Issue 1: Support for infrequent small data transmission
---------------------------------------------------------------

The following solutions are addressing key issue 1:

\- **Solution1** supports small data transfer inside a PDU session in
NAS-SM via AMF/SMF to UPF. To also support the NIDD API (i.e. to address
the architectural requirements to \"support API(s) for infrequent small
data transmission and capability exposure to AF\"), solution 1 relies on
solution30, which extends solution 1 by supporting non-IP data in a PDU
session via AMF/SMF/NEF and the NIDD API to AFs. Solution1 supports
early data and reuses EPC interworking as defined in Rel-15, i.e. relies
on mapping PDU sessions to PDN connections. Solution1 follows the same
concept as EPS CP optimization. This enables low complexity IoT devices
that support both EPC and 5GC connectivity to send small data over NAS
(i.e. without having to support a user-plane stack, AS security, etc.)
regardless of the core network those devices are connected to. Whether
to send the existing SM header or a shortened SM header with the small
data is up to CTWG1 to decide.

\- **Solution2** transfers small data inside a PDU session by means of
NAS-MM. In addition solution2 introduces a user-plane tunnel (Nx
interface) between AMF and UPF to bypass SMF for small data transfer to
the UPF. This results in AMF impact to support a user-plane interface
(Nx interface) on the AMF and related changes to the SMF to support Nx
tunnel establishment. When the UE moves from CM-IDLE to CM-CONNECTED the
Nx interface first needs to be established before small data can be
forwarded between AMF to UPF. As a result DL data in response to UL data
sent by the UE will be delayed compared to solution1 due to the tunnel
setup signaling. No SM header is needed for solution2.

\- In contrast to solution1 and 2, **solution 3** is not a generic
solution as it only supports small data transfer of non-IP data. The
solution does not establish a PDU session but establishes a Non Session
Data Delivery (NSDD) context in the SMF instead. The benefit of not
establishing a PDU session is however not obvious since NSDD context is
anyhow established at the SMF. Interworking with EPC is not supported as
per the solution description (the solution targets UEs that only support
5GC-NAS).

\- **Solution 4** relies on use of the RDS protocol (already defined for
EPS) for reliable delivery of small data unstructured PDUs. It does not
require establishment of a PDU session as the RDS header contains the
routing information for the small data transfer between UE and AF. As
compared to solution30 it carries data over NAS-MM between UE and AMF
and then from AMF to NEF directly. For IP small data transfer,
solution4 would need to rely on either solution1 or 2. From a
signaling perspective it is more efficient than solution30 but when
combined with either solution1 or 2 it would also be required to
support PDU session establishment logic for IP data transfer via the
UPF.

\- **Solution 6** proposes to send IP and non-IP small data in a DATA
PDU in RRC via SRB to the RAN, which in turn forwards the small data to
a UPF. As per the solution description, a single UPF appears to be
assumed (as the UE does not include any UPF ID or similar information
together with the UL data). As a consequence there is no support for
different UPFs for different DNNs, slices or even load-balancing
reasons. While this may be addressable, the solution has two other key
drawbacks: (1) In contrast to the other infrequent small data solutions,
solution6 requires the UE to support an additional security assocation
per PDU session and (2) the solution has RAN impact (handling of new
DATA PDU in RRC; determining the target UPF and new forwarding mechanism
for small data to/from target UPF) compared to all other solutions which
are transparent to the RAN. The latter is important to ensure simple
migration to 5GC. This solution does not add any additional load for
control plane entities (AMF and SMF).

\- **Solution 40** proposes to establish a PDU session for sending UL
data, which gets released after UL data is sent and related DL data has
been received or after the expiration of the inactivity timer. As a
consequence there is no support for DL-initiated small data. The
solution avoids user-plane stack and AS security complexity. The
solution avoids the PDU session related signaling between UE and network
and avoids the complexity of storing a PDU session context in the UE.
The temporary PDU session is introduced for the small data transmission,
and established in an on-demand way, which saves PDU session resource
consumption in 5GC. The core network signaling will increase due to
establishment and release of temporary PDU session. The amount of
signaling depends on how frequently the UE sends UL small data and how
quickly the network releases the PDU session based on Release Assistance
Indication information from the UE or expiration of inactivity timer
(e.g. determined by interval of data transmission). In case there is no
default DNN and S-NSSAI for the UE and the AMF, the UE needs to send the
DNN and S-NSSAI together with UL small data. The solution requires a
network address translation (NAT) function in the UPF since the UE uses
a locally generated IP address, which needs to be translated to a
routable IP address.

Additional load for control plane entities (AMF and SMF) that is implied
by all solutions except solution6 can be addressed by dynamically
adding virtualized AMF and SMF entities as needed. Control plane
overload can be addressed by solutions for KI\#7.

7.2 Key Issue 2: Frequent small data communication
--------------------------------------------------

### 7.2.1 Overview

Solution5 proposes to send MO small data together with an indication of
the target UPF and the UL-TEID to the RAN, which in turn forwards the
data to that UPF. Security is provided by a per PDU session security
association between UE and UPF, i.e. AS security is not used. For MT
data a procedure similar to paging in CM-IDLE state is used. The
solution impacts both RAN and CN to support the fast-path model; the UE
is impacted due to the need to additionally support a per PDU session
security association with the UPF. Solution 5 can be used with Early
Data Transfer (EDT) and eDRX. It is also compatible with RRC Inactive.

Solution7 proposes two aspects:

1\. Extend RRC Inactive as specified in Rel-15 by support for early
data.

2\. Re-building CM-IDLE state and related HLCom functionality in
CM-CONNECTED state with RRC Inactive to support eDRX with long sleep
cycles in RRC-Inactive.

Supporting early data for RRC-Inactive has only very limited system
impact (UE, RAN and AMF). In contrast to this, RAN and CN impact to
support long sleep cycles in RRC Inactive is significant (due to the
need to make AMF, SMF and UPF aware about the unreachability of the UE
to make the CN behave as if the UE was in CM-IDLE state while the UE is
actually in CM-CONNECTED state).

Solution19 proposes to introduce RRC Connection suspend and resume
procedures similar to User Plane CIoT EPS Optimization. The solution
bypasses Service Request procedure, based on RAN maintaining the AS
context of the suspended UE. In comparison to EPS UP optimization an
additional enhancement has been proposed: avoiding to fully resume the
RRC connection if the UE sends a single UL packet only (indicated by AS
Release Assistance Indication). As the UE is in CM-IDLE state when its
RRC connection has been suspended, the solution can be easily combined
with eDRX with long sleep cycles and the related HLCom mechanisms for
CM-IDLE. The solution has limited impact to UE, RAN and CN.

Solution29 proposes to send UL small data together with UPF CL Service
information (UCLSI) to the RAN. The RAN in turn looks up the target UPF
by performing a DNS look-up using the UCLSI and forwards the data to the
UPF using a shared N3 tunnel for UEs that are served by the same NR
node. To identity the UE and PDU session the small data belongs to
within the shared tunnel, the UCLSI is included as additional header
information. For MT data the UPF keeps track of the last known RAN node
serving a UE. Until a UE Location Freshness Timer expires, the UPF sends
DL data to this last known RAN node. If the UE is not reachable in this
last known RAN node, the DL data will be dropped, and the UE will be
paged to determine its new serving RAN node. Solution29 can be used
with EDT and eDRX. It is also compatible with RRC Inactive.

Solution36 proposes to leverage RRC Inactive with two enhancements for
frequent small data:

1\) Enable the RAN to avoid switching the N3 tunnel to the new RAN node
by establishing a data forwarding tunnel between old and new RAN nodes.

2\) Enable removing UP resources locally in the RAN, i.e. without paging
the UE, in case of CN-initiated PDU session deactivation when the UE is
in RRC Inactive.

While (1) only impacts the RAN, (2) also impacts the AMF.

Frequent Small Data Information including small data indication,
Communication Pattern, etc. is sent to RAN in order to assist the RAN
decision whether to send the UE to RRC Inactive state. UE resume request
is extended to include small data indication which the NG-RAN can use to
decide upon N3 path switching.

Solution41 illustrates how RRC Inactive as defined in Rel-15 can be
combined with 5G UP optimization (see solution19 above) and eDRX to
efficiently support bursty frequent small data. The interoperability
between RRC Inactive and eDRX is achieved via using short eDRX cycles in
RRC Inactive. The solution re-uses the existing procedures for the AMF
to pass the NAS negotiated eDRX value to RAN, and RAN configuring eDRX
cycle and using RRC Inactive when applicable, taking into account also
the RRC Inactive Assistance Information received from the AMF. If RAN
chooses to use eDRX in RRC Inactive state, then the RAN node is
responsible for DL data buffering.

### 7.2.2 Enhancements of existing procedures

RRC Inactive, eDRX, and EDT are already existing signalling
optimisations, and even higher optimisation can be achieved by combining
them. RRC Inactive can be enhanced further with EDT and eDRX. The
feasibility of avoiding N3 tunnel switching by data forwarding would
still need to be verified with RANWG3.

RRC Inactive, specifically when combined with the foreseen enhancements
is already a significant improvement over the EPS capabilities, and
consequently the 5G User Plane improvements need to be weighed against
RRC Inactive.

However, to efficiently address bursty frequent small data scenarios,
i.e. scenarios where frequent small data occurs in bursts with
significantly long silence periods in-between the bursts, solutions are
required to enable UE power saving during those silence periods. Since
long eDRX cycles cannot be supported efficiently in CM-CONNECTED with
RRC Inactive the UE should be moved to CM-IDLE in order to leverage long
eDRX sleep cycles.

To reduce over-the-air signaling when the UE sends small data from
CM-IDLE, the subsequent one-shot small data or burst of small data seems
to need some User Plane optimisation among the candidate solutions
documented in clause7.2.1.

Solution41 in turn combines 5G UP optimization with RRC Inactive to
jointly ensure that bursty frequent small data can be sent with minimal
signaling overhead while extended DRX sleep cycles ranging from a few
seconds to hours can be supported without causing significant system
impacts.

### 7.2.3 Optimised UP data solutions

Solutions 5 and 29 can be used together with RRC Inactive, but since all
these are optimising the RRC Connection establishment, some of the radio
interface benefits of the proposed UP solutions are already available
via RRC Inactive. Consequently, RRC Inactive and EDT can offer
comparable optimisations at the radio interface.

Solutions 5 and 29 can be used with EDT and eDRX.

The proposed UP optimisations are characterized by the following
aspects:

\- Shared N3 tunnel.

\- User Plane data does not require CN overload protection that is
needed for Control Plane data.

\- User plane QoS and HLCom concepts can be re-used.

These capabilities need to be weighed against the additional complexity
caused by the solutions.

### 7.2.4 UPF-NEF interface

Solution 35 introduces new interface between UPF and NEF to support
communication via NEF (T8 NIDD API) in addtion to communication via UPF.

Without this interface, T8 NIDD API cannot be provided over user plane.

7.3 Key Issue 3: High latency communication
-------------------------------------------

For key issue 3 - High latency communication, the following two
categories of solutions are proposed:

\- Extended buffering of downlink data in the network (solution11,
solution24 and solution25).

\- Notification towards the AF(s) (solution10, Solution24, Solution25
and solution39).

For Extended buffering of Downlink data in the network:

Solution 10 proposes extended data buffering in UPF but use the
term/concept of \"UE availability after DDN failure\" for communication
between UPF/SMF/AMF.

Solution11 proposes to handle the High latency communication by
extended buffering of DL data in the SMF. The SMF determines whether DL
data shall be buffered based on input from the AMF. The AMF indicates to
the SMF that the UE is unreachable, a Maximum estimated wait time for
the UE to become reachable and, optionally, a DL Buffering Suggested
Packet Count. The buffered DL data can be sent from the UPF/NEF to the
RAN, as soon as the UE becomes reachable. The solutions has no impacts
on UPF or NEF. Buffering in SMF meets the Architectural Requirement of
key issue3: \"Send DL data to UEs at the earliest possible opportunity
when the UEs are applying power saving functions\". For UEs that remain
in idle mode for a long time the associated UPF may change while the
associated SMF will not. Since this solution is based on buffering in
the SMF, it is more appropriate for this case because it would not
require forwarding any buffered data among UPFs in case of UPF change.

Solution24 proposes to handle the High latency communication by
extended buffering of downlink data in the UPF or SMF, and controlled by
the AMF/SMF. The AMF asks the SMF to buffer downlink data, and provide
buffering information to SMF. The SMF forward buffering information to
UPF, and may decide the number of packets to buffer.

Solution25 proposes to buffer the DL data in UPF (for data via N6) or
in the NEF (for data via APIs) based on the decision of the SMF which
determines whether Extended Buffering applies for the downlink packet or
not. The AMF indicates to the SMF that the UE is unreachable, a Maximum
estimated wait time for the UE to become reachable and optionally a DL
Buffering Suggested Packet Count. The SMF indicates to the UPF/NEF to
buffer DL data with Extended Buffering time. The buffered DL data can be
sent from the UPF/NEF to RAN as soon as the UE becomes reachable.
Contrary to Solution11, since this solution is based on UPF buffering,
it seems more appropriate for UEs in idle mode for short periods of time
because the associated UPF will most likely not change.

For solutions for notification towards the AF(s):

\- Notification towards a single AF:

\- Solution10 proposes two notification procedures for Mobile
Terminated Communication, UE reachability notification and UE
availability notification procedure after DDN failure and has the same
principles of solution24 and 25.

\- Solution24 proposes the notification procedure from the AMF
triggered by UE Reachability event or Availability after DDN failure
event. The notification procedure for the UE in CM-CONNECTED with
RRC\_INACTIVE state is also proposed and this aspect is not in scope for
event notifications towards the SCS/AS. The triggers to generate the
events within the network depend upon solutions to other key issues and
are not in scope for notification procedures aspect of this key issue.
The proposed notification procedure is based on the same principles as
the notification procedure for HLCOM in EPC. In addition, this solution
proposes a procedure to notify internal 5GCN NFs of UE availability
after MT CP signalling.

\- Solution25 proposes two notification procedures towards the AF: one
from the AMF for notification of UE reachability and Availability after
DDN failure (with reference to solution24), and a second one from the
SMF for data delivery status report to enhance the \"extended data
buffering\" method. For MT control plane signaling handling in this
solution, solution24 is referenced.

\- Notification of availability after DDN failure towards multiple AFs:

\- Solution39 is based on Solution 25 and proposes the Availability
after DDN failure notification procedure in case of multiple Application
Functions (AFs). The AF provides the Traffic Descriptor information
during the Event Configuration procedure, and the Traffic Descriptor
information can be used by the network to determine the corresponding AF
at notification. The Availability after DDN failure event is sent to the
AMF by the UDM, and the Availability after DDN failure event including
Traffic Descriptor information is sent to the SMF by the UDM. After
receiving the DDN message for the AF service, the SMF sends the message
to the AMF including the NEF Reference ID. Once the event has happened,
the AMF notifies the corresponding AF(s).

\- Solution 50 proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF
provides the application ID during the Event configuration procedure,
and the Application ID is used by the network to determine the
corresponding AF at notification. The \"Application detection event\" is
sent to the SMF by the UDM, and the \"Availability after DDN failure
event\" is sent to the AMF by the UDM. The SMF activates the
\"Application detection event\" based on the application ID reported by
the UPF. Once the event has happened, the SMF notifies the NEF the
traffic sent by AF has been detected. Then the NEF subscribes the UE
reachability event. The NEF notifies the corresponding AF(s) based on
the SMF\'s notification and AMF\'s notification.

\- The solutions above address the architectural requirements of key
issue3 to \"Provide the AF (i.e. SCS/AS) with UE status information
(e.g. reachability notification or the time when the UE is expected to
be reachable)\". The triggers to generate the events were not considered
since they depend upon solutions to other key issues.

Based on the evaluation above, it can be seen that all solutions support
UE reachability notification and Availability after DDN failure
notification from AMF in CM-IDLE mode. Solution25 also covers the
delivery of an SMF based buffering status report for the extended
buffering approach. Solution24 covers in addition the handling of these
notifications in RRC inactive state and CM-IDLE with suspend.

NOTE: Due to the limited duration of eDRX cycles for RRC-INACTIVE, it is
assumed that there is no need for interaction between RRC-INACTIVE and
HLCOM.

7.4 Key Issue 4: Power Saving Functions
---------------------------------------

Editor\'s note: This clause will capture the evaluation for key issue 4.

For Key Issue4, Track1 (\"extended DRX support in CM-IDLE\"),
Solution22 has been proposed and enables eDRX in CM-IDLE state
equivalent to eDRX support in EPS.

For Key Issue4, Track1 (\"extended DRX support in RRC-INACTIVE/
CM-CONNECTED\"), Solutions38 and 41 have been proposed.

The key idea of Solution38, Alternative3 (and the related Solution41)
is to enable UE power saving as follows:

\- For short silence periods the ng-eNB can configure extended DRX in
RRC-INACTIVE/CM-CONNECTED with sleep cycles up to the duration of the
NAS (and SMS) retransmission timers. Limiting the sleep cycles to the
NAS (and SMS) retransmission timers enables the core network to consider
the UE reachable while the UE is in RRC-INACTIVE/CM-CONNECTED state with
extended DRX.

\- For longer silence periods, CM-IDLE state can be used along with
longer extended DRX sleep cycles. As the UE is in CM-IDLE , the
buffering and notification mechanisms that need to be specified for
CM-IDLE anyhow can be re-used. (Note that this approach can be combined
with different UP-based small data solutions, which are discussed as
part of key issue 2).

The benefit of this approach is that extended DRX sleep cycles ranging
from a few seconds to hours can be supported without additional system
impacts.

In contrast to this, Solution38 Alternative1 aims at supporting very
long sleep cycles in RRC-INACTIVE state, which leads to system impact by
re-building CM-IDLE HLcom functionality in CM-CONNECTED state. This
stems from the need to make the AMF, SMF and UPF aware about the
unreachability of the UE to be able to behave as if the UE was in
CM-IDLE state while the UE is actually in CM-CONNECTED state.

For Key Issue4 Track2, Solutions8, 9 and 23 are proposed.

Solution8 proposes an enhancement for mobile terminated data/signalling
by introducing a minimum time to keep UE in RRC\_CONNECTED (the
Connected time). The solution can save power and allows a faster DL data
delivery.

Solution9 proposed the enhancement for MICO mode with Active Time. The
Solution is based on the same principle as Power Saving Mode in EPS, and
can save power for the case when the wait for subsequent data is long
(e.g., if an external AF has a long response time).

Solution23 proposed to determining MICO mode and periodic registration
timer value for the UE, taking into account communication pattern
information, and providing a *\"do not reset the timer for Periodic
Registration\"* indication to the UE and saves UE power according to the
expected and desired UE and application behaviour.

The above solutions jointly address all Architectural Requirements for
Key Issue\#4 (Power Saving Function) - Track2.

7.5 Key Issue 5: UE TX Power Saving Functions
---------------------------------------------

The solutions \#32, \#33, \#34, \#46 are understood to display some
gains in some scenarios, some degradation in some other scenarios; no
systematic gain is guaranteed.

7.6 Key Issue 6: Management of Enhanced Coverage
------------------------------------------------

Editor\'s note: This clausewill capture the evaluation for key issue 6.

7.7 Key Issue 7: Overload Control for small data
------------------------------------------------

Key Issue 7 has only 1 solution: Solution 27.

Solution 27 introduces Small Data Rate Control, Service Gap Control,
AMF/SMF Overload Control and Control plane data back-off timer. The
solution is based on the same principles as the Overload Control
functions of EPS, and addresses all the Architectural requirements of
Key Issue 7.

7.8 Key Issue 8: Support of the Reliable Data Service
-----------------------------------------------------

For Key Issue 8 following two solutions are specified:

\- Solution4 (Reliable data Service Support): This solution target both
Key Issue8 and Key Issue1. Solution4 has RDS support over NAS-MM
layer.

\- Solution49 (Support for RDS with infrequent small data transmission
solutions \#1, 2, 3): This solution builds on top of other small data
solutions i.e. solution \#1, \#2, and \#3.

In solution4 support of RDS is similar to support of RDS over
solution2 (as described in solution49) i.e. over NS-MM. Solution49
provides a generic meachanism for RDS support and is based on RDS
support design priciples in EPS.

7.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC Interworking
----------------------------------------------------------------------------

Key Issue 9 has 2 solutions.

Solution 13 introduces the combined SCEF+NEF node. By using a combined
node, the solution shows how the API termination point(s) associated
with the UE can remain consistent even when the UE switches between EPC
and 5GC. Since the solution continues the EPC principle that the
exposure function(s) related to a UE will not change, there is no need
to provide a way for the AF to detect API termination point changes and
there is no need for exposure functions to exchange UE context. Solution
1 also points out that if the level of support of a given service
changes (e.g. due to the UE\'s movement between EPC and 5GC), the
SCEF+NEF will notify the SCS/AS.

Solution 14 builds on solution 13 by showing, in more detail, if the
level of support of a given service changes (e.g. due to the UE\'s
movement between EPC and 5GC), the SCEF+NEF notifies the SCS/AS.

7.10 Key Issue 10: Network Parameter Configuration API via NEF
--------------------------------------------------------------

### 7.10.1 Overview

Solution 15 addresses Key Issue 10. It aligns with the architectural
baseline of the key issue in that it describes how an NEF API can be
used to provide the network with Maximum Latency, Maximum Response Time,
and Suggested Number of Downlink Packets and add the data to the UE\'s
subscription information in the UDM/UDR.

Solution 15 states that \"*It is a subject of local policy in the
UDM/UDR which external parameters are classified as AMF- Associated,
SMF- Associated, and PCF- Associated parameters*\" This flexibility, in
terms of how parameters are classified, aligns the solution with
solutions that have been selected for other Key Issues.

### 7.10.2 Evaluation Relative to Key Issue 3 (High Latency Communication)

Key Issue 3 (High Latency Communication) concluded that Solution 11 (DL
data buffered in the SMF) and Solution25 (DL data buffered in UPF/NEF)
are used as the basis for normative work to address the extended
buffering for high latency communication.

In Solution 11, the AMF requests that the SMF buffer data and indicates
how long the UE is expected to be sleeping. Thus, Maximum Response Time,
and Maximum Latency may be considered an AMF- Associated parameters when
Solutions 11 is used. The solution also uses the Suggested Number of
Downlink Packets, however how the AMF or SMF determines the Suggested
Number of Downlink Packets is left for the normative phase.

In Solution 25, the AMF requests that the SMF configure the UPF to
buffer data and indicates how long the UE is expected to be sleeping.
Thus, Maximum Response Time, and Maximum Latency may also be considered
an AMF- Associated parameters when Solutions25 is used. The solution
also uses the Suggested Number of Downlink Packets, however how the AMF
or SMF determines the Suggested Number of Downlink Packets is left for
the normative phase.

### 7.10.3 Evaluation Relative to Key Issue 4 (Power Savings Functions)

Key Issue4 (Power Savings Functions) concluded that Solutions22, 38
(Alternative3), 8, 9, and 23 are used as the basis for normative work.
Solution22 states that \"*Extended idle mode DRX cycle length value
needs to be added in the subscription data from the UDM using the same
principles as in EPS*\". In both Solution22 and Solution38,
alternative3, the AMF provides the UE\'s accepted eDRX parameters.
Solutions8 and 9 describe that the AMF considers Maximum Response Time
and Maximum Latency when configuring the UE\'s MICO mode. Thus, Maximum
Response Timer and Maximum Latency may be considered AMF- Associated
parameters.

7.11 Key Issue 11: Monitoring
-----------------------------

Solution37 addresses the architectural requirements for the Key Issue
\#11 - \"Monitoring\". Solution37 describes how events may be monitored
via the AMF, UDM, and PCF. It can be concluded that, Monitoring via the
PCF is not required since is no scenario identified for Monitoring via
the PCF in 5GC.

In EPC there are two 2 ways of Monitoring Location and Communication
Failure; one via the MME and one via the PCRF. TS23.682\[6\] does not
specify why there are 2 methods or when each method should be used.
However, one advantage of monitoring via the PCRF in EPC is that it can
be used to monitor Location and Communication Failure when the UE
accesses the network via WLAN. Since the MME is not involved in a WLAN
access, monitoring via the MME is not possible. However, in 5GC,
monitoring via the AMF is sufficient since the AMF is involved in when
the UE accesses the network via WLAN (via the N3IWF).

7.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
------------------------------------------------------------

Solution48 addresses the architectural baseline and requirements of Key
Issue \#12 by supporting separate radio capability handling for NB-IoT
and by handling PDU sessions at idle mode inter-RAT mobility following
the principles used by EPC, i.e. to determine the actions (maintain or
disconnect, with or without reactivation request, or left to VPLMN
policy) for a PDU session being stored in the subscription data or in
the absence of subscription data based on local policy.

7.13 Key Issue 13: Support for Expected UE Behaviour
----------------------------------------------------

The combination of Solution 15 and Solution 26 describes in detail how
and which parameters are to be provided to AMF and SMF to allow the 5GC
to operate as effectively as EPC for devices with communication
patterns.

The parameters identified by Solution 26 are also provided by the 5GC to
RAN, similarly to EPS, to support NB-IoT UE differentiation,
appropriately configure the Uu radio interface, minimize the UE state
transitions and achieve optimum network behaviour.

\- For PDU Session using data over NAS, Solution 28 describes how SMF
sends the \'SMF assisted NG-RAN information\' to the AMF during PDU
Session establishment. The AMF transfers both the \'AMF assisted NG-RAN
information\' and the \'SMF assisted NG-RAN information\' to the NG-RAN
within the UE context.

\- For PDU Session using data over UP, Solution 28 describes how the SMF
sends \'SMF assisted NG-RAN information\' within the N2 SM information.

7.14 Key Issue 14: QoS Support for NB-IoT
-----------------------------------------

For Key Issue \#14 four solutions categorized into two groups are
captured in this TR:

\- Solutions for Inter-UE QoS differentiation:

\- Solution 16 is based on the UDM provisioning the AMF and the UE of a
QoS Index which, at service request, is indicated by the UE to the
ng-eNB and used by the ng-eNB to prioritize the UE before RRC Message 4
is sent. The AMF later polices the usage of such QoS Index.

\- In Solution 52 at registration the AMF retrieves from the UDM the
NB-IoT QoS Index associated to that UE, it stores it locally and
associates it to the 5G-S-TMSI indicated by the UE in the registration
request. Later at service request, the ng-eNB, if not stored locally,
can retrieve from the AMF the NB-IoT QoS Index associated to the
indicated 5G-S-TMSI and, based on that, it prioritizes the UE before
sending RRC Message 4. Such additional roundtrip may lead to some extra
delay, but it allows to retrieve other information such as the UE Radio
Capabilities.

\- Both solutions allow to apply Inter-QoS differentiation before the
ng-eNB sends RRC Message 4.

\- Solutions for Intra-UE QoS differentiation:

\- Solution 17 supports QoS differentiation among QoS flows of the same
Unstructured PDU Session. The SMF sends QoS Rules to the UE without
packet filters for Unstructured PDU Sessions. The UE uses its own logic
to classify PDUs into QoS Flows in the UL. The SMF sends the N6 tunnel
headers and mapping between N6 tunnel header and QFI of N3 or N9 tunnel
for QoS Flows of Unstructured PDU Session to the UPF. The UPF classifies
DL PDUs into N3 or N9 QoS flows using existing mechanism that filters DL
PDUs based on N6 tunnel header.

\- Solution 18 supports QoS differentiation among QoS flows of the same
Unstructured PDU Session. A new packet filtering, Field Position Based
(FPB) packet filter, is to be standardized. The SMF sends FPB packet
filters to the UE and UPF. The UE and UPF need to support the new FPB
packet filters for classifying unstructured PDUs into UL and DL QoS
Flows, respectively.

7.15 Key Issue 15: Core Network selection for Cellular IoT
----------------------------------------------------------

The solutions for KI\#15 either address the architectural requirements
for:

\- core network type selection at UE and core network node selection at
RAN, AMF and MME, or

\- redirection between CN types, e.g. for operator policy or load
conditions, architectural requirements.

The following solutions address the core network type selection at UE
and core network node selection architectural requirements:

\- Solution44. This solution uses standardised S-NSSAI(s) broadcast in
system information that indicate sets of 5G CIoT features supported by
the network. The solution requires the S-NSSAI(s) broadcast to be
standardised and which feature(s) each standardised S-NSSAI represents.
The UE provides the S-NSSAI for the feature(s) it wishes to use when
establishing a connection.

\- Solution45. This solution uses an indication for each 5G CIoT
optimisations, relevant for CN selection, broadcast in system
information and the UE provides which 5G CIoT optimisations it prefers
when establishing a connection in RAN and when performing registration,
similar to the existing mechanism used in EPC.

Both solutions can fulfil the requirements for Key Issue \#15. However,
solution \#45 has following advantages. Solution45 is based on similar
mechanism used in EPC and therefore enables better interworking logic
with EPC system. Solution44 may lead to complex logic of mapping CIoT
optimizations in EPC with standardized S-NSSAI values. It is also to be
noted that low complexity CIoT devices may support single slice and
therefore may not be pre-configured with any S-NSSAI values. In addition
given the size of S-NSSAI is 32 bits long, it would be not efficient to
broadcast standardized S-NSSAI in system information as compared to only
few bits required for Solution45.

The following solutions address architectural requirements for
redirection between CN types:

\- Solution42. This solution uses a NAS level indication in
registration/attach rejection to indicate to the UE that the N1/S1 mode
needs to be disabled. The UE then disables the N1/S1 mode and performs
an attach/registration to the target CN type. The solution uses existing
procedures.

NOTE: Whether a new cause value needs to be defined for a redirection,
is up to Stage 3.

\- Solution43. This solution uses an RRC level indication in RRC
connection release after the registration/attach procedure to indicate
to the UE that the target CN type needs to be selected. Such procedure
exists for 5GS, but a similar procedure for EPS would need to be
specified. Handovers and idle-mode mobility to the old CN type are
prevented using existing procedures. The solution is not applicable for
NB-IoT UE. Idle-mode mobility to the old CN type cannot be prevented if
the operator uses the same RAT type(s) and frequencies in both EPS and
5GS.

\- Solution51. This solution provides the CN type selection rules to
the UE either in USIM or in NAS in attach/registration acceptance. The
UE then prioritizes the cells supporting the preferred CN type in cell
selection/reselection and selects the preferred CN type if available in
the cell the UE is camping on. The solution has an impact to the cell
selection/reselection procedures that needs to be confirmed by 3GPP RAN
WG2.

7.16 Key Issue 16: Support of Group communication and messaging
---------------------------------------------------------------

Group Message Delivery service can be supported by unicast MT NIDD
between NEF and UE, with group based NIDD API used between AF(SCS/AS)
and NEF.

Several solutions to Key issue\#1 and Key Issue \#2 supports unicast MT
NIDD. For example - Solution 30 supports MT NIDD delivery over control
plane and solution 35 supports unicast MT NIDD over user plane. For
evaluation of unicast MT NIDD solutions please refer to clause7.1 and
7.2.

Solution 30 also supports NIDD Configuration for group basis, which is
essential to support Group Message Delivery service provided by NIDD API
equivalent to T8 group message delivery API.

7.17 Key Issue 17: MSISDN-less MO SMS
-------------------------------------

No new solution is needed for Key Issue17 as the agreed architectural
baseline for this key issue provides sufficient details on a solution to
start the normative work.

8 Conclusions
=============

Editor\'s note: This clause will capture conclusions from the study.

8.1 Key Issue 1: Support for infrequent small data transmission
---------------------------------------------------------------

Solution 1 and solution30 are recommended for normative work to support
infrequent small data transmission via N6 and NIDD API.

8.2 Key Issue 2: Frequent small data communication
--------------------------------------------------

For Key Issue 2, it is recommended to use Solution 19 as the basis for
normative work.

NOTE: Solution 19 can also be used for infrequent small data scenarios.

8.3 Key Issue 3: High latency communication
-------------------------------------------

For Key Issue 3, it is concluded that:

\- Solution11 (DL data buffered in the SMF) and Solution25 (DL data
buffered in UPF/NEF) are used as the basis for normative work to address
the extended buffering for high latency communication.

\- Solution25 is used as the basis for normative work to address the
notification towards the AF for high latency communication.

NOTE1: For Solution11 and 25, whether the AMF or SMF determines the DL
Buffering Suggested Packet Count will be addressed during the normative
phase.

NOTE2: For Solution11, the details of how buffered data is forwarded
in the interworking case will be addressed during the normative phase.

\- To address the availability after DDN failure notification for the
case of multiple AFs, Solution39 is used as the basis for normative
work for the event configuration.

NOTE 3: How to report the detection of the data from the AF will be
addressed during the normative phase.

8.4 Key Issue 4: Power Saving Functions
---------------------------------------

For key issue4, track1, it is recommended that solution22 is used as
the basis for normative work to support extended DRX for UEs in CM-IDLE
state.

For Key Issue4, Track1, it is recommended that Solution38
Alternative3 is used as the basis for normative work to support
extended DRX for UEs in RRC-INACTIVE/CM-CONNECTED state. As eDRX sleep
cycles in RRC-INACTIVE are recommended to be supported up to the NAS
(and SMS) retransmission timers, the core network considers the UE
reachable while the UE is in RRC-INACTIVE/CM-CONNECTED state with
extended DRX. This implies that from the perspective of this key issue
there is no need to support specific high latency communication
functionality for RRC-INACTIVE/CM-CONNECTED with extended DRX.

NOTE: The maximum value for the eDRX cycle that can be supported in
RRC-INACTIVE/CM-CONNECTED taking into account the NAS (and SMS)
retransmission timers will be determined by CT groups. How the RAN
learns whether a UE supports eDRX in RRC-INACTIVE will be determined as
part of the normative phase.

For Key Issue4, Track2, it is concluded that one solution is not
sufficient to address the architectural requirement due to different
application scenarios. It is therefore recommended that Solution8,
Solution9 and Solution23 are used as the basis for normative work to
address UE power saving in different application scenarios.

8.5 Key Issue 5: UE TX Power Saving Functions
---------------------------------------------

For Key Issue 5 \"UE TX Power Saving Functions\" it is recommended that
no solution be specified addressing MT data reception and MO data
transmission.

8.6 Key Issue 6: Management of Enhanced Coverage
------------------------------------------------

For Key Issue \#6 (Management of Enhanced Coverage), it is recommended
to use Solution \#12: \"Solution for Management of Enhanced Coverage for
5GC\" for normative work in the Rel-16.

8.7 Key Issue 7: Overload Control for small data
------------------------------------------------

Solution 27 includes configuring the UE with low access priority and
signalling it over N1 and it is concluded this is not required. Small
Data Rate Control, Service Gap Control, AMF/SMF Overload Control and
Control plane data back-off timer from Solution 27 are required.

For Key Issue \#7 (Overload Control for small data), it is recommended
to use Small Data Rate Control, Service Gap Control, AMF/SMF Overload
Control and Control plane data back-off timer from Solution \#27:
\"Reuse of EPS Overload Control Mechanisms\" as the basis for normative
work.

8.8 Key Issue 8: Support of the Reliable Data Service
-----------------------------------------------------

For Key Issue 8 (Support of the Reliable Data Service) it is proposed to
use Solution 49 as the basis for normative work.

8.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC Interworking
----------------------------------------------------------------------------

For the Key Issue 9 \" Support of common north-bound APIs for EPC-5GC
Interworking\", it is concluded that, when a UE is capable of switching
between EPC and 5GC, it shall only be associated with combined SCEF+NEF
node(s) for Service Capability Exposure. It is recommended that the
principles of Solution 13 be used for normative work.

It is recommended that the principles of Solution 14 be used for
normative work when specifying how, if availability and expected the
level of support of a given service changes (e.g. due to the UE\'s
movement between EPC and 5GC), the SCEF+NEF notifies the SCS/AS of the
change and how the SCS/AS queries the SCEF+NEF for the availability and
expected level of support of a service.

NOTE: The north-bound APIs which can be supported by an EPC or 5GC
network are discovered by the SCEF+NEF node via the CAPIF function
and/or via local configuration of the SCEF+NEF node. Different sets of
APIs can be supported by the two network types.

8.10 Key Issue 10: Network Parameter Configuration API via NEF
--------------------------------------------------------------

For Key Issue \#10 (Network Parameter Configuration API via NEF), it is
recommended to use Solution\#15: External parameter provisioning in the
5GC as the basis of normative work in Rel-16. Maximum Response Timer and
Maximum Latency will be considered AMF- Associated parameters.

NOTE: Consistent with the Key Issue3 conclusions, whether Suggested
Number of Downlink Packets is considered an AMF-, SMF-, or PCF-
Associated parameter will be addressed during the normative phase.

8.11 Key Issue 11: Monitoring
-----------------------------

For Key Issue \#11 (Monitoring), it is recommended to use Solution\#37:
Monitoring as the basis of normative work in Rel-16. Monitoring events
at PCF in solution\#37 will not be considered for Release -16 normative
work.

NOTE: For interworking between EPC and 5GC, Monitoring Location and
Communication Failure is supported via AMF and MME.

8.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
------------------------------------------------------------

It is recommended to select solution48 as the basis for normative work.

8.13 Key Issue 13: Support for Expected UE Behaviour
----------------------------------------------------

For Key Issue 13, it is concluded that:

\- Solution 15 and Solution 26 are used as the basis for normative work
to address how and which parameters are provided to the CN.

\- For the provision of the parameters identified by Solution 26 to the
NG-RAN, Solution 28 is used as the basis for normative work.

NOTE: The protocol details of the signalling towards NG-RAN are left for
normative phase, in cooperation with RAN WGs.

8.14 Key Issue 14: QoS Support for NB-IoT
-----------------------------------------

For inter-UE QoS differentiation for Data over NAS, Solution 52 is
selected as the basis for the normative phase.

NOTE1: Whether the differentiation is based on the NB-IoT UE QoS Index
or on existing parameters is to be decided during the normative phase.

For intra-UE QoS differentiation no solution is selected as the basis
for the normative phase.

8.15 Key Issue 15: Core Network selection for Cellular IoT
----------------------------------------------------------

For the architectural requirement on CN Type Selection for CIoT and
discovery of 5G CIoT feature(s), it is recommended to use Solution45 as
the basis for the normative work.

NOTE: The 5GS CIoT feature(s) to be included in RAN information
broadcast, and indicated by the UE in the RRC and NAS signalling will be
defined as part of the normative work.

For the architectural requirement on CN redirection for CIoT UEs, it is
recommended to use Solution42 as the basis for the normative work.

8.16 Key Issue 16: Support of Group communication and messaging
---------------------------------------------------------------

For Group Message Delivery via unicast MT NIDD, NEF shall provide API to
the AF (i.e. SCS/AS) equivalent to T8 group message delivery API, also
NEF shall support unicast MT NIDD to the UE.

8.17 Key Issue 17: MSISDN-less MO SMS
-------------------------------------

The agreed Key Issue17 architectural baseline will be used as the basis
of normative work.

######### Annex A: Change history

  ---------------- --------- ----------- ------ ----- ----- -------------------------------------------------------------------------------------------------- -------------
  Change history                                                                                                                                               
  Date             Meeting   TDoc        CR     Rev   Cat   Subject/Comment                                                                                    New version
  2018-09          SP\#81    SP-180793                      MCC editorial update for presentation to TSG SA\#81 for information                                1.0.0
  2018-12          SP\#82    SP-181109   \-     \-    \-    MCC editorial update for presentation to TSG SA\#82 for approval                                   2.0.0
  2018-12          SP\#82    \-          \-     \-    \-    MCC editorial update for publication after approval at TSG SA\#82 (Release 16). Title corrected.   16.0.0
  2019-06          SP\#84    SP-190432   0003   1     B     Conclusion for key issue 2                                                                         16.1.0
  ---------------- --------- ----------- ------ ----- ----- -------------------------------------------------------------------------------------------------- -------------
