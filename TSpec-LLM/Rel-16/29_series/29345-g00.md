![](media/image1.jpeg){width="7.0875in" height="3.4229166666666666in"}

.

Contents {#contents .TT}
========

[7](#foreword)

[8](#scope)

[8](#references)

[9](#definitions-symbols-and-abbreviations)

[9](#definitions)

[9](#abbreviations)

[10](#general-description)

[10](#introduction)

[10](#procedures-description)

[10](#introduction-1)

[10](#prose-service-authorization)

[10](#general)

[11](#detailed-behaviour-of-the-prose-function-in-the-hplmn)

[12](#detailed-behaviour-of-the-prose-function-in-the-local-plmn-or-vplmn)

[12](#prose-direct-discovery-authorization)

[12](#general-1)

[13](#detailed-behaviour-of-the-hplmn-prose-function)

[15](#detailed-behaviour-of-the-prose-function-in-the-local-plmn-or-vplmn-1)

[17](#prose-match-report)

[17](#general-2)

[18](#detailed-behaviour-of-the-hplmn-prose-function-1)

[18](#detailed-behaviour-of-the-prose-function-in-the-local-plmn)

[19](#prose-match-report-info)

[19](#general-3)

[20](#detailed-behaviour-of-the-requesting-prose-function)

[20](#detailed-behaviour-of-the-receiving-prose-function)

[21](#prose-proximity-request)

[21](#general-4)

[22](#detailed-behaviour-of-the-prose-function-of-the-requesting-ue)

[22](#detailed-behaviour-of-the-prose-function-of-the-targeted-ue)

[23](#prose-location-update)

[23](#general-5)

[24](#detailed-behaviour-of-the-prose-function-of-the-requesting-ue-1)

[24](#detailed-behaviour-of-the-prose-function-of-the-targeted-ue-1)

[24](#prose-cancellation)

[24](#general-6)

[25](#detailed-behaviour-of-the-prose-function-of-the-requesting-ue-2)

[25](#detailed-behaviour-of-the-prose-function-of-the-targeted-ue-2)

[25](#prose-proximity-alert)

[25](#general-7)

[26](#detailed-behaviour-of-the-prose-function-of-the-targeted-ue-3)

[26](#detailed-behaviour-of-the-prose-function-of-the-requesting-ue-3)

[27](#prose-direct-discovery-authorization-update)

[27](#general-8)

[28](#detailed-behaviour-of-the-hplmn-prose-function-2)

[28](#detailed-behaviour-of-the-prose-function-in-the-local-plmn-or-vplmn-2)

[28](#prose-direct-discovery-authorization-update-result)

[28](#general-9)

[29](#detailed-behaviour-of-the-prose-function-in-the-local-plmn-1)

[29](#detailed-behaviour-of-the-hplmn-prose-function-3)

[30](#protocol-specification-and-implementation)

[30](#introduction-2)

[30](#use-of-diameter-base-protocol)

[30](#securing-diameter-messages)

[30](#accounting-functionality)

[30](#use-of-sessions)

[30](#transport-protocol)

[30](#routing-considerations)

[31](#advertising-application-support)

[31](#diameter-application-identifier)

[31](#use-of-the-supported-features-avp)

[31](#commands)

[31](#introduction-3)

[32](#command-code-values)

[32](#prose-authorization-request-par-command)

[33](#prose-authorization-answer-paa-command)

[33](#prose-discovery-request-pdr-command)

[34](#prose-discovery-answer-pda-command)

[34](#prose-match-request-pmr-command)

[34](#prose-match-answer-pma-command)

[35](#prose-match-report-info-request-pir-command)

[35](#prose-match-report-info-answer-pia-command)

[36](#prose-proximity-request-prr-command)

[36](#prose-proximity-answer-pra-command)

[37](#prose-location-update-request-plr-command)

[37](#prose-location-update-answer-pla-command)

[38](#prose-alert-request-alr-command)

[38](#prose-alert-answer-ala-command)

[38](#prose-cancellation-request-pcr-command)

[39](#prose-cancellation-answer-pca-command)

[39](#information-elements)

[39](#general-10)

[42](#app-layer-user-id)

[42](#assistance-info)

[43](#assistance-info-validity-timer)

[43](#discovery-type)

[43](#eap-master-session-key)

[44](#feature-list-id-avp)

[44](#feature-list-avp)

[44](#filter-id)

[44](#location-estimate)

[44](#mac-address)

[44](#match-report)

[45](#msisdn)

[45](#operating-channel)

[45](#p2p-features)

[45](#prose-app-code)

[45](#prose-app-id)

[45](#prose-app-mask)

[45](#prose-direct-allowed)

[45](#prose-discovery-filter)

[46](#prr-flags)

[46](#prose-validity-timer)

[46](#requesting-epuid)

[46](#supported-features)

[46](#ssid)

[46](#targeted-epuid)

[46](#time-window)

[47](#user-identifier)

[47](#visited-plmn-id)

[47](#wifi-p2p-assistance-info)

[47](#wlan-assistance-info)

[47](#wlan-link-layer-id)

[48](#wlan-link-layer-id-list)

[48](#oc-supported-features)

[48](#oc-olr)

[48](#validity-time-announce)

[48](#validity-time-monitor)

[48](#validity-time-communication)

[48](#prose-app-code-info)

[48](#mic)

[49](#utc-based-counter)

[49](#location-update-trigger)

[49](#location-update-event-type)

[49](#change-of-area-type)

[50](#location-update-event-trigger)

[50](#report-cardinality)

[50](#minimum-interval-time)

[50](#periodic-location-type)

[51](#location-report-interval-time)

[51](#total-number-of-reports)

[51](#authorized-discovery-range)

[51](#prose-match-refresh-timer)

[51](#discovery-auth-request)

[52](#discovery-auth-response)

[53](#match-request)

[54](#match-report-info)

[54](#pmr-flags)

[54](#prose-application-metadata)

[54](#discovery-entry-id)

[54](#prose-metadata-index-mask)

[54](#app-identifier)

[55](#os-id)

[55](#os-app-id)

[55](#requesting-rpauid)

[55](#target-rpauid)

[55](#target-pduid)

[55](#prose-restricted-code)

[55](#prose-restricted-code-suffix-range)

[55](#beginning-suffix)

[56](#ending-suffix)

[56](#match-timestamp)

[56](#drmp)

[56](#banned-rpauid)

[56](#banned-pduid)

[56](#code-receiving-security-material)

[56](#code-sending-security-material)

[57](#dusk)

[57](#duik)

[57](#duck)

[57](#mic-check-indicator)

[57](#encrypted-bitmask)

[57](#prose-app-code-suffix-range)

[58](#load)

[58](#pc5-tech)

[58](#result-code-and-experimental-result-values)

[58](#general-11)

[58](#success)

[58](#permanent-failures)

[58](#diameter_error_user_unknown-5001)

[58](#diameter_error_unauthorized_service-5511)

[58](#diameter_error_no_associated_discovery_filter-5630)

[58](#diameter_error_announcing_unauthorized_in_plmn-5631)

[58](#diameter_error_invalid_application_code-5632)

[59](#diameter_error_proximity_unauthorized-5633)

[59](#diameter_error_proximity_rejected-5634)

[59](#diameter_error_no_proximity_request-5635)

[59](#diameter_error_unauthorized_service_in_this_plmn-5636)

[59](#diameter_error_proximity_cancelled-5637)

[59](#diameter_error_invalid_discovery_type-5641)

[59](#diameter_error_invalid_target_pduid-5638)

[59](#diameter_error_invalid_target_rpauid-5639)

[59](#diameter_error_no_associated_restricted_code-5640)

[59](#diameter_error_revocation_failure-56x1)

[59](#diameter_error_already_banned-56x2)

[59](#transient-failures)

[61](#annex-a-normative-diameter-overload-control-mechanism)

[61](#a.1-general)

[61](#a.2-responding-prose-function-behaviour)

[61](#a.3-requesting-prose-function-behaviour)

[62](#annex-b-informative-diameter-overload-node-behaviour)

[62](#b.1-message-prioritization)

[62](#annex-c-normative-diameter-message-priority-mechanism)

[62](#c.1-general)

[62](#c.2-pc6pc7-interfaces)

[62](#c.2.1-general)

[62](#c.2.2-prose-function-behaviour)

[63](#annex-d-normative-diameter-load-control-mechanism)

[63](#d.1-general)

[63](#d.2-responding-prose-function-behaviour)

[63](#d.3-requesting-prose-function-behaviour)

[64](#annex-e-informative-change-history)Foreword 1 Scope 2 References 3
Definitions, symbols and abbreviations 3.1 Definitions 3.2 Abbreviations
4 General Description 4.1 Introduction 5 Procedures Description 5.1
introduction 5.2 ProSe Service Authorization 5.2.1 General 5.2.2
Detailed behaviour of the ProSe Function in the HPLMN 5.2.3 Detailed
behaviour of the ProSe Function in the Local PLMN or VPLMN 5.3 ProSe
Direct Discovery Authorization 5.3.1 General 5.3.2 Detailed behaviour of
the HPLMN ProSe Function 5.3.3 Detailed behaviour of the ProSe Function
in the Local PLMN or VPLMN 5.4 ProSe Match Report 5.4.1 General 5.4.2
Detailed behaviour of the HPLMN ProSe Function 5.4.3 Detailed behaviour
of the ProSe Function in the local PLMN 5.5 ProSe Match Report info
5.5.1 General 5.5.2 Detailed behaviour of the requesting ProSe Function
5.5.3 Detailed behaviour of the receiving ProSe Function 5.6 ProSe
Proximity Request 5.6.1 General 5.6.2 Detailed behaviour of the ProSe
Function of the requesting UE 5.6.3 Detailed behaviour of the ProSe
Function of the targeted UE 5.7 ProSe Location Update 5.7.1 General
5.7.2 Detailed behaviour of the ProSe Function of the requesting UE
5.7.3 Detailed behaviour of the ProSe Function of the targeted UE 5.8
ProSe Cancellation 5.8.1 General 5.8.2 Detailed behaviour of the ProSe
Function of the requesting UE 5.8.3 Detailed behaviour of the ProSe
Function of the targeted UE 5.9 ProSe Proximity Alert 5.9.1 General
5.9.2 Detailed behaviour of the ProSe Function of the targeted UE 5.9.3
Detailed behaviour of the ProSe Function of the requesting UE 5.10 ProSe
Direct Discovery Authorization Update 5.10.1 General 5.10.2 Detailed
behaviour of the HPLMN ProSe Function 5.10.3 Detailed behaviour of the
ProSe Function in the local PLMN or VPLMN 5.11 ProSe Direct Discovery
Authorization Update Result 5.11.1 General 5.11.2 Detailed behaviour of
the ProSe Function in the local PLMN 5.11.3 Detailed behaviour of the
HPLMN ProSe Function 6 Protocol Specification and Implementation 6.1
Introduction 6.1.1 Use of Diameter base protocol 6.1.2 Securing Diameter
Messages 6.1.3 Accounting functionality 6.1.4 Use of sessions 6.1.5
Transport protocol 6.1.6 Routing considerations 6.1.7 Advertising
Application Support 6.1.8 Diameter Application Identifier 6.1.9 Use of
the Supported-Features AVP 6.2 Commands 6.2.1 Introduction 6.2.2
Command-Code values 6.2.3 ProSe-Authorization-Request (PAR) Command
6.2.4 ProSe-Authorization-Answer (PAA) Command 6.2.5
ProSe-Discovery-Request (PDR) Command 6.2.6 ProSe-Discovery-Answer (PDA)
Command 6.2.7 ProSe-Match-Request (PMR) Command 6.2.8 ProSe-Match-Answer
(PMA) Command 6.2.9 ProSe-Match-Report-Info-Request (PIR) Command 6.2.10
ProSe-Match-Report-Info-Answer (PIA) Command 6.2.11
ProSe-Proximity-Request (PRR) Command 6.2.12 ProSe-Proximity-Answer
(PRA) Command 6.2.13 ProSe-Location-Update-Request (PLR) Command 6.2.14
ProSe-Location-Update-Answer (PLA) Command 6.2.15 ProSe-Alert-Request
(ALR) Command 6.2.16 ProSe-Alert-Answer (ALA) Command 6.2.17
ProSe-Cancellation-Request (PCR) Command 6.2.18
ProSe-Cancellation-Answer (PCA) Command 6.3 Information Elements 6.3.1
General 6.3.2 App-Layer-User-Id 6.3.3 Assistance-info 6.3.4
Assistance-Info-Validity-Timer 6.3.5 Discovery-Type 6.3.6
EAP-Master-Session-Key 6.3.7 Feature-List-ID AVP 6.3.8 Feature-List AVP
6.3.9 Filter-Id 6.3.10 Location-Estimate 6.3.11 MAC-Address 6.3.12
Match-Report 6.3.13 MSISDN 6.3.14 Operating-Channel 6.3.15 P2P-Features
6.3.16 ProSe-App-Code 6.3.17 ProSe-App-Id 6.3.18 ProSe-App-Mask 6.3.19
ProSe-Direct-Allowed 6.3.20 ProSe-Discovery-Filter 6.3.21 PRR-Flags
6.3.22 ProSe-Validity-Timer 6.3.23 Requesting-EPUID 6.3.24
Supported-Features 6.3.25 SSID 6.3.26 Targeted-EPUID 6.3.27 Time-Window
6.3.28 User-Identifier 6.3.29 Visited-PLMN-Id 6.3.30
WiFi-P2P-Assistance-Info 6.3.31 WLAN-Assistance-Info 6.3.32
WLAN-Link-Layer-Id 6.3.33 WLAN-Link-Layer-Id-List 6.3.34
OC-Supported-Features 6.3.35 OC-OLR 6.3.36 Validity-Time-Announce 6.3.37
Validity-Time-Monitor 6.3.38 Validity-Time-Communication 6.3.39
ProSe-App-Code-Info 6.3.40 MIC 6.3.41 UTC-based-Counter 6.3.42
Location-Update-Trigger 6.3.43 Location-Update-Event-Type 6.3.44
Change-Of-Area-Type 6.3.45 Location-Update-Event-Trigger 6.3.46
Report-Cardinality 6.3.47 Minimum-Interval-Time 6.3.48
Periodic-Location-Type 6.3.49 Location-Report-Interval-Time 6.3.50
Total-Number-Of-Reports 6.3.51 Authorized-Discovery-Range 6.3.52
ProSe-Match-Refresh-Timer 6.3.53 Discovery-Auth-Request 6.3.54
Discovery-Auth-Response 6.3.55 Match-Request 6.3.56 Match-Report-Info
6.3.57 PMR-Flags 6.3.58 ProSe-Application-Metadata 6.3.59
Discovery-Entry-ID 6.3.60 ProSe-Metadata-Index-Mask 6.3.61
App-Identifier 6.3.62 OS-ID 6.3.63 OS-App-ID 6.3.64 Requesting-RPAUID
6.3.65 Target-RPAUID 6.3.66 Target-PDUID 6.3.67 ProSe-Restricted-Code
6.3.68 ProSe-Restricted-Code-Suffix-Range 6.3.69 Beginning-Suffix 6.3.70
Ending-Suffix 6.3.71 Match-Timestamp 6.3.72 DRMP 6.3.73 Banned-RPAUID
6.3.74 Banned-PDUID 6.3.75 Code-Receiving-Security-Material 6.3.76
Code-Sending-Security-Material 6.3.77 DUSK 6.3.78 DUIK 6.3.79 DUCK
6.3.80 MIC-Check-Indicator 6.3.81 Encrypted-Bitmask 6.3.82
ProSe-App-Code-Suffix-Range 6.3.83 Load 6.3.84 PC5-tech 6.4 Result-Code
and Experimental-Result Values 6.4.1 General 6.4.2 Success 6.4.3
Permanent Failures 6.4.3.1 DIAMETER\_ERROR\_USER\_UNKNOWN (5001) 6.4.3.2
DIAMETER\_ERROR\_UNAUTHORIZED\_SERVICE (5511) 6.4.3.3
DIAMETER\_ERROR\_NO\_ASSOCIATED\_DISCOVERY\_FILTER (5630) 6.4.3.4
DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN (5631) 6.4.3.5
DIAMETER\_ERROR\_INVALID\_APPLICATION\_CODE (5632) 6.4.3.6
DIAMETER\_ERROR\_PROXIMITY\_UNAUTHORIZED (5633) 6.4.3.7
DIAMETER\_ERROR\_PROXIMITY\_REJECTED (5634) 6.4.3.8
DIAMETER\_ERROR\_NO\_PROXIMITY\_REQUEST (5635) 6.4.3.9
DIAMETER\_ERROR\_UNAUTHORIZED\_SERVICE\_IN\_THIS\_PLMN (5636) 6.4.3.10
DIAMETER\_ERROR\_PROXIMITY\_CANCELLED (5637) 6.4.3.11
DIAMETER\_ERROR\_INVALID\_DISCOVERY\_TYPE (5641) 6.4.3.12
DIAMETER\_ERROR\_INVALID\_TARGET\_PDUID (5638) 6.4.3.13
DIAMETER\_ERROR\_INVALID\_TARGET\_RPAUID (5639) 6.4.3.14
DIAMETER\_ERROR\_NO\_ASSOCIATED\_RESTRICTED\_CODE (5640) 6.4.3.15
DIAMETER\_ERROR\_REVOCATION\_FAILURE (56x1) 6.4.3.16
DIAMETER\_ERROR\_ALREADY\_BANNED (56x2) 6.4.4 Transient Failures Annex A
(normative): Diameter overload control mechanism A.1 General A.2
Responding ProSe Function behaviour A.3 Requesting ProSe Function
behaviour Annex B (Informative): Diameter overload node behaviour B.1
Message prioritization Annex C (normative): Diameter message priority
mechanism C.1 General C.2 PC6/PC7 interfaces C.2.1 General C.2.2 ProSe
Function behaviour Annex D (normative): Diameter load control mechanism
D.1 General D.2 Responding ProSe Function behaviour D.3 Requesting ProSe
Function behaviour Annex E (informative): Change history

Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document describes the Diameter-based interfaces between the
Proximity Services (ProSe) Function in the HPLMN and the ProSe Function
in a local PLMN (PC6 interface) or between the Proximity Services
(ProSe) Function in the HPLMN and the ProSe Function in a visited PLMN
(PC7 interface).

This specification defines the Diameter application for PC6/PC7
reference points between the ProSe Functions. The interactions between
the ProSe Functions are specified.

The stage 2 description for Proximity Services (ProSe) features in EPS
is specified in 3GPP TS 23.303 \[2\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".

\[2\] 3GPP TS 23 303: \"Proximity-based services (ProSe); Stage 2\".

\[3\] 3GPP TS 29 228: \"IP Multimedia (IM) Subsystem Cx and Dx
Interfaces; Signalling flows and message contents\".

\[4\] 3GPP TS 23.003: \"Numbering, addressing and identification\".

\[5\] 3GPP TS 29.329: \"Sh interface based on the Diameter protocol;
Protocol details\".

\[6\] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".

\[7\] Void.

\[8\] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP
network layer security\".

\[9\] IETF RFC 4960: \"Stream Control Transport Protocol\".

\[10\] 3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter
protocol; protocol details\".

\[11\] IETF RFC 5234: \"Augmented BNF for Syntax Specifications: ABNF\".

\[12\] IETF RFC 4072: \"Diameter Extensible Authentication Protocol
(EAP) Application\".

\[13\] 3GPP TS 32.299: \"Charging management; Diameter charging
applications\".

\[14\] 3GPP TS 29.344: \"Proximity-services (Prose) Function to Home
Subscriber Server (HSS) aspects (PC4); Stage 3\".

\[15\] 3GPP TS 29.273: \"Evolved Packet System (EPS); 3GPP EPS AAA
interfaces\".

\[16\] 3GPP TS 29.272: \"Evolved Packet System (EPS); Mobility
Management Entity (MME) and Serving GPRS Support Node (SGSN) related
interfaces based on Diameter protocol\".

\[17\] Wi-Fi Alliance Technical Committee P2P Task Group, \"Wi-Fi
Peer-to-Peer (P2P) Technical Specification\", Version 1.1.

\[18\] 3GPP TS 29.336: \"Home Subscriber Server (HSS) diameter
interfaces for interworking with packet data networks and
applications\".

\[19\] ITU-T Recommendation E.164: \"The international public
telecommunication numbering plan\".

\[20\] IEEE Std 802.11-2012: \"IEEE Standard for Information technology
- Telecommunications and information exchange between systems - Local
and metropolitan area networks - Specific requirements - Part 11:
Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY)
Specifications\".

\[21\] IETF RFC 7683: \"Diameter Overload Indication Conveyance\".

\[22\] 3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE)
to ProSe function protocol aspects; Stage 3\".

\[23\] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security
aspects\".

\[24\] 3GPP TS 23.271: \"Functional stage 2 description of Location
Services (LCS)\".

\[25\] Open Mobile Alliance, OMA AD SUPL: \"Secure User Plane Location
Architecture\",
([http://www.openmobilealliance.org](http://www.openmobilealliance.org/)).

\[26\] 3GPP TS 24.333: \"Proximity-services (ProSe) Management Objects
(MO)\".

\[27\] IETF RFC 7944: \"Diameter Routing Message Priority\".

\[28\] IETF RFC 8583: \"Diameter Load Information Conveyance\".

\[29\] IETF RFC 6733: \"Diameter Base Protocol\".

3 Definitions, symbols and abbreviations
========================================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions
given in 3GPP TR 21.905 \[1\] and the following apply. A term defined in
the present document takes precedence over the definition of the same
term, if any, in 3GPP TR 21.905 \[1\].

For the purposes of the present document, the following terms and
definitions given in 3GPP TS 23.303 \[2\] apply:

**Local PLMN**

3.2 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
3GPP TR 21.905 \[1\] and the following apply. An abbreviation defined in
the present document takes precedence over the definition of the same
abbreviation, if any, in 3GPP TR 21.905 \[1\].

ALUID Application Layer User ID

DRMP Diameter Routing Message Priority

DSCP Differentiated Services Code Point

DUCK Discovery User Confidentiality Key

DUIK Discovery User Integrity Key

DUSK Discovery User Scrambling Key

EPUID EPC ProSe User ID

MIC Message Integrity Check

PDUID ProSe Discovery UE ID

ProSe Proximity-based Services

RPAUID Restricted ProSe Application User ID

UTC Universal Time Coordinated

WLLID WLAN Link Layer ID

4 General Description
=====================

4.1 Introduction
----------------

The PC6 reference point is defined between a ProSe Function in the HPLMN
and a ProSe Function in a local PLMN.

The PC7 reference point is defined between ProSe Function in the HPLMN
and a ProSe Function in a visited PLMN.

The definition of the PC6/PC7 reference points and related
functionalities are given in 3GPP TS 23.303 \[2\].

As defined in 3GPP TS 23.303 \[2\], the PC6/PC7 reference points are
used for:

\- HPLMN control of service authorization for ProSe;

\- Authorization of ProSe Direct Discovery requests;

\- Retrieval of Discovery Filter(s) corresponding ProSe Application ID
name(s);

\- Translation of ProSe Application Code(s) to the associated ProSe
Application Name.

5 Procedures Description
========================

5.1 introduction
----------------

This clause describes the Diameter-based PC6 and PC7 interfaces related
procedures and Information elements exchanged between functional
entities.

In the tables that describe the Information Elements transported by each
Diameter command, each Information Element is marked as (M) Mandatory,
(C) Conditional or (O) Optional in the \"Cat.\" column. For the correct
handling of the Information Element according to the category type, see
the description detailed in clause 6 of the 3GPP TS 29.228 \[3\].

5.2 ProSe Service Authorization
-------------------------------

### 5.2.1 General

The ProSe Service Authorization Procedure shall be used between the
ProSe Function in the HPLMN and the ProSe Function in Local PLMN or
VPLMN to obtain service authorization information for ProSe Direct
Discovery, ProSe Direct Communication or both. The procedure shall be
invoked by the ProSe Function in the HPLMN by the UE and is used:

\- to request service authorization information for ProSe related to the
UE from the ProSe Function in the local PLMN or VPLMN;

\- to provide the ProSe Function in the local PLMN or VPLMN with the UE
identity (IMSI or MSISDN) in order to allow to perform charging:

This procedure is mapped to the commands
ProSe-Authorization-Request/Answer (PAR/PAA) in the Diameter application
specified in clause 6.

Table 5.2.1-1 specifies the involved information elements for the
request.

Table 5.2.1-2 specifies the involved information elements for the
answer.

Table 5.2.1-1: ProSe Service Authorization Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| UE Identity       | User-Identifier   | M    | This information  |
|                   |                   |      | element shall     |
| (See 6.3.28)      |                   |      | contain either    |
|                   |                   |      | the user IMSI,    |
|                   |                   |      | formatted         |
|                   |                   |      | according to      |
|                   |                   |      | 3GPP              |
|                   |                   |      |  TS 23.003 \[4\], |
|                   |                   |      | clause 2.2, or    |
|                   |                   |      | the user MSISDN,  |
|                   |                   |      | formatted         |
|                   |                   |      | according to      |
|                   |                   |      | 3GPP              |
|                   |                   |      |  TS 29.329 \[5\]. |
+-------------------+-------------------+------+-------------------+
| PLMN Id           | Visited-PLMN-Id   | M    | This IE shall     |
|                   |                   |      | contain the       |
| (See 6.3.29)      |                   |      | PLMN-Id           |
|                   |                   |      | (3GPP             |
|                   |                   |      |  TS 23.003 \[4\]) |
|                   |                   |      | of the network in |
|                   |                   |      | which the ProSe   |
|                   |                   |      | Function is       |
|                   |                   |      | located.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+

Table 5.2.1-2: ProSe Service Authorization Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- User Unknown   |
|                   |                   |      |                   |
|                   |                   |      | \- Unauthorized   |
|                   |                   |      | Service           |
|                   |                   |      |                   |
|                   |                   |      | \- Unauthorized   |
|                   |                   |      | Service in this   |
|                   |                   |      | PLMN              |
+-------------------+-------------------+------+-------------------+
| ProSe Direct      | Pro               | C    | This Information  |
| Allowed           | Se-Direct-Allowed |      | Element shall     |
|                   |                   |      | contain the ProSe |
| (See 6.3.42)      |                   |      | authorization     |
|                   |                   |      | information of    |
|                   |                   |      | the user. It      |
|                   |                   |      | shall be present  |
|                   |                   |      | if success is     |
|                   |                   |      | reported.         |
+-------------------+-------------------+------+-------------------+
| Validity Time of  | Valid             | C    | This Information  |
| Announcing        | ity-Time-Announce |      | Element shall     |
| (see.6.3.36)      |                   |      | contain the       |
|                   |                   |      | validity time for |
|                   |                   |      | a UE              |
|                   |                   |      | authorization to  |
|                   |                   |      | perform ProSe     |
|                   |                   |      | direct discovery  |
|                   |                   |      | announcing in     |
|                   |                   |      | this PLMN. It     |
|                   |                   |      | shall be present  |
|                   |                   |      | if success is     |
|                   |                   |      | reported.         |
+-------------------+-------------------+------+-------------------+
| Validity Time of  | Vali              | C    | This Information  |
| Monitoring        | dity-Time-Monitor |      | Element shall     |
| (see.6.3.37)      |                   |      | contain the       |
|                   |                   |      | validity time for |
|                   |                   |      | a UE              |
|                   |                   |      | authorization to  |
|                   |                   |      | perform ProSe     |
|                   |                   |      | direct discovery  |
|                   |                   |      | monitoring in     |
|                   |                   |      | this PLMN. It     |
|                   |                   |      | shall be present  |
|                   |                   |      | if success is     |
|                   |                   |      | reported.         |
+-------------------+-------------------+------+-------------------+
| Validity Time of  | Validity-T        | C    | This Information  |
| Communication     | ime-Communication |      | Element shall     |
| (see.6.3.38)      |                   |      | contain the       |
|                   |                   |      | validity time for |
|                   |                   |      | a UE              |
|                   |                   |      | authorization to  |
|                   |                   |      | perform ProSe     |
|                   |                   |      | direct            |
|                   |                   |      | communication in  |
|                   |                   |      | this PLMN. It     |
|                   |                   |      | shall be present  |
|                   |                   |      | if success is     |
|                   |                   |      | reported.         |
+-------------------+-------------------+------+-------------------+
| Authorized        | Authorize         | C    | This information  |
| Discovery Range   | d-Discovery-Range |      | element shall     |
|                   |                   |      | contain the       |
| (See 3GPP TS      |                   |      | authorised range  |
| 29.344 \[14\])    |                   |      | (s                |
|                   |                   |      | hort/medium/long) |
|                   |                   |      | at which the UE   |
|                   |                   |      | is allowed to     |
|                   |                   |      | announce in the   |
|                   |                   |      | given PLMN        |
|                   |                   |      | according to the  |
|                   |                   |      | defined           |
|                   |                   |      | announcing        |
|                   |                   |      | authorisation     |
|                   |                   |      | policy for this   |
|                   |                   |      | UE. It shall be   |
|                   |                   |      | present if the    |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | type is for       |
|                   |                   |      | announcing.       |
|                   |                   |      | Otherwise it      |
|                   |                   |      | shall be absent.  |
+-------------------+-------------------+------+-------------------+

### 5.2.2 Detailed behaviour of the ProSe Function in the HPLMN

The ProSe Function in the HPLMN shall make use of this procedure to
request service authorization information for ProSe related to the UE
from the ProSe Function in local PLMN or VPLMN. The ProSe Function shall
include in the request the UE identity (IMSI or MSISDN) and the PLMN-Id
identifying the PLMN of the requesting ProSe Function.

When receiving a ProSe Service Authorization response from the ProSe
Function in the local PLMN or VPLMN, the ProSe Function in the HPLMN
shall check the result code. If it indicates SUCCESS, the ProSe Function
shall merge with its own policy.

### 5.2.3 Detailed behaviour of the ProSe Function in the Local PLMN or VPLMN

When receiving a ProSe Service Authorization request, the ProSe Function
in the local PLMN or VPLMN shall, in the following order:

1\. Check whether the UE Identity (IMSI or MSISDN) exists. If not, a
Result Code of DIAMETER\_ERROR\_USER\_UNKNOWN shall be returned.

2\. Check whether ProSe is authorized for this UE Identity. If not, a
Result Code of DIAMETER\_ERROR\_UNAUTHORIZED\_SERVICE shall be returned.

If there is an error in any of the above steps then the ProSe Function
shall stop processing the request and shall return the error code
specified in the respective step.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall stop processing the
request and set the Result Code to \"DIAMETER\_UNABLE\_TO\_COMPLY\".

Otherwise, when the UE is authorized to use ProSe Direct Discovery or
ProSe Direct Communication in this PLMN, the ProSe Function shall return
the authorization data in the response, according to the
supported/unsupported features of the ProSe Function in the Local PLMN
or VPLMN, and the authorised announcing range (short/medium/long) at
which and if the UE is allowed to announce in the VPLMN according to the
defined announcing authorisation policy for this UE (see 3GPP TS 24.333
\[26\] for the possible values of the range) and shall set the Result
Code to \"DIAMETER\_SUCCESS\".

5.3 ProSe Direct Discovery Authorization
----------------------------------------

### 5.3.1 General

The ProSe Direct Discovery Authorization Procedure shall be used between
the ProSe Function in the HPLMN and the ProSe Function in a Local PLMN
or VPLMN to obtain authorization for access to the discovery resources
and perform ProSe Direct Discovery. The procedure shall be invoked by
the ProSe Function in the HPLMN and is used:

\- to request the ProSe Function in the VPLMN or Local PLMN for the
authorization for ProSe Direct Discovery announcing when the announcing
UE is roaming in the VPLMN or announcing in a Local PLMN;

\- to perform the resolution ProSe Application ID Name to ProSe
Application Code and/or ProSe Application Mask when the ProSe
Application ID has PLMN-specific scope for open ProSe Direct discovery;

\- to notify the ProSe Function in Local PLMN that the previously
allocated ProSe Discovery Filter for a ProSe Application ID which has
PLMN-specific scope is no longer monitored by a monitoring UE of the
HPLMN;

\- to perform the resolution of a target RPAUID to a ProSe Restricted
Code or ProSe Restricted Code Prefix for restricted ProSe Direct
Discovery;

\- to provide the ProSe Function in the Local PLMN or VPLMN with the
application identity in order to allow it to perform charging;

\- to provide the ProSe Function in the Local PLMN or VPLMN with the UE
identity (i.e. IMSI or MSISDN) in order to allow to perform charging;

\- to provide the ProSe Function in VPLMN with the allocated ProSe
Application Code, ProSe Restricted Code or ProSe Restricted Code
Prefix/Suffix Pool, and the corresponding validity timer, or a
notification of the termination or change of the allocated ProSe-related
codes, in order to allow to perform charging.

\- to provide the ProSe Function in VPLMN with the allocated ProSe Query
Code or ProSe Response Code and the corresponding validity timer when
such a code is announced in restricted ProSe Direct Discovery model B
procedure, in order to allow to perform charging.

\- to provide the ProSe Function in VPLMN/Local PLMN with the allocated
ProSe Query Code, ProSe Response Code and associated validity timer for
a given RPAUID using restricted ProSe Direct Discovery model B.

\- to provide the ProSe Function in the Local PLMN or VPLMN with the PC5
radio technology that the UE is using.

This procedure is mapped to the commands ProSe-Discovery-Request/Answer
(PDR/PDA) in the Diameter application specified in clause 6.

Table 5.3.1-1 specifies the involved information elements for the
request.

Table 5.3.1-2 specifies the involved information elements for the
answer.

Table 5.3.1-1: ProSe Direct Discovery Authorization Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Discovery         | Disco             | M    | This information  |
| Authorization     | very-Auth-Request |      | element shall     |
| Request           |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.53)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

Table 5.3.1-2: ProSe Direct Discovery Authorization Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Announcing Not |
|                   |                   |      | Authorized        |
|                   |                   |      |                   |
|                   |                   |      | \- No Associated  |
|                   |                   |      | Discovery Filter  |
+-------------------+-------------------+------+-------------------+
| Discovery         | Discov            | C    | This information  |
| Authorization     | ery-Auth-Response |      | element shall     |
| Response          |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.54)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | response. This    |
|                   |                   |      | information       |
|                   |                   |      | element shall be  |
|                   |                   |      | present if the    |
|                   |                   |      | Result Code AVP   |
|                   |                   |      | is                |
|                   |                   |      | D                 |
|                   |                   |      | IAMETER\_SUCCESS. |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

### 5.3.2 Detailed behaviour of the HPLMN ProSe Function 

The ProSe Function in the HPLMN shall make use of this procedure to
request the ProSe Function in VPLMN or a PLMN other than the HPLMN/VPLMN
for ProSe Direct Discovery announcing authorisation for an announcing UE
roaming in the VPLMN or announcing in a Local PLMN.

\- For open ProSe Direct Discovery, the HPLMN ProSe Function shall
include in the request the Discovery Entry ID and shall include in the
Discovery Authorization Request the Discovery Type set to
\"ANNOUNCING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the ProSe
Application ID corresponding to the request from the announcing UE and
the ProSe Application Code or ProSe Application Code Prefix/Suffix(es)
assigned for this request. The Discovery Authorization Request shall
include the UE identity (i.e., IMSI or MSISDN) and the ProSe Validity
Timer corresponding to ProSe Application Code in order to allow the
ProSe Function in VPLMN or the Local PLMN to perform charging. If the
announcing UE\'s original announce request is for updating the metadata,
the updated metadata shall also be included. If the announcing UE\'s
original announce request is for stopping the announcing operation, the
ProSe Function shall not include any ProSe Application Code(s) or ProSe
Validity Timer. The HPLMN ProSe Function may also include the PC5-tech
set to the PC5 radio technology that the UE is using.

\- For restricted ProSe Direct Discovery, the HPLMN ProSe Function shall
include in the Discovery Authorization Request the Discovery Entry ID
and the Discovery Type set to
\"ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
application identity, RPAUID corresponding to the announcing UE, the
ProSe Restricted Code assigned for this request. The Discovery
Authorization Request shall also include the UE identity (i.e., IMSI or
MSISDN) and the ProSe Validity Timer corresponding to ProSe Restricted
Code in order to allow the ProSe Function in VPLMN or the Local PLMN to
perform charging. For restricted ProSe Direct Discovery using
application-controlled extension, the ProSe Function shall include a
ProSe Restricted Code Prefix and one or more ProSe Restricted Code
Suffix Range in the Discovery Authorization Request. If the announcing
UE\'s original announce request is for stopping the announcing
operation, the ProSe Function shall not include any ProSe Restricted
Code or ProSe Restricted Code Prefix or ProSe Restricted Code Suffix
Range(s), or ProSe Validity Timer. The HPLMN ProSe Function may also
include the PC5-tech set to the PC5 radio technology that the UE is
using.

\- For restricted ProSe Direct Discovery model B discoverer operation,
the HPLMN ProSe Function shall include in the Discovery Authorization
Request the Discovery Entry ID and the Discovery Type set to
\"DISCOVERER\_ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\",
the application identity, RPAUID corresponding to the discoverer UE as
well as the ProSe Query Code assigned for this request. The Discovery
Authorization Request shall also include the UE identity (i.e., IMSI or
MSISDN) and the ProSe Validity Timer corresponding to ProSe Query Code
in order to allow the ProSe Function in VPLMN or the Local PLMN to
perform charging. The HPLMN ProSe Function may also include the PC5-tech
set to the PC5 radio technology that the UE is using.

\- For restricted ProSe Direct Discovery model B discoveree operation,
the HPLMN ProSe Function shall include in the Discovery Authorization
Request the Discovery Entry ID and the Discovery Type set to
\"DISCOVEREE\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
application identity, RPAUID corresponding to the discoverer UE as well
as the ProSe Response Code assigned for this request. The Discovery
Authorization Request shall also include the UE identity (i.e., IMSI or
MSISDN) and the ProSe Validity Timer corresponding to ProSe Query Code
in order to allow the ProSe Function in VPLMN or the Local PLMN to
perform charging. The HPLMN ProSe Function may also include the PC5-tech
set to the PC5 radio technology that the UE is using.

The ProSe Function in the HPLMN shall make use of this procedure to
retrieve from the ProSe Function in the Local PLMN the Discovery Filter
for monitoring in open ProSe Direct Discovery or to retrieve parameters
needed to create a Restricted Discovery Filter, or ProSe Response Filter
associated with the monitored/queried application-layer identity for
restricted ProSe Direct Discovery.

\- For open ProSe Direct Discovery, the HPLMN ProSe Function shall
include in the request the Discovery Entry ID and shall include in the
Discovery Authorization Request the Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the ProSe
Application ID name corresponding to the request from the monitoring UE.
The Discovery Authorization Request shall also include the UE identity
(i.e., IMSI or MSISDN) in order to allow the ProSe Function in Local
PLMN to perform charging. If the monitoring UE\'s original announce
request is for stopping the monitoring operation or the allocated
Discovery Filter has been revoked by the ProSe Function, the ProSe
Function shall not include the ProSe Application ID name. The HPLMN
ProSe Function may also include the PC5-tech set to the PC5 radio
technology that the UE is using.

\- For restricted ProSe Direct Discovery, the HPLMN ProSe Function shall
include in the Discovery Authorization Request the Discovery Entry ID
and the Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY, the
application identity, the requesting RPAUID, target RPAUID and target
PDUID of a monitoring target. The Discovery Authorization Request shall
also include the UE identity (i.e., IMSI or MSISDN) in order to allow
the ProSe Function in Local PLMN to perform charging. The HPLMN ProSe
Function may also include the PC5-tech set to the PC5 radio technology
that the UE is using.

\- For restricted ProSe Direct Discovery model B discoveree operation,
the HPLMN ProSe Function shall include in the Discovery Authorization
Request the Discovery Entry ID and the Discovery Type set to the
indicate
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
application identity, the requesting RPAUID, target RPAUID and target
PDUID of a monitoring target. The request shall include the UE identity
(IMSI or MSISDN) and the Discovery Entry ID in order to allow the ProSe
Function in Local PLMN to perform charging. The HPLMN ProSe Function may
also include the PC5-tech set to the PC5 radio technology that the UE is
using.

When receiving the ProSe Direct Discovery Authorization response with
the Result Code set to \"DIAMETER\_SUCCESS\" for a request with the
Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the HPLMN
ProSe Function shall check whether a ProSe Discovery Filter is received
for each ProSe Application ID Name sent in the request. If a ProSe
Discovery Filter is missing for one ProSe Application ID Name, the ProSe
Function shall consider that there is no valid ProSe Discovery Filter
the ProSe associated with this ProSe Application ID Name in the ProSe
Function in the Local PLMN or VPLMN.

When receiving the ProSe Direct Discovery Authorization response with
the Result Code set to \"DIAMETER\_SUCCESS\" for a request with the
Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\" or
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
HPLMN ProSe Function shall enclose the information in Code Receiving
Security Material parameter in the discovery filter created for the
target RPAUID. If a DUIK parameter is included in the response message,
the ProSe Function shall store the DUIK in order to verify the MIC
field, as specified in 3GPP TS 24.334 \[22\].

### 5.3.3 Detailed behaviour of the ProSe Function in the Local PLMN or VPLMN

When receiving a ProSe Direct Discovery Authorization request, the ProSe
Function in the Local PLMN or VPLMN shall check the value of the
Discovery Type.

\- If the value is
\"ANNOUNCING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the ProSe
Function shall check if the UE is authorized to announce in the PLMN for
the specified PC5 radio technology.

\- If the UE is not authorized, the experimental result code shall be
set to \"DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN\" in the
response sent by the ProSe Function.

\- If the UE is authorized, the result code shall be set to
\"DIAMETER\_SUCCESS\" in the response sent by the ProSe Function. The
ProSe Function shall store the UE identity (i.e., IMSI or MSISDN) in
order to perform charging. In addition, the ProSe Function in the VPLMN
or the Local PLMN shall store the ProSe Validity Timer corresponding to
ProSe Application Code or ProSe Application Code Prefix/Suffix(es) in
order to perform charging. If no ProSe Application Code is included in
the request, the ProSe Function shall remove the discovery entry
associated with the Discovery Entry ID for the requesting UE.

> \- If the value is
> \"ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\",
> the ProSe Function shall check whether the UE is authorized to
> announce in the PLMN for restricted discovery model A for the
> specified PC5 radio technology.

\- If the UE is not authorized, the experimental result code shall be
set to \"DIAMETER\_ERROR\_ANNOUNCING\_NOT\_AUTHORIZED\" in the response
sent by the ProSe Function.

\- If the UE is authorized, the result code shall be set to
\"DIAMETER\_SUCCESS\" in the response sent by the ProSe Function. The
ProSe Function in the VPLMN or the Local PLMN shall store the UE
identity (IMSI or MSISDN) in order to perform charging;

\- ProSe Function in the VPLMN or the Local PLMN shall store the
Application Identity, and the ProSe Validity Timer corresponding to
ProSe Restricted Code or ProSe Restricted Code Prefix and ProSe
Restricted Code Suffix(es) in order to perform charging. If no ProSe
Restricted Code or ProSe Restricted Code Prefix is included in the
request, the ProSe Function shall remove the discovery entry associated
with the Discovery Entry ID for the requesting UE.

\- If the value is
\"DISCOVEREE\_ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\",
the ProSe Function shall check whether the UE is authorized to announce
in the PLMN for restricted discovery model B discoveree operation for
the specified PC5 radio technology.

\- If the UE is not authorized, the experimental result code shall be
set to \"DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN\" in the
response sent by the ProSe Function.

\- If the UE is authorized, the result code shall be set to
\"DIAMETER\_SUCCESS\" in the response sent by the ProSe Function. The
ProSe Function in the VPLMN or the Local PLMN shall store the UE
identity (IMSI or MSISDN) in order to perform charging;

\- ProSe Function in the VPLMN or the Local PLMN shall store the
Application Identity, and the ProSe Validity Timer corresponding to
ProSe Response Code in order to perform charging.

\- If the value is
\"DISCOVERER\_ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\",
the ProSe Function shall check whether the UE is authorized to announce
in the PLMN for restricted discovery model B discoverer operation for
the specified PC5 radio technology.

\- If the UE is not authorized, the experimental result code shall be
set to \"DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN\" in the
response sent by the ProSe Function.

\- If the UE is authorized, the result code shall be set to
\"DIAMETER\_SUCCESS\" in the response sent by the ProSe Function. The
ProSe Function in the VPLMN or the Local PLMN shall store the UE
identity (IMSI or MSISDN), the Application Identity and the ProSe
Validity Timer corresponding to ProSe Query Code in order to perform
charging;

\- If the value is
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the ProSe
Function shall check whether one or more Discovery Filter(s) exist for
each ProSe Application ID name received in the request.

\- If there is no valid Discovery Filter associated to the ProSe
Application ID name in the request, the experimental result code shall
be set to \"DIAMETER\_ERROR\_NO\_ASSOCIATED\_DISCOVERY\_FILTER\" in the
response sent by the ProSe Function.

\- If no ProSe Application ID is included in the request, the ProSe
Function shall remove the discovery entry associated with the Discovery
Entry ID for the requesting UE. If there exists one or more valid
Discovery Filters related to the ProSe Application ID name, the ProSe
Function shall return the Discovery Authorization Response including the
Discovery Filter(s) along with the Discovery Entry ID and set the result
code to \"DIAMETER\_SUCCESS\" in the response. If the announcing UE is
roaming, the PLMN-Id of the VPLMN shall be included in the Discovery
Authorization Response.

\- If the value is
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
ProSe Function shall process the request in the following order to check
if the monitoring is authorized.

\- The ProSe function shall check whether the target PDUID is known and
belongs to its own PLMN. If not, the experimental result code shall be
set to \"DIAMETER\_ERROR\_INVALID\_TARGET\_PDUID\" in the response sent
by the ProSe Function.

\- The ProSe function may check whether the requesting RPAUID is allowed
to discover the target RPAUID. If not, the experimental result code
shall be set to \"DIAMETER\_ERROR\_INVALID\_TARGET\_RPAUID\" in the
response sent by the ProSe Function.

\- The ProSe function shall check whether a valid ProSe Restricted Code
or ProSe Restricted Code Prefix exists for the target RPAUID included in
the request.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_NO\_ASSOCIATED\_RESTRICTED\_CODE\" in the response
sent by the ProSe Function.

\- Otherwise, the ProSe Function shall set the result code to
\"DIAMETER\_SUCCESS\" in the response. The ProSe Function shall return
the Discovery Authorization Response including the ProSe Restricted Code
or ProSe Restricted Code Prefix associated with the target RPAUID, and
the corresponding Code Receiving Security Material and optionally a
DUIK, and its corresponding Validity Timer. If the announcing UE is
roaming, the PLMN-Id of the VPLMN shall be also included in the
response.

\- If the value is
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
ProSe Function shall process the request in the following order to check
whether the monitoring is authorized.

\- The ProSe function shall check if the target PDUID is known and
belongs to its own PLMN. If not, the experimental result code shall be
set to \"DIAMETER\_ERROR\_INVALID\_TARGET\_PDUID\" in the response sent
by the ProSe Function.

\- The ProSe function may check if the requesting RPAUID is allowed to
discovery the target RPAUID. If not, the experimental result code shall
be set to \"DIAMETER\_ERROR\_INVALID\_TARGET\_RPAUID\" in the response
sent by the ProSe Function.

\- The ProSe function shall check if both ProSe Query Code and ProSe
Response Code exist for the target RPAUID included in the request.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_NO\_ASSOCIATED\_RESTRICTED\_CODE\" in the response
sent by the ProSe Function.

> \- Otherwise, the ProSe Function shall set the result code to
> \"DIAMETER\_SUCCESS\" in the response. The ProSe Function shall return
> the Discovery Authorization Response including the ProSe Query Code
> and the corresponding Code Sending Security Material and ProSe
> Response Code Code associated with the target RPAUID, and the
> corresponding Code Receiving Security Material and optionally a DUIK,
> and its corresponding Validity Timer. If the discoverer UE is roaming
> or announcing in a Local PLMN, the PLMN-Id of the VPLMN or the Local
> PLMN shall be also included in the response.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall set the Result Code to
\"DIAMETER\_UNABLE\_TO\_COMPLY\".

5.4 ProSe Match Report
----------------------

### 5.4.1 General

The ProSe Match Report Procedure shall be used between the ProSe
Function in the HPLMN and the ProSe Function in the local PLMN
identified by the PLMN-Id contained in the ProSe Application Code(s)
discovered by the monitoring UE. The procedure shall be invoked by the
ProSe Function in the HPLMN and is used:

\- to confirm that the ProSe Application Code(s) is authorized to be
transmitted on the monitored PLMN;

\- to retrieve the ProSe Application ID(s), associated validity timer(s)
and associated match report refresh timer(s) corresponding to the ProSe
Application Code(s) as well metadata associated with the ProSe
Application ID if available and requested by the UE; and

\- to provide the ProSe Function in the local PLMN with the identity
(IMSI or MSISDN) of the monitoring UE in order to allow to perform
charging.

\- to provide the ProSe Function in the Local PLMN with the PC5 radio
technology that the UE is using.

This procedure is mapped to the commands ProSe-Match-Request/Answer
(PMR/PMA) in the Diameter application specified in clause 6.

Table 5.4.1-1 specifies the involved information elements for the
request.

Table 5.4.1-2 specifies the involved information elements for the
answer.

Table 5.4.1-1: ProSe Match Report Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Match Request     | Match-Request     | M    | This information  |
|                   |                   |      | element shall     |
| (See 6.3.55)      |                   |      | contain the       |
|                   |                   |      | information       |
|                   |                   |      | elements used in  |
|                   |                   |      | discovery match   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| PMR Flags         | PMR-Flags         | C    | This Information  |
|                   |                   |      | Element contains  |
| (See 6.3.57)      |                   |      | a bit mask. See   |
|                   |                   |      | 6.3.57 for the    |
|                   |                   |      | meaning of the    |
|                   |                   |      | bits.             |
+-------------------+-------------------+------+-------------------+

Table 5.4.1-2: ProSe Match Report Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See .6.3.24)     |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Announcing Not |
|                   |                   |      | Authorized in     |
|                   |                   |      | PLMN              |
|                   |                   |      |                   |
|                   |                   |      | \- Invalid        |
|                   |                   |      | Application Code  |
+-------------------+-------------------+------+-------------------+
| Match Report (See | Match-Report      | C    | This Information  |
| 6.3.12)           |                   |      | Element shall     |
|                   |                   |      | contain the       |
|                   |                   |      | information       |
|                   |                   |      | elements in       |
|                   |                   |      | response to the   |
|                   |                   |      | discovery match   |
|                   |                   |      | request. This     |
|                   |                   |      | Information       |
|                   |                   |      | Element shall be  |
|                   |                   |      | present only when |
|                   |                   |      | the Result-Code   |
|                   |                   |      | AVP is            |
|                   |                   |      | D                 |
|                   |                   |      | IAMETER\_SUCCESS. |
|                   |                   |      | Multiple          |
|                   |                   |      | instances of this |
|                   |                   |      | Information       |
|                   |                   |      | Element may be    |
|                   |                   |      | present in the    |
|                   |                   |      | message.          |
+-------------------+-------------------+------+-------------------+

### 5.4.2 Detailed behaviour of the HPLMN ProSe Function 

The ProSe Function in the HPLMN shall make use of this procedure to
retrieve from the ProSe Function in the local PLMN (identified by the
PLMN-Id contained in the Prose Application Code) the ProSe Application
ID(s) that correspond to ProSe Application Code(s) discovered by the
monitoring UE. The HPLMN ProSe Function shall include in the Match
Request the Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
discovered ProSe Application Code(s) corresponding to the request from
the monitoring UE as well as the MIC and UTC-based counter associated
with the discovered ProSe Application Code. The request shall include
the UE identity (i.e. IMSI or MSISDN) in order to allow the ProSe
Function in the local PLMN to perform charging of the monitoring UE. If
the metadata information associated with the ProSe Application ID is
requested by the UE, the flag \"Metadata Requested\" shall be set in the
PMR Flags. The HPLMN ProSe Function may also include the PC5-tech set to
the PC5 radio technology that the UE is using.

When receiving the ProSe Match Report response from the ProSe Function
in the local PLMN with the Result Code set to \"DIAMETER\_SUCCESS\", the
HPLMN ProSe Function shall check whether a Match Report is received for
each ProSe Application Code sent in the request. If a Match Report is
missing for one ProSe Application Code, this ProSe Application Code
shall be considered as invalid by the ProSe Function.

### 5.4.3 Detailed behaviour of the ProSe Function in the local PLMN

When receiving a ProSe Match Report request, the ProSe Function in the
local PLMN shall check the value of the Discovery Type contained in the
Match Request.

\- If the value indicated in the Discovery Type is not supported, the
experimental result code shall be set to
\"DIAMETER\_ERROR\_INVALID\_DISCOVERY\_TYPE\" in the response.

\- If the value is
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the ProSe
Function shallcheck whether that the ProSe Application Code received is
authorized to be announced in the monitored PLMN for the specified PC5
radio technology.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN\" in the response.

\- If the ProSe Code is authorized to be announced, the ProSe Function
shall check the validity of the ProSe Application Code(s) discovered by
the monitoring UE, i.e. a ProSe Application ID name is associated and
the validity timer has not expired, and the MIC value associated with
the ProSe Application Code is valid when verified based on the
associated UTC-based counter as defined in 3GPP TS 33.303 \[23\].

\- If none of the ProSe Application Code(s) is valid in the ProSe
Function, i.e. either no ProSe Application Code exists, the validity
timer(s) has expired, or MIC check(s) for the ProSe Application Code(s)
has failed, the experimental result code shall be set to
\"DIAMETER\_ERROR\_INVALID\_APPLICATION\_CODE\" in the response sent by
the ProSe Function.

\- Otherwise, when at least one ProSe Application Code is valid, the
ProSe Function shall return the Match Report and set the result code to
\"DIAMETER\_SUCCESS\" in the response. For each valid ProSe Application
code, the Match Report shall contain the matched ProSe Application Code,
the ProSe Application ID Name, the validity timer and the match report
refresh timer. The Match Report may include metadata associated with the
ProSe Application ID if requested and available. The ProSe Function may
store the monitoring UE identity (i.e. IMSI or MSISDN) in order to
perform charging.

If there is an error in any of the above steps then the ProSe Function
shall stop processing the request and shall return the error code
specified in the respective step.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall stop processing the
request and set the Result Code to \"DIAMETER\_UNABLE\_TO\_COMPLY\".

If the ProSe Application Code contains a metadata index, a
ProSe-Metadata-Index-Mask AVP shall be provided for this ProSe
Application Code.

5.5 ProSe Match Report info
---------------------------

### 5.5.1 General

For open discovery, the ProSe Match Report Info Procedure shall be used
by the ProSe Function in the HPLMN of the monitoring UE to provide a
match report information to the ProSe Function of the visited PLMN in
which the announcing UE is roaming. For restricted discovery, the ProSe
Match Report Info Procedure shall also be used by the ProSe Function in
the HPLMN of the monitoring UE or discoverer UE to provide a match
report information to the ProSe Function of the HPLMN of the announcing
UE or discoveree UE.

This procedure is mapped to the commands
ProSe-Match-Report-Info-Request/Answer (PIR/PIA) in the Diameter
application specified in clause 6.

Table 5.5.1-1 specifies the involved information elements for the
request.

Table 5.5.1-2 specifies the involved information elements for the
answer.

Table 5.5.1-1: ProSe Match Report Info Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Match Report      | Match-Report-Info | C    | This information  |
| Information       |                   |      | element shall     |
|                   |                   |      | contain the       |
| (See 6.3.56)      |                   |      | information       |
|                   |                   |      | elements used in  |
|                   |                   |      | discovery match   |
|                   |                   |      | report info       |
|                   |                   |      | request. This     |
|                   |                   |      | information       |
|                   |                   |      | element shall be  |
|                   |                   |      | present if the    |
|                   |                   |      | Discovery Type is |
|                   |                   |      | MONITO            |
|                   |                   |      | RING\_REQUEST\_FO |
|                   |                   |      | R\_OPEN\_PROSE\_D |
|                   |                   |      | IRECT\_DISCOVERY. |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+

Table 5.5.1-2: ProSe Match Report Info Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Unknown User   |
+-------------------+-------------------+------+-------------------+

### 5.5.2 Detailed behaviour of the requesting ProSe Function 

When the monitored PLMN-Id provided by the monitoring UE during the
Match Report procedure (see clause 5.4) is different from the PLMN-Id
contained in the ProSe Application Code discovered by the monitoring UE,
i.e. the announcing UE is roaming in a visited PLMN, the monitoring
UE\'s ProSe Function in the HPLMN may make use of this procedure to send
a match report information to the ProSe Function in the visited PLMN in
which the announcing UE is roaming.. In such case, the HPLMN ProSe
Function shall include in the Match Report Information the Discovery
Type set to \"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\"
as well as the ProSe Application ID and the identity of the monitoring
UE (i.e. IMSI or MSISDN).

When the HPLMN ProSe Function of the monitoring UE processes a match
report for a discovered ProSe Restricted Code from the UE, and finds
that the target PDUID for the corresponding discovery entry contains a
PLMN-Id different from the PLMN of the ProSe Function, the monitoring
UE\'s ProSe Function in the HPLMN may make use of this procedure to send
a match report information to the ProSe Function to which the announcing
UE belongs. In such case, the HPLMN ProSe Function shall include in the
Match Report Information the Discovery Type set to
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
ProSe Restricted Code, the RPAUID, the target RPAUID and the identity of
the monitoring UE (i.e. IMSI or MSISDN). The ProSe Function may also
include the timestamp of the match event in the Match Report
Information.

When the HPLMN ProSe Function of the discoverer UE processes a match
report for a discovered ProSe Response Code from the discoverer UE, and
finds that the target PDUID for the corresponding discovery entry
contains a PLMN-Id different from the PLMN of the ProSe Function, the
discoverer UE\'s ProSe Function in the HPLMN may make use of this
procedure to send a match report information to the ProSe Function to
which the discoveree UE belongs. In such case, the HPLMN ProSe Function
shall include in the Match Report Information the Discovery Type set to
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
ProSe Response Code, the RPAUID, the target RPAUID and the identity of
the discoverer UE (i.e. IMSI or MSISDN). The ProSe Function may also
include the timestamp of the match event in the Match Report
Information.

### 5.5.3 Detailed behaviour of the receiving ProSe Function

When receiving a ProSe Match Report Info request, the ProSe Function
shall check the value of the Discovery Type contained in the Match
Report Information.

\- If the value indicated in the Discovery Type is not supported, the
experimental result code shall be set to
\"DIAMETER\_ERROR\_INVALID\_DISCOVERY\_TYPE\" in the response.

\- If the value is
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\",
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\" or
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
ProSe Function shall check whether the UE Identity (i.e. IMSI or MSISDN)
exists.

\- If not, a Result Code of DIAMETER\_ERROR\_USER\_UNKNOWN shall be
returned.

\- Otherwise, it shall acknowledge the reception of the Match Report
info and set the Result Code to \"DIAMETER\_SUCCESS\" in the response.

If the ProSe Function in the VPLMN cannot fulfil the received request
for reasons not stated in the above steps, e.g. due to a database error
or any of the required actions cannot be performed, it shall stop
processing the request and set the Result Code to
\"DIAMETER\_UNABLE\_TO\_COMPLY\" in the response.

5.6 ProSe Proximity Request
---------------------------

### 5.6.1 General

The ProSe Proximity Request Procedure shall be used by a ProSe Function
in charge of the requesting UE to request the ProSe Function in charge
of another UE to indicate when two UEs will enter into proximity within
a requested time window.

This procedure is mapped to the commands ProSe-Proximity-Request/Answer
(PRR/PRA) in the Diameter application specified in clause 6.

Table 5.6.1-1 specifies the involved information elements for the
request.

Table 5.6.1-2 specifies the involved information elements for the
answer.

Table 5.6.1-1: ProSe Proximity Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Requesting EPUID  | Requesting-EPUID  | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.23)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the UE |
|                   |                   |      | triggering the    |
|                   |                   |      | Proximity         |
|                   |                   |      | Request.          |
+-------------------+-------------------+------+-------------------+
| Targeted EPUID    | Targeted-EPUID    | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.26)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the UE |
|                   |                   |      | targeted by the   |
|                   |                   |      | Proximity         |
|                   |                   |      | Request.          |
+-------------------+-------------------+------+-------------------+
| Time Window       | Time-Window       | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.27)      |                   |      | contain the time  |
|                   |                   |      | period during     |
|                   |                   |      | which the         |
|                   |                   |      | Proximity request |
|                   |                   |      | is valid          |
+-------------------+-------------------+------+-------------------+
| Requesting UE     | Location-Estimate | M    | This Information  |
| Location          |                   |      | Element shall     |
|                   |                   |      | contain the       |
| (See 6.3.10)      |                   |      | current location  |
|                   |                   |      | of the requesting |
|                   |                   |      | UE expressed in   |
|                   |                   |      | GAD shapes        |
|                   |                   |      | defined in        |
|                   |                   |      | TS 23.032 \[6\]   |
+-------------------+-------------------+------+-------------------+
| Location Update   | Locati            | O    | If present, this  |
| Trigger           | on-Update-Trigger |      | Information       |
|                   |                   |      | Element shall     |
| (See 6.3.a)       |                   |      | contain the       |
|                   |                   |      | trigger that will |
|                   |                   |      | cause the         |
|                   |                   |      | location updates  |
|                   |                   |      | performed by the  |
|                   |                   |      | ProSe Function.   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| PRR Flags         | PRR-Flags         | M    | This Information  |
|                   |                   |      | Element contains  |
| (See 6.3.21)      |                   |      | a bit mask. See   |
|                   |                   |      | 6.3.21 for the    |
|                   |                   |      | meaning of the    |
|                   |                   |      | bits.             |
+-------------------+-------------------+------+-------------------+

Table 5.6.1/2: ProSe Proximity Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- EPUID unknown  |
|                   |                   |      |                   |
|                   |                   |      | \- Proximity      |
|                   |                   |      | request rejected  |
|                   |                   |      |                   |
|                   |                   |      | \- Proximity      |
|                   |                   |      | unauthorized      |
+-------------------+-------------------+------+-------------------+
| Targeted UE       | Location-estimate | C    | This Information  |
| Location          |                   |      | Element shall     |
|                   |                   |      | contain the       |
| (See 6.3.10)      |                   |      | current location  |
|                   |                   |      | of the targeted   |
|                   |                   |      | UE expressed in   |
|                   |                   |      | GAD shapes        |
|                   |                   |      | defined in        |
|                   |                   |      | TS 23.032 \[6\].  |
|                   |                   |      | This information  |
|                   |                   |      | shall be present  |
|                   |                   |      | when the Result   |
|                   |                   |      | Code is           |
|                   |                   |      | \"DI              |
|                   |                   |      | AMETER\_SUCCESS\" |
|                   |                   |      | and the location  |
|                   |                   |      | of the targeted   |
|                   |                   |      | UE is known.      |
+-------------------+-------------------+------+-------------------+
| WLAN Link Layer   | W                 | C    | This Information  |
| ID                | LAN-Link-Layer-Id |      | shall contain the |
|                   |                   |      | permanent link    |
| (See 6.3.32)      |                   |      | layer identity    |
|                   |                   |      | used by the       |
|                   |                   |      | targeted UE for   |
|                   |                   |      | WLAN direct       |
|                   |                   |      | discovery and/or  |
|                   |                   |      | WLAN direct       |
|                   |                   |      | communication. It |
|                   |                   |      | shall be present  |
|                   |                   |      | if the requesting |
|                   |                   |      | UE has requested  |
|                   |                   |      | EPC support for   |
|                   |                   |      | WLAN direct       |
|                   |                   |      | discovery and if  |
|                   |                   |      | the targeted UE   |
|                   |                   |      | has a permanent   |
|                   |                   |      | WLAN Link Layer   |
|                   |                   |      | ID for            |
|                   |                   |      | communication     |
|                   |                   |      | (e.g. permanent   |
|                   |                   |      | MAC address).     |
+-------------------+-------------------+------+-------------------+

### 5.6.2 Detailed behaviour of the ProSe Function of the requesting UE

The ProSe Function of the UE triggering the Proximity request shall make
use of this procedure to propagate the Proximity request to the ProSe
Function of the targeted UE. The ProSe Function shall include in the
request the EPC ProSe User Identities of the requesting and targeted
UEs, the location of the requesting UE, the validity period of the
Proximity request and, the location update trigger. If the requesting UE
has requested EPC support for WLAN direct discovery and communication
with the targeted UE, the PRR-Flag \"WLAN Indication\" shall be set.

NOTE: The location update trigger enable the ProSe Function of the
targeted UE to configure SUPL reporting in targeted UE using the
\"\"Inside\" trigger with Repeated Reporting\" mechanism as defined in
OMA AD SUPL \[25\].

When receiving a ProSe Proximity response from the ProSe Function of the
targeted UE, the ProSe Function of the requesting UE shall check the
result code. If it indicates SUCCESS, the ProSe Function shall create
and manage a context associated with the Proximity request, including
the EPUIDs of the UEs, the validity period of this Proximity request and
the WLAN indication received in the Proximity request until the
execution of the Proximity Alert procedure, the Proximity Request
Cancellation procedure or until the expiry of the time window during
which the request is valid.

### 5.6.3 Detailed behaviour of the ProSe Function of the targeted UE

When receiving a ProSe Proximity request, the ProSe Function of the
targeted UE, shall, in the following order:

1\. Check whether the EPC ProSe User Identity of the targeted UE exists.
If not, a Result Code of DIAMETER\_ERROR\_USER\_UNKNOWN shall be
returned.

2\. Check whether the proximity request is authorized by the user. If
not, the Proximity request is not authorized by the user, a Result Code
of DIAMETER\_ERROR\_PROXIMITY\_UNAUTHORIZED shall be returned.

3\. Check the location of the requesting UE and the time window received
in the request and determine whether UEs are likely to enter into
proximity based the last known location of the targeted UE. If it is
unlikely that UEs enter into proximity for the received time window, a
Result Code of DIAMETER\_ERROR\_PROXIMITY\_REJECTED shall be returned in
the response.

If there is an error in any of the above steps then the ProSe Function
shall stop processing the request and shall return the error code
specified in the respective step.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall stop processing the
request and set the Result Code to \"DIAMETER\_UNABLE\_TO\_COMPLY\".

Otherwise, the ProSe Function shall acknowledge the reception of the
Proximity and set the Result Code to \"DIAMETER\_SUCCESS\" in the
response. The message may include the last known location of the
targeted UE, if available. The message may also include the permanent
WLAN Link Layer ID (e.g. MAC address) of the targeted UE if available
and if the PRR-Flag \"WLAN Indication\" was set in the request. The
ProSe Function shall create and manage a context associated with the
Proximity request, including the identity of ProSe Function triggering
the Proximity request, the EPUIDs of the UEs, the validity period of
this Proximity request, the WLAN indication, the location update
periodicity and/or location update trigger received in the Proximity
request until the execution of the Proximity Alert procedure, the
Proximity Request Cancellation procedure or until the expiry of the time
window during which the request is valid.

5.7 ProSe Location Update
-------------------------

### 5.7.1 General

The ProSe Location Update Procedure shall be used by a ProSe Function to
forward the location of UE to the ProSe Function triggering the
Proximity Request and in charge of determining the proximity of two UEs.

This procedure is mapped to the commands
ProSe-Location-Update-Request/Answer (PLR/PLA) in the Diameter
application specified in clause 6.

Table 5.7.1-1 specifies the involved information elements for the
request.

Table 5.7.1-2 specifies the involved information elements for the
answer.

Table 5.7.1-1: ProSe Location Update Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Targeted EPUID    | Targeted-EPUID    | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.26)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the UE |
|                   |                   |      | targeted by the   |
|                   |                   |      | Proximity         |
|                   |                   |      | Request.          |
+-------------------+-------------------+------+-------------------+
| Targeted UE       | Location-Estimate | M    | This Information  |
| Location          |                   |      | Element shall     |
|                   |                   |      | contain the       |
| (See 6.3.10)      |                   |      | current location  |
|                   |                   |      | of the targeted   |
|                   |                   |      | UE expressed in   |
|                   |                   |      | GAD shapes        |
|                   |                   |      | defined in        |
|                   |                   |      | TS 23.032 \[6\].  |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+

Table 5.7.1-2: ProSe Location Update Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- User Unknown   |
|                   |                   |      |                   |
|                   |                   |      | \- Proximity      |
|                   |                   |      | Cancelled         |
+-------------------+-------------------+------+-------------------+

### 5.7.2 Detailed behaviour of the ProSe Function of the requesting UE

The ProSe Function of the UE targeted by the Proximity request shall
make use of this procedure to periodically update the targeted UE\'s
location in the ProSe Function in charge of Proximity request. The ProSe
Function shall include in the request the EPC ProSe User Identity and
the location of the targeted UE.

### 5.7.3 Detailed behaviour of the ProSe Function of the targeted UE

When receiving a ProSe Location Update request, the ProSe Function in
charge of the Proximity request shall, in the following order:

1\. Check whether a proximity request exists for the EPC ProSe User
Identity received in the request. If there is no pending Proximity
request for this EPUID, a Result Code of DIAMETER\_ERROR\_USER\_UNKNOWN
shall be returned.

2\. Check the location of the requesting UE and the time window
indicated by the requesting UE and determine whether UEs are likely to
enter into proximity based the last known location of the targeted UE.
If it is unlikely that UEs enter into proximity for the received time
window, a Result Code of DIAMETER\_ERROR\_PROXIMITY\_CANCELLED shall be
returned in the response.

If there is an error in any of the above steps then the ProSe Function
shall stop processing the request and shall return the error code
specified in the respective step.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall stop processing the
request and set the Result Code to \"DIAMETER\_UNABLE\_TO\_COMPLY\".

Otherwise, the ProSe Function shall acknowledge the reception of the
ProSe Location Update and set the Result Code to \"DIAMETER\_SUCCESS\"
in the response.

5.8 ProSe Cancellation
----------------------

### 5.8.1 General

The ProSe Cancellation Procedure shall be used between the ProSe
Function in the HPLMN and the ProSe Function in the local/visited PLMN.
The procedure shall be invoked by the ProSe Function in HPLMN and is
used:

\- to indicate that the service authorization for ProSe Direct Discovery
and ProSe Direct Communication is revoked for this UE.

\- to indicate that the Proximity Request sent earlier is cancelled.

This procedure is mapped to the commands
ProSe-Cancellation-Request/Answer (PCR/PCA) in the Diameter application
specified in clause 6.

Table 5.8.1-1 specifies the involved information elements for the
request.

Table 5.8.1-2 specifies the involved information elements for the
answer.

Table 5.8.1-1: ProSe Cancellation Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Requesting EPUID  | Requesting-EPUID  | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.23)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the UE |
|                   |                   |      | triggering the    |
|                   |                   |      | Proximity         |
|                   |                   |      | Request.          |
+-------------------+-------------------+------+-------------------+
| Targeted EPUID    | Targeted-EPUID    | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.26)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the UE |
|                   |                   |      | targeted by the   |
|                   |                   |      | Proximity         |
|                   |                   |      | Request.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+

Table 5.8.1-2: ProSe Cancellation Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- No proximity   |
|                   |                   |      | request           |
+-------------------+-------------------+------+-------------------+

### 5.8.2 Detailed behaviour of the ProSe Function of the requesting UE

The ProSe Function of the requesting UE shall make use of this procedure
to cancel a Proximity Request sent earlier to the ProSe Function in
charge of the targeted UE (e.g. due to change in the location of one of
the UEs, termination of corresponding application or due to completion
of certain event). The ProSe Function shall include in the request the
EPC ProSe User Identities of the requesting and targeted UEs.

### 5.8.3 Detailed behaviour of the ProSe Function of the targeted UE

When receiving a ProSe Cancellation request, the ProSe Function of the
targeted UE shall check whether there is a context associated with EPC
ProSe User Identities included in the request. If not, the Result Code
of DIAMETER\_ERROR\_NO\_PROXIMITY\_REQUEST shall be returned. Otherwise,
the ProSe Function shall cancel the Proximity request and set the Result
Code to \"DIAMETER\_SUCCESS\" in the response

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall set the Result Code to
\"DIAMETER\_UNABLE\_TO\_COMPLY\".

5.9 ProSe Proximity Alert
-------------------------

### 5.9.1 General

The ProSe Proximity Alert Procedure shall be used by a ProSe Function in
charge of Proximity request to indicate to the ProSe Function of the UE
targeted by the Proximity request that UEs enter into proximity and that
a Proximity Alert should be sent to the targeted UE.

This procedure is mapped to the commands ProSe-Alert-Request/Answer
(ALR/ALA) in the Diameter application specified in clause 6.

Table 5.9.1-1 specifies the involved information elements for the
request.

Table 5.9.1-2 specifies the involved information elements for the
answer.

Table 5.9.1-1: ProSe Proximity Alert Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Application Layer | Applicat          | M    | This Information  |
| User ID           | ion-Layer-User-Id |      | Element shall     |
|                   |                   |      | contain the       |
| (See 6.3.2)       |                   |      | Application Layer |
|                   |                   |      | User ID of the    |
|                   |                   |      | requesting UE     |
|                   |                   |      | entering into     |
|                   |                   |      | proximity.        |
+-------------------+-------------------+------+-------------------+
| Targeted EPUID    | Targeted-EPUID    | M    | This Information  |
|                   |                   |      | Element shall     |
| (See 6.3.26)      |                   |      | contain the EPC   |
|                   |                   |      | ProSe User ID     |
|                   |                   |      | (EPUID) of the    |
|                   |                   |      | targeted UE to    |
|                   |                   |      | which the         |
|                   |                   |      | Proximity Alert   |
|                   |                   |      | shall be sent.    |
+-------------------+-------------------+------+-------------------+
| Assistance        | Assistance-Info   | O    | If present, this  |
| Information       |                   |      | Information       |
|                   |                   |      | Element shall     |
| (See 6.3.3)       |                   |      | contain the       |
|                   |                   |      | assistance        |
|                   |                   |      | information for   |
|                   |                   |      | WLAN direct       |
|                   |                   |      | discovery and     |
|                   |                   |      | communications if |
|                   |                   |      | required.         |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+

Table 5.9.1-2: ProSe Proximity Alert Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Announcing Not |
|                   |                   |      | Authorized        |
|                   |                   |      |                   |
|                   |                   |      | \- No Discovery   |
|                   |                   |      | Filter            |
+-------------------+-------------------+------+-------------------+

### 5.9.2 Detailed behaviour of the ProSe Function of the targeted UE

The ProSe Function in charge of the Proximity request shall make use of
this procedure to indicate to the ProSe Function in charge of the
targeted UE that the UEs enter into proximity and a Proximity Aleter
should be sent to the targeted UE. The ProSe Function shall include in
the request the Application Layer User ID and the EPUID of the
requesting UE entering into proximity. It may include assistance
information for WLAN direct discovery and communications if required the
WLAN indication was included in the Proximity request.

### 5.9.3 Detailed behaviour of the ProSe Function of the requesting UE

When receiving a ProSe Proximity Alert request, the ProSe Function of
the targeted UE, shall, in the following order:

1\. Check whether the EPC ProSe User Identity of the targeted UE exists.
If not, a Result Code of DIAMETER\_ERROR\_USER\_UNKNOWN shall be
returned.

2\. Check whether the proximity request is authorized by the user. If
not, the Proximity request is not authorized by the user, a Result Code
of DIAMETER\_ERROR\_PROXIMITY\_UNAUTORIZED shall be returned.

If there is an error in any of the above steps then the ProSe Function
shall stop processing the request and shall return the error code
specified in the respective step.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall stop processing the
request and set the Result Code to \"DIAMETER\_UNABLE\_TO\_COMPLY\".

Otherwise, the ProSe Function shall acknowledge the reception of the
ProSe Proximity Alert request and shall set the Result Code to
\"DIAMETER\_SUCCESS\" in the response. The ProSe Function shall forward
the Proximity Alert to the requesting UE.

5.10 ProSe Direct Discovery Authorization Update
------------------------------------------------

### 5.10.1 General

The ProSe Direct Discovery Authorization Update Procedure shall be used
between the ProSe Function in the HPLMN and the ProSe Function in a
local PLMN or VPLMN to update authorization for access to the discovery
resources and perform ProSe Direct Discovery. The procedure shall be
invoked by the ProSe Function in the HPLMN and is used:

\- to provide the ProSe Function in Local PLMN with an update for banned
users.

This procedure is mapped to the commands ProSe-Discovery-Request/Answer
(PDR/PDA) in the Diameter application specified in clause 6.

Table 5.10.1-1 specifies the involved information elements for the
request.

Table 5.10.1-2 specifies the involved information elements for the
answer.

Table 5.10.1-1: ProSe Direct Discovery Authorization Update Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Discovery         | Disco             | M    | This information  |
| Authorization     | very-Auth-Request |      | element shall     |
| Request           |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.53)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

Table 5.10.1-2: ProSe Direct Discovery Authorization Update Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Announcing Not |
|                   |                   |      | Authorized        |
|                   |                   |      |                   |
|                   |                   |      | \- No Associated  |
|                   |                   |      | Discovery Filter  |
+-------------------+-------------------+------+-------------------+
| Discovery         | Discov            | C    | This information  |
| Authorization     | ery-Auth-Response |      | element shall     |
| Response          |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.53)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | response. This    |
|                   |                   |      | information       |
|                   |                   |      | element shall be  |
|                   |                   |      | present if the    |
|                   |                   |      | Result Code AVP   |
|                   |                   |      | is                |
|                   |                   |      | D                 |
|                   |                   |      | IAMETER\_SUCCESS. |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

### 5.10.2 Detailed behaviour of the HPLMN ProSe Function 

The ProSe Function in the HPLMN shall make use of this procedure to
revoke permissions to discover a ProSe Restricted Code given to users
served by the ProSe Function located in a Local PLMN. The HPLMN ProSe
Function shall include in the request the Discovery Entry ID and shall
include in the Discovery Authorization Request the Discovery Type set to
\"MONITORING\_UPDATE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
application identity, the ProSe-restricted-Code, Banned RPAUID and
Banned PDUID of a monitoring target.When receiving the ProSe Direct
Discovery Authorization Update response with the Result Code set to
\"DIAMETER\_SUCCESS\" for a request with the Discovery Type set to
\"MONITORING\_UPDATE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
HPLMN ProSe Function shall start a timer to wait for the ProSe Funciton
in Local PLMN/VPLMN to report the result of the Direct Discovery
Authorization Update procedure for the monitoring operation, i.e.,
whether the ProSe Discovery Filter(s) for monitoring this ProSe
Restricted Code has been successfully revoked in the banned UE.

### 5.10.3 Detailed behaviour of the ProSe Function in the local PLMN or VPLMN

When receiving a ProSe Direct Discovery Authorization Update request,
the ProSe Function in the local PLMN or VPLMN shall process the request
in the following order to check whether the monitoring is authorized.

\- The ProSe function shall check if the Banned PDUID belongs to its own
PLMN.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_INVALID\_TARGET\_PDUID\" in the response sent by the
ProSe Function.

\- If the Banned PDUID belongs to its own PLMN, the ProSe function may
check if the requesting RPAUID is allowed to discovery the Banned
RPAUID.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_INVALID\_TARGET\_RPAUID\" in the response sent by the
ProSe Function;

\- Otherwise, the ProSe Function shall set the result code to
\"DIAMETER\_SUCCESS\" in the response.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall set the Result Code to
\"DIAMETER\_UNABLE\_TO\_COMPLY\".

5.11 ProSe Direct Discovery Authorization Update Result
-------------------------------------------------------

### 5.11.1 General

The ProSe Direct Discovery Authorization Update Result Procedure shall
be used between the ProSe Function in the local PLMN and the ProSe
Function in the HPLMN to report the result of ProSe Direct Discovery
Authorization Update in Local PLMN to the the ProSe Function in the
HPLMN. In this case the procedure shall be invoked by the ProSe Function
in the local PLMN and is used:

\- to report the result of Direct Discovery Authorization Update
procedure initiated by the ProSe Function in the HPLMN.

This procedure is mapped to the commands ProSe-Discovery-Request/Answer
(PDR/PDA) in the Diameter application specified in clause 6.

Table 5.11.1-1 specifies the involved information elements for the
request.

Table 5.11.1-2 specifies the involved information elements for the
answer.

Table 5.11.1-1: ProSe Direct Discovery Authorization Update Result
Request

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Discovery         | Disco             | M    | This information  |
| Authorization     | very-Auth-Request |      | element shall     |
| Request           |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.53)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

Table 5.11.1-2: ProSe Direct Discovery Authorization Update Result
Answer

+-------------------+-------------------+------+-------------------+
| Information       | Mapping to        | Cat. | Description       |
| element name      | Diameter AVP      |      |                   |
+-------------------+-------------------+------+-------------------+
| Supported         | S                 | O    | If present, this  |
| Features          | upported-Features |      | information       |
|                   |                   |      | element shall     |
| (See 6.3.24)      |                   |      | contain the list  |
|                   |                   |      | of features       |
|                   |                   |      | supported by the  |
|                   |                   |      | origin host.      |
+-------------------+-------------------+------+-------------------+
| Result            | Result-Code /     | M    | This IE shall     |
|                   | Ex                |      | contain the       |
| (See 6.4)         | perimental-Result |      | result of the     |
|                   |                   |      | operation.        |
|                   |                   |      |                   |
|                   |                   |      | The Result-Code   |
|                   |                   |      | AVP shall be used |
|                   |                   |      | to indicate       |
|                   |                   |      | success / errors  |
|                   |                   |      | as defined in the |
|                   |                   |      | Diameter Base     |
|                   |                   |      | Protocol.         |
|                   |                   |      |                   |
|                   |                   |      | The               |
|                   |                   |      | Ex                |
|                   |                   |      | perimental-Result |
|                   |                   |      | AVP shall be used |
|                   |                   |      | for PC6/PC7       |
|                   |                   |      | errors. This is a |
|                   |                   |      | grouped AVP which |
|                   |                   |      | shall contain the |
|                   |                   |      | 3GPP Vendor ID in |
|                   |                   |      | the Vendor-Id     |
|                   |                   |      | AVP, and the      |
|                   |                   |      | error code in the |
|                   |                   |      | Experim           |
|                   |                   |      | ental-Result-Code |
|                   |                   |      | AVP.              |
|                   |                   |      |                   |
|                   |                   |      | The following     |
|                   |                   |      | errors are        |
|                   |                   |      | applicable:       |
|                   |                   |      |                   |
|                   |                   |      | \- Announcing Not |
|                   |                   |      | Authorized        |
|                   |                   |      |                   |
|                   |                   |      | \- No Associated  |
|                   |                   |      | Discovery Filter  |
+-------------------+-------------------+------+-------------------+
| Discovery         | Discov            | C    | This information  |
| Authorization     | ery-Auth-Response |      | element shall     |
| Response          |                   |      | contain the       |
|                   |                   |      | information       |
| (See 6.3.53)      |                   |      | elements used in  |
|                   |                   |      | discovery         |
|                   |                   |      | authorization     |
|                   |                   |      | response. This    |
|                   |                   |      | information       |
|                   |                   |      | element shall be  |
|                   |                   |      | present if the    |
|                   |                   |      | Result Code AVP   |
|                   |                   |      | is                |
|                   |                   |      | D                 |
|                   |                   |      | IAMETER\_SUCCESS. |
+-------------------+-------------------+------+-------------------+
| Discovery Entry   | D                 | C    | This Information  |
| ID                | iscovery-Entry-ID |      | Element contains  |
|                   |                   |      | the discovery     |
| (See 6.3.59)      |                   |      | entry ID used by  |
|                   |                   |      | the sending ProSe |
|                   |                   |      | Function to       |
|                   |                   |      | identify the      |
|                   |                   |      | discovery entry   |
|                   |                   |      | related to this   |
|                   |                   |      | request.          |
+-------------------+-------------------+------+-------------------+

### 5.11.2 Detailed behaviour of the ProSe Function in the local PLMN

The ProSe Function in the local PLMN shall make use of this procedure to
report to the ProSe Function in HPLMN the result of the ProSe Direct
Discovery Authorization Update for restricted ProSe Direct Discovery.
The local PLMN ProSe Function shall include in the Discovery
Authorization Update Result Request the Discovery Entry ID and the
Discovery Type set to
\"MONITORING\_RESPONSE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
application identity, the ProSe-Restricted-Code, Banned RPAUID and
Banned PDUID of a monitoring target, result of the monitoring update
operation.

### 5.11.3 Detailed behaviour of the HPLMN ProSe Function

When receiving a ProSe Direct Discovery Authorization Update Result
request (Discovery Type set to
\"MONITORING\_RESPONSE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\" in
the PDR command), the ProSe Function in the HPLMN shall check whether
there exists a discovery entry matching the Discovery Entry ID included
in the request. If yes, then the ProSe Function shall update the result
for the given ProSe Restricted Code or ProSe Restricted Code Prefix in
this entry regarding the revocation operation for banned RPAUID and
banned PDUID indicated in the request message.

\- If not, the experimental result code shall be set to
\"DIAMETER\_ERROR\_NO\_ASSOCIATED\_RESTRICTED\_CODE\" in the response
sent by the ProSe Function.

\- If it exists, the ProSe Function shall set the result code to
\"DIAMETER\_SUCCESS\" in the Discovery AuthorizationUpdate Result
response and shall store the outcome of the operation provided to be
able to forward this to the UE.

If the ProSe Function cannot fulfil the received request for reasons not
stated in the above steps, e.g. due to a database error or any of the
required actions cannot be performed, it shall set the Result Code to
\"DIAMETER\_UNABLE\_TO\_COMPLY\".

6 Protocol Specification and Implementation
===========================================

6.1 Introduction
----------------

### 6.1.1 Use of Diameter base protocol

The Diameter Base Protocol as specified in IETF RFC 6733 \[29\] shall
apply except as modified by the defined support of the methods and the
defined support of the commands and AVPs, result and error codes as
specified in this specification. Unless otherwise specified, the
procedures (including error handling and unrecognised information
handling) shall be used unmodified.

### 6.1.2 Securing Diameter Messages

For secure transport of Diameter messages, see 3GPP TS 33.210 \[8\].

### 6.1.3 Accounting functionality

Accounting functionality (Accounting Session State Machine, related
command codes and AVPs) shall not be used on the PC6/PC7 interfaces.

### 6.1.4 Use of sessions

Between the ProSe Functions, Diameter sessions shall be implicitly
terminated. An implicitly terminated session is one for which the server
does not maintain state information. The client shall not send any
re-authorization or session termination requests to the server.

The Diameter base protocol includes the Auth-Session-State AVP as the
mechanism for the implementation of implicitly terminated sessions.

The client (server) shall include in its requests (responses) the
Auth-Session-State AVP set to the value NO\_STATE\_MAINTAINED (1), as
described in IETF RFC 6733 \[29\]. As a consequence, the server shall
not maintain any state information about this session and the client
shall not send any session termination request. Neither the
Authorization-Lifetime AVP nor the Session-Timeout AVP shall be present
in requests or responses.

### 6.1.5 Transport protocol

Diameter messages over the PC6/PC7 interfaces shall make use of SCTP
IETF RFC 4960 \[9\].

### 6.1.6 Routing considerations

This clause specifies the use of the Diameter routing AVPs
Destination-Realm and Destination-Host.

The Destination-Realm AVP shall contain the network domain name of the
targeted ProSe Function. The network domain name is either known by the
sending ProSe Function or derived from the PLMN-Id of the targeted ProSe
Function to construct the EPC Home Network Realm/Domain, as indicated in
3GPP TS 23.003 \[4\], clause 19.2.

If a ProSe Function knows the address/name of the ProSe Function in
charge of a given UE, and the associated network domain name, both the
Destination-Realm and Destination-Host AVPs shall be present in the
request.

If a ProSe Function knows only the network domain name, the
Destination-Realm AVP shall be present and the command shall be routed
to the next Diameter node.

Consequently, the Destination-Realm AVP is declared as mandatory and the
Destination-Host AVP is declared as optional in the ABNF for all
requests initiated by a ProSe Function.

If the Vendor-Specific-Application-ID AVP is received in any of the
commands defined in this specification, it shall be ignored by the
receiving node, and it shall not be used for routing purposes.

### 6.1.7 Advertising Application Support

The ProSe Functions shall advertise support of the Diameter Inter ProSe
Functions Application by including the value of the application
identifier in the Auth-Application-Id AVP within the
Vendor-Specific-Application-Id grouped AVP of the
Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands.

The vendor identifier value of 3GPP (10415) shall be included in the
Supported-Vendor-Id AVP of the Capabilities-Exchange-Request and
Capabilities-Exchange-Answer commands, and in the Vendor-Id AVP within
the Vendor-Specific-Application-Id grouped AVP of the
Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands.

The Vendor-Id AVP included in Capabilities-Exchange-Request and
Capabilities-Exchange-Answer commands that is not included in the
Vendor-Specific-Application-Id AVPs as described above shall indicate
the manufacturer of the Diameter node as per IETF RFC 6733 \[29\].

### 6.1.8 Diameter Application Identifier

The Diameter Inter ProSe Functions Application protocol shall be defined
as an IETF vendor specific Diameter application, where the vendor is
3GPP. The vendor identifier assigned by IANA to 3GPP
(http://www.iana.org/assignments/enterprise-numbers) is 10415.

The Diameter application identifier assigned to the Diameter Inter ProSe
Functions application is 16777340 (allocated by IANA). The same Diameter
application identifier is used over the PC6 interface and the PC7
interface.

### 6.1.9 Use of the Supported-Features AVP

When new functionality is introduced on the PC6/PC7 interfaces, it
should be defined as optional. If backwards incompatible changes cannot
be avoided, the new functionality shall be introduced as a new feature
and support advertised with the Supported-Features AVP. The usage of the
Supported-Features AVP on the PC6/PC7 interfaces is consistent with the
procedures for the dynamic discovery of supported features as defined in
clause 7.2 of 3GPP TS 29.229 \[10\].

When extending the application by adding new AVPs for a feature, the new
AVPs shall have the M bit cleared and the AVP shall not be defined
mandatory in the command ABNF.

As defined in 3GPP TS 29.229 \[10\], the Supported-Features AVP is of
type grouped and contains the Vendor-Id, Feature-List-ID and
Feature-List AVPs. On the all reference points as specified in this
specification, the Supported-Features AVP is used to identify features
that have been defined by 3GPP and hence, for features defined in this
document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415).
If there are multiple feature lists defined for the reference point, the
Feature-List-ID AVP shall differentiate those lists from one another.

6.2 Commands
------------

### 6.2.1 Introduction

This clause defines the Command code values and related ABNF for each
command described in this specification.

### 6.2.2 Command-Code values

This csublause defines Command-Code values for the Diameter Inter ProSe
Functions application used over the PC6/PC7 interfaces as allocated by
IANA.

Every command is defined by means of the ABNF syntax
IETF RFC 5234 \[11\], according to the Command Code Format (CCF)
specification defined in IETF RFC 6733 \[29\]. In the case, the
definition and use of an AVP is not specified in this document, the
guidelines in IETF RFC 6733 \[29\] shall apply.

The Vendor-Specific-Application-Id AVP shall not be included in any
command sent by Diameter nodes supporting applications defined in this
specification. If the Vendor-Specific-Application-Id AVP is received in
any of the commands defined in this specification, it shall be ignored
by the receiving node.

NOTE: The Vendor-Specific-Application-Id is included as an optional AVP
in all Command Code Format specifications defined in this specification
in order to overcome potential interoperability issues with intermediate
Diameter agents non-compliant with IETF RFC 6733 \[29\].

The following Command Codes are defined in this specification:

Table 6.2.2-1: Command-Code values for Diameter ProSe Inter Functions
Application

  --------------------------------- -------------- --------- --------
  Command-Name                      Abbreviation   Code      Clause
  ProSe-Authorization-Request       PAR            8388668   6.2.3
  ProSe-Authorization-Answer        PAA            8388668   6.2.4
  ProSe-Discovery-Request           PDR            8388669   6.2.5
  ProSe-Discovery-Answer            PDA            8388669   6.2.6
  ProSe-Match-Request               PMR            8388670   6.2.7
  ProSe-Match-Answer                PMA            8388670   6.2.8
  ProSe-Match-Report-Info-Request   PIR            8388671   6.2.9
  ProSe-Match-Report-Info-Answer    PIA            8388671   6.2.10
  ProSe-Proximity-Request           PRR            8388672   6.2.11
  ProSe-Proximity-Answer            PRA            8388672   6.2.12
  ProSe-Location-Update-Request     PLR            8388673   6.2.13
  ProSe-Location-Update-Answer      PLA            8388673   6.2.14
  ProSe-Alert-Request               ALR            8388674   6.2.15
  ProSe-Alert-Answer                ALA            8388674   6.2.16
  ProSe-Cancellation-Request        PCR            8388675   6.2.17
  ProSe-Cancellation-Answer         PCA            8388675   6.2.18
  --------------------------------- -------------- --------- --------

For these commands, the Application-ID field shall be set to 16777340
(application identifier of the Diameter Inter ProSe Functions interface
application, allocated by IANA).

### 6.2.3 ProSe-Authorization-Request (PAR) Command

The ProSe-Authorization-Request (PAR) Command, indicated by the
Command-Code field set to 8388668 and the \"R\" bit set in the Command
Flags field, is sent from the ProSe Function in the HPLMN to the ProSe
Function in Local PLMN/VPLMN.

Message Format

> \< ProSe-Authorization-Request \> ::= \< Diameter Header: 8388668,
> REQ, PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { User-Identity }
>
> { Visited-PLMN-Id }
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.4 ProSe-Authorization-Answer (PAA) Command

The ProSe-Authorization-Answer (PAA) Command, indicated by the
Command-Code field set to 8388668 and the \"R\" bit cleared in the
Command Flags field, is sent from the ProSe Function in Local PLMN/VPLMN
to the ProSe Function in the HPLMN.

Message Format

> \< ProSe-Authorization-Answer\> ::= \< Diameter Header: 8388668, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \[ ProSe-Direct-Allowed\]
>
> \[ Validity-Time-Announce \]
>
> \[ Validity-Time-Monitor \]
>
> \[ Validity-Time-Communication \]
>
> \[ Authorized-Discovery-Range \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.5 ProSe-Discovery-Request (PDR) Command

The ProSe-Discovery-Request (PDR) Command, indicated by the Command-Code
field set to 8388669 and the \"R\" bit set in the Command Flags field,
is sent from the ProSe Function in the HPLMN to the ProSe Function in
Local PLMN.

Message Format

> \< ProSe-Discovery-Request \> ::= \< Diameter Header: 8388669, REQ,
> PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { Discovery-Auth-Request }
>
> \[ Discovery-Entry-ID \]
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.6 ProSe-Discovery-Answer (PDA) Command

The ProSe-Discovery-Answer (PDA) Command, indicated by the Command-Code
field set to 8388669 and the \"R\" bit cleared in the Command Flags
field, is sent from the ProSe Function in Local PLMN to the ProSe
Function in the HPLMN.

Message Format

> \< ProSe-Discovery-Answer \> ::= \< Diameter Header: 8388669, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \[ Discovery-Auth-Response \]
>
> \[ Discovery-Entry-ID \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.7 ProSe-Match-Request (PMR) Command

The ProSe-Match-Request (PMR) Command, indicated by the Command-Code
field set to 8388670 and the \"R\" bit set in the Command Flags field,
is sent from the ProSe Function in the HPLMN to the ProSe Function in
Local PLMN.

Message Format

> \< ProSe-Match-Request \> ::= \< Diameter Header: 8388670, REQ, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { Match-Request }
>
> \[ PMR-Flags \]
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.8 ProSe-Match-Answer (PMA) Command

The ProSe-Match-Answer (PMA) Command, indicated by the Command-Code
field set to 8388670 and the \"R\" bit cleared in the Command Flags
field, is sent from the ProSe Function in Local PLMN to the ProSe
Function in the HPLMN.

Message Format

> \< ProSe-Match-Answer \> ::= \< Diameter Header: 8388670, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \*\[ Match-Report \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.9 ProSe-Match-Report-Info-Request (PIR) Command

The ProSe-Match-Report-Info-Request (PIR) Command, indicated by the
Command-Code field set to 8388671 and the \"R\" bit set in the Command
Flags field, is sent from the ProSe Function in the HPLMN of the
monitoring UE to the ProSe Function of the PLMN in which the announcing
UE is roaming.

Message Format

> \< ProSe-Match-Report-Info-Request \> ::= \< Diameter Header: 8388671,
> REQ, PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { Match-Report-Info }
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.10 ProSe-Match-Report-Info-Answer (PIA) Command

The ProSe-Match-Report-Info-Answer (PIA) Command, indicated by the
Command-Code field set to 8388671 and the \"R\" bit cleared in the
Command Flags field, is sent from the ProSe Function of the PLMN in
which the announcing UE is roaming to the ProSe Function in the HPLMN of
the monitoring UE.

Message Format

> \< ProSe-Match-Report-Info-Answer \> ::= \< Diameter Header: 8388671,
> PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.11 ProSe-Proximity-Request (PRR) Command

The ProSe-Proximity-Request (PRR) Command, indicated by the Command-Code
field set to 8388672 and the \"R\" bit set in the Command Flags field,
is sent from the ProSe Function in the HPLMN to the ProSe Function of
another PLMN.

Message Format

> \< ProSe-Proximity-Request \> ::= \< Diameter Header: 8388672, REQ,
> PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { PRR-Flags }
>
> { Requesting-EPUID }
>
> { Targeted-EPUID }
>
> { Time-Window }
>
> { Location-Estimate }
>
> \[ Location-Update-Trigger \]
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.12 ProSe-Proximity-Answer (PRA) Command

The ProSe-Proximity-Answer (PRA) Command, indicated by the Command-Code
field set to 8388672 and the \"R\" bit cleared in the Command Flags
field, is sent from the ProSe Function in the HPLMN to the ProSe
Function of another PLMN.

Message Format

> \< ProSe-Proximity-Answer \> ::= \< Diameter Header: 8388672, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \[ Location-Estimate \]
>
> \[WLAN-Link-Layer-Id \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.13 ProSe-Location-Update-Request (PLR) Command

The ProSe-Location-Update-Request (PLR) Command, indicated by the
Command-Code field set to 8388673 and the \"R\" bit set in the Command
Flags field, is sent from the ProSe Function in the HPLMN to the ProSe
Function of another PLMN.

Message Format

> \< ProSe-Location-Update-Request \> ::= \< Diameter Header: 8388673,
> REQ, PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { Targeted-EPUID }
>
> { Location-Estimate }
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.14 ProSe-Location-Update-Answer (PLA) Command

The ProSe-Location-Update-Answer (PLA) Command, indicated by the
Command-Code field set to 8388673 and the \"R\" bit cleared in the
Command Flags field, is sent from the ProSe Function in the HPLMN to the
ProSe Function of another PLMN.

Message Format

> \< ProSe-Location-Update-Answer \> ::= \< Diameter Header: 8388673,
> PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.15 ProSe-Alert-Request (ALR) Command

The ProSe-Alert-Request (ALR) Command, indicated by the Command-Code
field set to 8388674 and the \"R\" bit set in the Command Flags field,
is sent from the ProSe Function in the HPLMN to the ProSe Function of
another PLMN.

Message Format

> \< ProSe-Alert-Request \> ::= \< Diameter Header: 8388674, REQ, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { App-Layer-User-Id }
>
> { Targeted-EPUID }
>
> \[ Assistance-Info \]
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.16 ProSe-Alert-Answer (ALA) Command

The ProSe-Alert-Answer (ALA) Command, indicated by the Command-Code
field set to 8388674 and the \"R\" bit cleared in the Command Flags
field, is sent from the ProSe Function in the HPLMN to the ProSe
Function of another PLMN.

Message Format

> \< ProSe-Alert-Answer \> ::= \< Diameter Header: 8388674, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.17 ProSe-Cancellation-Request (PCR) Command

The ProSe-Cancellation-Request (PCR) Command, indicated by the
Command-Code field set to 8388675 and the \"R\" bit set in the Command
Flags field, is sent from the ProSe Function in the HPLMN to the ProSe
Function in a local/visited PLMN.

Message Format

> \< ProSe-Cancellation-Request \> ::= \< Diameter Header: 8388675, REQ,
> PXY, 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> \[ Destination-Host \]
>
> { Destination-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> { Requesting-EPUID }
>
> { Targeted-EPUID }
>
> \*\[ AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

### 6.2.18 ProSe-Cancellation-Answer (PCA) Command

The ProSe-Cancellation-Answer (PCA) Command, indicated by the
Command-Code field set to 8388675 and the \"R\" bit cleared in the
Command Flags field, is sent from the ProSe Function in a local/visited
PLMN to the ProSe Function in the HPLMN.

Message Format

> \< ProSe-Cancellation-Answer \> ::= \< Diameter Header: 8388675, PXY,
> 16777340 \>
>
> \< Session-Id \>
>
> \[ DRMP \]
>
> \[ Vendor-Specific-Application-Id \]
>
> \[ Result-Code \]
>
> \[ Experimental-Result \]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **\*\[ Supported-Features \]**
>
> \[ OC-Supported-Features \]
>
> \[ OC-OLR \]
>
> \*\[ Load \]
>
> \*\[ AVP \]
>
> \[ Failed-AVP \]
>
> \*\[ Proxy-Info \]
>
> \*\[ Route-Record \]

6.3 Information Elements
------------------------

### 6.3.1 General

The following table (table 6.3.1-1) specifies the Diameter AVPs defined
for the PC6/PC7 interfaces, their AVP Code values, types, possible flag
values and whether or not the AVP may be encrypted. The Vendor-ID header
of all AVPs defined in this specification shall be set to 3GPP (10415).

For all AVPs which contain bit masks and are of the type Unsigned32
e.g., PRR-Flags, bit 0 shall be the least significant bit. For example,
to get the value of bit 0, a bit mask of 0x0001 shall be used.

Table 6.3.1-1: PC6/PC7 specific Diameter AVPs

+-------+-------+-------+-------+------+-----+-------+-------+-------+
|       | AVP   |       |       |      |     |       |       |       |
|       | Flag  |       |       |      |     |       |       |       |
|       | rules |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Attr  | AVP   | C     | Value | Must | May | S     | Must  | May   |
| ibute | Code  | lause | Type  |      |     | hould | not   | Encr. |
| Name  |       |       |       |      |     | not   |       |       |
|       |       | de    |       |      |     |       |       |       |
|       |       | fined |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ap    | 3801  | 6.3.2 | UTF8S | M, V |     |       |       | No    |
| p-Lay |       |       | tring |      |     |       |       |       |
| er-Us |       |       |       |      |     |       |       |       |
| er-Id |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Assis | 3802  | 6.3.3 | Gr    | M, V |     |       |       | No    |
| tance |       |       | ouped |      |     |       |       |       |
| -info |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Assis | 3803  | 6.3.4 | Unsig | M, V |     |       |       | No    |
| tance |       |       | ned32 |      |     |       |       |       |
| -Info |       |       |       |      |     |       |       |       |
| -Vali |       |       |       |      |     |       |       |       |
| dity- |       |       |       |      |     |       |       |       |
| Timer |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Disc  | 3804  | 6.3.5 | Unsig | M, V |     |       |       | No    |
| overy |       |       | ned32 |      |     |       |       |       |
| -Type |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Filt  | 3805  | 6.3.9 | O     | M, V |     |       |       | No    |
| er-Id |       |       | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| M     | 3806  | 6     | UTF8S | M, V |     |       |       | No    |
| AC-Ad |       | .3.11 | tring |      |     |       |       |       |
| dress |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ma    | 3807  | 6     | Gr    | M, V |     |       |       | No    |
| tch-R |       | .3.12 | ouped |      |     |       |       |       |
| eport |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Op    | 3808  | 6     | Unsig | M, V |     |       |       | No    |
| erati |       | .3.14 | ned32 |      |     |       |       |       |
| ng-Ch |       |       |       |      |     |       |       |       |
| annel |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| P2    | 3809  | 6     | Unsig | M, V |     |       |       | No    |
| P-Fea |       | .3.15 | ned32 |      |     |       |       |       |
| tures |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProS  | 3810  | 6     | O     | M, V |     |       |       | No    |
| e-App |       | .3.16 | ctetS |      |     |       |       |       |
| -Code |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Pr    | 3811  | 6     | UTF8S | M, V |     |       |       | No    |
| oSe-A |       | .3.17 | tring |      |     |       |       |       |
| pp-Id |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProS  | 3812  | 6     | O     | M, V |     |       |       | No    |
| e-App |       | .3.18 | ctetS |      |     |       |       |       |
| -Mask |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Pr    | 3813  | 6     | Gr    | M, V |     |       |       | No    |
| oSe-D |       | .3.20 | ouped |      |     |       |       |       |
| iscov |       |       |       |      |     |       |       |       |
| ery-F |       |       |       |      |     |       |       |       |
| ilter |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| PRR-  | 3814  | 6     | Unsig | M, V |     |       |       | No    |
| Flags |       | .3.21 | ned32 |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProSe | 3815  | 6     | Unsig | M, V |     |       |       | No    |
| -Vali |       | .3.22 | ned32 |      |     |       |       |       |
| dity- |       |       |       |      |     |       |       |       |
| Timer |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| R     | 3816  | 6     | UTF8S | M, V |     |       |       | No    |
| eques |       | .3.23 | tring |      |     |       |       |       |
| ting- |       |       |       |      |     |       |       |       |
| EPUID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Targ  | 3817  | 6     | UTF8S | M, V |     |       |       | No    |
| eted- |       | .3.26 | tring |      |     |       |       |       |
| EPUID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| T     | 3818  | 6     | Unsig | M, V |     |       |       | No    |
| ime-W |       | .3.27 | ned32 |      |     |       |       |       |
| indow |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| WiFi  | 3819  | 6     | Gr    | M, V |     |       |       | No    |
| -P2P- |       | .3.30 | ouped |      |     |       |       |       |
| Assis |       |       |       |      |     |       |       |       |
| tance |       |       |       |      |     |       |       |       |
| -Info |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| WLAN- | 3820  | 6     | Gr    | M, V |     |       |       | No    |
| Assis |       | .3.31 | ouped |      |     |       |       |       |
| tance |       |       |       |      |     |       |       |       |
| -Info |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| WLA   | 3821  | 6     | O     | M, V |     |       |       | No    |
| N-Lin |       | .3.32 | ctetS |      |     |       |       |       |
| k-Lay |       |       | tring |      |     |       |       |       |
| er-Id |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| WLA   | 3822  | 6     | Gr    | M, V |     |       |       | No    |
| N-Lin |       | .3.33 | ouped |      |     |       |       |       |
| k-Lay |       |       |       |      |     |       |       |       |
| er-Id |       |       |       |      |     |       |       |       |
| -List |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Loc   | 3823  | 6     | Gr    | M,V  |     |       |       | No    |
| ation |       | .3.42 | ouped |      |     |       |       |       |
| -Upda |       |       |       |      |     |       |       |       |
| te-Tr |       |       |       |      |     |       |       |       |
| igger |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| L     | 3824  | 6     | Unsig | M,V  |     |       |       | No    |
| ocati |       | .3.43 | ned32 |      |     |       |       |       |
| on-Up |       |       |       |      |     |       |       |       |
| date- |       |       |       |      |     |       |       |       |
| Event |       |       |       |      |     |       |       |       |
| -Type |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Chan  | 3825  | 6     | Gr    | M,V  |     |       |       | No    |
| ge-Of |       | .3.44 | ouped |      |     |       |       |       |
| -Area |       |       |       |      |     |       |       |       |
| -Type |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Loca  | 3826  | 6     | Unsig | M,V  |     |       |       | No    |
| tion- |       | .3.45 | ned32 |      |     |       |       |       |
| Updat |       |       |       |      |     |       |       |       |
| e-Eve |       |       |       |      |     |       |       |       |
| nt-Tr |       |       |       |      |     |       |       |       |
| igger |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Rep   | 3827  | 6     | Enume | M,V  |     |       |       | No    |
| ort-C |       | .3.46 | rated |      |     |       |       |       |
| ardin |       |       |       |      |     |       |       |       |
| ality |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| M     | 3828  | 6     | Unsig | M,V  |     |       |       | No    |
| inimu |       | .3.47 | ned32 |      |     |       |       |       |
| m-Int |       |       |       |      |     |       |       |       |
| erval |       |       |       |      |     |       |       |       |
| -Time |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Pe    | 3829  | 6     | Gr    | M,V  |     |       |       | No    |
| riodi |       | .3.48 | ouped |      |     |       |       |       |
| c-Loc |       |       |       |      |     |       |       |       |
| ation |       |       |       |      |     |       |       |       |
| -Type |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Loca  | 3830  | 6     | Unsig | M,V  |     |       |       | No    |
| tion- |       | .3.49 | ned32 |      |     |       |       |       |
| Repor |       |       |       |      |     |       |       |       |
| t-Int |       |       |       |      |     |       |       |       |
| erval |       |       |       |      |     |       |       |       |
| -Time |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Tot   | 3831  | 6     | Unsig | M,V  |     |       |       | No    |
| al-Nu |       | .3.50 | ned32 |      |     |       |       |       |
| mber- |       |       |       |      |     |       |       |       |
| Of-Re |       |       |       |      |     |       |       |       |
| ports |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Va    | 3832  | 6     | Unsig | M, V |     |       |       | No    |
| lidit |       | .3.36 | ned32 |      |     |       |       |       |
| y-Tim |       |       |       |      |     |       |       |       |
| e-Ann |       |       |       |      |     |       |       |       |
| ounce |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| V     | 3833  | 6     | Unsig | M, V |     |       |       | No    |
| alidi |       | .3.37 | ned32 |      |     |       |       |       |
| ty-Ti |       |       |       |      |     |       |       |       |
| me-Mo |       |       |       |      |     |       |       |       |
| nitor |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Va    | 3834  | 6     | Unsig | M, V |     |       |       | No    |
| lidit |       | .3.38 | ned32 |      |     |       |       |       |
| y-Tim |       |       |       |      |     |       |       |       |
| e-Com |       |       |       |      |     |       |       |       |
| munic |       |       |       |      |     |       |       |       |
| ation |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProS  | 3835  | 6     | Gr    | M. V |     |       |       | No    |
| e-App |       | .3.39 | ouped |      |     |       |       |       |
| -Code |       |       |       |      |     |       |       |       |
| -Info |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| MIC   | 3836  | 6     | O     | M, V |     |       |       | No    |
|       |       | .3.40 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| UT    | 3837  | 6     | Unsig | M. V |     |       |       | No    |
| C-bas |       | .3.41 | ned32 |      |     |       |       |       |
| ed-Co |       |       |       |      |     |       |       |       |
| unter |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProSe | 3838  | 6     | Unsig | M, V |     |       |       | No    |
| -Matc |       | .3.52 | ned32 |      |     |       |       |       |
| h-Ref |       |       |       |      |     |       |       |       |
| resh- |       |       |       |      |     |       |       |       |
| Timer |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProSe | 3839  | 6     | O     | V    |     |       | M     | No    |
| -Meta |       | .3.60 | ctetS |      |     |       |       |       |
| data- |       |       | tring |      |     |       |       |       |
| Index |       |       |       |      |     |       |       |       |
| -Mask |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| App-  | 3840  | 6     | Group | V    |     |       | M     | No    |
| Ident |       | .3.61 |       |      |     |       |       |       |
| ifier |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| OS-ID | 3841  | 6     | O     | V    |     |       | M     | No    |
|       |       | .3.62 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| OS-A  | 3842  | 6     | UTF8S | V    |     |       | M     | No    |
| pp-ID |       | .3.63 | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Re    | 3843  | 6     | UTF8S | V    |     |       | M     | No    |
| quest |       | .3.64 | tring |      |     |       |       |       |
| ing-R |       |       |       |      |     |       |       |       |
| PAUID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Tar   | 3844  | 6     | UTF8S | V    |     |       | M     | No    |
| get-R |       | .3.65 | tring |      |     |       |       |       |
| PAUID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ta    | 3845  | 6     | O     | V    |     |       | M     | No    |
| rget- |       | .3.66 | ctetS |      |     |       |       |       |
| PDUID |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| P     | 3846  | 6     | O     | V    |     |       | M     | No    |
| roSe- |       | .3.67 | ctetS |      |     |       |       |       |
| Restr |       |       | tring |      |     |       |       |       |
| icted |       |       |       |      |     |       |       |       |
| -Code |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| ProS  | 3847  | 6     | O     | V    |     |       | M     | No    |
| e-Res |       | .3.68 | ctetS |      |     |       |       |       |
| trict |       |       | tring |      |     |       |       |       |
| ed-Co |       |       |       |      |     |       |       |       |
| de-Su |       |       |       |      |     |       |       |       |
| ffix- |       |       |       |      |     |       |       |       |
| Range |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| B     | 3848  | 6     | O     | V    |     |       | M     | No    |
| eginn |       | .3.69 | ctetS |      |     |       |       |       |
| ing-S |       |       | tring |      |     |       |       |       |
| uffix |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| End   | 3849  | 6     | O     | V    |     |       | M     | No    |
| ing-S |       | .3.70 | ctetS |      |     |       |       |       |
| uffix |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Dis   | 3850  | 6     | Unsig | V    |     |       | M     | No    |
| cover |       | .3.59 | ned32 |      |     |       |       |       |
| y-Ent |       |       |       |      |     |       |       |       |
| ry-ID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Match | 3851  | 6     | Time  | V    |     |       | M     | No    |
| -Time |       | .3.71 |       |      |     |       |       |       |
| stamp |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| PMR-  | 3852  | 6     | Unsig | M,V  |     |       |       | No    |
| Flags |       | .3.57 | ned32 |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| P     | 3853  | 6     | UTF8S | M,V  |     |       |       | No    |
| roSe- |       | .3.58 | tring |      |     |       |       |       |
| Appli |       |       |       |      |     |       |       |       |
| catio |       |       |       |      |     |       |       |       |
| n-Met |       |       |       |      |     |       |       |       |
| adata |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Di    | 3854  | 6     | Gr    | M, V |     |       |       | No    |
| scove |       | .3.53 | ouped |      |     |       |       |       |
| ry-Au |       |       |       |      |     |       |       |       |
| th-Re |       |       |       |      |     |       |       |       |
| quest |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Dis   | 3855  | 6     | Gr    | M, V |     |       |       | No    |
| cover |       | .3.54 | ouped |      |     |       |       |       |
| y-Aut |       |       |       |      |     |       |       |       |
| h-Res |       |       |       |      |     |       |       |       |
| ponse |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Mat   | 3856  | 6     | Gr    | M, V |     |       |       | No    |
| ch-Re |       | .3.55 | ouped |      |     |       |       |       |
| quest |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ma    | 3857  | 6     | Gr    | M, V |     |       |       | No    |
| tch-R |       | .3.56 | ouped |      |     |       |       |       |
| eport |       |       |       |      |     |       |       |       |
| -Info |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ban   | 3858  | 6     | UTF8S | V    |     |       | M     | No    |
| ned-R |       | .3.73 | tring |      |     |       |       |       |
| PAUID |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Ba    | 3859  | 6     | O     | V    |     |       | M     | No    |
| nned- |       | .3.74 | ctetS |      |     |       |       |       |
| PDUID |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Co    | 3860  | 6     | Gr    | V    |     |       | M     | No    |
| de-Re |       | .3.75 | ouped |      |     |       |       |       |
| ceivi |       |       |       |      |     |       |       |       |
| ng-Se |       |       |       |      |     |       |       |       |
| curit |       |       |       |      |     |       |       |       |
| y-Mat |       |       |       |      |     |       |       |       |
| erial |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Code- | 3861  | 6     | Gr    | V    |     |       | M     | No    |
| Sendi |       | .3.76 | ouped |      |     |       |       |       |
| ng-Se |       |       |       |      |     |       |       |       |
| curit |       |       |       |      |     |       |       |       |
| y-Mat |       |       |       |      |     |       |       |       |
| erial |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| DUSK  | 3862  | 6     | O     | V    |     |       | M     | No    |
|       |       | .3.77 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| DUIK  | 3863  | 6     | O     | V    |     |       | M     | No    |
|       |       | .3.78 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| DUCK  | 3864  | 6     | O     | V    |     |       | M     | No    |
|       |       | .3.79 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| MIC-  | 3865  | 6     | Unsig | V    |     |       | M     | No    |
| Check |       | .3.80 | ned32 |      |     |       |       |       |
| -indi |       |       |       |      |     |       |       |       |
| cator |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| En    | 3866  | 6     | O     | V    |     |       | M     | No    |
| crypt |       | .3.81 | ctetS |      |     |       |       |       |
| ed-Bi |       |       | tring |      |     |       |       |       |
| tmask |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| Pr    | 3867  | 6     | O     | V    |     |       | M     | No    |
| oSe-A |       | .3.82 | ctetS |      |     |       |       |       |
| pp-Co |       |       | tring |      |     |       |       |       |
| de-Su |       |       |       |      |     |       |       |       |
| ffix- |       |       |       |      |     |       |       |       |
| Range |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| PC5   | 3868  | 6     | O     | V    |     |       | M     | No    |
| -tech |       | .3.84 | ctetS |      |     |       |       |       |
|       |       |       | tring |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+
| NOTE  |       |       |       |      |     |       |       |       |
| 1:    |       |       |       |      |     |       |       |       |
| The   |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| h     |       |       |       |      |     |       |       |       |
| eader |       |       |       |      |     |       |       |       |
| bit   |       |       |       |      |     |       |       |       |
| de    |       |       |       |      |     |       |       |       |
| noted |       |       |       |      |     |       |       |       |
| as    |       |       |       |      |     |       |       |       |
| \     |       |       |       |      |     |       |       |       |
| "M\", |       |       |       |      |     |       |       |       |
| indi  |       |       |       |      |     |       |       |       |
| cates |       |       |       |      |     |       |       |       |
| wh    |       |       |       |      |     |       |       |       |
| ether |       |       |       |      |     |       |       |       |
| su    |       |       |       |      |     |       |       |       |
| pport |       |       |       |      |     |       |       |       |
| of    |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| is    |       |       |       |      |     |       |       |       |
| requ  |       |       |       |      |     |       |       |       |
| ired. |       |       |       |      |     |       |       |       |
| The   |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| h     |       |       |       |      |     |       |       |       |
| eader |       |       |       |      |     |       |       |       |
| bit   |       |       |       |      |     |       |       |       |
| de    |       |       |       |      |     |       |       |       |
| noted |       |       |       |      |     |       |       |       |
| as    |       |       |       |      |     |       |       |       |
| \"V\" |       |       |       |      |     |       |       |       |
| indi  |       |       |       |      |     |       |       |       |
| cates |       |       |       |      |     |       |       |       |
| wh    |       |       |       |      |     |       |       |       |
| ether |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| opt   |       |       |       |      |     |       |       |       |
| ional |       |       |       |      |     |       |       |       |
| Vend  |       |       |       |      |     |       |       |       |
| or-ID |       |       |       |      |     |       |       |       |
| field |       |       |       |      |     |       |       |       |
| is    |       |       |       |      |     |       |       |       |
| pr    |       |       |       |      |     |       |       |       |
| esent |       |       |       |      |     |       |       |       |
| in    |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| he    |       |       |       |      |     |       |       |       |
| ader. |       |       |       |      |     |       |       |       |
| For   |       |       |       |      |     |       |       |       |
| fu    |       |       |       |      |     |       |       |       |
| rther |       |       |       |      |     |       |       |       |
| det   |       |       |       |      |     |       |       |       |
| ails, |       |       |       |      |     |       |       |       |
| see   |       |       |       |      |     |       |       |       |
| I     |       |       |       |      |     |       |       |       |
| ETF R |       |       |       |      |     |       |       |       |
| FC 67 |       |       |       |      |     |       |       |       |
| 33 \[ |       |       |       |      |     |       |       |       |
| 29\]. |       |       |       |      |     |       |       |       |
|       |       |       |       |      |     |       |       |       |
| NOTE  |       |       |       |      |     |       |       |       |
| 2: If |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| M-bit |       |       |       |      |     |       |       |       |
| is    |       |       |       |      |     |       |       |       |
| set   |       |       |       |      |     |       |       |       |
| for   |       |       |       |      |     |       |       |       |
| an    |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| and   |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| rec   |       |       |       |      |     |       |       |       |
| eiver |       |       |       |      |     |       |       |       |
| does  |       |       |       |      |     |       |       |       |
| not   |       |       |       |      |     |       |       |       |
| under |       |       |       |      |     |       |       |       |
| stand |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| AVP,  |       |       |       |      |     |       |       |       |
| it    |       |       |       |      |     |       |       |       |
| shall |       |       |       |      |     |       |       |       |
| r     |       |       |       |      |     |       |       |       |
| eturn |       |       |       |      |     |       |       |       |
| a     |       |       |       |      |     |       |       |       |
| rejec |       |       |       |      |     |       |       |       |
| tion. |       |       |       |      |     |       |       |       |
| If    |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| M-bit |       |       |       |      |     |       |       |       |
| is    |       |       |       |      |     |       |       |       |
| not   |       |       |       |      |     |       |       |       |
| set   |       |       |       |      |     |       |       |       |
| for   |       |       |       |      |     |       |       |       |
| an    |       |       |       |      |     |       |       |       |
| AVP,  |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| rec   |       |       |       |      |     |       |       |       |
| eiver |       |       |       |      |     |       |       |       |
| shall |       |       |       |      |     |       |       |       |
| not   |       |       |       |      |     |       |       |       |
| r     |       |       |       |      |     |       |       |       |
| eturn |       |       |       |      |     |       |       |       |
| a     |       |       |       |      |     |       |       |       |
| rejec |       |       |       |      |     |       |       |       |
| tion, |       |       |       |      |     |       |       |       |
| wh    |       |       |       |      |     |       |       |       |
| ether |       |       |       |      |     |       |       |       |
| or    |       |       |       |      |     |       |       |       |
| not   |       |       |       |      |     |       |       |       |
| it    |       |       |       |      |     |       |       |       |
| u     |       |       |       |      |     |       |       |       |
| nders |       |       |       |      |     |       |       |       |
| tands |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| AVP.  |       |       |       |      |     |       |       |       |
| If    |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| rec   |       |       |       |      |     |       |       |       |
| eiver |       |       |       |      |     |       |       |       |
| u     |       |       |       |      |     |       |       |       |
| nders |       |       |       |      |     |       |       |       |
| tands |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| AVP   |       |       |       |      |     |       |       |       |
| but   |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| M-bit |       |       |       |      |     |       |       |       |
| value |       |       |       |      |     |       |       |       |
| does  |       |       |       |      |     |       |       |       |
| not   |       |       |       |      |     |       |       |       |
| match |       |       |       |      |     |       |       |       |
| with  |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| defin |       |       |       |      |     |       |       |       |
| ition |       |       |       |      |     |       |       |       |
| in    |       |       |       |      |     |       |       |       |
| this  |       |       |       |      |     |       |       |       |
| t     |       |       |       |      |     |       |       |       |
| able, |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| rec   |       |       |       |      |     |       |       |       |
| eiver |       |       |       |      |     |       |       |       |
| shall |       |       |       |      |     |       |       |       |
| i     |       |       |       |      |     |       |       |       |
| gnore |       |       |       |      |     |       |       |       |
| the   |       |       |       |      |     |       |       |       |
| M     |       |       |       |      |     |       |       |       |
| -bit. |       |       |       |      |     |       |       |       |
+-------+-------+-------+-------+------+-----+-------+-------+-------+

The following table (table 6.3.1-2) specifies the Diameter AVPs re-used
by the PC6/PC7 interfaces from existing Diameter Applications, including
a reference to their respective specifications and when needed, a short
description of their use within PC6/PC7 interfaces.

Any other AVPs from existing Diameter Applications, except for the AVPs
from Diameter Base Protocol, do not need to be supported. The AVPs from
Diameter Base Protocol are not included in table 6.3.1-2.

Table 6.3.1-2: PC6/PC7 re-used Diameter AVPs

+----------------+----------------+----------------+--------------+
| Attribute Name | Reference      | Comments       | M-bit        |
+----------------+----------------+----------------+--------------+
| Supp           | 3GPP TS        |                |              |
| orted-Features |  29.229 \[10\] |                |              |
+----------------+----------------+----------------+--------------+
| EAP-Mast       | IETF R         |                |              |
| er-Session-Key | FC 4072 \[12\] |                |              |
+----------------+----------------+----------------+--------------+
| F              | 3GPP TS        |                |              |
| eature-List-ID |  29.229 \[10\] |                |              |
+----------------+----------------+----------------+--------------+
| Feature-List   | 3GPP TS        | See clause     |              |
|                |  29.229 \[10\] | 7.3.10         |              |
+----------------+----------------+----------------+--------------+
| MSISDN         | 3GPP T         |                |              |
|                | S 29.329 \[5\] |                |              |
+----------------+----------------+----------------+--------------+
| User-Name      | IETF R         |                |              |
|                | FC 6733 \[29\] |                |              |
+----------------+----------------+----------------+--------------+
| Loc            | 3GPP TS        |                |              |
| ation-Estimate |  32.299 \[13\] |                |              |
+----------------+----------------+----------------+--------------+
| ProSe-         | 3GPP TS        |                |              |
| Direct-Allowed |  29.344 \[14\] |                |              |
+----------------+----------------+----------------+--------------+
| Authorized-D   | 3GPP TS        |                |              |
| iscovery-Range |  29.344 \[14\] |                |              |
+----------------+----------------+----------------+--------------+
| SSID           | 3GPP TS        |                |              |
|                |  29.273 \[15\] |                |              |
+----------------+----------------+----------------+--------------+
| V              | 3GPP TS        |                |              |
| isited-PLMN-Id |  29.272 \[16\] |                |              |
+----------------+----------------+----------------+--------------+
| U              | 3GPP TS        |                |              |
| ser-Identifier |  29.336 \[18\] |                |              |
+----------------+----------------+----------------+--------------+
| OC-Supp        | IETF RFC 7683  | See clause     | Must set     |
| orted-Features | \[21\]         | 6.3.34         |              |
+----------------+----------------+----------------+--------------+
| OC-OLR         | IETF RFC 7683  | See clause     | Must set     |
|                | \[21\]         | 6.3.35         |              |
+----------------+----------------+----------------+--------------+
| DRMP           | IETF RFC 7944  | see clause     | Must not set |
|                | \[27\]         | 6.3.72         |              |
+----------------+----------------+----------------+--------------+
| Service-Result | 3GPP TS        |                |              |
|                |  29.336 \[18\] |                |              |
+----------------+----------------+----------------+--------------+
| Load           | IETF R         | See clause     | Must not set |
|                | FC 8583 \[28\] | 6.3.83         |              |
+----------------+----------------+----------------+--------------+
| NOTE 1: The    |                |                |              |
| M-bit settings |                |                |              |
| for re-used    |                |                |              |
| AVPs override  |                |                |              |
| those of the   |                |                |              |
| defining       |                |                |              |
| specifications |                |                |              |
| that are       |                |                |              |
| referenced.    |                |                |              |
| Values         |                |                |              |
| include:       |                |                |              |
| \"Must set\",  |                |                |              |
| \"Must not     |                |                |              |
| set\". If the  |                |                |              |
| M-bit setting  |                |                |              |
| is blank, then |                |                |              |
| the defining   |                |                |              |
| specification  |                |                |              |
| applies.       |                |                |              |
|                |                |                |              |
| NOTE 2: If the |                |                |              |
| M-bit is set   |                |                |              |
| for an AVP and |                |                |              |
| the receiver   |                |                |              |
| does not       |                |                |              |
| understand the |                |                |              |
| AVP, it shall  |                |                |              |
| return a       |                |                |              |
| rejection. If  |                |                |              |
| the M-bit is   |                |                |              |
| not set for an |                |                |              |
| AVP, the       |                |                |              |
| receiver shall |                |                |              |
| not return a   |                |                |              |
| rejection,     |                |                |              |
| whether or not |                |                |              |
| it understands |                |                |              |
| the AVP. If    |                |                |              |
| the receiver   |                |                |              |
| understands    |                |                |              |
| the AVP but    |                |                |              |
| the M-bit      |                |                |              |
| value does not |                |                |              |
| match with the |                |                |              |
| definition in  |                |                |              |
| this table,    |                |                |              |
| the receiver   |                |                |              |
| shall ignore   |                |                |              |
| the M-bit.     |                |                |              |
+----------------+----------------+----------------+--------------+

### 6.3.2 App-Layer-User-Id

The App-Layer-User-Id AVP is of type UTF8String. This AVP contains an
identity identifying a user within the context of a specific application
(e.g. alice\@social.net).

### 6.3.3 Assistance-info

The Assistance-Info AVP is of type Grouped. It shall contain the
information for direct discovery and communications between UEs.

The AVP format shall conform to:

Assistance-Info ::= \<AVP header: 3802 10415\>

> \[ WLAN-Assistance-Info \]
>
> \*\[AVP\]

### 6.3.4 Assistance-Info-Validity-Timer

The Assistance-Info-Validity-Timer AVP is of type Unsigned32 and it
shall contain the maximum number of seconds of validity of the provided
assistance information.

### 6.3.5 Discovery-Type

The Discovery-Type AVP is of type Unsigned32 and contains a 32-bit
address space representing types of Direct Discovery Authorization
Request. The following values are defined:

ANNOUNCING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY (0)

> This value is used when the Direct Discovery Authorization Request
> message is sent for a UE requesting authorization for announcing in
> open Prose Direct Discovery (Model A).

MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY (1)

> This value is used when the Direct Discovery Authorization Request
> message is sent for a UE requesting authorization for monitoring in
> open Prose Direct Discovery (Model A).

ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (2)

> This value is used when the Direct Discovery Authorization Request
> message is sent for a UE requesting authorization for announcing in
> restricted ProSe Direct Discovery (Model A).

MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (3)

> This value is used when the Direct Discovery Authorization Request
> message is sent for a UE requesting authorization for monitoring in
> restricted ProSe Direct Discovery (Model A).

DISCOVEREE\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (4)

> This value is used when the Direct Discovery Authorization Request
> message is sent for a discoveree UE requesting authorization for
> monitoring in restricted ProSe Direct Discovery (Model B).

DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (5)

> This value is used when the Direct Discovery Authorization Request
> message is sent to the ProSe Function in local PLMN for a discoverer
> UE requesting authorization for announcing in restricted ProSe Direct
> Discovery (Model B).

DISCOVERER\_ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY
(6)

> This value is used when the Direct Discovery Authorization Request
> message is sent to the ProSe Function in the visited PLMN for a
> discoverer UE requesting authorization for announcing in restricted
> ProSe Direct Discovery (Model B).

MONITORING\_UPDATE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (7)

> This value is used when the Direct Discovery Authorization Request
> message is sent for the ProSe Function requesting to ban a user of an
> authorization for monitoring in restricted ProSe Direct Discovery
> (Model A).

MONITORING\_RESPONSE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY (8)

> This value is used when the Direct Discovery Authorization Request
> message is sent for the ProSe Function reporting the result of an
> authorization for monitoring in restricted ProSe Direct Discovery
> (Model A).

### 6.3.6 EAP-Master-Session-Key

The EAP-Master-Session-Key AVP is of type OctetString and it shall
contains keying material for protecting the communications between UEs.
This AVP is defined in the IETF RFC 4072 \[12\]

### 6.3.7 Feature-List-ID AVP

The syntax of this AVP is defined in 3GPP TS 29.229 \[10\]. For this
release, the Feature-List-ID AVP value shall be set to 1.

### 6.3.8 Feature-List AVP

The syntax of this AVP is defined in 3GPP TS 29.229 \[10\]. A null value
indicates that there is no feature used by the application.

NOTE: There is no feature defined for this release.

### 6.3.9 Filter-Id

The Filter-Id AVP is of type OctectString. This AVP shall contain the
identifier of a Discovery Filter.

### 6.3.10 Location-Estimate

The *Location-Estimate* AVP is of type OctetString and it shall contain
an estimate of the location of an MS in universal coordinates and the
accuracy of the estimate. This AVP is defined in the
3GPP TS 32.299 \[13\].

### 6.3.11 MAC-Address

The MAC-Address AVP is of type UTF8String and it shall contain a 6-octet
MAC address used as link layer identifier for discovery and
communication. It shall be encoded in upper-case ASCII characters with
the octet values separated by dash characters. It shall contain a string
of 17 octets. Example: \"00-10-A4-23-19-C0\".

### 6.3.12 Match-Report

The Match-Report AVP is of type Grouped. It shall contain the
information elements used in ProSe Match Report answer.

The AVP format shall conform to:

Match-Report ::= \<AVP header: 3807 10415\>

> { Discovery-Type }
>
> \[ ProSe-App-Code \]
>
> \[ ProSe-Metadata-Index-Mask \]
>
> \[ ProSe-App-Id \]
>
> \[ ProSe-Validity-Timer \]
>
> \[ ProSe-Match-Refresh-Timer \]
>
> \[ ProSe-Application-Metadata \]
>
> \[ PC5-tech \]
>
> \*\[AVP\]

The valid value for Discovery-Type for Match-Report AVP is:
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\",

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Match-Report shall contain a ProSe Application Code, the associated
ProSe Application ID Name, the validity time for which the ProSe
Application Code is valid, the associated match report refresh timer and
optionally the PC5 radio technology that the UE is using.

If the ProSe Application Code contains a metadata index, a
ProSe-Metadata-Index-Mask AVP shall be provided for this ProSe
Application Code.

### 6.3.13 MSISDN

The MSISDN AVP is of type OctetString. This AVP contains an MSISDN, in
international number format as described in ITU-T Rec E.164 \[19\]. This
AVP is defined in the 3GPP TS 29.329 \[5\].

### 6.3.14 Operating-Channel

The Operating-Channel AVP is of type Unsigned32 and it shall contain the
operating channel in MHz on which Wi-Fi P2P discovery and communication
should take place.

### 6.3.15 P2P-Features

The P2P-Features AVP is of type Unsigned32 and it shall contain a bit
mask. The meaning of the bits shall be as defined in table 6.3.15-1:

Table 6.3.15-1: P2P-Features

  ------------------------------------------------------------------------------------------------------------------------------------ ------------------------ -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Bit                                                                                                                                  Name                     Description
  0                                                                                                                                    Group Owner Indication   This bit, when set, shall indicate that the UE should implement the Group Owner (GO) functionality specified in the Wi-Fi P2P specification \[17\]. When not set, this bit shall indicate the UE should behave as a Wi-Fi P2P client that attempts to discover and associate with a GO.
  NOTE: Bits not defined in this table shall be cleared by the sending ProSe Function and discarded by the receiving ProSe Function.                            
  ------------------------------------------------------------------------------------------------------------------------------------ ------------------------ -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### 6.3.16 ProSe-App-Code

The ProSe-App-Code AVP is of type OctetString. This AVP contains a ProSe
Application Code or ProSe Application Code Prefix (see
3GPP TS 23.003 \[4\]) is associated with a ProSe Application ID.

### 6.3.17 ProSe-App-Id

The ProSe-App-Id AVP is of type UTF8String. This AVP contains a ProSe
Application ID (see 3GPP TS 23.003 \[4\]).

### 6.3.18 ProSe-App-Mask

The ProSe-App-Mask AVP is of type OctetString. This AVP contains a ProSe
Application Mask (see 3GPP TS 24.334 \[22\]).

### 6.3.19 ProSe-Direct-Allowed

The ProSe-Direct-Allowed AVP is of type Unsigned32 and it shall contain
a bit mask that indicates the permissions for ProSe direct services for
the UE in the PLMN of the responding ProSe Function. This AVP is defined
in the 3GPP TS 29.344 \[14\].

### 6.3.20 ProSe-Discovery-Filter

The ProSe-Discovery-Filter AVP is of type Grouped. It shall contain a
Filter ID, a ProSe Application ID name, a validity timer, a ProSe
Application Code and zero or more ProSe Application Masks.

The AVP format shall conform to:

ProSe-Discovery-Filter ::= \<AVP header: 3813 10415\>

> { Filter-Id }
>
> { ProSe-App-Id }
>
> { ProSe-Validity-Timer }
>
> { ProSe-App-Code }
>
> \*\[ ProSe-App-Mask \]
>
> \*\[AVP\]

### 6.3.21 PRR-Flags

The PRR-Flags AVP is of type Unsigned32 and it shall contain a bit mask.
The meaning of the bits shall be as defined in table 6.3.21-1:

Table 6.3.21-1: PRA-Flags

  ------------------------------------------------------------------------------------------------------------------------------------ ----------------- ----------------------------------------------------------------------------------------------------------------
  Bit                                                                                                                                  Name              Description
  0                                                                                                                                    WLAN Indication   This bit, when set, shall indicate the UE is requested EPC support for WLAN direct discovery and communication
  NOTE: Bits not defined in this table shall be cleared by the sending ProSe Function and discarded by the receiving ProSe Function.                     
  ------------------------------------------------------------------------------------------------------------------------------------ ----------------- ----------------------------------------------------------------------------------------------------------------

### 6.3.22 ProSe-Validity-Timer

The ProSe-Validity-Timer AVP is of type Unsigned32 and it shall contain
the maximum number of seconds of validity of a ProSe Application Code or
a ProSe Discovery Filter.

### 6.3.23 Requesting-EPUID

The Requesting-EPUID AVP is of type UTF8String. This AVP contains an
identifier for EPC-level ProSe Discovery and EPC support for WLAN direct
communication that uniquely identifies a UE registered for ProSe
triggering a Proximity request.

### 6.3.24 Supported-Features

The Supported-Features AVP is of type Grouped and it informs the
destination host about the features that the origin host supports for
the application. This AVP is defined in the 3GPP TS 29.229 \[10\].

### 6.3.25 SSID

The SSID AVP is of type UTF8String and it shall contain the Service Set
Identifier which identifies a specific 802.11 extended service set (see
IEEE Std 802.11-2012 \[20\]). This AVP is defined in the
3GPP TS 29.273 \[15\].

### 6.3.26 Targeted-EPUID

The Targeted-EPUID AVP is of type UTF8String. This AVP contains an
identifier for EPC-level ProSe Discovery and EPC support for WLAN direct
communication that uniquely identifies a UE registered for ProSe
targeted by a Proximity request.

### 6.3.27 Time-Window

The Time-Window AVP is of type Unsigned32 and it shall contain the
maximum number of seconds of validity of the Proximity request.

### 6.3.28 User-Identifier

The User-Identifier AVP is of type Grouped. It shall contain the UE
identity used as identifier of a Proximity-based service subscribed by
the user (i.e. IMSI or MSISDN). This AVP is defined in the
3GPP TS 29.336 \[18\].

### 6.3.29 Visited-PLMN-Id

The Visited-PLMN-Id AVP is of type OctetString. This AVP shall contain
the concatenation of MCC and MNC. This AVP is defined in the
3GPP TS 29.272 \[16\].

### 6.3.30 WiFi-P2P-Assistance-Info

The WiFi-P2P-Assistance-Info AVP is of type Grouped. It shall contain
information to assist WLAN direct discovery and communication as
required by the Wi-Fi P2P technology.

The AVP format shall conform to:

WiFi-P2P-Assistance-Info ::= \<AVP header: 3819 10415\>

> \[ SSID \]
>
> \[ EAP-Master-Session-Key \]
>
> \[ P2P-Features \]
>
> \[ WLAN-Link-Layer-Id-List \]
>
> \[ WLAN-Link-Layer-Id-List \]
>
> \[ Operating-Channel \]
>
> \[ Assistance-Info-Validity-Timer \]
>
> \*\[AVP\]

### 6.3.31 WLAN-Assistance-Info

The WLAN-Assistance-Info AVP is of type Grouped. It shall contain
information to assist WLAN direct discovery and communication required
for WLAN direct discovery and communication between UEs.

The AVP format shall conform to:

WLAN-Assistance-Info ::= \<AVP header: 3820 10415\>

> \[ WiFi-P2P-Assistance-Iinfo \]
>
> \*\[AVP\]

### 6.3.32 WLAN-Link-Layer-Id

The WLAN-Link-Layer-Id AVP is of type Grouped. It shall contain a link
layer identity used for WLAN direct discovery and/or WLAN direct
communication.

The AVP format shall conform to:

WLAN-Link-Layer-Id ::= \<AVP header: 3821 10415\>

> \[ MAC-Address \]
>
> \*AVP

### 6.3.33 WLAN-Link-Layer-Id-List

The WLAN-Link-Layer-Id-List AVP is of type Grouped. It shall contain a
list of WLAN Link Layer IDs provided to a UE implementing the Group
Owner functionality in a Wi-Fi P2P group.

The AVP format shall conform to:

WLAN-Link-Layer-Id-List ::= \<AVP header: 3822 10415\>

> \*\[ WLAN-Link-Layer-Id \]
>
> \*AVP

### 6.3.34 OC-Supported-Features

The OC-Supported-Features AVP is of type Grouped and it is defined in
IETF RFC 7683 \[21\]. This AVP is used to support Diameter overload
control mechanism, see Annex A for more information.

### 6.3.35 OC-OLR

The OC-OLR AVP is of type Grouped and it is defined in IETF RFC 7683
\[21\]. This AVP is used to support Diameter overload control mechanism,
see Annex A for more information.

### 6.3.36 Validity-Time-Announce

The Validity-Time-Announce AVP is of type Unsigned32 and it shall
contain the maximum number of seconds of validity of a ProSe announcing
authorization policy.

### 6.3.37 Validity-Time-Monitor

The Validity-Time-Monitor AVP is of type Unsigned32 and it shall contain
the maximum number of seconds of validity of a ProSe monitoring
authorization policy.

### 6.3.38 Validity-Time-Communication

The Validity-Time-Communication AVP is of type Unsigned32 and it shall
contain the maximum number of seconds of validity of a ProSe
communication authorization policy.

### 6.3.39 ProSe-App-Code-Info

The ProSe-App-Code-Info AVP is of type Grouped. It shall contain a ProSe
Application Code, the associated MIC and the associated UTC-based
counter.

The AVP format shall conform to:

ProSe-App-Code-Info ::= \<AVP header: 3835 10415\>

> { ProSe-App-Code }
>
> { MIC }
>
> { UTC-based-Counter }
>
> \*\[AVP\]

### 6.3.40 MIC

The MIC AVP is of type OctetString and shall contain a MIC (Message
Integrity Check) associated with a discovered ProSe Application Code, as
defined in 3GPP TS 33.303 \[23\].

### 6.3.41 UTC-based-Counter

The UTC-based-Counter AVP is of type Unsigned32 and it shall contain the
UTC-based counter (in seconds) associated with a discovered ProSe
Application Code as defined in 3GPP TS 24.334 \[22\].

### 6.3.42 Location-Update-Trigger

The Location-Update-Trigger AVP is of type Grouped. It shall contain the
type of event that will trigger a locate update procedure to forward the
location of UE to the ProSe Function initiating the Proximity Request.

The AVP format shall conform to:

Location-Update-Trigger::= \<AVP header: 3823 10415\>

> { Location-Update-Event-Type }
>
> \[ Change-Of-Area-Type \]
>
> \[ Periodic-Location-Type \]
>
> \*\[AVP\]

The Change-Of-Area-Type AVP shall be present if the
Location-Update-Event-Type AVP value is set to CHANGE\_OR\_AREA (1).
Otherwise, it shall be absent.

The Periodic-Location-Type AVP shall be present if the
Location-Update-Event-Type AVP value is set to PERIODIC\_LOCATION (2).
Otherwise, it shall be absent.

### 6.3.43 Location-Update-Event-Type

The Location-Update-Event-Type AVP is of type Unsigned32 and contains an
32-bit address space representing types of events that will trigger a
location update. The following values are defined:

UE\_AVAILABLE (0)

This value shall be used to indicate that the location update trigger is
any event in which the MSC/SGSN/MME has established a contact with the
UE.

CHANGE\_OF\_AREA (1)

This value shall be used to indicate that the location update trigger is
an event where the UE enters or leaves a pre-defined geographical area
or if the UE is currently within the pre-defined geographical area.

PERIODIC\_LOCATION (2)

This value shall be used to indicate that the location update trigger is
an event where a defined periodic timer expires in the UE and activates
a location report or a location request

The types of event listed above are defined in the clause 4.4.2.1 of the
3GPP TS 23.271 \[24\]

### 6.3.44 Change-Of-Area-Type

The Change-Of-Area-Type AVP is of type Grouped. It shall contain the
information related to the type of event that will trigger a locate
update procedure to forward the location of UE to the ProSe Function
initiating the Proximity Request.

The AVP format shall conform to:

Change-Of-Area-Type::= \<AVP header: 3825 10415\>

> { Location-Update-Event-Trigger }
>
> { Report-Cardinality }
>
> \[ Minimum-Interval-Time \]
>
> \*\[AVP\]

The Minimum-Interval-Time AVP may be present only if the
Report-Cardinality AVP value is set to MULTIPLE (1).

### 6.3.45 Location-Update-Event-Trigger

The Location-Update-Event-Type AVP is of type Unsigned32 and contains a
32-bit address space representing the possible change of area events
i.e. UE enters, leaves or is within requested target area. The following
values are defined:

UE\_ENTRY (0)

This value shall be used to indicate the event trigger is the UE
entering a pre-defined geographical area.

UE\_EXIT (1)

This value shall be used to indicate the event trigger is the UE leaving
a pre-defined geographical area

UE\_PRESENCE (2)

This value shall be used to indicate the event trigger is the current
presence of the UE within a pre-defined geographical area.

The types of change of area event listed above are defined in the clause
4.4.2.1 of the 3GPP TS 23.271 \[24\].

### 6.3.46 Report-Cardinality

The Report-Cardinality AVP is of type Enumerated. The following values
are defined:

SINGLE (0)

This value shall be used to indicate the change of area event shall be
reported one time only.

MULTIPLE (1)

This value shall be used to indicate the change of area event may be
reported several times.

### 6.3.47 Minimum-Interval-Time

The Minimum-Interval-Time AVP is of type Unsigned32 and shall contain
the minimum number of seconds between area event reports.

### 6.3.48 Periodic-Location-Type

The Periodic-Location-Type AVP is of type Grouped. It shall contain the
time interval between successive location reports and the total number
of reports.

The AVP format shall conform to:

Periodic-Location-Type::= \<AVP header: 3829 10415\>

> { Location-Report-Interval-Time }
>
> { Total-Number-Of-Reports }
>
> \*\[AVP\]

### 6.3.49 Location-Report-Interval-Time

The Location-Report-Interval-Time AVP is of type Unsigned32 and shall
contain the number of seconds between successive location reports.

### 6.3.50 Total-Number-Of-Reports

The Total-Number-Of-Reports AVP is of type Unsigned32 and shall indicate
the maximum number of requested location reports.

### 6.3.51 Authorized-Discovery-Range

The Authorized-Discovery-Range AVP is of type Unsigned32 and it shall
contain a value that indicates the authorised announcing range
(short/medium/long) at which the UE is allowed to announce in the given
PLMN according to the defined announcing authorisation policy for this
UE. This AVP is defined in the 3GPP TS 29.344 \[14\].

### 6.3.52 ProSe-Match-Refresh-Timer

The ProSe-Match-Refresh-Timer AVP is of type Unsigned32 and it shall
contain the number of seconds indicating how long the UE shall wait
before sending a new Match Report for the associated ProSe Application
Code.

### 6.3.53 Discovery-Auth-Request 

The Discovery-Auth-Request is of type Grouped. It shall contain the
information elements used in ProSe direct discovery authorization
request.

The AVP format shall conform to:

Discovery-Auth-Request ::= \<AVP header: 3854 10415\>

> { Discovery-Type }
>
> \[ User-Identity \]
>
> \[ ProSe-App-ID \]
>
> \[ ProSe-App-Code \]
>
> \[ ProSe-App-Code-Suffix-Range \]
>
> \[ ProSe-Validity-Timer \]
>
> \[ App-Identifier \]
>
> \[ Requesting-RPAUID \]
>
> \[ Target-RPAUID \]
>
> \[ Target-PDUID \]
>
> \[ ProSe-Restricted-Code \]
>
> \[ ProSe-Query-Code \]
>
> \[ ProSe-Response-Code \]
>
> \*\[ ProSe-Restricted-Code-Suffix-Range \]
>
> \[ Banned-RPAUID \]
>
> \[ Banned-PDUID \]
>
> \[ Service-Result \]
>
> \[ PC5-tech \]
>
> \*\[AVP\]

When the Discovery-Type is set to
\"ANNOUNCING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, a ProSe Application
ID, a ProSe Application Code and optionally one or more ProSe Restricted
Code Suffix-Range, ProSe Validity Timer and the PC5 radio technology
that the UE is using.

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, a ProSe Application
ID and optionally the PC5 radio technology that the UE is using.

When the Discovery-Type is set to
\"ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, an Application
Identifier, the Requesting RPAUID, ProSe Restricted Code and optionally
one or more ProSe Restricted Code SuffixRange, a ProSe Validity Timer
and the PC5 radio technology that the UE is using.

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, an Application
Identifier, Requesting RPAUID, Target RPAUID, Target PDUID and
optionally the PC5 radio technology that the UE is using.

When the Discovery-Type is set to
\"DISCOVEREE\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, an Application
Identifier, Requesting RPAUID, a ProSe Response Code and optionally the
PC5 radio technology that the UE is using.

When the Discovery-Type is set to
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain a UE identity, an Application
Identifier, Requesting RPAUID, Target RPAUID, Target PDUID and
optionally the PC5 radio technology that the UE is using.

When the Discovery-Type is set to
\"DISCOVERER\_ANNOUNCING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\",
the Discovery-Auth-Request shall contain a UE identity, an Application
Identifier, Requesting RPAUID, a ProSe Query Code and optionally the PC5
radio technology that the UE is using.

When the Discovery-Type is set to
\"MONITORING\_UPDATE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain an Application Identifier, a ProSe
Restricted Code, a Banned RPAUID, a Banned PDUID and optionally the PC5
radio technology that the UE is using.

When the Discovery-Type is set to
\"MONITORING\_RESPONSE\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Request shall contain an Application Identifier,
ProSe-Restricted-Code, Banned RPAUID, Banned PDUID, Result and
optionally the PC5 radio technology that the UE is using.

### 6.3.54 Discovery-Auth-Response

The Discovery-Auth-Response is of type Grouped. It shall contain the
information elements used in ProSe direct discovery authorization
answer.

The AVP format shall conform to:

Discovery-Auth-Response ::= \<AVP header: 3855 10415\>

> { Discovery-Type }
>
> \*\[ ProSe-Discovery-Filter \]
>
> \[ Visited-PLMN-Id \]
>
> \[ ProSe-Restricted-Code \]
>
> \[ ProSe-Query-Code \]
>
> \[ ProSe-Response-Code \]
>
> \[ ProSe-Validity Timer \]
>
> \[ Code-Sending-Security-Material \]
>
> \[ Code-Receiving-Security-Material \]
>
> \[ DUIK \]
>
> \[ PC5-tech \]
>
> \*\[AVP\]

When the Discovery-Type is set to
\"ANNOUNCING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Response shall contain no other parameters.

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Response shall contain one or more ProSe Discovery
Filters, optionally a PLMN ID and the PC5 radio technology that the UE
is using.

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Response shall contain a ProSe Restricted Code, a Code
Receiving Security Material, optionally a DUIK, a ProSe Validity Timer
and the PC5 radio technology that the UE is using. The DUIK parameter
shall be included in Discovery-Auth-Response only if the
Code-Receiving-Security-Material contains a MIC Check Indicator set to
MIC\_CHECK\_BY\_PROSE\_FUNCTION.

When the Discovery-Type is set to
\"DISCOVERER\_REQUEST\_FOR\_RESTRICTED\_PROSE\_DIRECT\_DISCOVERY\", the
Discovery-Auth-Response shall contain a ProSe Query Code, a Code Sending
Security Material, a ProSe Response Code, a Code Receiving Security
Material, optionally a DUIK, a ProSe Validity Timer and the PC5 radio
technology that the UE is using. The DUIK parameter shall be included in
Discovery-Auth-Response only if the Code-Receiving-Security-Material
contains a MIC Check Indicator set to MIC\_CHECK\_BY\_PROSE\_FUNCTION.

### 6.3.55 Match-Request 

The Match-Request is of type Grouped. It shall contain the information
elements used in ProSe Match Report request.

The AVP format shall conform to:

Match-Request ::= \<AVP header: 3856 10415\>

> { Discovery-Type }
>
> \[ User Identity \]
>
> \[ Visited-PLMN-ID \]
>
> \*\[ ProSe-App-Code-Info \]
>
> \[ PC5-tech \]
>
> \*\[AVP\]

The valid value for Discovery-Type for Match-Report AVP is:
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\",

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Match-Request shall contain one UE Identity, one Visited PLMN ID, one or
more ProSe App Code Info and optionally the PC5 radio technology that
the UE is using.

### 6.3.56 Match-Report-Info 

The Match-Report-Info is of type Grouped. It shall contain the
information elements used in ProSe Match Report Info request.

The AVP format shall conform to:

Match-Report-Info ::= \<AVP header: 3857 10415\>

> { Discovery-Type }
>
> \[ User-Identity \]
>
> \*\[ ProSe-App-ID \]
>
> \*\[AVP\]

The valid value for Discovery-Type for Match-Report-Info AVP is:
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\",

When the Discovery-Type is set to
\"MONITORING\_REQUEST\_FOR\_OPEN\_PROSE\_DIRECT\_DISCOVERY\", the
Match-Report-Info shall contain one User Identity and one or more ProSe
Application IDs.

### 6.3.57 PMR-Flags

The PMR-Flags AVP is of type Unsigned32 and it shall contain a bit mask.
The meaning of the bits shall be as defined in table 6.3.57/1:

Table 6.3.57/1: PMR-Flags

  ---------------------------------------------------------------------------------------------------------------------------------------------- -------------------- -----------------------------------------------------------------------------------------------------------------
  Bit                                                                                                                                            Name                 Description
  0                                                                                                                                              Metadata Requested   This bit, when set, indicates that metadata information associated with the ProSe Application ID are requested.
  NOTE: Bits not defined in this table shall be cleared by the sending Prose Function and discarded by the receiving receiving ProSe function.                        
  ---------------------------------------------------------------------------------------------------------------------------------------------- -------------------- -----------------------------------------------------------------------------------------------------------------

### 6.3.58 ProSe-Application-Metadata

The ProSe-Application-Metadata AVP is of type UTF8String. This AVP shall
contain the metadata associated with the ProSe Application ID contained
in the Match Report. As defined in 3GPP TS 24.334 \[22\], the length and
contents of the metadata formatted as UTF8-encoded string are out of
scope of 3GPP.

### 6.3.59 Discovery-Entry-ID 

The Discovery-Entry-ID is of type Unsigned32. It shall contain the
discovery Entry ID used to identify the discovery entry in the UE
context related to the discovery authorization request in the requesting
ProSe Function.

### 6.3.60 ProSe-Metadata-Index-Mask

The ProSe-Metadata-Index-Mask AVP is of type OctetString. This AVP
contains a ProSe metadata index mask (see 3GPP TS 24.334 \[22\]).

### 6.3.61 App-Identifier 

The App-Identifier AVP is of type Grouped. It shall contain an OS ID and
OS Application ID name.

The AVP format shall conform to:

App-Identifier ::= \<AVP header: 3840 10415\>

> { OS-ID }
>
> { OS-App-ID }
>
> \*\[AVP\]

### 6.3.62 OS-ID 

The OS-ID AVP is of type OctetString. It shall contain an identifier of
the operating system as defined in clause 12.2.2.5 in
3GPP TS 24.334 \[22\].

### 6.3.63 OS-App-ID 

The OS-App-ID AVP is of type UTF8String. It shall contain an OS specific
application as defined in clause 12.2.2.5 in 3GPP TS 24.334 \[22\].

### 6.3.64 Requesting-RPAUID 

The Requesting-RPAUID AVP is of type UTF8String. This AVP contains an
identifier for restricted ProSe direct discovery that uniquely
identifies an application user originating a restricted ProSe direct
discovery request.

### 6.3.65 Target-RPAUID 

The Target-RPAUID AVP is of type UTF8String. This AVP contains an
identifier for restricted ProSe direct discovery that uniquely
identifies an application user targeted by a restricted ProSe direct
discovery request.

### 6.3.66 Target-PDUID 

The Target-PDUID AVP is of type OctetString. It shall contain the ProSe
Discovery UE ID which uniquely identifies the UE targeted by a
restricted ProSe direct discovery request.

### 6.3.67 ProSe-Restricted-Code 

The ProSe-Restricted-Code AVP is of type OctetString. This AVP contains
a ProSe Restricted Code (see 3GPP TS 23.003 \[4\]) which is associated
with a RPAUID.

### 6.3.68 ProSe-Restricted-Code-Suffix-Range 

The ProSe-Restricted-Code-Suffix-Range AVP is of type Grouped. It
contains a range of consecutive ProSe Restricted Code Suffixes that can
be appended to a ProSe Restricted Code Prefix. It shall contain a
Beginning Suffix and may contain an Ending Suffix. If the Ending Suffix
is not present, the only ProSe Restricted Code Suffix included in the
ProSe Restricted Code Suffix Range is equal to the Beginning Suffix.

The AVP format shall conform to:

ProSe-Restricted-Code-Suffix-Range ::= \<AVP header: 3847 10415\>

> { Beginning-Suffix}
>
> \[ Ending--Suffix \]
>
> \*\[AVP\]

Beginning Sufifx and Ending Suffix shall have the same length.

### 6.3.69 Beginning-Suffix 

The Beginning-Suffix AVP is of type OctetString. This AVP shall contain
the lowest ProSe Restricted Code Suffix in a consecutive sequence of
ProSe Restricted Code suffixes, or the lowest ProSe Application Code
Suffix in a consecutive sequence of ProSe Application Code Suffixes. The
format of ProSe Restricted Code Suffix or ProSe Application Code Suffix
is defined in 3GPP TS 23.003 \[4\]. The size of this suffix shall align
with octet boundary.

### 6.3.70 Ending-Suffix 

The Ending-Suffix AVP is of type OctetString. This AVP shall contain the
highest ProSe Restricted Code Suffix in a consecutive sequence of ProSe
Restricted Code suffixes or the highest ProSe Application Code Suffix in
a consecutive sequence of ProSe Application Code Suffixes. The format of
ProSe Restricted Code Suffix or ProSe Application Code Suffix is defined
in 3GPP TS 23.003 \[4\]. The size of this suffix shall align with octet
boundary.

### 6.3.71 Match-Timestamp

The Match-Timestamp AVP is of type Time and it shall contain the UTC
time identifying when the discovery match event occurred.

### 6.3.72 DRMP

The DRMP AVP is of type Enumerated and it is defined in
IETF RFC 7944 \[27\]. This AVP allows the Prose Function to indicate the
relative priority of Diameter messages. The DRMP AVP may be used to set
the DSCP marking for transport of the associated Diameter message.

### 6.3.73 Banned-RPAUID 

The Banned-RPAUID AVP is of type UTF8String. This AVP contains an
identifier for restricted ProSe direct discovery that uniquely
identifies an application user banned by a restricted ProSe direct
discovery request.

### 6.3.74 Banned-PDUID 

The Banned-PDUID AVP is of type OctetString. It shall contain the ProSe
Discovery UE ID which uniquely identifies the UE Banned by a restricted
ProSe direct discovery request.

### 6.3.75 Code-Receiving-Security-Material 

The Code-Receiving-Security-Material AVP is of type Grouped. It shall
contain security parameters used to indicate to a UE how a received
restricted ProSe direct discovery message is protected. The Code
Receiving Security Material may contain a DUSK and may contain either a
DUIK or an indication whether to use Match Reports for MIC checking. It
may also contain both a DUCK and a corresponding Encrypted Bitmask.

The AVP format shall conform to:

Code-Receiving-Security-Material ::= \<AVP header: 3847 10415\>

> \[ DUSK \]
>
> \[ DUIK \]
>
> \[ MIC-Check-Indicator \]
>
> \[ DUCK \]
>
> \[ Encrypted-Bitmask \]
>
> \*\[AVP\]

### 6.3.76 Code-Sending-Security-Material 

The Code-Sending-Security-Material AVP is of type Grouped. It shall
contain security parameters used to indicate to a UE how to protect the
transmission of restricted ProSe direct discovery message. The Code
Sending Security Material may contain a DUSK and may contain a DUIK. It
may also contain both a DUCK and a corresponding Encrypted Bitmask.

The AVP format shall conform to:

Code-Sending-Security-Material ::= \<AVP header: 3847 10415\>

> \[ DUSK \]
>
> \[ DUIK \]
>
> \[ DUCK \]
>
> \[ Encrypted-Bitmask \]
>
> \*\[AVP\]

### 6.3.77 DUSK 

The DUSK AVP is of type OctetString. It shall contain the Discovery User
Scrambling Key used to scramble or unscramble the restricted ProSe
direct discovery message containing the ProSe Restricted Code, ProSe
Query Code or ProSe Response Code. The format of the DUSK is defined in
3GPP TS 33.303 \[23\].

### 6.3.78 DUIK 

The DUIK AVP is of type OctetString. It shall contain the Discovery User
Integrity Key used to compute the MIC of the restricted ProSe direct
discovery message containing the ProSe Restricted Code, ProSe Query Code
or ProSe Response Code. The format of the DUIK is defined in
3GPP TS 33.303 \[23\].

### 6.3.79 DUCK 

The DUCK AVP is of type OctetString. It shall contain the Discovery User
Confidentiality Key used to encrypt and decrypt a portion in restricted
ProSe direct discovery message.The format of the DUCK is defined in
3GPP TS 33.303 \[23\].

### 6.3.80 MIC-Check-Indicator 

The MIC-Check-Indicator AVP is of type Unsigned32. It shall contain the
indication of whether the UE shall use the ProSe Function to verify the
MIC field of the received discovery message. The following values are
defined:

MIC\_CHECK\_BY\_PROSE\_FUNCTION (1)

This value is used when the MIC check is required to be done by the
ProSe Function.

### 6.3.81 Encrypted-Bitmask 

The Encrypted-Bitmask AVP is of type OctetString. It shall contain a
184-bit bitmask which uses bit \"1\" to mark the positions of the bits
of a ProSe Restricted Code, ProSe Query Code or ProSe Response Code, for
which the DUCK encryption is applied.

### 6.3.82 ProSe-App-Code-Suffix-Range 

The ProSe-App-Code-Suffix-Range AVP is of type Grouped. It contains a
range of consecutive ProSe Application Code Suffixes that can be
appended to a ProSe Application Code Prefix. It shall contain a
Beginning Suffix and may contain an Ending Suffix. If the Ending Suffix
is not present, the only ProSe Application Code Suffix included in the
ProSe Application Code Suffix Range is equal to the Beginning Suffix.

The AVP format shall conform to:

ProSe-App-Code-Suffix-Range ::= \<AVP header: 3847 10415\>

> { Beginning-Suffix }
>
> \[ Ending--Suffix \]
>
> \*\[AVP\]

Beginning Suffix and Ending Suffix shall have the same length.

### 6.3.83 Load

The Load AVP is of type Grouped and it is defined in
IETF RFC 8583 \[28\]. This AVP is used to support Diameter load control
mechanism, see Annex D for more information.

### 6.3.84 PC5-tech 

The PC5-tech AVP is of type OctetString. It shall contain an identifier
of the PC5 radio technology as defined in clause 12.2.2.71 in
3GPP TS 24.334 \[22\].

6.4 Result-Code and Experimental-Result Values
----------------------------------------------

### 6.4.1 General

This clause defines result code values that shall be supported by all
Diameter implementations that conform to this specification.

### 6.4.2 Success

Result codes that fall within the Success category shall be used to
inform a peer that a request has been successfully completed. The
Result-Code AVP values defined in the Diameter base protocol
(IETF RFC 6733 \[29\]) shall be applied.

### 6.4.3 Permanent Failures

Errors that fall within the Permanent Failures category shall be used to
inform the peer that the request has failed, and should not be attempted
again. The Result-Code AVP values defined in the Diameter base protocol
(IETF RFC 6733 \[29\]) shall be applied. When one of the result codes
defined here is included in a response, it shall be inside an
Experimental-Result AVP and the Result-Code AVP shall be absent.

#### 6.4.3.1 DIAMETER\_ERROR\_USER\_UNKNOWN (5001)

This result code shall be sent by the ProSe Function in the HPLMN to
indicate that the user identified by the UE identity is unknown

#### 6.4.3.2 DIAMETER\_ERROR\_UNAUTHORIZED\_SERVICE (5511)

This result code shall be sent by the ProSe Function in the HPLMN to
indicate that no ProSe subscription is associated with the UE.

#### 6.4.3.3 DIAMETER\_ERROR\_NO\_ASSOCIATED\_DISCOVERY\_FILTER (5630)

This result code shall be sent by the ProSe Function in the
local/visited PLMN to indicate that there is no valid Discovery Filter
associated to the ProSe Application ID name received in the request.

#### 6.4.3.4 DIAMETER\_ERROR\_ANNOUNCING\_UNAUTHORIZED\_IN\_PLMN (5631)

This result code shall be sent by the ProSe Function in the
local/visited PLMN to indicate that the UE is not authorized to announce
in this PLMN.

#### 6.4.3.5 DIAMETER\_ERROR\_INVALID\_APPLICATION\_CODE (5632)

This result code shall be sent by the ProSe Function in the local PLMN
to indicate that none of the ProSe Application Code(s) received in the
request is valid.

#### 6.4.3.6 DIAMETER\_ERROR\_PROXIMITY\_UNAUTHORIZED (5633)

This result code shall be sent by the ProSe Function in the serving PLMN
to indicate that the Proximity request is not authorized by the user.

#### 6.4.3.7 DIAMETER\_ERROR\_PROXIMITY\_REJECTED (5634)

This result code shall be sent by the ProSe Function in the serving PLMN
to indicate that it is unlikely that UEs enter into proximity for the
received time window.

#### 6.4.3.8 DIAMETER\_ERROR\_NO\_PROXIMITY\_REQUEST (5635)

This result code shall be sent by the ProSe Function in the serving PLMN
to indicate that there is no context associated with EPC ProSe User
Identities included in the request.

#### 6.4.3.9 DIAMETER\_ERROR\_UNAUTHORIZED\_SERVICE\_IN\_THIS\_PLMN (5636)

This result code shall be sent by the ProSe Function HPLMN to indicate
that ProSe is not authorized to announce in this PLMN.

#### 6.4.3.10 DIAMETER\_ERROR\_PROXIMITY\_CANCELLED (5637)

This result code shall be sent by the ProSe Function triggering the
Proximity Request to indicate that the cancellation of the Proximity
Request procedure as it determines that the UEs are unlikely to enter
proximity within the requested time window.

#### 6.4.3.11 DIAMETER\_ERROR\_INVALID\_DISCOVERY\_TYPE (5641)

This result code shall be sent by the ProSe Function to indicate that
the Discovery Tpe in the request message is not supported.

#### 6.4.3.12 DIAMETER\_ERROR\_INVALID\_TARGET\_PDUID (5638)

This result code shall be sent by the ProSe Function to indicate that
the PDUID is not belonging to this ProSe Function.

#### 6.4.3.13 DIAMETER\_ERROR\_INVALID\_TARGET\_RPAUID (5639)

This result code shall be sent by the ProSe Function to indicate that
the target RPAUID is not allowed to be discovered.

#### 6.4.3.14 DIAMETER\_ERROR\_NO\_ASSOCIATED\_RESTRICTED\_CODE (5640)

This result code shall be sent by the ProSe Function to indicate that
the there is no allocated ProSe Restricted Code for the requested
target.

#### 6.4.3.15 DIAMETER\_ERROR\_REVOCATION\_FAILURE (56x1)

This value is used to indicate that the ProSe Function was unable to
successfully complete the revocation procedure (in an
operator-configured time period).

#### 6.4.3.16 DIAMETER\_ERROR\_ALREADY\_BANNED (56x2)

This value is used to indicate that the ProSe Function has determined
that the revocation is not necessary because the target RPAUID has
already been banned for discovery.

### 6.4.4 Transient Failures

Result codes that fall within the transient failures category shall be
used to inform a peer that the request could not be satisfied at the
time it was received, but may be able to satisfy the request in the
future. The Result-Code AVP values defined in the Diameter base protocol
specified in IETF RFC 6733 \[29\] shall be applied. When one of the
result codes defined here is included in a response, it shall be inside
an Experimental-Result AVP and the Result-Code AVP shall be absent.

######## Annex A (normative): Diameter overload control mechanism

A.1 General
-----------

Diameter overload control mechanism is an optional feature.

IETF RFC 7683 \[21\] specifies a Diameter overload control mechanism
which includes the definition and the transfer of related AVPs between
Diameter nodes.

It is recommended to make use of IETF RFC 7683 \[21\] on the PC6/PC7
interface where, when applied, the requesting ProSe Function shall
behave as a reacting node and the responding ProSe Function as a
reporting node.

A.2 Responding ProSe Function behaviour
---------------------------------------

The responding ProSe Function requests traffic reduction from requesting
ProSe Function when it is in an overload situation, including OC-OLR AVP
in answer commands as described in IETF RFC 7683 \[21\].

The ProSe Function identifies that it is in an overload situation by
implementation specific means. For example, the ProSe Function may take
into account the traffic over the PC6/PC7 interfaces or other
interfaces, the level of usage of internal resources (CPU, memory), the
access to external resources, etc.

The ProSe Function determines the specific contents of OC-OLR AVP in
overload reports and the ProSe Function decides when to send OC-OLR AVPs
by implementation specific means.

A.3 Requesting ProSe Function behaviour
---------------------------------------

The requesting ProSe Function applies required traffic reduction
received in answer commands to subsequent applicable requests, as per
IETF RFC 7683 \[21\].

Requested traffic reduction is achieved by the requesting ProSe Function
by implementation specific means. For example, it may implement message
throttling with prioritization or a message retaining mechanism for
operations that can be postponed.

As a result of the need to throttle traffic, the requesting ProSe
Function may reject Registration Request, Discovery Request, Match
Report Requests initiated by UEs. The possible related error messages
used over PC3 are described in the 3GPP TS 24.334 \[22\].

######## Annex B (Informative): Diameter overload node behaviour

B.1 Message prioritization 
--------------------------

This clause describes possible behaviours of the requesting ProSe
Function receiving an overload indication from the responding ProSe
Function, regarding message prioritisation in an informative purpose.

The requesting ProSe Function may take the following into account when
making throttling decisions:

\- Identification of the procedures that can be deferred (e.g. Proximity
Requests), so to avoid to drop non deferrable procedures;

\- Prioritisation of certain types of request (e.g. between
ProSe-Proximity-Request (PRR) and ProSe-Location-Update-Request (PLR))
according to the context of their use, in particular:

\- Higher prioritisation for commands that are related to a registered
user for a service, so to avoid the interruption of the registered
service for the user.

######## Annex C (normative):** **Diameter message priority mechanism

C.1 General
-----------

IETF RFC 7944 \[27\] specifies a Diameter routing message priority
mechanism that allows Diameter nodes to indicate the relative priority
of Diameter messages. With this information, other Diameter nodes may
leverage the relative priority of Diameter messages into routing,
resource allocation, set the DSCP marking for transport of the
associated Diameter message, and also abatement decisions when overload
control is applied.

C.2 PC6/PC7 interfaces
----------------------

### C.2.1 General 

The Diameter message priority mechanism is an optional feature.

It is recommended to make use of IETF RFC 7944 \[27\] over the PC6/PC7
interfaces of an operator network when the overload control defined in
Annex A is applied on these PC6/7 interfaces.

### C.2.2 ProSe Function behaviour

When the ProSe Function supports the Diameter message priority mechanism
over the PC6 or the PC7 interface, the ProSe Function shall comply with
IETF RFC 7944 \[27\].

The ProSe Function sending a request shall determine the required
priority according to its policies. When priority is required, the ProSe
Function shall include the DRMP AVP indicating the required priority
level in the requests it sends, and shall prioritise the request
according to the required priority level.

When the ProSe Function receives the corresponding response, it shall
prioritise the received response according to the priority level
received within the DRMP AVP if present in the response, otherwise
according to the priority level of the corresponding request.

When the ProSe Function receives a request, it shall handle the request
according to the received DRMP AVP priority level. For the response, the
ProSe Function may modify the priority level received in the DRMP AVP
according to its policies and shall handle the response according to the
required priority level. If the required priority level is different
from the priority level received in the request, it shall include the
DRMP AVP in the response.

If:

\- the ProSe Function supports using the Diameter message priority
mechanism for DSCP marking purposes,

\- the transport network utilizes DSCP marking, and

\- message-dependant DSCP marking is possible for the protocol stack
transporting Diameter,

then the ProSe Function shall set the DSCP marking for transport of the
request or response according to the required priority level.

The ProSe Function decisions for a required priority and for the
priority level value are implementation specific.

Diameter requests related to high priority traffic shall contain a DRMP
AVP with a high priority of which the level value is operator dependent.

######## Annex D (normative): Diameter load control mechanism

D.1 General
-----------

Diameter load control mechanism is an optional feature.

IETF RFC 8583 \[28\] specifies a Diameter load control mechanism which
includes the definition and the transfer of related AVPs between
Diameter nodes.

It is recommended to make use of IETF RFC 8583 \[28\] on the PC6/PC7
interface where, when applied, the requesting ProSe Function shall
behave as a reacting node and the responding ProSe Function as a
reporting node.

D.2 Responding ProSe Function behaviour
---------------------------------------

The responding ProSe Function may report its current load by including a
Load AVP of type HOST in answer commands as described in
IETF RFC 8583 \[28\].

The responding ProSe Function calculates its current load by
implementation specific means. For example, the responding ProSe
Function may take into account the traffic over the PC6/PC7 interface or
other interfaces, the level of usage of internal resources (e.g. CPU,
memory), the access to external resources, etc.

The responding ProSe Function determines when to send Load AVPs of type
HOST by implementation specific means.

D.3 Requesting ProSe Function behaviour
---------------------------------------

When performing next hop Diameter Agent selection for requests that are
routed based on realm, the requesting ProSe Function may take into
account load values from Load AVPs of type PEER received from candidate
next hop Diameter nodes, as per IETF RFC 8583 \[28\].

######## Annex E (informative): Change history

  ----------- ------------ -------------- -------- --------- --------------------------------------------------------------------------------------------------------------------------------- ----------
  **Date**    **TSG \#**   **TSG Doc.**   **CR**   **Rev**   **Subject/Comment**                                                                                                               **New**
  2014-04     CT4\#64bis   C4-140705                         TR Skeleton                                                                                                                       0.1.0
  2014-05     CT4\#65      C4-141079                         Proposed text for clause \"Scope\"                                                                                                0.2.0
  2014-05     CT4\#65      C4-141080                         General Description of TS 29.345                                                                                                  0.2.0
  2014-05     CT4\#65      C4-141081                         Description of the ProSe Service Authorization Procedure                                                                          0.2.0
  2014-05     CT4\#65      C4-141082                         Description of the Direct Discovery Authorization procedure                                                                       0.2.0
  2014-05     CT4\#65      C4-141084                         Description of the Match Report Procedure                                                                                         0.2.0
  2014-05     CT4\#65      C4-141086                         Description of the Proximity request Procedure                                                                                    0.2.0
  2014-05     CT4\#65      C4-141087                         Description of the Location Update procedure                                                                                      0.2.0
  2014-05     CT4\#65      C4-141088                         Description of the Cancellation procedure                                                                                         0.2.0
  2014-05     CT4\#65      C4-141089                         Description of Protocol Specification and Implementation                                                                          0.2.0
  2014-05     CT4\#65      C4-141090                         Description of the Proximity Alert Procedure                                                                                      0.2.0
  2014-05     CT4\#65      C4-141091                         Description of Information Elements                                                                                               0.2.0
  2014-05     CT4\#65      C4-141092                         Description of Commands                                                                                                           0.2.0
  2014-05     CT4\#65      C4-141175                         Description of Result Codes                                                                                                       0.2.0
  2014-07     CT4\#66      C4-141266                         Editorial corrections                                                                                                             0.3.0
  2014-07     CT4\#66      C4-141422                         Removal of the Cancellation-Type AVP                                                                                              0.3.0
  2014-07     CT4\#66      C4-141423                         Domain Name used for ProSe related Diameter Applications                                                                          0.3.0
  2014-07     CT4\#66      C4-141511                         Description of the Match Report Info procedure                                                                                    0.3.0
  2014-07     CT4\#66      C4-141512                         Correction of the User-Identifier AVP                                                                                             0.3.0
  2014-07     CT4\#66      C4-141641                         Correction of the Discovery-Filter AVP                                                                                            0.3.0
  *2014-09*   *CT\#65*     *CP-140498*                       *Presented for information and approval*                                                                                          *1.0.0*
  *2014-09*   *CT\#65*                                       *Approved at CT\#65*                                                                                                              *12.0.0*
  *2014-12*   *CT\#66*     *CP-140778*    *0006*   *1*       ProSe Validity Timer to VPLMN                                                                                                     *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    *0003*   *1*       *Overload Control management*                                                                                                     *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    0007     1         *Wrong P-CR implementations*                                                                                                      *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    0005               *Clarification in the ProSe Direct Discovery Authorization Procedure*                                                             *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    0001     4         *Clarification on ProSe Application Code and Discovery Filter IE Formats*                                                         *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    0009     1         *Deletion of the unused AVP*                                                                                                      *12.1.0*
  *2014-12*   *CT\#66*     *CP-140778*    0010     1         *Updates of the values for Application ID, Command codes, AVP codes and Experimental-Result codes*                                *12.1.0*
  *2015-03*   *CT\#67*     *CP-150028*    0012     2         *Correction on ProSe Service Authorization Procedures in PC6/PC7 interface*                                                       *12.2.0*
  *2015-03*   *CT\#67*     *CP-150028*    0014     2         *Addition of Integrity Check aspects to ProSe Match Report procedure*                                                             *12.2.0*
  *2015-03*   *CT\#67*     *CP-150028*    0016     1         *Correction in the Discovery Type description*                                                                                    *12.2.0*
  *2015-03*   *CT\#67*     *CP-150028*    0020     2         *Location Update Trigger*                                                                                                         *12.2.0*
  *2015-03*   *CT\#67*     *CP-150149*    0015     4         *Introduction of Authorized Discovery Range Indication for announcing UE*                                                         *12.2.0*
  *2015-03*   *CT\#67*     *CP-150031*    0021     1         *Update of the reference for IETF draft-ietf-dime-ovli*                                                                           *12.2.0*
  *2015-06*   *CT\#68*     *CP-150257*    0022     1         *Addition of Match Report Refresh Timer in PMA command*                                                                           *12.3.0*
  *2015-06*   *CT\#68*     *CP-150257*    0024     1         *Corrections of errors and inconsistencies in TS 29.345*                                                                          *12.3.0*
  *2015-06*   *CT\#68*     *CP-150257*    0025     2         *Ambiguity in the definition of Prose-Discovery-Filter AVP*                                                                       *12.3.0*
  *2015-06*   *CT\#68*     *CP-150257*    0027     2         *Clarification on ProSe Validity Timer*                                                                                           *12.3.0*
  *2015-06*   *CT\#68*     *CP-150257*    0028     2         *Alignment on using ProSe service and ProSe*                                                                                      *12.3.0*
  *2015-12*   *CT\#70*     *CP-150755*    0032     4         *Correction of AVP and message definitions to allow Diameter command reuse*                                                       *12.4.0*
  *2015-12*   *CT\#70*     *CP-150755*    0033     1         *Metadata in Match-Report*                                                                                                        *12.4.0*
  *2015-12*   *CT\#70*     *CP-150759*    0035     1         *Reference to DOIC updated with IETF RFC 7683*                                                                                    *12.4.0*
  *2015-12*   *CT\#70*     *CP-150772*    0029     5         *Addition of ProSe discovery service authorization for restricted discovery*                                                      *13.0.0*
  *2015-12*   *CT\#70*     *CP-150772*    0030     2         *ProSe Open Discovery for Dynamic Metadata*                                                                                       *13.0.0*
  *2015-12*   *CT\#70*     *CP-150772*    0031     2         *AVP and Message format changes for new ProSe procedures*                                                                         *13.0.0*
  *2015-12*   *CT\#70*     *CP-150772*    0034     2         *Addition of ProSe match report info for restricted discovery*                                                                    *13.0.0*
  *2016-03*   *CT\#71*     *CP-160023*    0041               *Diameter message priority over PC6/PC7*                                                                                          *13.1.0*
  *2016-03*   *CT\#71*     *CP-160036*    0036     3         *Monitoring update and Reporting of update result*                                                                                *13.1.0*
  *2016-03*   *CT\#71*     *CP-160036*    0037     1         *Inter-PLMN discovery transmission support*                                                                                       *13.1.0*
  *2016-03*   *CT\#71*     *CP-160036*    0038     1         *Adding security related parameters for restricted ProSe direct discovery authorization*                                          *13.1.0*
  *2016-03*   *CT\#71*     *CP-160036*    0039     1         *Support open discovery with application-controlled extension*                                                                    *13.1.0*
  *2016-03*   *CT\#71*     *CP-160036*    0040     \-        *Discovery update for open and restricted ProSe direct discovery*                                                                 *13.1.0*
  *2016-06*   *CT\#72*     *CP-160232*    0042     2         *Update of AVP codes for ProSe direct discovery security and open ProSe direct discovery with application-controlled extension*   *13.2.0*
  *2016-06*   *CT\#72*     *CP-160232*    0043     1         *Clarification of local PLMN usage in direct discovery authorization*                                                             *13.2.0*
  *2016-12*   *CT\#74*     *CP-160664*    0045     \-        *Correction to change IETF drmp draft version to official RFC 7944*                                                               *13.3.0*
  *2016-12*   *CT\#74*     *CP-160681*    0044     1         *Load Control*                                                                                                                    *14.0.0*
  *2017-03*   *CT\#75*     *CP-170048*    0046     1         *Update of reference for the Diameter base protocol*                                                                              *14.1.0*
  *2017-03*   *CT\#75*     *CP-170048*    0047     1         *Handling of the Vendor-Specific-Application-Id AVP*                                                                              *14.1.0*
  *2017-03*   *CT\#75*     *CP-170048*    0048     1         *Cardinality of the Failed-AVP AVP in answer*                                                                                     *14.1.0*
  *2017-06*   *CT\#76*     *CP-171018*    0050     1         *Support for signaling transport level packet marking*                                                                            *14.2.0*
  *2017-09*   *CT\#77*     *CP-172013*    0052     \-        *Correction of DRMP Procedures*                                                                                                   *14.3.0*
  *2017-12*   *CT\#78*     *CP-173032*    0053     1         *Updates for WLAN based ProSe Direct Discovery*                                                                                   *15.0.0*
  *2019-09*   *CT\#85*     *CP-192094*    0055     1         *draft-ietf-dime-load published as RFC 8583*                                                                                      *15.1.0*
  *2020-07*   *CT\#88e*    *-*            \-       \-        *Update to Rel-16 version (MCC)*                                                                                                  *16.0.0*
  ----------- ------------ -------------- -------- --------- --------------------------------------------------------------------------------------------------------------------------------- ----------
