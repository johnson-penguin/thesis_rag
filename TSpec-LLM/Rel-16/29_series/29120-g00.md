![](media/image1.jpeg){width="7.0875in" height="1.2131944444444445in"}

Contents {#contents .TT}
========

[7](#foreword)

[8](#scope)

[8](#references)

[8](#abbreviations)

[9](#the-entities-and-interfaces-within-the-mobile-network-utilising-the-glr)

[9](#the-entities-of-the-mobile-system)

[9](#the-interfaces-within-the-mobile-services)

[9](#overload-and-compatibility-overview)

[9](#overload-control-for-map-entities)

[9](#compatibility)

[10](#requirements-concerning-the-use-of-sccp-and-tc)

[10](#use-of-sccp)

[10](#sccp-class)

[10](#sub-system-number-ssn)

[10](#sccp-addressing)

[10](#introduction)

[10](#the-gateway-location-register-glr)

[10](#addressed-by-the-vlr)

[10](#addressed-by-the-hlr)

[11](#addressed-by-the-gmsc)

[11](#addressed-by-the-im-gsn)

[11](#the-intermediate-msc-im_msc)

[11](#addressed-by-the-gmsc-1)

[11](#addressed-by-the-gmlc)

[11](#the-intermediate-gsn-im_gsn)

[11](#summary-table)

[12](#use-of-tc)

[13](#general-on-map-services)

[13](#common-map-services)

[13](#map-u-abort-service)

[14](#mobility-services)

[14](#general)

[15](#location-management-services)

[15](#authentication-management-services)

[15](#subscriber-management-services)

[16](#fault-recovery-services)

[16](#subscriber-information-services)

[16](#operation-and-maintenance-services)

[16](#general-1)

[16](#map_send_imsi-service)

[17](#call-handling-services)

[17](#general-2)

[17](#map_provide_roaming_number-service)

[17](#map_set_reporting_state-service)

[17](#map_status_report-service)

[17](#map_remote_user_free-service)

[18](#supplementary-services-related-services)

[18](#general-3)

[18](#map_register_ss-service)

[18](#map_erase_ss-service)

[18](#map_activate_ss-service)

[18](#map_deactivate_ss-service)

[19](#map_-interrogate-_ss-service)

[19](#map_-register_password-service)

[19](#map_-get_password-service)

[19](#map_-process_unstructured_ss_request-service)

[20](#map_-unstructured_ss_request-service)

[20](#map_unstructured_ss_notify-service)

[20](#map_register_cc_entry-service)

[20](#map_erase_cc_entry-service)

[20](#short-message-service-management-services)

[20](#general-4)

[21](#map-ready-for-sm-service)

[21](#map-mt-forward-short-message-service)

[21](#network-requested-pdp-context-activation-services)

[21](#general-5)

[21](#map_send_routing_info_for_gprs-service)

[22](#map_failure_report-service)

[22](#void)

[22](#element-of-procedure)

[22](#sdl-descriptions)

[23](#mapping-onto-tc-services)

[24](#abstract-syntax-of-the-map-protocol)

[24](#general-6)

[24](#packages-specifications)

[25](#application-contexts)

[26](#general-on-map-user-procedure)

[27](#mobility-procedures)

[27](#location-management-procedures)

[29](#location-updating)

[29](#general-7)

[30](#detailed-procedure-in-the-glr)

[43](#location-cancellation)

[43](#general-8)

[44](#detailed-procedure-in-the-glr-1)

[49](#purge-ms)

[49](#general-9)

[49](#detailed-procedure-in-glr)

[54](#fault-recovery-procedures)

[54](#reset-procedure)

[54](#hlr-failure-case)

[54](#glr-failure-case)

[54](#detailed-procedure-in-glr-1)

[58](#vlr-restoration-the-restore-data-procedure-in-the-glr)

[58](#general-10)

[58](#detailed-procedure-in-glr-2)

[65](#operations-and-maintenance-procedures)

[65](#general-11)

[65](#subscriber-data-management-procedures)

[65](#general-12)

[67](#procedures-in-the-glr)

[67](#subscriber-deletion-procedure)

[67](#subscriber-data-modification-procedure)

[77](#subscriber-identity-procedure)

[78](#subscriber-identity-procedure-in-the-glr)

[81](#call-handling-procedures)

[81](#general-13)

[82](#retrieval-of-routing-information)

[82](#general-14)

[83](#process-in-the-glr-to-provide-a-roaming-number)

[86](#process-in-the-glr-to-provide-subscriber-information)

[89](#setting-of-reporting-state)

[89](#general-15)

[89](#process-in-the-glr-to-set-the-reporting-state)

[92](#status-reporting)

[92](#general-16)

[92](#process-in-the-glr-for-status-reporting)

[94](#remote-user-free)

[94](#general-17)

[95](#process-in-the-glr-for-remote-user-free)

[98](#supplementary-services-procedures)

[98](#functional-supplementary-service-processes)

[98](#functional-supplementary-service-process-co-ordinator-for-glr)

[100](#call-completion-supplementary-service-process-co-ordinator-for-glr)

[102](#registration-procedure)

[102](#general-18)

[103](#procedures-in-the-glr-1)

[105](#erasure-procedure)

[105](#general-19)

[106](#procedures-in-the-glr-2)

[106](#activation-procedure)

[106](#general-20)

[106](#procedures-in-the-glr-3)

[108](#deactivation-procedure)

[108](#general-21)

[109](#procedures-in-the-glr-4)

[109](#interrogation-procedure)

[109](#general-22)

[109](#procedures-in-the-glr-5)

[109](#password-registration-procedure)

[109](#general-23)

[109](#procedures-in-the-glr-6)

[109](#mobile-initiated-ussd-procedure)

[109](#procedures-in-the-glr-7)

[112](#network-initiated-ussd-procedure)

[112](#procedure-in-the-glr)

[116](#common-macros-for-clause-22)

[116](#ss-password-handling-macros)

[118](#activation-of-a-ccbs-request)

[118](#general-24)

[118](#procedure-in-the-glr-1)

[120](#deactivation-of-a-ccbs-request)

[120](#general-25)

[121](#procedure-in-the-glr-2)

[124](#short-message-service-procedures)

[124](#general-26)

[124](#the-mobile-terminated-short-message-transfer-procedure)

[124](#procedure-in-the-intermediate-msc)

[130](#procedure-in-the-glr-3)

[136](#the-short-message-alert-procedure)

[137](#procedures-in-the-glr-8)

[139](#gprs-process-description)

[139](#general-27)

[139](#send-routing-information-procedure)

[139](#process-in-the-glr-for-send-routing-information-for-gprs)

[140](#process-in-the-im-gsn-for-send-routing-information-for-gprs)

[143](#failure-report-procedure)

[143](#process-in-the-glr-for-failure-report)

[144](#process-in-the-im-gsn-for-failure-report)

[147](#general-macro-description)

[147](#map-open-macros)

[147](#macros-to-check-the-content-of-indication-and-confirmation-primitives)

[147](#authentication-processes)

[147](#process-obtain_authentication_sets_glr)

[149](#process-authentication_failure_report_glr)

[151](#short-message-alert-procedures)

[151](#subscriber_present_glr_as_vlr-process)

[154](#the-mobile-subscriber-is-present)

[156](#annex-a-informative-change-history)Foreword 1 Scope 2 References
3 Abbreviations 4 The entities and interfaces within the mobile network
utilising the GLR 4.1 The entities of the mobile system 4.2 The
Interfaces within the mobile services 5 Overload and compatibility
overview 5.1 Overload control for MAP entities 5.2 Compatibility 6
Requirements concerning the use of SCCP and TC 6.1 Use of SCCP 6.1.1
SCCP Class 6.1.2 Sub-System Number (SSN) 6.1.3 SCCP addressing 6.1.3.1
Introduction 6.1.3.2 The Gateway Location Register (GLR) 6.1.3.2.1
Addressed by the VLR 6.1.3.2.2 Addressed by the HLR 6.1.3.2.3 Addressed
by the GMSC 6.1.3.2.4 Addressed by the IM-GSN 6.1.3.3 The Intermediate
MSC (IM\_MSC) 6.1.3.3.1 Addressed by the GMSC 6.1.3.3.2 Addressed by the
GMLC 6.1.3.4 The Intermediate GSN (IM\_GSN) 6.1.3.5 Summary table 6.2
Use of TC 7 General on MAP services 7.1 Common MAP services 7.1.1
MAP-U-ABORT service 8 Mobility services 8.1 General 8.2 Location
Management services 8.3 Authentication Management services 8.4
Subscriber management services 8.5 Fault recovery services 8.6
Subscriber Information services 9 Operation and maintenance services 9.1
General 9.2 MAP\_SEND\_IMSI service 10 Call handling services 10.1
General 10.2 MAP\_PROVIDE\_ROAMING\_NUMBER service 10.3
MAP\_SET\_REPORTING\_STATE service 10.4 MAP\_STATUS\_REPORT service 10.5
MAP\_REMOTE\_USER\_FREE service 11 Supplementary services related
services 11.1 General 11.2 MAP\_REGISTER\_SS service 11.3 MAP\_ERASE\_SS
service 11.4 MAP\_ACTIVATE\_SS service 11.5 MAP\_DEACTIVATE\_SS service
11.6 MAP\_ INTERROGATE \_SS service 11.7 MAP\_ REGISTER\_PASSWORD
service 11.8 MAP\_ GET\_PASSWORD service 11.9 MAP\_
PROCESS\_UNSTRUCTURED\_SS\_REQUEST service 11.10 MAP\_
UNSTRUCTURED\_SS\_REQUEST service 11.11 MAP\_UNSTRUCTURED\_SS\_NOTIFY
service 11.12 MAP\_REGISTER\_CC\_ENTRY service 11.13
MAP\_ERASE\_CC\_ENTRY service 12 Short message service management
services 12.1 General 12.2 MAP-READY-FOR-SM service 12.3
MAP-MT-FORWARD-SHORT-MESSAGE service 13 Network-Requested PDP Context
Activation services 13.1 General 13.2
MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service 13.3 MAP\_FAILURE\_REPORT
service 14 Void 15 Element of procedure 15.1 SDL descriptions 16 Mapping
onto TC services 17 Abstract syntax of the MAP protocol 17.1 General
17.2 Packages specifications 17.3 Application contexts 18 General on MAP
user procedure 19 Mobility procedures 19.1 Location management
Procedures 19.1.1 Location updating 19.1.1.1 General 19.1.1.2 Detailed
procedure in the GLR 19.1.2 Location Cancellation 19.1.2.1 General
19.1.2.2 Detailed procedure in the GLR 19.1.3 Purge MS 19.1.3.1 General
19.1.3.2 Detailed procedure in GLR 19.2 Fault recovery procedures 19.2.1
RESET procedure 19.2.1.1 HLR failure case 19.2.1.2 GLR failure case
19.2.1.3 Detailed procedure in GLR 19.2.2 VLR restoration: the restore
data procedure in the GLR 19.2.2.1 General 19.2.2.2 Detailed procedure
in GLR 20 Operations and maintenance procedures 20.1 General 20.2
Subscriber data management procedures 20.2.1 General 20.2.2 Procedures
in the GLR 20.2.2.1 Subscriber deletion procedure 20.2.2.2 Subscriber
data modification procedure 20.3 Subscriber Identity procedure 20.3.1
Subscriber identity procedure in the GLR 21 Call handling procedures
21.1 General 21.2 Retrieval of routing information 21.2.1 General 21.2.2
Process in the GLR to provide a roaming number 21.2.3 Process in the GLR
to provide subscriber information 21.3 Setting of Reporting State 21.3.1
General 21.3.2 Process in the GLR to set the reporting state 21.4 Status
Reporting 21.4.1 General 21.4.2 Process in the GLR for Status Reporting
21.5 Remote User Free 21.5.1 General 21.5.2 Process in the GLR for
Remote User Free 22 Supplementary services procedures 22.1 Functional
supplementary service processes 22.1.1 Functional supplementary service
process co-ordinator for GLR 22.1.2 Call completion supplementary
service process co-ordinator for GLR 22.2 Registration procedure 22.2.1
General 22.2.2 Procedures in the GLR 22.3 Erasure procedure 22.3.1
General 22.3.2 Procedures in the GLR 22.4 Activation procedure 22.4.1
General 22.4.2 Procedures in the GLR 22.5 Deactivation procedure 22.5.1
General 22.5.2 Procedures in the GLR 22.6 Interrogation procedure 22.6.1
General 22.6.2 Procedures in the GLR 22.7 Password registration
procedure 22.7.1 General 22.7.2 Procedures in the GLR 22.8 Mobile
Initiated USSD procedure 22.8.1 Procedures in the GLR 22.9 Network
initiated USSD procedure 22.9.1 Procedure in the GLR 22.10 Common macros
for clause 22 22.10.1 SS Password handling macros 22.11 Activation of a
CCBS request 22.11.1 General 22.11.2 Procedure in the GLR 22.12
Deactivation of a CCBS request 22.12.1 General 22.12.2 Procedure in the
GLR 23 Short message service procedures 23.1 General 23.2 The mobile
terminated short message transfer procedure 23.2.1 Procedure in the
Intermediate MSC 23.2.2 Procedure in the GLR 23.3 The Short Message
Alert procedure 23.3.1 Procedures in the GLR 24 GPRS process description
24.1 General 24.2 Send Routing Information procedure 24.2.1 Process in
the GLR for Send Routing Information for GPRS 24.2.2 Process in the
IM-GSN for Send Routing Information for GPRS 24.3 Failure Report
procedure 24.3.1 Process in the GLR for Failure Report 24.3.2 Process in
the IM-GSN for Failure Report 25 General macro description 25.1 MAP open
macros 25.2 Macros to check the content of indication and confirmation
primitives 25.3 Authentication processes 25.3.1 Process
Obtain\_Authentication\_Sets\_GLR 25.3.2 Process
Authentication\_Failure\_Report\_GLR 25.4 Short Message Alert procedures
25.4.1 Subscriber\_Present\_GLR\_AS\_VLR process 25.4.2 The Mobile
Subscriber is present Annex A (informative): Change history

Foreword
========

This Technical Specification (TS) has been produced by the 3^rd^
Generation Partnership Project (3GPP).

The present document specifies the signalling requirements and
procedures used at network elements related to the Gateway Location
Register (GLR) for Mobile Application Part (MAP) within the 3GPP system.
(i.e. the present document specifies the delta against 3GPP TS 29.002.)

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document describes the signalling requirements and
procedures used at network elements related to the GLR for MAP within
the 3GPP system at the application level.

The present document gives the description of the systems needed only in
the network utilising GLR as the delta document against 3GPP TS 29.002.

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies.

\[1\] 3GPP TS 23.003: \"Numbering, addressing and identification\".

\[2\] 3GPP TS 23.007: \"Restoration procedures\".

\[3\] 3GPP TS 23.012: \"Location registration procedures\".

\[4\] 3GPP TS 23.040: \"Technical realization of the Short Message
Service (SMS) Point to Point (PP)\".

> \[5\] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
>
> \[6\] 3GPP TS 23.119: \"Gateway Location Register (GLR) - stage2\".

3 Abbreviations
===============

For the purposes of the present document, the following abbreviations
apply:

CCBS Completion of Call to Busy Subscriber\
GLR Gateway Location Register\
GPRS General Packet Radio Service\
IM\_GSN Intermediate GSN\
IM\_MSC Intermediate MSC\
SGSN Serving GPRS support node\
GGSN Gateway GPRS support node

4 The entities and interfaces within the mobile network utilising the GLR
=========================================================================

4.1 The entities of the mobile system
-------------------------------------

The functional entities related to the GLR are described below. The
description of each entity is detailed in 3GPP TS 23.119 (GLR stage2
specification). The other functional entities described in the present
document (e.g. MSC, VLR, and HLR) are specified in 3GPP TS 29.002.

\- The Gateway location Register (GLR).

\- The Intermediate MSC (IM-MSC).

\- The Intermediate GSN (IM-GSN).

4.2 The Interfaces within the mobile services
---------------------------------------------

The Interfaces related to the GLR are described below. The description
of each interface is detailed in 3GPP TS 23.119 (GLR stage2
specification).

\- Interface between the HLR and the GLR.

\- Interface between the VLR and the GLR.

\- Interface between the MSC and the IM\_MSC.

\- Interface between the SGSN and the GLR.

\- Interface between the MSC and the GLR.

\- Interface between the GLR and the IM\_GSN.

5 Overload and compatibility overview
=====================================

5.1 Overload control for MAP entities
-------------------------------------

The VLR and SGSN see the GLR as an HLR, and the HLR sees the GLR as a
VLR or a SGSN. Therefore the GLR shall behave like mobile entity as
which the GLR is regarded. If overload of the GLR is detected, the
responder may ignore requests for certain MAP operations (see tables
5.1/1, 5.1/2 and 5.1/3 in 3GPP TS 29.002). The decision as to which MAP
Operations may be ignored is made by the MAP service provider and is
based upon the priority of the application context.

5.2 Compatibility
-----------------

A version negotiation mechanism based on the use of an
application-context-name is used to negotiate the protocol version used
between two entities for supporting a MAP-user signalling procedure. The
description of the version negotiation mechanism is detailed in 3GPP TS
29.002.

6 Requirements concerning the use of SCCP and TC
================================================

6.1 Use of SCCP
---------------

The Mobile Application Part makes use of the services offered by the
Signalling Connection Control Part of signalling System No. 7. CCITT
Blue Book or ITU‑T (03/93) Recommendations Q.711 to Q.716 should be
consulted for the full specification of SCCP. In North America (World
Zone 1) the national version of SCCP is used as specified in ANSI
T1.112.

### 6.1.1 SCCP Class

MAP will only make use of the connectionless classes (0 or 1) of the
SCCP.

### 6.1.2 Sub-System Number (SSN)

The Application Entities (AEs) defined for MAP consist of several
Application Service Elements (ASEs) and are addressed by sub-system
numbers (SSNs). The SSN for MAP are specified in 3GPP TS 23.003 \[1\].
The specific SSN is not needed for the GLR, IM\_MSC, and IM\_GSN.

### 6.1.3 SCCP addressing

#### 6.1.3.1 Introduction

The format and coding of address parameters carried by SCCP are detailed
in 3GPP TS 29.002.

The following subclauses describe the method of SCCP addressing
appropriate for each entity both for the simple intra-PLMN case and
where an inter-PLMN communication is required. The following entities
are considered for the GLR additionally:

\- the Gateway location Register (GLR);

\- the Intermediate Mobile-services Switching Centre (IM\_MSC);

\- the Intermediate GPRS Support Node (IM\_GSN).

#### 6.1.3.2 The Gateway Location Register (GLR)

##### 6.1.3.2.1 Addressed by the VLR

In the network utilising the GLR, when an MS that belongs to other PLMN
registers in a VLR/SGSN, the VLR/SGSN sees the GLR as the MS\'s HLR.
When initiating the update location dialogues, the VLR is able to
address the GLR based on the SPC of the GLR because of intra-PLMN
signalling. And the VLR can address the GLR based on an E.214 Mobile
Global Title originally derived by the VLR from the IMSI (when CCITT or
ITU-T SCCP is used), or an E.212 number originally derived from IMSI
(when ANSI SCCP is used, an IMSI). When answering with Global Title to
the VLR, the GLR shall insert its E.164 address in the Calling Party
Address of the SCCP message containing the first responding CONTINUE
message. After that, the VLR can address the GLR based on an E.164 GLR
address.

##### 6.1.3.2.2 Addressed by the HLR

When a location updating dialogue initiated by a GLR has been
successfully completed, the HLR sees the GLR as the VLR. When initiating
dialogues towards the VLR, the routeing information used by the HLR is
derived from the E.164 VLR number received as a parameter of the MAP
message initiating the update location dialogue, but in reality the HLR
addresses the GLR using the VLR number.

##### 6.1.3.2.3 Addressed by the GMSC

In the case that the MS is served by the SGSN in the network utilising
the GLR, the GMSC sees the GLR as the SGSN. When the GMSC initiates
dialogues towards the SGSN the SGSN (MAP) SSN (See 3GPP TS 23.003) shall
be included in the called party address. The routeing information used
by the GMSC is derived from the E.164 SGSN number received as a
parameter of the MAP message initiating the forward short message
procedure. But in reality the GMSC addresses the GLR using the SGSN
number.

##### 6.1.3.2.4 Addressed by the IM-GSN

In the network utilising the GLR, the IM-GSN initiates the GPRS location
information retrieval to the GLR. The IM-GSN must have the value of the
GLR address beforehand.

#### 6.1.3.3 The Intermediate MSC (IM\_MSC)

##### 6.1.3.3.1 Addressed by the GMSC

When a short message for CS has to be routed to an MS, the GMSC
addresses the MSC by an MSC identity received from the HLR that complies
with E.164 rules. But in reality the GMSC addresses the IM-MSC in the
network utilising the GLR.

##### 6.1.3.3.2 Addressed by the GMLC

When a location request for a particular MS needs to be sent to the
MS\'s VMSC, the GMLC addresses the MSC using an E.164 address received
from the MS\'s HLR. But in reality the GMLC addresses the IM-MSC in the
network utilising the GLR.

#### 6.1.3.4 The Intermediate GSN (IM\_GSN)

The IM-GSN provides routing of the Network-Requested PDP Context
activation. If a Network-Requested PDP Context activation fails, the GLR
will alert the IM-GSN when the subscriber becomes reachable. The GLR
will use the E.164 IM-GSN number received as parameter of the MAP
message reporting the failure.

#### 6.1.3.5 Summary table

The following table summarises the SCCP address used for invoke
operations. As a principle, within a PLMN either an SPC or a GT may be
used (network operation option), whereas when addressing an entity
outside the PLMN the GT must be used. The address type mentioned in the
table (e.g. MSISDN) is used as GT or to derive the SPC.

For a response, the originating address passed in the invoke message is
used as SCCP Called Party Address. For extra‑PLMN addressing the own
E.164 entity address is used as SCCP Calling Party Address; for
intra-PLMN addressing an SPC derived from the entity number may be used
instead. When using an SPC, the SPC may be taken directly from MTP.

Table 6.1.3/1

<table>
<tbody>
<tr class="odd">
<td><p>to</p>
<p>from</p></td>
<td>fixed net work</td>
<td>HLR</td>
<td>VLR</td>
<td>MSC</td>
<td><strong>SGSN</strong></td>
<td><strong>GGSN</strong></td>
<td><strong>GLR</strong></td>
<td><strong>IM-MSC</strong></td>
<td><strong>IM-GSN</strong></td>
</tr>
<tr class="even">
<td><strong>fixed network</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>home location register</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>I:SPC/GT</p>
<p>E:GT</p>
<p>T:VLR NUMBER</p></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>visitor location register</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>I:SPC/GT</p>
<p>E:GT</p>
<p>T:MGT</p>
<p>(outside World Zone 1)/MSISDN</p>
<p>(World Zone 1/)HLR NUMBER</p>
<p>(note)</p></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>mobile-services switching centre</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>E:GT</p>
<p>T:SGSN NUMBER</p></td>
<td><p>I:SPC/GT</p>
<p>E:GT</p>
<p>T:MSC NUMBER</p></td>
<td></td>
</tr>
<tr class="even">
<td><p><strong>Serving</strong></p>
<p><strong>GPRS</strong></p>
<p><strong>Support</strong></p>
<p><strong>Node</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>I:SPC/GT</p>
<p>T:MGT/MSISDN/HLR NUMBER</p></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><p><strong>Gateway</strong></p>
<p><strong>GPRS</strong></p>
<p><strong>Support</strong></p>
<p><strong>Node</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Note1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><p><strong>Gateway</strong></p>
<p><strong>Location</strong></p>
<p><strong>register</strong></p></td>
<td>---</td>
<td><p>E:GT</p>
<p>T:MGT</p>
<p>(outside</p>
<p>World Zone1)/MSISDN(World Zone1/)</p>
<p>HLR NUMBER</p>
<p>(note)</p></td>
<td><p>I:SPC/GT</p>
<p>T:VLR</p>
<p>NUMBER</p></td>
<td>---</td>
<td><p>I:SPC/GT</p>
<p>T:SGSN</p>
<p>NUMBER</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><p><strong>Intermediate-</strong></p>
<p><strong>MSC</strong></p></td>
<td>---</td>
<td></td>
<td></td>
<td><p>I:SPC/GT</p>
<p>T:MSC NUMBER</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><p><strong>Intermediate-</strong></p>
<p><strong>GSN</strong></p></td>
<td>---</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>I:SPC/GT</p>
<p>T:HLR</p>
<p>NUMBER</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

I: Intra-PLMN E: Extra (Inter)-PLMN T: Address Type\
GT: Global Title MGT: E.214 Mobile Global Title SPC: Signalling Point
Code

NOTE 0: For initiating the location updating procedure and an
authentication information retrieval from the HLR preceding it, the VLR
has to derive the HLR address from the IMSI of the MS. The result can be
an SPC or an E.214 Mobile Global Title if CCITT or ITU-T SCCP is used,
or IMSI itself if ANSI SCCP is used (ANSI SCCP is used in World Zone 1).
When continuing the established update location dialogue (as with any
other dialogue) the VLR must derive the routeing information towards the
HLR from the Calling Party Address received with the first responding
CONTINUE message until the dialogue terminating message is received.

For transactions invoked by the VLR after update location completion,
the VLR may derive the information for addressing the HLR from addresses
received in the course of the update location procedure (MSISDN or HLR
number) or from the IMSI.

When invoking the Restore Data procedure and an authentication
information retrieval from the HLR preceding it, the VLR must derive the
information for addressing the HLR from the address information received
in association with the roaming number request. This may be either the
IMSI received as a parameter of the MAP message requesting the Roaming
Number or the Calling Party Address associated with the MAP message
requesting the Roaming Number.

> From VLR in, GLR as for T (address type) only HLR Number is used. VLR
> and HLR are because only the thing that is belonging to same PLMN is
> thought.

NOTE1: The hatching part is the same part of 3GPP TS29.002.

6.2 Use of TC
-------------

Refer to the corresponding section in 3GPP TS 29.002.

7 General on MAP services
=========================

Refer to the corresponding section in 3GPP TS 29.002 with the exceptions
described below.

7.1 Common MAP services
-----------------------

The following common services are used:

\- MAP-OPEN service;

\- MAP-CLOSE service;

\- MAP-DELIMITER service;

\- MAP-U-ABORT service;

\- MAP-P-ABORT service;

\- MAP-NOTICE service;

> \- MAP-SECURE-TRANSPORT-CLASS-1 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-2 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-3 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-4 service.

Replace the MAP-U-ABORT service as follows.

### 7.1.1 MAP-U-ABORT service

This service enables the service-user to request the MAP dialogue to be
aborted. The service is an unconfirmed service with service-primitives
as shown in table 7.1/1. MAP service-user in the GLR may set
\"application context not supported\" as user reason.

Table 7.1/1: Service-primitives for the MAP-U-ABORT service

  ------------------------ --------- ------------
  Parameters               Request   Indication
  User reason              M         M(=)
  Diagnostic information   U         C(=)
  Specific information     U         C(=)
  ------------------------ --------- ------------

[User reason]{.underline}:

This parameter can take the following values:

\- resource limitation (congestion);

the requested user resource is unavailable due to congestion;

\- resource unavailable;

the requested user resource is unavailable for reasons other than
congestion;

\- application procedure cancellation;

the procedure is cancelled for reason detailed in the diagnostic
information parameter;

\- application context not supported;

the requested application context is not supported;

\- procedure error;

processing of the procedure is terminated for procedural reasons.

[Diagnostic information]{.underline}:

This parameter may be used to give additional information for some of
the values of the user-reason parameter:

Table 7.1/2: User reason and diagnostic information

  ------------------------------------ --------------------------------
  **User reason**                      **Diagnostic information**

  Resource limitation (congestion)     \-

  Resource unavailable                 Short term/long term problem

  Application procedure cancellation   Handover cancellation/\
                                       Radio Channel release/\
                                       Network path release/\
                                       Call release/\
                                       Associated procedure failure/\
                                       Tandem dialogue released/\
                                       Remote operations failure

  Application context not supported    \-

  Procedure error                      \-
  ------------------------------------ --------------------------------

[Specific information]{.underline}:

This parameter may be used for passing any user specific information.
Establishment and processing of the Specific information is not
specified by GSM and shall be performed according to operator specific
requirements.

8 Mobility services
===================

8.1 General
-----------

Regarding definition of each service, only the interval for adoption
shall be considered for the GLR introduction. The interval for adoption
for the GLR specification is described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

8.2 Location Management services
--------------------------------

  ----------------------------- -----------------------
  Services                      Interval for adoption
  MAP\_UPDATE\_LOCATION         VLR -- GLR
                                GLR -- HLR
  MAP\_CANCEL \_LOCATION        HLR -- GLR
                                GLR -- VLR
                                GLR -- SGSN
  MAP\_PURGE\_MS                VLR -- GLR
                                SGSN -- GLR
                                GLR -- HLR
  MAP\_UPDATE\_GPRS\_LOCATION   SGSN -- GLR
                                GLR -- HLR
  ----------------------------- -----------------------

Figure 8.2 /1

8.3 Authentication Management services
--------------------------------------

  -------------------------------------- -----------------------
  Services                               Interval for adoption
  MAP\_SEND\_AUTHENTICATION\_INFO        VLR -- GLR
                                         SGSN -- GLR
                                         GLR -- HLR
  MAP\_AUTHENTICATION\_FAILURE\_REPORT   VLR -- GLR
                                         SGSN -- GLR
                                         GLR -- HLR
  -------------------------------------- -----------------------

Figure 8.3/1

8.4 Subscriber management services
----------------------------------

  ------------------------------ -----------------------
  Services                       Interval for adoption
  MAP\_ INSERT-SUBSCRIBER-DATA   HLR -- GLR
                                 GLR -- VLR
                                 GLR -- SGSN
  MAP-DELETE-SUBSCRIBER-DATA     HLR -- GLR
                                 GLR -- VLR
                                 GLR -- SGSN
  ------------------------------ -----------------------

Figure 8.4/1

8.5 Fault recovery services
---------------------------

  ------------------------------------- -----------------------
  Services                              Interval for adoption
  MAP\_RESET                            HLR -- GLR
                                        GLR -- VLR
                                        GLR -- SGSN
  MAP\_FORWARD\_CHECK\_SS\_INDICATION   HLR -- GLR
                                        GLR -- VLR
  MAP\_RESTORE\_DATA                    VLR -- GLR
  ------------------------------------- -----------------------

Figure 8.5/1

8.6 Subscriber Information services
-----------------------------------

  ----------------------------- -----------------------
  Services                      Interval for adoption
  MAP-PROVIDE-SUBSCRIBER-Info   VLR -- GLR
                                GLR -- HLR
  ----------------------------- -----------------------

Figure 8.6/1

9 Operation and maintenance services
====================================

9.1 General
-----------

Regarding definition of each service, only the interval for adoption
shall be considered for the GLR introduction. The intervals for adoption
for the GLR specification are described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

9.2 MAP\_SEND\_IMSI service
---------------------------

  ------------------ -----------------------
  Services           Interval for adoption
  MAP\_ SEND\_IMSI   HLR -- GLR
                     GLR -- VLR
  ------------------ -----------------------

Figure 9.2/1

10 Call handling services
=========================

10.1 General
------------

Regarding definition of each service, only the interval for adoption
shall be considered for the GLR introduction. The intervals for adoption
for the GLR specification are described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

10.2 MAP\_PROVIDE\_ROAMING\_NUMBER service
------------------------------------------

  -------------------------------- -----------------------
  Services                         Interval for adoption
  MAP\_ PROVIDE\_ROAMING\_NUMBER   HLR -- GLR
                                   GLR -- VLR
  -------------------------------- -----------------------

Figure 10.2/1

10.3 MAP\_SET\_REPORTING\_STATE service
---------------------------------------

  ----------------------------- -----------------------
  Services                      Interval for adoption
  MAP\_ SET\_REPORTING\_STATE   HLR -- GLR
                                GLR -- VLR
  ----------------------------- -----------------------

Figure 10.3/1

10.4 MAP\_STATUS\_REPORT service
--------------------------------

  ---------------------- -----------------------
  Services               Interval for adoption
  MAP\_ STATUS\_REPORT   VLR -- GLR
                         GLR -- HLR
  ---------------------- -----------------------

Figure 10.4/1

10.5 MAP\_REMOTE\_USER\_FREE service
------------------------------------

  ------------------------- -----------------------
  Services                  Interval for adoption
  MAP\_REMOTE\_USER\_FREE   VLR -- GLR
                            GLR -- HLR
  ------------------------- -----------------------

Figure 10.5/1

11 Supplementary services related services
==========================================

11.1 General
------------

Regarding definition of each service, only the interval for adoption
shall be considered for the GLR introduction. The intervals for adoption
for the GLR specification are described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

11.2 MAP\_REGISTER\_SS service
------------------------------

  -------------------- -----------------------
  Services             Interval for adoption
  MAP\_ REGISTER\_SS   VLR -- GLR
                       GLR -- HLR
  -------------------- -----------------------

Figure 11.2/1

11.3 MAP\_ERASE\_SS service
---------------------------

  ----------------- -----------------------
  Services          Interval for adoption
  MAP\_ ERASE\_SS   VLR -- GLR
                    GLR -- HLR
  ----------------- -----------------------

Figure 11.3/1

11.4 MAP\_ACTIVATE\_SS service
------------------------------

  -------------------- -----------------------
  Services             interval for adoption
  MAP\_ ACTIVATE\_SS   VLR -- GLR
                       GLR -- HLR
  -------------------- -----------------------

Figure 11.4/1

11.5 MAP\_DEACTIVATE\_SS service
--------------------------------

  ---------------------- -----------------------
  Services               Interval for adoption
  MAP\_ DEACTIVATE\_SS   VLR -- GLR
                         GLR -- HLR
  ---------------------- -----------------------

Figure 11.5/1

11.6 MAP\_ INTERROGATE \_SS service
-----------------------------------

  ----------------------- -----------------------
  Services                Interval for adoption
  MAP\_ INTERROGATE\_SS   VLR -- GLR
                          GLR -- HLR
  ----------------------- -----------------------

Figure 11.6/1

11.7 MAP\_ REGISTER\_PASSWORD service
-------------------------------------

  -------------------------- -----------------------
  Services                   Interval for adoption
  MAP\_ REGISTER\_PASSWORD   VLR -- GLR
                             GLR -- HLR
  -------------------------- -----------------------

Figure 11.7/1

11.8 MAP\_ GET\_PASSWORD service
--------------------------------

  --------------------- -----------------------
  Services              Interval for adoption
  MAP\_ GET\_PASSWORD   HLR -- GLR
                        GLR -- VLR
  --------------------- -----------------------

Figure 11.8/1

11.9 MAP\_ PROCESS\_UNSTRUCTURED\_SS\_REQUEST service
-----------------------------------------------------

  ------------------------------------------ -----------------------
  Services                                   Interval for adoption
  MAP\_ PROCESS\_UNSTRUCTURED\_SS\_REQUEST   VLR -- GLR
                                             GLR -- HLR
  ------------------------------------------ -----------------------

Figure 11.9/1

11.10 MAP\_ UNSTRUCTURED\_SS\_REQUEST service
---------------------------------------------

  --------------------------------- -----------------------
  Services                          Interval for adoption
  MAP\_ UNSTRUCTURED\_SS\_REQUEST   HLR -- GLR
                                    GLR -- VLR
  --------------------------------- -----------------------

Figure 11.10/1

11.11 MAP\_UNSTRUCTURED\_SS\_NOTIFY service
-------------------------------------------

  -------------------------------- -----------------------
  Services                         Interval for adoption
  MAP\_ UNSTRUCTURED\_SS\_NOTIFY   HLR -- GLR
                                   GLR -- VLR
  -------------------------------- -----------------------

Figure 11.11/1

11.12 MAP\_REGISTER\_CC\_ENTRY service
--------------------------------------

  -------------------------------- -----------------------
  Services                         Interval for adoption
  MAP\_ UNSTRUCTURED\_SS\_NOTIFY   VLR -- GLR
                                   GLR -- HLR
  -------------------------------- -----------------------

Figure 11.12/1

11.13 MAP\_ERASE\_CC\_ENTRY service
-----------------------------------

  ------------------------- -----------------------
  Services                  Interval for adoption
  MAP\_ ERASE\_CC\_NOTIFY   VLR -- GLR
                            GLR -- HLR
  ------------------------- -----------------------

Figure 11.13/1

12 Short message service management services
============================================

12.1 General
------------

Regarding definition of each service, only the interval for adoption
shall be considered for the GLR introduction. The intervals for adoption
for the GLR specification are described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

12.2 MAP-READY-FOR-SM service
-----------------------------

  ------------------ -----------------------
  Services           interval for adoption
  MAP-READY-FOR-SM   VLR -- GLR
                     SGSN -- GLR
                     GLR -- HLR
  ------------------ -----------------------

Figure 12.2/1

12.3 MAP-MT-FORWARD-SHORT-MESSAGE service
-----------------------------------------

  ---------------------------------- -----------------------
  Services                           interval for adoption
  MAP\_MT\_FORWARD\_SHORT\_MESSAGE   SMS-GMSC -- IM-MSC
                                     IM-MSC -- MSC
                                     SMS-GMSC -- GLR
                                     GLR -- SGSN
  ---------------------------------- -----------------------

Figure 12.3/1

13 Network-Requested PDP Context Activation services
====================================================

13.1 General
------------

Regarding definition of each service, only the interval for adopttion
shall be considered for the GLR introduction. The intervals for adoption
for the GLR specification are described below. Service primitives and
parameter definitions are as in 3GPP TS 29.002.

13.2 MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service
------------------------------------------------

  ------------------------------------- -----------------------
  Services                              Interval for adoption
  MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS   IM-GSN -- GLR
  ------------------------------------- -----------------------

Figure 13.2/1

13.3 MAP\_FAILURE\_REPORT service
---------------------------------

  ----------------------- -----------------------
  Services                Interval for adoption
  MAP\_ FAILURE\_REPORT   IM-GSN -- GLR
  ----------------------- -----------------------

Figure 13.3/1

14 Void
=======

15 Element of procedure
=======================

The elements of procedures for the MAP protocol are referred to the
corresponding section in 3GPP TS 29.002002 with the exceptions described
below.

15.1 SDL descriptions
---------------------

Replace the corresponding part of Process Secure\_MAP\_DSM as figure
15.1/1.

![](media/image3.wmf){width="6.651388888888889in"
height="8.204166666666667in"}

Figure 15.1/1: Process Secure\_MAP\_DSM\_GLR

16 Mapping onto TC services
===========================

Dialogue control, Service specific procedures and SDL descriptions are
referred to the corresponding section in 3GPP TS 29.002.

17 Abstract syntax of the MAP protocol
======================================

17.1 General
------------

Refer to the corresponding section in 3GPP TS 29.002 except Packages
specifications and Application contexts.

Regarding the operations which are initiated by the VLR or SGSN toward
HLR via GLR, the timer value used in the operations should be configured
enough long to guarantee the GLR specific fallback mechanism.

17.2 Packages specifications
----------------------------

Regarding Packages specifications, only the supplier and consumer
definition shall be considered for the GLR introduction. The supplier
and consumer definition for the GLR specification are derived Table
17.2/1. For the other definitions of the package specifications are as
in 3GPP TS 29.002.

Table 17.2/1: supplier and consumer definition

  ---------------------------------------- ---------------------------------------------------------------------------------------------------------------------------- --------------
  **Operation Package**                    **supplier**                                                                                                                 **consumer**
  LocationUpdatingPackage-v3               HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  LocationCancellationPackage-v3           VLR or SGSN                                                                                                                  GLR
                                           GLR                                                                                                                          HLR
  RoamingNumberEnquiryPackage-v3           VLR                                                                                                                          GLR
                                           GLR                                                                                                                          HLR
  InfoRetrievalPackage-v2                  HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
                                           GLR                                                                                                                          SGSN
  InfoRetrievalPackage-v1                  HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
                                           GLR                                                                                                                          SGSN
  IMSIRetrievalPackage-v2                  HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  SubscriberDataMngtStandAlonePackage-v3   VLR or SGSN                                                                                                                  GLR
                                           GLR                                                                                                                          HLR
  SubscriberDataMngtPackage-v3             VLR or SGSN                                                                                                                  GLR
                                           GLR                                                                                                                          HLR
  ResetPackage-v2                          VLR or SGSN                                                                                                                  GLR
                                           GLR                                                                                                                          HLR
  FunctionalSsPackage-v2                   HLR                                                                                                                          GLR
                                           GLR                                                                                                                          HLR
  BindingPackage-v1                        HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  UnstructuredSsPackage-v2                 HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  UnstructuredSsPackage-v1                 HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  MTShortMsgRelayPackage-v3                IM-MSC or GLR                                                                                                                GMSC
                                           MSC                                                                                                                          IM-MSC
                                           SGSN                                                                                                                         GLR
  MwdMngtPackage-v3                        HLR                                                                                                                          GLR
                                           GLR                                                                                                                          SGSN
                                           GLR                                                                                                                          VLR
  MwdMngtPackage-v1                        HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  DataRestorationPackage-v3                GLR                                                                                                                          VLR
  PurgingPackage-v3                        HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
                                           GLR                                                                                                                          SGSN
  SubscriberInformationEnquiryPackage-v3   VLR                                                                                                                          GLR
                                           GLR                                                                                                                          HLR
  GprsLocationUpdatingPackage-v3           HLR                                                                                                                          GLR
                                           GLR                                                                                                                          SGSN
  FailureReportingPackage-v3               GLR                                                                                                                          IM-GSN
  SetReportingStatePackage-v3              VLR                                                                                                                          GLR
                                           GLR                                                                                                                          HLR
  StatusReportPackage-v3                   HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  RemoteUserFreePackage-v3                 VLR                                                                                                                          GLR
                                           GLR                                                                                                                          HLR
  CallCompletionPackage-v3                 HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
  AuthenticationFailureReportPackage-v3    HLR                                                                                                                          GLR
                                           GLR                                                                                                                          VLR
                                           GLR                                                                                                                          SGSN
  SecureTransportHandlingPackage-v3        This operation package includes the operations required for the secure transport of MAP messages between any MAP entities.   
  ---------------------------------------- ---------------------------------------------------------------------------------------------------------------------------- --------------

17.3 Application contexts
-------------------------

Regarding Application contexts specifications, only the responder and
initiator definition shall be considered for the GLR introduction. The
responder and initiator definition for the GLR specification are derived
Table 17.3/1. For the other definitions of the package specifications
are as in 3GPP TS 29.002.

Table 17.3/1: supplier and consumer definition

  ------------------------------------ ------------- ----------------------------------------------------------------------------------------------------- ---------------
  **Application Context**              **Version**   **Initiator**                                                                                         **Responder**
  locationCancellationContext          v3            HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR or SGSN
  imsiRetrievalContext                 v2            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
  infoRetrievalContext                 v2            VLR or SGSN                                                                                           GLR
                                                     GLR                                                                                                   HLR
  mwdMngtContext                       v3            VLR or SGSN                                                                                           GLR
                                                     GLR                                                                                                   HLR
  msPurgingContext                     v3            VLR or SGSN                                                                                           GLR
                                                     GLR                                                                                                   HLR
  resetContext                         v2            HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR or SGSN
  networkUnstructuredSsContext         v2            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
                                                     HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR
  networkFunctionalSsContext           v2            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
  shortMsgMT-RelayContext              v3            MSC                                                                                                   IM-MSC or GLR
                                                     IM-MSC                                                                                                MSC
                                                     GLR                                                                                                   SGSN
  networkLocUpContext                  v3            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
  gprsLocationUpdateContext            v3            SGSN                                                                                                  GLR
                                                     GLR                                                                                                   HLR
  subscriberDataMngtContext            v3            HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR or SGSN
  roamingNumberEnquiryContext          v3            HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR
  gprsLocationInfoRetrievalContext     v3            IM-GSN                                                                                                GLR
  failureReportContext                 v3            IM-GSN                                                                                                GLR
  subscriberInfoEnquiryContext         v3            HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR
  reportingContext                     v3            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
                                                     HLR                                                                                                   GLR
                                                     GLR                                                                                                   VLR
  callCompletionContext                v3            VLR                                                                                                   GLR
                                                     GLR                                                                                                   HLR
  authenticationFailureReportContext   v3            VLR or SGSN                                                                                           GLR
                                                     GLR                                                                                                   HLR
  SecureTransportHandlingContext       v3            This application context is used for the secure transport of MAP messages between any MAP entities.   
  ------------------------------------ ------------- ----------------------------------------------------------------------------------------------------- ---------------

18 General on MAP user procedure
================================

Refer to 3GPP TS 29.002 for general matters for procedure description
such as notation convention, version handling at dialogue establishment
and interaction between MAP provider and MAP users.

19 Mobility procedures
======================

19.1 Location management Procedures
-----------------------------------

For non-GPRS subscribers, this subclause comprises a number of processes
to handle the mobile nature of the subscriber. The processes will be
addressed by SCCP SSN (VLR or HLR) and the Application Context. The
processes in the GLR interact with the processes in the VLR or HLR
defined in 29.002. The followings show the relations between the
protocol processes in the GLR and the processes in the other node.

Process Update Location (VLR-GLR):

\- Initiator: Update\_Location\_Area\_VLR or Update\_Location\_HLR;

\- Responder: Update\_Location\_GLR.

Process Update Location (GLR-HLR):

\- Initiator: GLR\_Update\_Location\_HLR;

\- Responder: Update\_Location\_HLR.

Process Cancel Location (VLR-GLR):

\- Initiator: GLR\_Cancel\_Location\_VLR;

\- Responder: Cancel\_Location\_VLR.

Process Cancel Location (GLR-HLR):

\- Initiator: Cancel\_Location\_HLR;

\- Responder: Cancel\_Location\_GLR.

Process Purge MS (VLR-GLR):

\- Initiator: Purge\_MS\_VLR;

\- Responder: Purge\_MS\_GLR.

Process Purge MS (GLR-HLR):

\- Initiator: GLR\_Purge\_MS\_HLR;

\- Responder: Purge\_MS\_HLR.

A Location Management Co-ordinator in the GLR co-ordinates the two
protocol processes \"Update\_Location\_GLR\" (subclause 19.1.2) and
\"RESTORE\_DATA\_GLR\" (subclause 19.2) that are addressed by the same
application context.

On receipt of a dialogue request for the Location Management Application
Context, the location Management\_Coordinator\_GLR will:

\- Terminate the process in case of parameter problems; or

\- Revert to MAP version Vr protocol if the VLR requests version Vr
protocol; or

\- Continue as described in the following, if the dialogue is accepted.

The protocol process is created depending on the first primitive
received from the MAP service provider within this dialogue:

\- Update\_Location\_GLR if the primitive is a MAP\_UPDATE\_LOCATION
indication.

\- RESTORE\_DATA\_GLR if the primitive is a MAP\_RESTORE\_DATA
indication.

If a MAP\_NOTICE indication is received instead, the dialogue towards
the VLR is terminated and the process returns to idle state.

After creation of the protocol process the service primitive received
from the MAP service-provider is passed to the protocol process.
Henceforth, the co-ordinator will relay all service primitives from MAP
service-provider to the MAP service-user and vice versa, until a request
or indication for dialogue termination is received. This last primitive
will be relayed, too, before the Co-ordinator process returns to idle
state.

![](media/image4.wmf){width="6.413194444444445in"
height="8.185416666666667in"}

Figure 19.1.1/1: Process Location\_Management\_Coordinator\_GLR

For GPRS subscribers, this subclause comprises a number of other
processes to handle the mobile nature of the subscriber. The processes
will be addressed by SCCP Sub-System Number (SGSN or HLR) and the
Application Context. The processes in the GLR interact with the
processes in the VLR, SGSN or HLR defined in 29.002. The followings show
the relations between the processes in the GLR and the processes in the
other node:

Process GPRS Update Location (VLR or SGSN-GLR):

Initiator: GPRS\_Update\_Location\_Area\_VLR, or SGSN\_Update\_HLR.

Responder: Update\_GPRS\_Location\_GLR.

Process GPRS Update Location (GLR-HLR):

Initiator: GLR\_Update\_GPRS\_Location\_HLR.

Responder: Update\_GPRS\_Location\_HLR.

Process Cancel Location (SGSN-GLR):

Initiator: GLR\_Cancel\_Location\_SGSN.

Responder: Cancel\_Location\_SGSN.

Process Cancel Location (GLR-HLR):

Initiator: Cancel\_GPRS\_Location\_HLR.

Responder: Cancel\_GPRS\_Location\_GLR.

Process Purge MS (SGSN-GLR):

Initiator: Purge\_MS\_SGSN.

Responder: Purge\_MS\_GLR\_for\_GPRS.

Process Purge MS (GLR-HLR):

Initiator: GLR\_Purge\_MS\_HLR\_for\_GPRS.

Responder: Purge\_MS\_HLR.

### 19.1.1 Location updating

#### 19.1.1.1 General

This location updating procedure is used to update the location
information held in the network.

If the GLR is located between the VLR and the HLR, the
MAP\_UPDATE\_LOCATION service is invoked towards the GLR whose identity
is contained in the VLR table. When the GLR receives a
MAP\_UPDATE\_LOCATION indication, it determines whether it invokes the
MAP\_UPDATE\_LOCATION service towards the HLR, and invokes it if
necessary.

If the GLR is located between the SGSN and the HLR, the
MAP\_UPDATE\_GPRS\_LOCATION service is invoked towards the GLR whose
identity is contained in the SGSN table. When the GLR receives a
MAP\_UPDATE\_GPRS\_LOCATION indication, it determines whether it invokes
the MAP\_UPDATE\_GPRS\_LOCATION service towards the HLR, and invokes it
if necessary.

+\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\-\--+\
│VLR/│ \| \| │ │ │PGLR/│

│SGSN+\-\-\-\--+\-\-\-\-\-\-\-\-\--│GLR
│\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│HLR
+\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│PVLR/│\
│ │ \| \| │ │ │PSGSN│

+\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\-\--+\
│ │ │ │\
│ MAP UPDATE\_LOCATION │ │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ │ │\
│ or MAP UPDATE GPRS │ MAP UPDATE\_LOCATION │ MAP\_CANCEL\_ │\
│ LOCATION │ \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\
│ │or MAP UPDATE GPRS │ LOCATION │\
│ │ LOCATION │ │\
│ │ │ │\
│ │ │ MAP\_CANCEL\_LOCATION │\
│ │ │\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-- │\
│ │ │ ack │\
│MAP INSERT SUBSCRIBER│MAP INSERT SUBSCRIBER │ │\
│ DATA │ DATA │ │\
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│
│\
│ │ │ │\
│ │ │ │\
│MAP INSERT SUBSCRIBER│MAP INSERT SUBSCRIBER │ │\
│ DATA │ DATA │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>
│ │\
│ ack │ ack │ │\
│ │ │ │\
│ │ │ │\
│MAP CHECK SS │MAP CHECK SS │ │\
│ INDICATION │ INDICATION │ │\
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│
│\
│ │ │ │\
│ │ │ │\
│MAP UPDATE\_LOCATION │MAP UPDATE\_LOCATION │ │\
│or MAP UPDATE\_GPRS │or MAP UPDATE\_GPRS │ │\
│ LOCATION │ LOCATION │ │\
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
│ │\
│ ack │ ack │ │\
│ │ │

Figure 19.1.2/1: Interface and services for Location updating

#### 19.1.1.2 Detailed procedure in the GLR

Figure 19.1.2/2 shows the Process Update\_Location\_GLR. This process is
a GLR MAP prorocol machine handling location updating and is a responder
to the VLR.

![](media/image5.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/2 (sheet 1 of 3): Process Update\_Location\_GLR

![](media/image6.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/2 (sheet 2 of 3): Process Update\_Location\_GLR

![](media/image7.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/2 (sheet 3 of 3): Process Update\_Location\_GLR

Figure 19.1.2/3 shows the Process GLR\_Update\_Location\_HLR. This
process is a GLR MAP protocol machine handling location updating and is
an initiator to the HLR.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process Update\_Location\_GLR.

![](media/image8.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/3 (Sheet 1 of 3): Process GLR\_Update\_Location\_HLR

![](media/image9.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/3 (Sheet 2 of 3): Process GLR\_Update\_Location\_HLR

![](media/image10.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/3 (Sheet 3 of 3): Process GLR\_Update\_Location\_HLR

Figure 19.1.2/4 shows the Process Update\_GPRS\_Location\_GLR. This
process is a GLR MAP protocol machine handling location updating and is
a responder to the SGSN.

![](media/image11.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/4 (sheet 1 of 3): Process Update\_GPRS\_Location\_GLR

![](media/image12.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/4 (sheet 2 of 3): Process Update\_GPRS\_Location\_GLR

![](media/image13.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/4 (sheet 3 of 3): Process Update\_GPRS\_Location\_GLR

Figure 19.1.2/5 shows the Process GLR\_Update\_GPRS\_Location\_HLR. This
process is a GLR MAP protocol machine handling location updating and is
an initiator to the HLR.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process Update\_GPRS\_Location\_GLR.

![](media/image14.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/5 (Sheet 1 of 3): Process GLR\_Update\_GPRS\_Location\_HLR

![](media/image15.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/5 (Sheet 2 of 3): Process GLR\_Update\_GPRS\_Location\_HLR

![](media/image16.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.2/5 (Sheet 3 of 3): Process GLR\_Update\_GPRS\_Location\_HLR

### 19.1.2 Location Cancellation

#### 19.1.2.1 General

The purpose of this process is to delete a subscriber\'s record from a
previous GLR/VLR/SGSN after she has registered with a new GLR/VLR/SGSN.
The procedure may also be used if the subscriber\'s record is to be
deleted for other operator determined purposes. Location cancellation
can be used to enforce location updating including updating of
subscriber data in the VLR or in the SGSN at the next subscriber access.

In all cases, the process is performed independently of the invoking
process (e.g. Location Updating).

If GLR is located between the VLR or the SGSN and the HLR, the
MAP\_CANCEL\_LOCATION service is invoked towards the GLR whose identity
is contained in the HLR table.

+\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\--+\
│VLR/│ D \| \| D │ │ D │ │

│GLR +\-\-\-\--+\-\-\-\-\-\-\-\-\--│HLR
│\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│PGLR+\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│PVLR│\
+\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\--+\
│ │ │ │\
│ MAP UPDATE\_LOCATION │ │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ │ │\
│ │ MAP\_CANCEL\_ │ MAP\_CANCEL\_ │\
│ │ \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\
│ │ LOCATION │ LOCATION │\
│ │ │ │\
│ │ │ │\
│ │ MAP\_CANCEL\_LOCATION │ MAP\_CANCEL\_LOCATION │\
│ │\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-- │\
│ │ ack │ ack │\
│ │ │

NOTE: The service shown in dotted lines indicates the trigger provided
by other MAP signalling.

Figure 19.1.3/1: Interface and services for Location Cancellation

+\-\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\-\--+\
│SGSN/│ D \| \| D │ │ D │ │

│GLR +\-\-\-\-\--+\-\-\-\-\-\--│HLR
│\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│PGLR+\-\-\-\-\-\--+\-\-\-\-\-\-\-\--│PSGSN│\
+\-\-\-\--+ +\-\-\--+ +\-\-\--+ +\-\-\-\--+\
│ │ │ │\
│MAP\_UPDATE\_GPRS\_LOCATION│ │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ │ │\
│ │ MAP\_CANCEL\_ │ MAP\_CANCEL\_ │\
│ │ \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\
│ │ LOCATION │ LOCATION │\
│ │ │ │\
│ │ │ │\
│ │ MAP\_CANCEL\_LOCATION │ MAP\_CANCEL\_LOCATION │\
│ │\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-- │\
│ │ ack │ ack │\
│ │ │ │

NOTE: The service shown in dotted lines indicates the trigger provided
by other MAP signalling.

Figure 19.1.3/2: Interface and services for Location Cancellation in
GPRS

Additionally, The MAP\_CANCEL\_LOCATION service is invoked when the GLR
that stores the subscriber\'s record receives a MAP\_UPDATE\_LOCATION
indication from a VLR other than that stored in its table for this
subscriber. Also the MAP\_CANCEL\_LOCATION service is invoked when the
GLR that stores the subscriber\'s record a MAP\_UPDATE\_GPRS\_LOCATION
indication from a SGSN other than stored in its table for this
subscriber. The MAP\_CANCEL\_LOCATION service is in any case invoked
towards the VLR or the SGSN whose identity is contained in the HLR
table.

+\-\-\--+ D +\-\-\--+ D +\-\-\-\--+\
│VLR/+\-\-\-\-\-\-\-\-\-\--+\-\-\-\-\-\-\-\-\-\-\--+GLR
+\-\-\-\-\-\--+\-\-\-\-\-\-\--+PVLR/│\
│SGSN\| │ │ │PSGSN│\
+\-\-\--+ +\-\-\--+ +\-\-\-\--+\
│ MAP\_UPDATE\_LOCATION or │ │\
│ MAP\_UPDATE\_GPRS\_LOCATION │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ │\
│ │ MAP\_CANCEL\_ │\
│ │ \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\
│ │ LOCATION │\
│ │ │\
│ │ │\
│ │ MAP\_CANCEL\_LOCATION │\
│ │\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-- │\
│ │ ack │\
│ │ │

Figure 19.1.3/4: Interface and services for Location Cancellation in
case that the GLR stores the subscriber\'s record

#### 19.1.2.2 Detailed procedure in the GLR

Figure 19.1.3/5 shows the Process Cancel\_Location\_GLR. This process is
a GLR MAP protocol machine handling location cancellation and is a
responder to the HLR.

![](media/image17.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.3/5: Process Cancel\_Location\_GLR

Figure 19.1.3/6 shows the Process GLR\_Cancel\_Location\_VLR. This
process is a GLR MAP protocol machine handling location cancellation and
is an initiator to the VLR.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process Cancel\_Location\_GLR.

![](media/image18.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.3/6: Process GLR\_Cancel\_Location\_VLR

Figure 19.1.3/7 shows the Process Cancel\_GPRS\_Location\_GLR. This
process is a GLR MAP protocol machine handling location cancellation and
is a responder to the HLR.

![](media/image19.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.3/7: Process Cancel\_GPRS\_Location\_GLR

Figure 19.1.3/8 shows the Process GLR\_Cancel\_Location\_SGSN. This
process is a GLR MAP protocol machine handling location cancellation and
is an initiator to the SGSN.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process Cancel\_GPRS\_Location\_GLR.

![](media/image20.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.3/8: Process GLR\_Cancel\_Location\_SGSN

### 19.1.3 Purge MS

#### 19.1.3.1 General

This Purge MS procedure is used to treat any request for routing
information for a mobile terminated call or a mobile terminated short
message as if the MS is not reachable.

If GLR is located between the VLR or the SGSN and the HLR, the
MAP\_PURGE\_MS service is invoked towards the GLR whose identity is
contained in the VLR table or the SGSN table.

When the GLR receives a MAP\_PURGE\_MS indication, the GLR determines
whether it invokes the MAP\_PURGE\_MS service towards the HLR.

+\-\-\--+ +\-\-\--+ +\-\-\--+\
│VLR/│ \| \| │ │\
│SGSN+\-\-\-\--+\-\-\-\-\-\-\-\-\--+GLR
+\-\-\-\-\-\-\--+\-\-\-\-\-\-\--│ HLR│\
+\-\-\--+ +\-\-\--+ +\-\-\--+\
│ │ │\
│ MAP PURGE\_MS │ │\
│\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ │\
│ │ MAP PURGE\_MS │\
│ │ \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│\
│ │ │\
│ │ │\
│ │ │\
│ │ MAP PURGE\_MS ack │\
│ MAP\_PURGE\_MS ack │\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│\
│\<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │\
│ │ │

Figure 19.1.4/1: Interface and services for Purge MS

#### 19.1.3.2 Detailed procedure in GLR

Figure 19.1.4/2 shows the Process Purge\_MS\_GLR. This process is a GLR
MAP protocol machine handling purge MS and is a responder to the VLR.

![](media/image21.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.4/2: Process Purge\_MS\_GLR

Figure 19.1.4/3 shows the Process GLR\_Purege\_MS\_HLR. This process is
a GLR MAP protocol machine handling purge MS and is an initiator to the
HLR.

![](media/image22.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.4/3: Process GLR\_PURGE\_MS\_HLR

Figure 19.1.4/4 shows the Process Purge\_MS\_GLR\_for\_GPRS. This
process is a GLR MAP protocol machine handling purge MS and is a
responder to the SGSN.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process PURGE\_MS\_GLR.

![](media/image23.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.4/4: Process Purge\_MS\_GLR\_for\_GPRS

Figure 19.1.4/5 shows the Process GLR\_Purge\_MS\_HLR\_for\_GPRS. This
process is a GLR MAP protocol machine handling purge MS and is an
initiator to the HLR.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process PURGE\_MS\_GLR\_for\_GPRS.

![](media/image24.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.1.4/5: Process GLR\_Purge\_MS\_HLR\_for\_GPRS

19.2 Fault recovery procedures
------------------------------

### 19.2.1 RESET procedure

This procedure is used to notify VLR, SGSN and GLR of the failure of the
node for restoration of the subscriber data.

#### 19.2.1.1 HLR failure case

In the case of HLR failure, the HLR invokes MAP\_RESET service towards
the affected GLR, if GLR is located between the VLR and the HLR or
between the SGSN and the HLR. When a GLR receives MAP\_RESET indication,
it sends a MAP\_RESET message to the affected VLR and/or SGSN.

#### 19.2.1.2 GLR failure case

In the case of GLR failure, the GLR invokes MAP\_RESET service towards
the affected VLR and/or SGSN.

#### 19.2.1.3 Detailed procedure in GLR

Figure 19.2.1/1 shows the Process RECEIVE\_RESET\_IN\_GLR. This process
is a GLR MAP protocol machine handling reset message from HLR.

![](media/image25.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.1/1: Process RECEIVE\_RESET\_IN\_GLR

Figure 19.2.1/2 shows the Process SEND\_RESET\_TO\_VLR. This process is
a GLR MAP protocol machine handling reset message to VLR.

![](media/image26.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.1/2: Process SEND\_RESET\_TO\_VLR

Figure 19.2.1/3 shows the Process SEND\_RESET\_TO\_SGSN. This process is
a GLR MAP protocol machine handling reset message to SGSN.

![](media/image27.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.1/3: Process SEND\_RESET\_TO\_SGSN

### 19.2.2 VLR restoration: the restore data procedure in the GLR

#### 19.2.2.1 General

This procedure is used to restore the subscriber data for an
unidentified MS (i.e. IMSI unknown in VLR), or for a known MS whose IMSI
record is marked as \"Not Confirmed\" by the indicator \"Confirmed by
HLR\" in VLR.

If GLR is located between the VLR and the HLR, the MAP\_RESTORE\_DATA
service is invoked towards the GLR whose identity is contained in the
VLR table. When the GLR receives a MAP\_RESTORE\_DATA indication, it
determines whether it invokes the MAP\_RESTORE\_DATA service towards the
HLR, and invokes it if necessary.

#### 19.2.2.2 Detailed procedure in GLR

Figure 19.2.2/1 shows the Process RESTORE\_DATA\_GLR. This process is a
GLR MAP protocol machine handling VLR restoration and is a responder to
the VLR.

![](media/image28.wmf){width="6.768055555555556in"
height="7.476388888888889in"}

Figure 19.2.2/1 (Sheet 1 of 3): Process RESTORE\_DATA\_GLR

![](media/image29.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.2/1 (Sheet 2 of 3): Process RESTORE\_DATA\_GLR

![](media/image30.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.2/1 (Sheet 3 of 3): Process RESTORE\_DATA\_GLR

Figure 19.2.2/2 shows the Process GLR\_RESTORE\_DATA\_HLR. This process
is a GLR MAP protocol machine handling VLR restoration and is an
initiator to the HLR.

Sheet 1: If the Macro Open\_Receive\_Cnf results Vr, the process
requests to perform MAP Vr. It causes a request for sending an abort
message to Process RESTORE\_DATA\_GLR.

![](media/image31.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.2/2 (Sheet 1 of 3): Process GLR\_RESTORE\_DATA\_HLR

![](media/image32.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.2/2 (Sheet 2 of 3): Process GLR\_RESTORE\_DATA\_HLR

![](media/image33.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 19.2.2/2 (Sheet 3 of 3): Process GLR\_RESTORE\_DATA\_HLR

20 Operations and maintenance procedures
========================================

20.1 General
------------

The Operations and Maintenance procedures are needed for operating and
maintaining the UMTS PLMN network.

The following procedures exist for operation and maintenance purposes:

i\) Tracing procedures;

ii\) Subscriber Data Management procedures;

iii\) Subscriber Identity procedures.

The following application contexts refer to complex MAP Users consisting
of several processes:

\- subscriberDataManagementContext;

\- tracingContext.

These two application contexts need a co-ordinating process in the VLR
or in the SGSN. Refer to the 3GPP TS 29.002 for detail procedures.

The Subscriber Data Management procedures are only procedures that
impact to the GLR. The following subclause describes the Subscriber
Identity procedures in the GLR.

20.2 Subscriber data management procedures
------------------------------------------

### 20.2.1 General

Two types of subscriber data management procedures exist in the Mobile
Application Part

i\) Subscriber Deletion;

ii\) Subscriber Data Modification.

No requirements have been identified for the Subscriber creation and
subscriber data interrogation procedures.

The subscriber deletion and subscriber data modification procedures are
initiated by the OMC (see figures 20.2.1/1, 20.2.1/2, 20.2.1/3 and
20.2.1/4).

+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ VLR │ │ GLR │ │ HLR │ │ OMC │\
+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ │ │1. │\
│ │2. +\< - - - - - - - │\
│2. +\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │\
+\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │ │\
│ 3.│ │ │\
+\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 3.│ │\
│ +\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 4.│\
│ │ + - - - - - - - \>│\
│ │ │ │

1\) Delete Subscriber.

2\) MAP\_CANCEL\_LOCATION.

3\) MAP\_CANCEL\_LOCATION\_ACK.

4\) Subscriber Deleted.

Figure 20.2.1/1: Subscriber deletion procedure

In the subscriber deletion procedure the subscriber data should be
removed from the VLR and from the HLR. The HLR uses the
MAP\_CANCEL\_LOCATION service.

+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│SGSN │ │ GLR │ │ HLR │ │ OMC │\
+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ │ │1. │\
│ │2. +\< - - - - - - - │\
│2. +\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │\
+\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │ │\
│ 3.│ │ │\
+\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 3.│ │\
│ +\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 4.│\
│ │ + - - - - - - - \>│\
│ │ │ │

1\) Delete GPRS Subscriber.

2\) MAP\_CANCEL\_LOCATION.

3\) MAP\_CANCEL\_LOCATION\_ACK.

4\) GPRS Subscriber Deleted.

Figure 20.2.1/2: Subscriber deletion procedure for GPRS

In the subscriber deletion procedure the subscriber data should be
removed from the SGSN and from the HLR. The HLR uses the
MAP\_CANCEL\_LOCATION service.

+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ VLR │ │ GLR │ │ HLR │ │ OMC │\
+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ │ │1. │\
│ │2. +\< - - - - - - - │\
│2. +\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │\
+\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │ │\
│ 3.│ │ │\
+\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 3.│ │\
│ +\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 4.│\
│ │ + - - - - - - - \>│\
│ │ │ │

1\) Modify Subscriber Data.

2\) MAP\_CANCEL\_LOCATION, MAP\_INSERT\_SUBSCRIBER\_DATA or\
MAP\_DELETE\_SUBSCRIBER\_DATA.

3\) MAP\_CANCEL\_LOCATION\_ACK, MAP\_INSERT\_SUBSCRIBER\_DATA\_ACK or\
MAP\_DELETE\_SUBSCRIBER\_DATA\_ACK.

4\) Subscriber Data Modified.

Figure 20.2.1/3: Subscriber data modification procedure

+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│SGSN │ │ GLR │ │ HLR │ │ OMC │\
+\-\-\-\--+ +\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\-\--+\
│ │ │1. │\
│ │2. +\< - - - - - - - │\
│2. +\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │\
+\<\-\-\-\-\-\-\-\-\-\-\-\-\-\--│ │ │\
│ 3.│ │ │\
+\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 3.│ │\
│ +\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>│ 4.│\
│ │ + - - - - - - - \>│\
│ │ │ │

1\) Modify Subscriber Data.

2\) MAP\_CANCEL\_LOCATION, MAP\_INSERT\_SUBSCRIBER\_DATA or\
MAP\_DELETE\_SUBSCRIBER\_DATA.

3\) MAP\_CANCEL\_LOCATION\_ACK, MAP\_INSERT\_SUBSCRIBER\_DATA\_ACK or\
MAP\_DELETE\_SUBSCRIBER\_DATA\_ACK.

4\) Subscriber Data Modified.

Figure 20.2.1/4: Subscriber data modification procedure for GPRS

In the subscriber data modification procedure the subscriber data is
modified in the HLR and when necessary also in the VLR or in the SGSN.
The HLR initiates either the MAP\_INSERT\_SUBSCRIBER\_DATA,
MAP\_DELETE\_SUBSCRIBER\_DATA or MAP\_CANCEL\_LOCATION service depending
on the modified data.

### 20.2.2 Procedures in the GLR

#### 20.2.2.1 Subscriber deletion procedure

The subscriber deletion procedure in the GLR is described in the
subclause 19.

#### 20.2.2.2 Subscriber data modification procedure

When receiving either the MAP\_INSERT\_SUBSCRIBER\_DATA indication or
the MAP\_DELETE\_SUBSCRIBER\_DATA indication, the GLR checks the
parameters and data in the primitive. Data errors are reported as an
unexpected data value error or a data missing error depending on the
nature of the error.

After receiving the first MAP\_INSERT\_SUBSCRIBER\_DATA indication, the
GLR will check the IMSI that is included in the primitive. If the IMSI
is unknown, the error \"Unidentified subscriber\" is returned.

If the GLR does not support received basic or supplementary services or
the network feature Operator Determined Barring, or there is a problem
with Regional Subscription Data then this is reported to the HLR.

If the entire MSC area that covered the VLR wherein the subscriber is
registered is restricted due to regional subscription, this is reported
to the HLR.

If the updating of the subscriber data is not possible, the GLR will
initiate the MAP\_U\_ABORT request primitive.

If the updating is successful in the GLR, the GLR will initiate the
MAP\_INSERT\_SUBSCRIBER\_DATA request or the
MAP\_DELETE\_SUBSCRIBER\_DATA request to the VLR or to the SGSN wherein
the subscriber is registered.

The subscriber data modification procedure in the GLR is shown in the
figures 20.2.2.2/1, 20.2.2.2/2, 20.2.2.2/3, 20.2.2.2/4, 20.2.2.2/5 and
20.2.2.2/6.

![](media/image34.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/1 (Sheet 1 of 3): Process INS\_SUBS\_DATA\_GLR

![](media/image35.wmf){width="6.775in" height="8.185416666666667in"}

Figure 20.2.2.2/1 (Sheet 2 of 3): Process INS\_SUBS\_DATA\_GLR

![](media/image36.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/1 (Sheet 3 of 3): Process INS\_SUBS\_DATA\_GLR

![](media/image37.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/2 (Sheet 1 of 3): Process INS\_GPRS\_SUBS\_DATA\_GLR

![](media/image38.wmf){width="6.775in" height="8.185416666666667in"}

Figure 20.2.2.2/2 (Sheet 2 of 3): Process INS\_GPRS\_SUBS\_DATA\_GLR

![](media/image39.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/2 (Sheet 3 of 3): Process INS\_GPRS\_SUBS\_DATA\_GLR

![](media/image40.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/3: Process Delete\_Subscriber\_Data\_GLR

![](media/image41.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.2.2.2/4: Process Delete\_GPRS\_Subscriber\_Data\_GLR

![](media/image42.wmf){width="6.6875in" height="8.102777777777778in"}

Figure 20.2.2.2/5: Macro Delete\_Subs\_Data\_GLR

![](media/image43.wmf){width="6.6875in" height="8.102777777777778in"}

Figure 20.2.2.2/6: Macro Delete\_GPRS\_Subs\_Data\_GLR

20.3 Subscriber Identity procedure
----------------------------------

In the subscriber identity procedure the IMSI of the subscriber is
retrieved from the HLR. The procedure is shown in figure 20.3/1.

+\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\--+\
¦ OMC ¦ ¦ VLR ¦ ¦ GLR ¦ ¦ HLR ¦\
¦ ¦ ¦ ¦ ¦ ¦ ¦ ¦\
+\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\--+ +\-\-\-\-\--+\
¦ 1.¦ ¦ ¦\
+ - - - - \>¦ 2.¦ 2.¦\
¦ +\-\-\-\-\-\-\-\-\-\-\-\--\>¦\-\-\-\-\-\-\-\-\-\-\--\>¦\
¦ ¦ 3. ¦ 3. ¦\
¦ 4. +\<\-\-\-\-\-\-\-\-\-\-\-\--+\<\-\-\-\-\-\-\-\-\-\-\--¦\
+\< - - - - ¦ ¦ ¦\
¦ ¦ ¦ ¦

1\) Identity request.

2\) MAP\_SEND\_IMSI.

3\) MAP\_SEND\_IMSI\_ACK.

4\) Identity confirm.

Figure 20.3/1: The subscriber identity procedure

### 20.3.1 Subscriber identity procedure in the GLR

The subscriber identity procedure in the GLR is shown in figure 20.3/2.

![](media/image44.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.3/2 (Sheet 1 of 2): Process Send\_IMSI\_GLR

![](media/image45.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 20.3/2 (Sheet 2 of 2): Process Send\_IMSI\_GLR

21 Call handling procedures
===========================

21.1 General
------------

The MAP call handling procedures are used:

1\. to retrieve routeing information to handle a mobile terminating
call;

2\. to transfer control of a call back to the GMSC if the call is to be
forwarded;

3\. to retrieve and transfer information between anchor MSC and relay
MSC for inter MSC group calls / broadcast calls;

4\. to allocate resources in an SIWFS;

5\. to handle the reporting of MS status for call completion services;

6\. to handle the notification of remote user free for CCBS.

Items 1, 5 and 6 are only procedures that have impact to the GLR. The
following subclause describes the function of the GLR related to these
procedures.

21.2 Retrieval of routing information
-------------------------------------

### 21.2.1 General

The message flows for successful retrieval of routeing information for a
mobile terminating call are shown in figure 21.2.1/1 (mobile terminating
call which has not been optimally routed) and 21.2.1/2 (mobile-to-mobile
call which has been optimally routed).

Notes:

*xxx = Optional Procedure*

NOTE 1: This service may also be used by an ISDN exchange for obtaining
routing information from the HLR.

NOTE 2: TUP or ISUP may be used in signalling between MSCs, depending on
the network type between the MSCs. For further details on the TUP and
ISUP procedures refer to the following ITU-T Recommendations and ETSI
specification:

Q.721‑725 ‑ Telephone User Part (TUP);

ETS 300 356-1 ‑ Integrated Services Digital Network (ISDN); Signalling
System No.7; ISDN User Part (ISUP) version 2 for the international
interface; Part 1: Basic services.

NOTE 3: As a network operator option, the HLR sends\
MAP\_PROVIDE\_SUBSCRIBER\_INFORMATION to the VLR. For further details on
the CAMEL procedures refer to GSM 3GPP TS 03.78.

Figure 21.2.1/1: Message flow for retrieval of routeing information
(non-optimally routed call)

Figure 21.2.1/2: Message flow for retrieval of routeing information
(optimally routed call)

Notes:

*xxx = Optional Procedure.*

For Optimal Routeing phase 1, only one of the information flows for
Provide Subscriber Info and Provide Roaming Number is used. For later
phases of Optimal Routeing, the HLR may return a
MAP\_SEND\_ROUTEING\_INFORMATION ack after the Provide Subscriber Info
information flow, and the GMSC may send a second MAP\_SEND\_
ROUTEING\_INFORMATION, which will trigger the Provide Roaming Number
information flow.

TUP or ISUP may be used in signalling between MSCs, depending on the
network type between the MSCs. For further details on the TUP and ISUP
procedures refer to the following CCITT. Recommendations & ETSI
specification:

Q.721‑725 ‑ Telephone User Part (TUP);

ETS 300 356-1 ‑ Integrated Services Digital Network (ISDN); Signalling
System No.7; ISDN User Part (ISUP) version 2 for the international
interface; Part 1: Basic services.

### 21.2.2 Process in the GLR to provide a roaming number

The MAP process in the GLR to provide a roaming number for a mobile
terminating call is shown in figure 21.2.2/1 (Process PRN\_Receive\_GLR)
and figure 21.2.2/2 (Process PRN\_Send\_GLR). The MAP process invokes a
macro not defined in this subclause; the definition of this macro can be
found as follows:

\- Receive\_Open\_Ind see subclause 25.1.

\- Receive\_Open\_Cnf see subclause 25.1.

\- Check\_Confirmation see subclause 25.2.

![](media/image48.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.2.2/1: Process PRN\_Receive\_GLR

![](media/image49.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.2.2/2: Process PRN\_Send\_GLR

### 21.2.3 Process in the GLR to provide subscriber information

The MAP process in the GLR to provide subscriber information for a
mobile terminating call is shown in figure 21.2.3/1 (Process PSI
Receive\_GLR) and figure 21.2.3/2 (Process PSI Send\_GLR). The MAP
process invokes a macro not defined in this subclause; the definition of
this macro can be found as follows:

Receive\_Open\_Ind see subclause 25.1.

Receive\_Open\_Cnf see subclause 25.1.

Check\_Confirmation see subclause 25.2.

![](media/image50.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.2.3/1 : Process PSI\_Receive GLR

![](media/image51.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.2.3/2 : Process PSI\_Send\_GLR

21.3 Setting of Reporting State
-------------------------------

### 21.3.1 General

In case the HLR received the CCBS request message from the other HLR for
CCSB monitoring, the message flow for setting the reporting state is
shown in figure 21.3.1/1. The message flow shown in figure 21.3.1/1
shall also be applied in case for stop monitoring. The stage2
specification for the interaction with CCBS in a GLR is in 3GPP TS
23.119.

  ----- ----------------------------------------------------------------------------------------------------- ----- --------------------------------------------------------------------------------------------------- -----
  VLR                                                                                                         GLR                                                                                                       HLR
        MAP\_SET\_REPORTING\_STATE                                                                                  MAP\_SET\_REPORTING\_STATE                                                                          
        \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--         \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--   
        MAP\_SET\_REPORTING\_STATE ack                                                                              MAP\_SET\_REPORTING\_STATE ack                                                                      
        \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>           \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>   
                                                                                                                                                                                                                        
  ----- ----------------------------------------------------------------------------------------------------- ----- --------------------------------------------------------------------------------------------------- -----

Figure 21.3.1/1: Message Flow for Setting the Reporting State

### 21.3.2 Process in the GLR to set the reporting state

The MAP process in the GLR to set the reporting state is shown in
figures 21.3.2/1 and 21.3.2/2. The MAP process invokes a macro not
define in this subclause; the definition of this macro can be found as
follows:

Receive\_Open\_Ind see subclause 25.1.

Receive\_Open\_Cnf see subclause 25.1.

Check\_Confirmation see subclause 25.2.

**Set the reporting state**

When receiving the MAP\_SET\_REPORTING\_STATE indication, the MAP user
in the GLR transfers the information to the VLR in the MAP\_
SET\_REPORTING\_STATE request.

The GLR then awaits the receipt of the MAP\_ SET\_REPORTING\_STATE
confirm from the VLR. The MAP user in the GLR shall transfer the
information contained in this primitive to the HLR in the MAP\_
SET\_REPORTING\_STATE response without checking its contents.

![](media/image52.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.3.2/1: Process Reporting\_State\_Receive\_GLR

![](media/image53.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.3.2/2: Process Reporting\_State\_Send\_GLR

21.4 Status Reporting
---------------------

### 21.4.1 General

In case that the monitored subscriber becomes to the idle state, the
message flow for reporting subscriber\'s state to the HLR is shown in
figure 21.4.1/1. The stage2 specification for the interaction with CCBS
in a GLR is in 3GPP TS 23.119.

  ----- ------------------------------------------------------------------------------------------------------- ----- ------------------------------------------------------------------------------------------------------- -----
  VLR                                                                                                           GLR                                                                                                           HLR
        MAP\_STATUS\_REPORT                                                                                           MAP\_ STATUS\_REPORT                                                                                    
        \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>         \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>   
        MAP\_STATUS\_REPORT ack                                                                                       MAP\_ STATUS\_REPORT ack                                                                                
        \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--         \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--   
                                                                                                                                                                                                                              
  ----- ------------------------------------------------------------------------------------------------------- ----- ------------------------------------------------------------------------------------------------------- -----

Figure 21.4.1/1: Message Flow for Status Reporting

### 21.4.2 Process in the GLR for Status Reporting

The MAP process in the GLR to send the status report to the HLR is shown
in figures 21.4.1/1 and 21.4.2/2.

**Send Status report**

When receiving the MAP\_STATUS\_REPORT indication, the MAP user in the
GLR transfers the information to the HLR in the MAP\_ STATUS\_REPORT
request.

The GLR then awaits the receipt of the MAP\_ STATUS\_REPORT confirm from
the HLR. The MAP user in the GLR shall transfer the information
contained in this primitive to the VLR in the MAP\_ STATUS\_REPORT
response without checking its contents.

![](media/image54.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.4.2/1: Process Status\_Report\_Receive\_GLR

![](media/image55.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.4.2/2: Process Status\_Report\_Send\_GLR

21.5 Remote User Free
---------------------

### 21.5.1 General

The message flow for handling remote user free is shown in figure
21.5.1/1.

  ----- ----------------------------------------------------------------------------------------------------- ----- ------------------------------------------------------------------------------------------------------- -----
  VLR                                                                                                         GLR                                                                                                           HLR
        MAP\_REMOTE\_USER\_FREE                                                                                     MAP\_ REMOTE\_USER\_FREE                                                                                
        \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--         \<\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--   
        MAP\_ REMOTE\_USER\_FREE ack                                                                                MAP\_ REMOTE\_USER\_FREE ack                                                                            
        \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>           \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>   
                                                                                                                                                                                                                            
  ----- ----------------------------------------------------------------------------------------------------- ----- ------------------------------------------------------------------------------------------------------- -----

Figure 21.5.1/1: Message Flow for Remote User Free

### 21.5.2 Process in the GLR for Remote User Free

The MAP process in the GLR to handling Remote User Free is shown in
figures 21.5.2/1 and 21.5.2/2.

**Remote User Free**

When receiving the MAP\_REMOTE\_USER\_FREE indication, the MAP user in
the GLR transfers the information to the VLR in the MAP\_
REMOTE\_USER\_FREE request.

The GLR then awaits the receipt of the MAP\_REMOTE\_USER\_FREE confirm
from the VLR. The MAP user in the GLR shall transfer the information
contained in this primitive to the HLR in the MAP\_REMOTE\_USER\_FREE
response without checking its contents.

![](media/image56.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.5.2/1: Process Remote\_User\_Free\_Receive\_GLR

![](media/image57.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 21.5.2/2: Process Remote\_User\_Free\_Send\_GLR

22 Supplementary services procedures
====================================

22.1 Functional supplementary service processes
-----------------------------------------------

### 22.1.1 Functional supplementary service process co-ordinator for GLR

Any functional SS process in the GLR starts by the GLR receiving a
MAP-OPEN service indication. If that service is successful, the GLR can
handle supplementary service indications from the VLR. Table 21.1/1
shows the co-ordinating process\' reaction on receipt of specific SS
service indications from the VLR. After the relevant process is invoked,
the received service indication is sent to that process, and the
co-ordinating process terminates.

Table 21.1/1: Relationship between received service indication and
invoked process in the GLR

  ----------------------------- -------------------------
  Service indication received   Process invoked
  MAP\_REGISTER\_SS\_ind        REGISTER\_SS\_GLR
  MAP\_ERASE\_SS\_ind           ERASE\_SS\_GLR
  MAP\_ACTIVATE\_SS\_ind        ACTIVATE\_SS\_GLR
  MAP\_DEACTIVATE\_SS\_ind      DEACTIVATE\_SS\_GLR
  MAP\_INTERROGATE\_SS\_ind     INTERROGATE\_SS\_GLR
  MAP\_REGISTER\_PASSWORD       REGISTER\_PASSWORD\_GLR
  ----------------------------- -------------------------

Figure 22.1/1 shows the co-ordinating process in the GLR.

![](media/image58.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.1/1 (sheet 1 of 2): Process SS\_Coordinator\_GLR

![](media/image59.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.1/1 (sheet 2 of 2): Process SS\_Coordinator\_GLR

### 22.1.2 Call completion supplementary service process co-ordinator for GLR

The MAP co-ordinating process in the GLR to handle a dialogue opened
with the call Completion application context is shown in figure 22.1/2.
The MAP process invokes a macro not defined in this subclause; the
definition of this macro can be found as follows:

Receive\_Open\_Ind see subclause 25.1.

Any call completion SS process in the GLR starts by the GLR receiving a
MAP-OPEN service indication. If that service is successful, the GLR can
handle call completion supplementary service indications from the VLR.
Table 22.1/2 shows the co-ordinating process\' reaction on receipt of
specific call completion SS service indications from the VLR. After the
relevant process is invoked, the received service indication is sent to
that process.

Table 22.1/2: Relationship between received service indication and
invoked process in the GLR

  ------------------------------- --------------------------
  Service indication received     Process invoked
  MAP\_REGISTER\_CC\_ENTRY\_ind   REGISTER\_CC\_ENTRY\_GLR
  MAP\_ERASE\_CC\_ENTRY\_ind      ERASE\_CC\_ENTRY\_GLR
  ------------------------------- --------------------------

After creation of the user process the Co-ordinator relays the messages
between the MAP\_PM and the invoked process until a request or an
indication for dialogue termination is received.

The Call\_Completion Co-ordinator is shown in figure 22.1/2.

![](media/image60.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.1/2: Process\_CC\_Coord\_GLR

22.2 Registration procedure
---------------------------

### 22.2.1 General

The registration procedure is used to register data related to a
supplementary service in the HLR. The registration procedure is a fully
transparent communication between the MS and the HLR.

### 22.2.2 Procedures in the GLR

**Supplementary service registration**

When receiving the MAP\_REGISTER\_SS indication from VLR, the MAP user
in the GLR transfers the information to the HLR in the MAP\_REGISTER\_SS
request without checking the contents of the service indication.

The GLR then awaits the receipt of the MAP\_REGISTER\_SS confirm from
the HLR. The MAP user in the GLR shall transfer the information
contained in this primitive to the VLR in the MAP\_REGISTER\_SS response
without checking its contents.

**Error handling**

If at any time during this procedure a MAP\_P\_ABORT, MAP\_U\_ABORT,
MAP\_NOTICE or unexpected MAP\_CLOSE indication is received from the VLR
concerning the process, a MAP\_U\_ABORT request indicating application
procedure cancellation is sent to the HLR (if a connection exists). If a
MAP\_NOTICE indication was received from the VLR, that dialogue must be
closed by sending a MAP\_CLOSE request towards the VLR. The process is
terminated.

If a MAP\_P\_ABORT, MAP\_U\_ABORT or MAP\_CLOSE indication is received
from the HLR, a MAP\_U\_ABORT request shall be sent to the VLR
terminating the process. If a MAP\_NOTICE indication was received from
the HLR, that dialogue must be closed by sending a MAP\_CLOSE request
towards the HLR. The process terminates.

The registration procedure in the GLR is shown in figure 22.2/1.

![](media/image61.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.2/1 (sheet 1 of 2): Procedure SS\_Register\_GLR

![](media/image62.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.2/1 (sheet 2 of 2): Procedure SS\_Register\_GLR

22.3 Erasure procedure
----------------------

### 22.3.1 General

The erasure procedure is used to erase data related to a supplementary
service in the HLR. The erasure procedure is a fully transparent
communication between the MS and the HLR.

### 22.3.2 Procedures in the GLR

The GLR procedures for erasure are identical to those specified for
registration in subclause 22.2. The text and diagrams in subclause 22.2
apply with all references to registration changed to erasure.

22.4 Activation procedure
-------------------------

### 22.4.1 General

The activation procedure is used to activate a supplementary service in
the HLR. The activation procedure is a fully transparent communication
between the MS and the HLR.

### 22.4.2 Procedures in the GLR

Supplementary service activation

When receiving the MAP\_ACTIVATE\_SS indication, the MAP user in the GLR
transfers the information to the HLR in the MAP\_ACTIVATE\_SS request
without checking the contents of the service indication.

The GLR may then receive the MAP\_GET\_PASSWORD indication. This
information is transferred to the VLR in the MAP\_GET\_PASSWORD request.
If a MAP\_GET\_PASSWORD confirm primitive is received from the VLR, the
VLR initiates the MAP\_GET\_PASSWORD response towards the HLR.

The GLR will receive the MAP\_ACTIVATE\_SS confirm from the HLR. The MAP
user in the GLR shall transfer the information contained in this
primitive to the VLR in the MAP\_ACTIVATE\_SS response without checking
its contents.

Error handling

The handling of MAP\_P\_ABORT, MAP\_U\_ABORT, MAP\_NOTICE and unexpected
MAP\_CLOSE in this procedure is identical to the handling in the
Registration procedure in the GLR, see subclause 22.2 of the present
document.

The activation procedure in the GLR is shown in figure 22.4/1.

![](media/image63.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.4/1 (sheet 1 of 2): Procedure Activate\_SS\_GLR

![](media/image64.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.4/1 (sheet 2 of 2): Procedure SS\_Activate\_GLR

22.5 Deactivation procedure
---------------------------

### 22.5.1 General

The deactivation procedure is used to deactivate a supplementary service
in the HLR. The deactivation procedure is a fully transparent
communication between the MS and the HLR.

### 22.5.2 Procedures in the GLR

The GLR procedures for deactivation are identical to those specified for
activation in subclause 22.4. The text and diagrams in subclause 22.4
apply with all references to activation changed to deactivation.

22.6 Interrogation procedure
----------------------------

### 22.6.1 General

The interrogation procedure is used to retrieve information related to a
supplementary service from the VLR or the HLR. The interrogation
procedure in the GLR is a fully transparent communication between the
VLR and the HLR.

### 22.6.2 Procedures in the GLR

The GLR procedures for interrogation are identical to those specified
for registration in subclause 22.2. The text and diagrams in
subclause 22.2 apply with all references to registration changed to
interrogation.

22.7 Password registration procedure
------------------------------------

### 22.7.1 General

The password registration procedure is used to register a password in
the HLR. The password registration procedure is a fully transparent
communication between the MS and the HLR.

### 22.7.2 Procedures in the GLR

The password registration procedure in the GLR is identical to that for
activation specified in subclause 22.4. All the text and diagrams in
subclause 22.4 apply with all references to activation changed to
password registration.

22.8 Mobile Initiated USSD procedure
------------------------------------

### 22.8.1 Procedures in the GLR

The initiation of the process is shown in subclause 22.1.

In the case that a GLR is located between the VLR and the HLR, the
Mobile Initiated USSD procedure in the GLR is a fully transparent
communication between the VLR and the HLR.

When receiving the MAP\_PROCESS\_UNSTRUCTURED\_SS\_REQUEST indication
from VLR, the MAP user in the GLR transfers the information to the HLR
in the MAP\_PROCESS\_UNSTRUCTURED\_SS\_REQUEST request without checking
the contents of the service indication.

The GLR may subsequently receive one or more
MAP\_UNSTRUCTURED\_SS\_REQUEST or MAP\_UNSTRUCTURED\_SS\_NOTIFY
indications from the HLR. These shall be sent transparently to the VLR.
When a confirmation is received from the VLR this shall be returned to
the HLR.

When the GLR receives a MAP\_PROCESS\_UNSTRUCTURED\_SS\_REQUEST
confirmation from the HLR then it shall pass this to the VLR and closes
the MAP provider service.

Error Handling

Both the VLR and the HLR may initiate release of the MAP service at any
time. This is handled as shown in the diagrams.

The procedure in the HLR is shown in figure 22.8/1.

![](media/image65.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.8/1 (sheet 1 of 2): Procedure MI\_USSD\_GLR

![](media/image66.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.8/1 (sheet 2 of 2): Procedure MI\_USSD\_GLR

![](media/image67.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.8/2: Macro MS\_Receive\_ERROR\_at\_GLR

22.9 Network initiated USSD procedure
-------------------------------------

### 22.9.1 Procedure in the GLR

In the case that a GLR is located between the VLR and the HLR, the
Network initiated USSD procedure in the GLR is a fully transparent
communication between the VLR and the HLR.

The procedure may be invoked by the HLR. It may start by using either
the MAP\_UNSTRUCTURED\_SS\_REQUEST or MAP\_UNSTRUCTURED\_SS\_NOTIFY
service.

The GLR may subsequently receive one or more
MAP\_UNSTRUCTURED\_SS\_REQUEST\_ind or
MAP\_UNSTRUCTURED\_SS\_NOTIFY\_ind indications from the VLR. These shall
be sent transparently to the HLR. When a confirmation is received from
the HLR this shall be returned to the VLR.

When the GLR receives a MAP\_CLOSE\_ind from the HLR then it shall pass
this to the VLR and close the MAP dialogue.

Error Handling

Both the VLR and the HLR may initiate release of the MAP service at any
time. This is handled as shown in the diagrams.

The Network initiated USSD procedure in the GLR is shown in
figure 22.9/1.

![](media/image68.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.9/1 (sheet 1 of 2): Procedure NI\_USSD\_GLR

![](media/image69.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.9/1 (sheet 2 of 2): Procedure NI\_USSD\_GLR

![](media/image70.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.9/2: Marco NW\_Receive\_Rrror\_at\_GLR

22.10 Common macros for clause 22
---------------------------------

### 22.10.1 SS Password handling macros

Macro Get\_Password\_GLR

This macro is used by the GLR to relay a request for password from the
HLR to the VLR, and to relay a response from the VLR back to the HLR.
The macro is described in figure 22.10/1.

![](media/image71.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.10/1: Macro Get\_PW\_GLR

22.11 Activation of a CCBS request
----------------------------------

### 22.11.1 General

The Activation of a CCBS request procedure in the GLR is a fully
transparent communication between the VLR and the HLR.

### 22.11.2 Procedure in the GLR

When receiving the MAP\_REGISTER\_CC\_ENTRY indication from VLR, the MAP
user in the GLR transfers the information to the HLR in the
MAP\_REGISTER\_CC\_ENTRY request without checking the contents of the
service indication.

When the GLR receives a MAP\_REGISTER\_CC\_ENTRY confirmation from the
HLR then it shall pass this to the VLR and closes the MAP provider
service.

The activation of a CCBS request procedure in the GLR is shown in
figure 22.11/1.

![](media/image72.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.11/1 (sheet 1 of 2): Process Register\_CC\_Entry\_GLR

![](media/image73.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.11/1 (sheet 2 of 2): Process Register\_CC\_Entry\_GLR

22.12 Deactivation of a CCBS request
------------------------------------

### 22.12.1 General

The Deactivation of a CCBS request procedure in the GLR is a fully
transparent communication between the VLR and the HLR.

### 22.12.2 Procedure in the GLR

When receiving the MAP\_ ERASE \_CC\_ENTRY indication from VLR, the MAP
user in the GLR transfers the information to the HLR in the MAP\_ ERASE
\_CC\_ENTRY request without checking the contents of the service
indication.

When the GLR receives a MAP\_ ERASE \_CC\_ENTRY confirmation from the
HLR then it shall pass this to the VLR and closes the MAP provider
service.

The deactivation of a CCBS request procedure in the GLR is shown in
figure 22.12/1.

![](media/image74.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.12/1 (sheet 1 of 2): Process Erase\_CC\_Entry\_GLR

![](media/image75.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 22.12/1 (sheet 2 of 2): Process Erase\_CC\_Entry\_GLR

23 Short message service procedures
===================================

23.1 General
------------

The short message service procedures are used to control both mobile
originated and mobile terminated short message transfer.

Four procedures exist for short message services (see 29.002) but only
the following two procedures are involved in the GLR and the IM-MSC:

\- mobile terminated short message service transfer;

\- short message alert procedure.

23.2 The mobile terminated short message transfer procedure
-----------------------------------------------------------

The mobile terminated short message transfer procedure is used for
forwarding a short message or several short messages from a Service
Centre to a mobile subscriber. This subclause includes the description
of the procedures in the IM-MSC and the GLR. The procedures in the other
existing entities are entirely the same as in the network without the
GLR and are described in 29.002.

### 23.2.1 Procedure in the Intermediate MSC

When initiating the dialogue with the IM-MSC, the SMS Gateway MSC must
provide the IMSI of the subscriber to whom the short message is
directed.

The IMSI can be included either in the Destination Reference of the
MAP\_OPEN indication received from the SMS Gateway MSC or in the
sm-RP-DA information field of the MAP\_MT\_FORWARD\_SHORT\_MESSAGE
indication.

When receiving a MAP\_OPEN indication primitive that is not associated
with any MAP service indication primitive and if the dialogue is
accepted, the MAP service-user in the IM-MSC issues a MAP\_DELIMITER
request primitive in order to trigger the local MAP service-provider to
confirm the dialogue.

When receiving the first MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication
from the gateway MSC, the IM- MSC retrieves the E.164 Number of the
servicing MSC from the GLR if the MAP service primitive is accepted.

The MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication primitive is checked by
the macro \"Check\_Indication\". If the received MAP service primitive
contains errors, the service is aborted and an unexpected data value
error or data missing error is returned to the GMSC.

The subscriber identity information that may be included in the
MAP\_OPEN indication primitive and in the MAP service indication
primitive is checked by the macro
\"Check\_Subscr\_Identity\_For\_MT\_SMS\" as follows.

If a Destination Reference has been received in the MAP\_OPEN
indication, an LMSI must be present in the sm-RP-DA information field of
the MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication. The LMSI shall be key
information for retrieving the MSC Number in the GLR.

Otherwise, if the IMSI is included in the sm-RP-DA information field of
the MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication, it is used to retrieve
the MSC Number in the GLR.

If:

a Destination Reference has been received in the IM-MSC and the sm-RP-DA
information field of the MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication
does not include an LMSI, or

no Destination Reference has been received and the sm-RP-DA information
field does not cover an IMSI;

the service is aborted in the IM-MSC and the error \"Unexpected Data
Value\" is returned to the SMS GMSC.

The interaction between the IM-MSC and the GLR for the MSC Number
retrieval is described in 3GPP TS 23.119 GLR‑stage2.

If the IM-MSC is successfully retrieves the MSC Number it initiates the
forward short message procedure to the servicing MSC. The presence of
the Destination Reference in the MAP\_OPEN request and the LMSI or IMSI
in the first MAP\_MT\_FORWARD\_SHORT\_MESSAGE request follows the
message received from the GMSC. The More Messages To Send flag is set to
TRUE or FALSE depending on the information received from the GMSC.

If the grouping of MAP\_OPEN request and
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request together would need segmenting,
these primitives must not be grouped together. The MAP\_OPEN request
primitive is sent first without any associated MAP service request
primitive and the dialogue confirmation must be received before the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request is sent.

As a response to the procedure, the IM-MSC will receive the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE confirmation indicating:

> \- a successful forwarding of the short message. This indication is
> passed to the GMSC;
>
> \- unsuccessful forwarding of the short message. This indication is
> passed to the GMSC.

The IM-MSC informs the delivery failure to the GLR, if an absent
subscriber\_SM, an unidentified subscriber or SM delivery failure with
error cause MS memory capacity exceeded indication is received from the
servicing MSC. That enables the GLR set the MNRF. The interaction
between the IM-MSC and the GLR regarding the procedure is described in
3GPP TS 23.119 GLR-stage2.

Unexpected data value, system failure errors and other errors are simply
passed to the GMSC.

If the More Messages To Send flag was TRUE in the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request and the previous short message
transfer succeeded, then the IM-MSC awaits the next short message.

When receiving the next short message from the GMSC, the IM-MSC sets the
More Messages To Send flag according to the information received and
starts the service MAP\_MT\_FORWARD\_SHORT\_MESSAGE again.

If the More Messages To Send flag was FALSE or the service
MAP\_MT\_FORWARD\_SHORT\_MESSAGE ends unsuccessfully, the transaction to
the gateway MSC is terminated.

The mobile terminated short message transfer procedure in the IM-MSC is
shown in figure 23.2/1 and 23.2/2.

![](media/image76.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/1 (sheet1 of 3): Procedure\_MT\_SM\_Transfer\_IM-MSC

![](media/image77.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/1 (sheet 2 of 3): Procedure MT\_SM\_Transfer\_IM-MSC

![](media/image78.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/1 (sheet 3 of 3): Procedure MT\_SM\_Transfer\_IM-MSC

![](media/image79.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/2 (sheet1 of 2): Macro MT\_SM\_IM-MSC

![](media/image80.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/2 (sheet2 of 2): Macro MT\_SM\_IM-MSC

### 23.2.2 Procedure in the GLR

When initiating the dialogue with the GLR, the SMS Gateway MSC must
provide the IMSI of the subscriber to whom the short message is
directed.

The IMSI is included in the sm-RP-DA information field of the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication.

When receiving a MAP\_OPEN indication primitive that is not associated
with any MAP service indication primitive and if the dialogue is
accepted, the MAP service-user in the GLR issues a MAP\_DELIMITER
request primitive in order to trigger the local MAP service-provider to
confirm the dialogue.

When receiving the first MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication
from the gateway MSC, the GLR performs some subscriber data checks, if
the MAP service primitive is accepted.

The MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication primitive is checked by
the macro \"Check\_Indication\". If the received MAP service primitive
contains errors, the service is aborted and an unexpected data value
error or data missing error is returned to the GMSC.

The subscriber identity information that is included in the MAP service
indication primitive is checked by the macro
\"Check\_Subscr\_Identity\_For\_MT\_SMS\" as follows:

If the IMSI is included in the sm-RP-DA information field of the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE indication, the MAP\_OPEN indication
received from the gateway MSC shall not include a Destination Reference.

If no Destination Reference has been received and the sm-RP-DA
information field does not cover an IMSI the service is aborted in the
GLR and the error \"Unexpected Data Value\" is returned to the GMSC.

The following outcomes from the subscriber data checks can occur in GLR:

\- if the mobile subscriber is unknown, the unidentified subscriber
error is forwarded to the GMSC;

\- if the \"Confirmed by HLR\" indicator is set to \"Not Confirmed\",
the unidentified subscriber error is forwarded to the GMSC.

If the mobile subscriber is known and \"Confirmed by HLR\" indicator is
set to \"Confirmed\", the GLR shall successfully retrieves the SGSN
Number.

If the GLR is successfully retrieves the SGSN Number it initiates the
forward short message procedure to the SGSN. The IMSI is included in the
sm-RP-DA information field of the MAP\_MT\_FORWARD\_SHORT\_MESSAGE
request. More Messages To Send flag is set to TRUE or FALSE depending on
the information received from the GMSC.

If the grouping of MAP\_OPEN request and
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request together would need segmenting,
these primitives must not be grouped together. The MAP\_OPEN request
primitive is sent first without any associated MAP service request
primitive and the dialogue confirmation must be received before the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request is sent.

As a response to the procedure, the GLR will receive the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE confirmation indicating:

> \- a successful forwarding of the short message. This indication is
> passed to the GMSC;
>
> \- unsuccessful forwarding of the short message. This indication is
> passed to the GMSC.

The GLR sets MNRG, if an absent subscriber\_SM (except for the case that
absent subscriber reason is PurgedMS), an unidentified subscriber or SM
delivery failure with error cause MS memory capacity exceeded indication
is received from the SGSN.

If the GLR receives an absent subscriber\_SM and absent subscriber
reason is PurgedMS, the GLR deletes the subscriber data for the user.

Unexpected data value, system failure errors and other errors are simply
passed to the GMSC.

If the More Messages To Send flag was TRUE in the
MAP\_MT\_FORWARD\_SHORT\_MESSAGE request and the previous short message
transfer succeeded, then the GLR awaits the next short message.

When receiving the next short message from the GMSC, the GLR sets the
More Messages To Send flag according to the information received and
starts the service MAP\_MT\_FORWARD\_SHORT\_MESSAGE again.

If the More Messages To Send flag was FALSE or the service
MAP\_MT\_FORWARD\_SHORT\_MESSAGE ends unsuccessfully, the transaction to
the gateway MSC is terminated.

The mobile terminated short message transfer procedure in the GLR is
shown in figure 23.2/3 and 23.2/4.

![](media/image81.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/3 (sheet 1 of 3): Procedure MT\_SM\_Transfer\_GLR

![](media/image82.wmf){width="6.745138888888889in"
height="8.158333333333333in"}

Figure 23.2/3 (sheet 2 of 3): Procedure MT\_SM\_Transfer\_GLR

![](media/image83.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/3 (sheet 3 of 3): Procedure MT\_SM\_Transfer\_GLR

![](media/image84.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.2/4 (sheet1 of 2): Macro MT\_SM\_GLR

![](media/image85.wmf){width="6.5875in" height="7.966666666666667in"}

Figure 23.2/4 (sheet2 of 2): Macro MT\_SM\_GLR

23.3 The Short Message Alert procedure
--------------------------------------

The Short Message Alert procedure is used for alerting the Service
Centre when the mobile subscriber is active after a short message
transfer has failed because the mobile subscriber is not reachable or
when the MS has indicated that it has memory capacity to accept a short
message.

### 23.3.1 Procedures in the GLR

When the GLR receives MAP\_READY\_FOR\_SM indication from the VLR or the
SGSN and it has MNRF or MNRG, it sends MAP\_READY\_FOR\_SM request to
the HLR.

If the outcome is successful, the MNRF or MNRG is cleared.

The short message alert procedure in the GLR is shown in figure 23.3/1.

![](media/image86.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.3/1 (sheet 1 of 2): Process SM\_Alert\_GLR

![](media/image87.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 23.3/1 (sheet 2 of 2): Process SM\_Alert\_GLR

24 GPRS process description
===========================

24.1 General
------------

The MAP GPRS procedures are used for the Network Requested PDP-Context
Activation procedures.

The stage 2 specification for Packet Switched Service involving GLR is
in 3GPP TS 23.119.

24.2 Send Routing Information procedure
---------------------------------------

### 24.2.1 Process in the GLR for Send Routing Information for GPRS

The MAP process in the GLR to provide routing information for a
network-requested PDP context activation is shown in figure 24.2/1. The
MAP process invokes a macro not defined in this subclause; the
definition of this macro can be found as follows:

\- Receive\_Open\_Ind see subclause 25.1;

\- Check\_Indication see subclause 25.2.

Successful outcome

When the MAP process receives a MAP\_OPEN indication with the
application context gprsLocationInfoRetrieval, it checks it by invoking
the macro Receive\_Open\_Ind.

If the macro takes the OK exit, the MAP process waits for a service
indication.

If a MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service indication is received,
the GLR sends a Send Routing Info For Gprs request to the GPRS
application process in the GLR, and wait for a response. The Send
Routing Info For Gprs request contains the parameter received in the
MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service indication.

If the GPRS application process in the GLR returns a positive response
containing the routing information, the MAP process constructs a
MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service response containing the
routing info, constructs a MAP\_CLOSE service request, sends them to the
IM-GSN and returns to the idle state.

Negative response from GLR GPRS application process

If the GPRS application process in the GLR returns a negative response,
the MAP process constructs a MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service
response containing the appropriate error, constructs a MAP\_CLOSE
service request, sends them to the IM-GSN and returns to the idle state.

Failure of dialogue opening with the IM-GSN

If the macro Receive\_Open\_Ind takes the Vr exit or the Error exit, the
MAP process returns to the idle state.

If the MAP provider sends a MAP\_P\_ABORT while the MAP process is
waiting for a service indication, the MAP process returns to the idle
state.

If the MAP provider sends a MAP\_NOTICE while the MAP process is waiting
for a service indication, the MAP process sends a MAP\_CLOSE request to
terminate the dialogue and returns to the idle state.

![](media/image88.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 24.2/1: Process Send Routing Info For Gprs\_GLR

### 24.2.2 Process in the IM-GSN for Send Routing Information for GPRS

Successful Outcome

When the MAP process receives a Send Routing Info For Gprs request from
the GPRS application process in the IM-GSN, it:

\- requests a dialogue with the GLR whose identity is contained in the
Send Routing Info For Gprs request by sending a MAP\_OPEN service
request;

\- requests routeing information using a
MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service request, and

\- invokes the macro Receive\_Open\_Cnf to wait for the response to the
dialogue opening request.

If the dialogue opening is successful, the MAP process waits for a
response from the GLR.

If the MAP process receives a MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS
service confirm from the GLR, the MAP process invokes the macro
Check\_Confirmation to check the content of the confirmation.

If the macro Check\_Confirmation takes the OK exit, the MAP process
sends a Send Routing Info For Gprs ack containing the routing
information received from the GLR to the GPRS application process in the
IM-GSN and returns to the idle state.

Failure of dialogue opening with the GLR

If the macro Receive\_Open\_Cnf takes the Vr exit or the Error exit, the
MAP process sends a negative response to the GPRS application process in
the IM-GSN and returns to the idle state.

Error in MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS confirm

If the MAP\_SEND\_ROUTING\_INFO\_FOR\_GPRS service confirm contains a
user error or a provider error, or the macro Check\_Confirmation
indicates that there is a data error, the MAP process sends a Send
Routing Info For Gprs negative response to the GPRS application process
in the IM-GSN and returns to the idle state.

Abort of GLRdialogue

After the dialogue with the GLR has been established, the MAP service
provider may abort the dialogue by issuing a MAP\_P\_ABORT or a
MAP\_U\_ABORT indication. In this case, the MAP process sends a Send
Routing Info For Gprs negative response to the GPRS application process
in the IM-GSN and returns to the idle state.

If the MAP provider indicates a protocol problem by sending a
MAP\_NOTICE indication, the MAP process closes the dialogue with the
GLR, sends a Send Routing Info For Gprs negative response indicating
system failure to the GPRS application process in the IM-GSN and returns
to the idle state.

![](media/image89.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 24.2/2: Process Send\_Routing\_Info\_For\_Gprs\_IM-GSN

24.3 Failure Report procedure
-----------------------------

### 24.3.1 Process in the GLR for Failure Report

The MAP process in the GLR to set the MNRG (Mobile station Not Reachable
for GPRS) flag for the subscriber is shown in figure 24.3/1. The MAP
process invokes a macro not defined in this subclause; the definition of
this macro can be found as follows:

\- Receive\_Open\_Ind see subclause 25.1;

\- Check Indication see subclause 25.2.

Successful outcome

When the MAP process receives a MAP\_OPEN indication with the
application context failureReport, it checks it by invoking the macro
Receive\_Open\_Ind.

If the macro takes the OK exit, the MAP process waits for a service
indication.

If a MAP\_FAILURE\_REPORT service indication is received, the GLR sends
a Failure Report request to the GPRS application process in the GLR, and
wait for a response. The Failure Report request contains the parameter
received in the MAP\_FAILURE\_REPORT service indication.

If a positive response is received, the MAP process constructs a
MAP\_FAILURE\_REPORT service response, constructs a MAP\_CLOSE service
request, sends them to the IM-GSN and returns to the idle state.

Negative response from GLR GPRS application process

If the GPRS application process in the GLR returns a negative response,
the MAP process constructs a MAP\_FAILURE\_REPORT service response
containing the appropriate error, constructs a MAP\_CLOSE service
request, sends them to the IM-GSN and returns to the idle state.

Failure of dialogue opening with the IM-GSN

If the macro Receive\_Open\_Ind takes the Vr exit or the Error exit, the
MAP process returns to the idle state.

If the MAP provider sends a MAP\_P\_ABORT while the MAP process is
waiting for a service indication, the MAP process returns to the idle
state.

If the MAP provider sends a MAP\_NOTICE while the MAP process is waiting
for a service indication, the MAP process sends a MAP\_CLOSE request to
terminate the dialogue and returns to the idle state.

![](media/image90.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 24.3/1: Process Failure\_Report\_GLR

### 24.3.2 Process in the IM-GSN for Failure Report

Successful Outcome

When the MAP process receives a Failure Report request from the GPRS
application process in the IM-GSN, it requests a dialogue with the GLR
whose identity is contained in the Failure Report request by sending a
MAP\_OPEN service request, sending failure information using a
MAP\_FAILURE\_REPORT service request and invokes the macro
Receive\_Open\_Cnf to wait for the response to the dialogue opening
request. If the dialogue opening is successful, the MAP process waits
for a response from the GLR.

If the MAP process receives a MAP\_FAILURE\_REPORT service confirm from
the GLR, the MAP process invokes the macro Check\_Confirmation to check
the content of the confirmation.

If the macro Check\_Confirmation takes the OK exit, the MAP process
sends a Failure Report ack containing the information received from the
GLR to the GPRS application process in the IM-GSN and returns to the
idle state.

Failure of dialogue opening with the GLR

If the macro Receive\_Open\_Cnf takes the Vr exit or the Error exit, the
MAP process sends a negative response to the GPRS application process in
the IM-GSN and returns to the idle state.

Error in MAP\_FAILURE\_REPORT confirm

If the MAP\_FAILURE\_REPORT service confirm contains a user error or a
provider error, or the macro Check\_Confirmation indicates that there is
a data error, the MAP process sends a Failure Report negative response
to the GPRS application process in the IM-GSN and returns to the idle
state.

Abort of GLR dialogue

After the dialogue with the GLR has been established, the MAP service
provider may abort the dialogue by issuing a MAP\_P\_ABORT or a
MAP\_U\_ABORT indication. In this case, the MAP process sends a Failure
Report negative response to the GPRS application process in the IM-GSN
and returns to the idle state.

If the MAP provider indicates a protocol problem by sending a
MAP\_NOTICE indication, the MAP process closes the dialogue with the
GLR, sends a Failure Report negative response indicating system failure
to the GPRS application process in the IM-GSN and returns to the idle
state.

![](media/image91.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 24.3/2: Process Failure\_Report\_IM-GSN

25 General macro description
============================

25.1 MAP open macros
--------------------

This subclause refers 3GPP TS 29.002.

25.2 Macros to check the content of indication and confirmation primitives
--------------------------------------------------------------------------

This subclause refers 3GPP TS 29.002.

25.3 Authentication processes
-----------------------------

### 25.3.1 Process Obtain\_Authentication\_Sets\_GLR

This process is initiated by the GLR to fetch authentication vectors
from a subscriber\'s HLR to the VLR. The process is described in
figure 25.3/1.

![](media/image92.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 25.3.1/1 (sheet 1 of 2): Process
Obtain\_Authentication\_Sets\_GLR

![](media/image93.wmf){width="6.768055555555556in"
height="8.185416666666667in"}

Figure 25.3.1/2 (sheet 2 of 2): Process
Obtain\_Authentication\_Sets\_GLR

### 25.3.2 Process Authentication\_Failure\_Report\_GLR

This process is initiated by the GLR to notify a subscriber\'s HLR about
the occurrence of an authentication failure in the VLR or SGSN. The
process is described in figure 25.3/2.

![](media/image94.wmf){width="6.651388888888889in"
height="8.378472222222221in"}

Figure 25.3.2/1 (sheet 1 of 2): Process
Authentication\_Failure\_Report\_GLR

![](media/image95.wmf){width="6.651388888888889in"
height="8.029861111111112in"}

Figure 25.3.2/2 (sheet 2 of 2): Process Authentication\_ Failure\_Report
\_GLR

25.4 Short Message Alert procedures
-----------------------------------

### 25.4.1 Subscriber\_Present\_GLR\_AS\_VLR process

The Subscriber\_Present\_GLR\_AS\_VLR process is invoked by the GLR,
when GLR receives Update Location from VLR and the MNRF flag is set. The
general description of the short message alert procedures is in the
subclause 23.3.

The GLR sends the MAP\_READY\_FOR\_SM request to the HLR and waits for
the HLR to answer. When receiving the answer, the GLR will act as
follows:

\- the MNRF flag is cleared if the procedure is successful;

\- the MNRF flag is not cleared if the procedure is not successful.

The Subscriber\_Present\_GLR\_AS\_VLR process is shown in the
figure 25.4/1.

![](media/image96.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 25.4/1: Process Subscriber\_Present\_GLR\_AS\_VLR

### 25.4.2 The Mobile Subscriber is present

When GLR receives Update GPRS Location from SGSN, while the MS not
reachable for GPRS (MNRG) flag is set, the GLR will send the
MAP\_READY\_FOR\_SM request towards the HLR. The Alert Reason is set to
indicate that the mobile subscriber is present for GPRS.

When receiving the answer, the GLR will act as follows:

\- MNRG is cleared if the procedure is successful.

\- MNRG is not cleared if the procedure is not successful.

The Subscriber\_Present\_GLR\_AS\_SGSN process is shown in the figure
25.4/2.

![](media/image97.wmf){width="6.768055555555556in"
height="8.539583333333333in"}

Figure 25.4/2: Process Subscriber\_Present\_GLR\_AS\_SGSN

######## Annex A (informative): Change history

  ---------- -------- ------- ----------- ------------- ----------------------------------------------------------
  TSG CN\#   Spec     CR      \<Phase\>   New Version   Subject/Comment
  CN\#07     29.120           R99         3.0.0         Approved at TSGN\#07
  CN\#09     29.120   001r1   R99         3.1.0         Changes to support Authentication Failure Report for GLR
  CN\#09     29.120   002     Rel-4       4.0.0         Changes to support secure transport MAP for GLR
  CN\#16     29.120           Rel-5       5.0.0         Rel-5 created after CN\#16
  CN\#26     29.120           Rel-6       6.0.0         Rel-6 created after CN\#26
  CT\#36     29.120           Rel-7       7.0.0         Upgraded unchanged from Rel-6
  CT\#42     29.120           Rel-8       8.0.0         Upgraded unchanged from Rel-7
  2009-12    29.120   \-      Rel-9       9.0.0         Update to Rel-9 version (MCC)
  2011-03    29.120   \-      Rel-10      10.0.0        Update to Rel-10 version (MCC)
  2012-09    29.120   \-      Rel-11      11.0.0        Update to Rel-11 version (MCC)
  2014-09    29.120   \-      Rel-12      12.0.0        Update to Rel-12 version (MCC)
  2015-12    29.120   \-      Rel-13      13.0.0        Update to Rel-13 version (MCC)
  2017-03    29.120   \-      Rel-14      14.0.0        Update to Rel-14 version (MCC)
  2018-06    29.120   \-      Rel-15      15.0.0        Update to Rel-15 version (MCC)
  2020-07    29.120   \-      Rel-16      16.0.0        Update to Rel-16 version (MCC)
  ---------- -------- ------- ----------- ------------- ----------------------------------------------------------
