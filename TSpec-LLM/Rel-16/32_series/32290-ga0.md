![](media/image1.jpeg){width="7.0875in" height="3.4229166666666666in"}

  {#section .TT}

Contents {#contents .TT}
========

[5](#foreword)

[6](#scope)

[6](#references)

[7](#definitions-symbols-and-abbreviations)

[7](#definitions)

[7](#symbols)

[7](#abbreviations)

[8](#architecture-reference-model)

[8](#general)

[8](#reference-architecture)

[8](#charging-function-requirement)

[8](#offline-charging-scenario)

[8](#basic-principles)

[8](#charging-scenarios)

[8](#introduction)

[9](#scenarios)

[9](#event-based-charging)

[10](#session-based-charging)

[11](#online-charging-scenario)

[11](#basic-principles-1)

[11](#charging-scenarios-1)

[11](#introduction-1)

[12](#scenarios-1)

[12](#void)

[12](#converged-charging-scenario)

[12](#basic-principles-2)

[12](#charging-scenarios-2)

[12](#introduction-2)

[12](#event-based-charging-1)

[13](#session-based-charging-1)

[23](#switch-between-quota-managed-and-not-quota-managed)

[24](#other-functionalities)

[24](#re-authorization)

[25](#threshold-based-re-authorization-triggers)

[25](#termination-action)

[25](#service-termination)

[25](#trigger-mechanism)

[26](#chf-controlled-quota-management)

[26](#error-handling)

[26](#failure-handling)

[26](#ctf-detected-failure)

[26](#chf-detected-failure)

[27](#retry-handling)

[27](#response-code-handling)

[28](#service-definition)

[28](#nf-service-framework)

[28](#nchf_convergedcharging-service)

[28](#general-1)

[29](#nchf_convergedcharging_create-service-operation)

[29](#nchf_convergedcharging_update-service-operation)

[30](#nchf_convergedcharging_release-service-operation)

[30](#nchf_convergedcharging_notify-service-operation)

[30](#nchf_spendinglimitcontrol-service)

[30](#overview)

[31](#void-1)

[31](#nchf_offlineonlycharging-service)

[31](#general-2)

[31](#nchf_offlineonlycharging_create-service-operation)

[31](#nchf_offlineonlycharging_update-service-operation)

[32](#nchf_offlineonlycharging_release-service-operation)

[32](#message-contents)

[37](#annex-a-informative-change-history)Foreword 1 Scope 2 References 3
Definitions, symbols and abbreviations 3.1 Definitions 3.2 Symbols 3.3
Abbreviations 4 Architecture reference model 4.1 General 4.2 Reference
architecture 5 Charging function requirement 5.1 Offline charging
scenario 5.1.1 Basic principles 5.1.2 Charging scenarios 5.1.2.1
Introduction 5.1.2.2 Scenarios 5.1.2.2.1 Event based charging 5.1.2.2.2
Session based charging 5.2 Online charging scenario 5.2.1 Basic
principles 5.2.2 Charging scenarios 5.2.2.1 Introduction 5.2.2.2
Scenarios 5.2.3 Void 5.3 Converged Charging scenario 5.3.1 Basic
principles 5.3.2 Charging scenarios 5.3.2.1 Introduction 5.3.2.2 Event
based charging 5.3.2.3 Session based charging 5.3.2.5 Switch between
quota managed and not quota managed 5.4 Other functionalities 5.4.1
Re-authorization 5.4.2 Threshold based re-authorization triggers 5.4.3
Termination action 5.4.4 Service termination 5.4.5 Trigger Mechanism
5.4.6 CHF-controlled quota management 5.5 Error handling 5.5.1 Failure
handling 5.5.1.1 CTF detected failure 5.5.1.2 CHF detected failure 5.5.2
Retry handling 5.5.3 Response code handling 6 Service definition 6.1 NF
service framework 6.2 Nchf\_ConvergedCharging service 6.2.1 General
6.2.2 Nchf\_ConvergedCharging\_Create service operation 6.2.3
Nchf\_ConvergedCharging\_Update service operation 6.2.4
Nchf\_ConvergedCharging\_Release service operation 6.2.5
Nchf\_ConvergedCharging\_Notify service operation 6.3
Nchf\_SpendingLimitControl service 6.3.1 Overview 6.4 Void 6.5
Nchf\_OfflineOnlyCharging service 6.5.1 General 6.5.2
Nchf\_OfflineOnlyCharging\_Create service operation 6.5.3
Nchf\_OfflineOnlyCharging\_Update service operation 6.5.4
Nchf\_OfflineOnlyCharging\_Release service operation 7 Message contents
Annex A (informative): Change history

Foreword
========

This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document specifies service, operations and procedures of 5G
charging for service based interface. This charging description includes
the charging architecture and scenarios as well as the mapping of the
common charging architecture specified in TS 32.240 \[1\]. The present
document is related to other 3GPP charging TSs as follows:

\- The common 3GPP charging architecture is specified in TS 32.240
\[1\].

\- The protocol that are used for service based interface is specified
in TS 32.291 \[58\].

The description is following the same methodology as used in TS 23.501
\[201\] and TS 23.502 \[202\] for the 5G system.

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TS 32.240: \"Telecommunication management; Charging
management; Charging architecture and principles\".

\[2\] - \[29\] Void.

\[30\] 3GPP TS 32.255: \"Telecommunication management; Charging
management; 5G Data connectivity domain charging; stage 2\".

\[31\] Void.

\[32\] 3GPP TS 32.254: \"Telecommunication management; Charging
management; Exposure function Northbound Application Program Interfaces
(APIs) charging\".

\[33\] 3GPP TS 32.256: \"Telecommunication management; Charging
management; 5G connection and mobility domain charging; Stage 2\".

\[34\] 3GPP TS 32.274: \"Telecommunication management; Charging
management; Short Message Service (SMS) charging\".

\[35\] 3GPP TS 28.201: \"Telecommunication management; Charging
management; Network slice performance and analytics charging in the 5G
System (5GS); Stage 2\".

\[36\] 3GPP TS 28.202: \"Telecommunication management; Charging
management; Network slice management charging in the 5G System (5GS);
Stage 2\".

\[37\] - \[49\] Void.

\[50\] 3GPP TS 32.299: \"Telecommunication management; Charging
management; Diameter charging application\".

\[51\] - \[54\] Void.

\[55\] - \[57\] Void.

\[58\] 3GPP TS 32.291: \"Telecommunication management; Charging
management; 5G system; Charging service, stage 3.

\[59\] - \[99\] Void.

\[100\] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".

\[101\] - \[200\] Void.

\[201\] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage
2\".

\[202\] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".

\[203\] - \[206\] Void.

\[207\] - \[299\] Void.

\[300\] 3GPP TS 29.510: \" 5G System; Network function repository
services; Stage 3\".

\[301\] - \[370\] Void.

\[371\] - \[399\] Void.

\[400\] - \[499\] Void.

\[500\] - \[599\] Void.

3 Definitions, symbols and abbreviations
========================================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions
given in 3GPP TR 21.905 \[100\], TS 32.240 \[1\] and the following
apply. A term defined in the present document takes precedence over the
definition of the same term, if any, in either 3GPP TR 21.905 \[100\] or
TS 32.240 \[1\].

**5G Access Network:** An access network comprising a NG-RAN and/or
non-3GPP AN connecting to a 5G Core Network.

**5G Core Network:** The core network specified in the present document.
It connects to a 5G Access Network.

**NF service:** a functionality exposed by a NF through a service based
interface and consumed by other authorized NFs.

**NF service operation:** An elementary unit a NF service is composed
of.

**service based interface:** It represents how a set of services is
provided/exposed by a given NF.

**charging session:** The association between the CHF (NF Service
Producer) that provides the charging service and NF service consumer.

3.2 Symbols
-----------

For the purposes of the present document, the following symbols apply:

Nchf Service-based interface exhibited by Charging Function.

3.3 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
3GPP TR 21.905 \[100\] and the following apply. An abbreviation defined
in the present document takes precedence over the definition of the same
abbreviation, if any, in 3GPP TR 21.905 \[100\].

5GC 5G Core Network

5GS 5G System

AMF Access and Mobility Management Function

CCS Converged Charging System

CEF Charging Enablement Function

CHF Charging Function

IEC Immediate Event Charging

MnS Management Service

NF Network Function

PCF Policy Control Function

SBI Service based Interface

SMSF Short Message Service Function

SMF Session Management Function

4 Architecture reference model
==============================

4.1 General
-----------

The present document describes the service based architecture for 5G
Charging.

4.2 Reference architecture
--------------------------

The NFs with CTF interact with CHF using Nchf interface for converged
charging or offline only charging. The NF PCF interacts with CHF using
Nchf interface for Spending Limit Control. The Nchf is a service based
interface for NF and CHF.

Figure 4.2.1 depicts the reference architecture for the Nchf Interface.

Figure 4.2.1: Reference Architecture for the Nchf Interface; SBI
representation

5 Charging function requirement
===============================

5.1 Offline charging scenario
-----------------------------

### 5.1.1 Basic principles

Basic principles for offline charging are defined in TS 32.240 \[1\].

### 5.1.2 Charging scenarios

#### 5.1.2.1 Introduction

Two basic scenarios are used:

\- Event based charging;

\- Session based charging.

Both scenarios may generate CDR files, which may then be transferred to
the network operator\'s BD for the purpose of subscriber billing and/or
inter-operator accounting.

#### 5.1.2.2 Scenarios

##### 5.1.2.2.1 Event based charging

Figure 5.1.2.2.1.1 shows a scenario for Post Event Charging, (PEC) where
the NF (CTF) interacts with the CHF after the service delivery.

Figure 5.1.2.2.1.1: Post Event Charging

**1) Request for resource usage:** A request for session establishment
is received in the NF (CTF).

**2) Content/Service Delivery:** the NF (CTF) delivers the
content/service.

**3) Charging Data Request \[Event\]:** The NF (CTF) the CTF generates
charging data related to the delivered service and sends the request for
the CHF to store related charging data for CDR generation purpose.

**4) Create CDR:** the CHF stores received information and creates a CDR
related to the service.

**5) Charging Data Response \[Event\]:** The CHF informs the NF (CTF) on
the result of the request.

##### 5.1.2.2.2 Session based charging

Figure 5.1.2.2.2.1 shows a scenario for Offline session based charging
where the NF (CTF) interacts with the CHF.

Figure 5.1.2.2.2.1: Offline charging

**1) Request for service delivery and start of service delivery:** A
request for session establishment is received in the NF (CTF).

**2) Charging Data Request \[Initial\]:** The NF (CTF) sends the request
to inform the CHF about the service to be started.

**3) Open CDR:** the CHF opens a CDR related to the service.

**4) Charging Data Response \[Initial\]:** The CHF informs the NF (CTF)
on the result of the request and optionnaly provides the usage reporting
triggers applicable to the service.

**5) Content/Service Delivery:** the NF (CTF) delivers the
content/service.

**6) Usage Reporting Trigger:** the NF (CTF) generates charging data
related to service delivered, based on a trigger for usage reporting is
met.

**7) Charging Data Request \[Update\]:** the NF (CTF) sends the request
for reporting the related charging data to the CHF.

**8) Update CDR:** the CHF updates the CDR with charging data related to
the service.

**9) Charging Data Response \[Update\]:** The CHF informs the NF (CTF)
on the result of the request.

**10) Content/Service Delivery:** the NF (CTF) delivers the
content/service.

**11) Service release:** the service is released.

**12) Charging Data Request \[Termination\]:** the NF (CTF) sends the
request to the CHF, for charging data related to the service
termination.

**13) Close CDR:** the CHF closes the CDR with charging data related to
the service termination.

**14) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF) on the result of the request.

5.2 Online charging scenario
----------------------------

### 5.2.1 Basic principles

Basic principles for online charging are defined in TS 32.240 \[1\].

### 5.2.2 Charging scenarios

#### 5.2.2.1 Introduction

The following basic scenarios are used:

1 Immediate Event Charging

a\) Decentralized Unit Determination and Centralized Rating

b\) Centralized Unit Determination and Centralized Rating

c\) Decentralized Unit Determination and Decentralized Rating

2 Event charging with Unit Reservation

a\) Decentralized Unit Determination and Centralized Rating

b\) Centralized Unit Determination and Centralized Rating

c\) Decentralized Unit Determination and Decentralized Rating

3 Session charging with Unit Reservation

a\) Decentralized Unit Determination and Centralized Rating

b\) Centralized Unit Determination and Centralized Rating

c\) Decentralized Unit Determination and Decentralized Rating

The combination of Centralized Unit Determination with Decentralized
Rating is not possible.

#### 5.2.2.2 Scenarios

The scenarios described in TS 32.299 \[50\], clauses 5.2.2.1, 5.2.2.2
and 5.2.2.3, apply with the CHF acting as an OCF.

### 5.2.3 Void

5.3 Converged Charging scenario
-------------------------------

### 5.3.1 Basic principles

When offline charging and online charging are applicable to a service
delivery, the charging information of both offline charging (without
quota management) and online charging (with quota management) can be
provided in a single command. The triggering for reporting the charging
information can be any triggers of the offline charging or online
charging (deferred or immediate triggers).

The invocation of the Charging Data Request for start of service, in
case there is no valid quota for the rating group, can be done in either
blocking mode or non-blocking mode:

> \- blocking mode: the service delivery shall not start before its
> authorization from CHF;

\- non-blocking mode: the service delivery may start before its
authorization from CHF.

For invoking the ConvergedCharging service with quota management,
the ConvergedCharging service will operate in decentralized unit
determination with the provided amounts of the Quota Requested
information element otherwise if no amount is included in the Quota
Requested information element, the ConvergedCharging service will
operate in centralized unit determination and rating.

### 5.3.2 Charging scenarios

#### 5.3.2.1 Introduction

Converged charging for both events and sessions between CTF and the CHF
is performed as defined in TS 32.240 \[1\].

Two basic scenarios are used:

\- Converged Event based charging;

\- Converged Session based charging.

#### 5.3.2.2 Event based charging

For Converged Event based Charging, he following cases are supported:

\- Immediate Event Charging (IEC);

\- Post Event Charging (PEC).

The scenario for Event based charging supported by IEC is shown in
figure 5.3.2.2.1 with: Decentralized and Centralized Unit Determination,
Centralized Rating configurationand user\'s account balance deduction
before service delivery, where the NF (CTF) may invoke converged
charging service towards the CHF, prior to service delivery if needed.

Figure 5.3.2.2.1: IEC- Event based charging with Decentralized and
Centralized Unit Determination, Centralized Rating

**1) Request for resource usage:** A request for session establishment
is received in the NF (CTF). The service is configured to be authorized
by the CHF to start.

**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.

**3) Charging Data Request \[Event, Units\]:** The NF (CTF) sends the
request to the CHF for the service to be granted authorization, and to
allow the number of units, if determined in item 2, to be rated and
accounted.

**4) Account, Rating Control:** The CHF calculates the number of
monetary units that represents the price and makes deduction of the
calculated amount from user\'s account balance based on the number of
units requested or on internal unit determination, if the user\'s credit
balance is sufficient.

**5) Create CDR:** based on policies, the CHF creates a CDR related to
the service.

**6) Charging Data Response \[Event, Units\]:** The CHF grants
authorization to NF (CTF) for the service to start, with a number of
granted units.

**7) Granted Units Supervision:** The service starts and the NF (CTF)
monitors the consumption of the granted units.

**8) Content/Service Delivery:** the NF (CTF) delivers the
content/service based on the number of units.

The scenario for Event based charging supported by PEC is described in
figure 5.1.2.2.1.1.

#### 5.3.2.3 Session based charging

For Converged Session based Charging, the following cases are supported:

\- SCUR

\- ECUR

Figure 5.3.2.3.1 shows a blocking mode scenario for Session based
charging (SCUR) with: Unit Reservation, Decentralized and Centralized
Unit Determination, Centralized Rating configuration, user's account
deduction, where the NF (CTF) invokes a converged charging service
towards the CHF.

Figure 5.3.2.3.1: SCUR - Session based charging with Decentralized and
Centralized Unit Determination, Centralized Rating

**1) Request for service delivery:** A request for session establishment
is received in the NF (CTF). The service is configured to be authorized
by the CHF to start.

**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.

**3) Charging Data Request \[Initial, Quota Requested\]:** The NF (CTF)
sends the request to the CHF for the service to be granted authorization
to start, and to reserve the number of units if determined in item 2.

**4) Account, Rating, Reservation Control:** the CHF rates the requests
either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the
user\'s account balance. If the account has sufficient funds, the CHF
performs the corresponding reservations.

**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.

**6) Charging Data Response \[Initial, Quota Granted\]:** The CHF grants
authorization to NF (CTF) for the service to start, with the reserved
number of units.

**7) Granted Units Supervision:** the NF (CTF) monitors the consumption
of the granted units.

**8) Start of service delivery:** the NF (CTF) starts to deliver the
content/service based on the reserved number of units.

**9) Usage Reporting Trigger:** the NF (CTF) generates charging data
related to the service delivered that is not under quota management,
based on a trigger for usage reporting is met.

**10) Charging Data Request \[Update, Unit Used\]:** the NF (CTF) sends
the request for reporting the related charging data, including the used
units, to the CHF.

**11) Account, Rating Control:** The CHF performs the reported usage
process involving rating entity and user\'s account balance.

**12) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**13) Charging Data Response \[Update\]:** The CHF informs the NF (CTF)
on the result of the request.

**14) Quota management Trigger:** A Trigger associated to Quota
management is met. Units determination is performed when applicable.

**15) Charging Data Request \[Update, Unit Used, Quota Requested\]:**
the NF (CTF) sends the request to the CHF, for more units to be granted
for the service to continue, and reporting the used units.

**16) Account, Rating, Reservation Control:** The CHF performs the
process related to the reported usage and the requested reservation,
involving rating entity and user\'s account balance.

**17) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**18) Charging Data Response \[Update, Quota Granted\]:** The CHF grants
quota to NF (CTF) for the service to continue, with the reserved number
of units.

**19) Content/Service Delivery:** the NF (CTF) delivers the
content/service based on the granted quota.

**20) Session released:** the session is released.

**21) Charging Data Request \[Termination,** **Unit Used\]:** the NF
(CTF) sends the request to the CHF, for charging data related to the
service termination with the final consumed units.

**22) Account, Rating Control:** The CHF performs the service
termination process involving rating entity and user\'s account balance.

**23) Close CDR:** based on policies, the CHF closes the CDR with
charging data related to the service termination and the last reported
units.

**24) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF) on the result of the request.

Figure 5.3.2.3.2 shows a Non-blocking mode scenario for Session based
charging (SCUR) with: Unit Reservation, Decentralized and Centralized
Unit Determination, Centralized Rating configuration , user's account
deduction , where the NF (CTF) invokes a converged charging service
towards the CHF.

NF (CTF) may use blocking mode instead when risk of quota overdraft is
more important than latency.

Figure 5.3.2.3.2: SCUR - Session based charging with Decentralized and
Centralized Unit Determination, Centralized Rating, immediate start of
service delivery (Non-blocking mode)

**1) Request for service delivery and start of service delivery:** A
request for session establishment is received in the NF (CTF). The NF
(CTF) is configured to allow the service to be delivered.

**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested, in \"Decentralized Units
determination\" scenario.

**3) Charging Data Request \[Initial, Unit Used, Quota Requested\]:**
the NF (CTF) sends the request to the CHF to reserve the number of units
if determined in step 2, it may also report the used units.

**4) Account, Rating, Reservation Control:** the CHF rates the requests
either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the
user\'s account balance. If the account has sufficient funds, the CHF
performs the corresponding reservation.

**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.

**6) Charging Data Response \[Initial, Quota Granted\]:** the CHF grants
the reserved number of units to NF (CTF).

**7) Granted Units Supervision:** The NF (CTF) monitors the consumption
of the granted units.

**8) Service delivery ongoing:** the NF (CTF) continues to deliver the
service.

**9) Usage reporting trigger:** the NF (CTF) generates charging data
related to a service delivered that is not under quota management, based
on that a trigger for service usage reporting is met.

**10) Charging Data Request \[Update, Unit Used\]:** the NF (CTF)
reports the charging data related to service delivered, including the
used units, to the CHF.

**11) Account, Rating Control:** the CHF uses the reported charging data
to rate the usage and deduct the funds corresponding to the usage on the
account balance.

**12) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**13) Charging Data Response \[Update\]:** The CHF informs the NF (CTF)
on the result of the request.

**14 ) Quota management Trigger:** A Trigger associated to Quota
management is met. Units determination is performed when applicable.

**15) Charging Data Request \[Update, Unit Used, Quota Requested\]:**
the NF (CTF) sends the request to the CHF, for more units to be granted
for the service to continue, and reporting the used units.

**16) Account, Rating, Reservation Control:** same as step 4, with the
option to also deduct the funds corresponding to the usage on the
account balance.

**17) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**18) Charging Data Response \[Update, Quota Granted\]:** The CHF grants
quota to NF (CTF) for the service, with the reserved number of units.

**19) Service delivery ongoing:** the NF (CTF) continues to deliver the
service.

**20) Service release:** the NF (CTF) is requested to end the service
delivery and does this.

**21) Charging Data Request \[Termination, Unit Used\]:** the NF (CTF)
sends the request to the CHF, for charging data related to the service
termination with the final consumed units.

**22) Account, Rating Control:** the CHF performs the service
termination process which involve using the reported charging data to
rate the usage and deduct the funds corresponding to the usage on the
account balance.

**23) Close CDR:** based on policies, the CHF closes the CDR with
charging data related to the service termination and the last reported
units.

**24) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF)on the result of the request.

Figure 5.3.2.3.3 shows a scenario for Session based charging (ECUR) in
Decentralized and Centralized Unit Determination, Centralized Rating
configuration, where the NF (CTF) invokes a converged charging service
towards the CHF, prior to service delivery if needed.

Figure 5.3.2.3.3: ECUR - Session based charging with - Decentralized and
Centralized Unit Determination, Centralized Rating.

**1) Request for resource usage:** A request for session establishment
is received in the NF (CTF). The service is configured to be authorized
by the CHF to start.

**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.

**3) Charging Data Request \[Initial, Quota Requested\]:** The NF (CTF)
sends the request to the CHF for the service to be granted authorization
to start, and to reserve the number of units if determined in item 2.

**4) Account, Rating, Reservation Control:** the CHF rates the requests
either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the
user\'s account balance. If the account has sufficient funds, the CHF
performs the corresponding reservation.

**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.

**6) Charging Data Response \[Initial, Quota Granted\]:** The CHF grants
authorization to NF (CTF) for the service to start, with the reserved
number of units.

**7) Granted Units Supervision:** The service starts and the NF (CTF)
monitors the consumption of the granted units.

**8) Content/Service Delivery:** the NF (CTF) delivers the
content/service based on the reserved number of units.

**9) Charging Data Request \[Termination, Unit Used\]:** the NF (CTF)
sends the request to the CHF, for charging data related to the delivered
service with the consumed units.

**10) Account, Rating Control:** The CHF performs the process for the
delivered service involving rating entity and user\'s account balance.

**11) Close CDR:** based on policies, the CHF closes the CDR with
charging data related to the delivered service.

**12) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF) on the result of the request.

5.3.2.4 Charging notification

The CHF can in Converged Session based Charging provide notifications to
the NF (CTF), the NF (CTF) implicitly subscribes to these when it sends
a Charging Data Request \[Initial\], i.e. there is no separate
subscription request from the NF for notification.

Figure 5.3.2.4-1 shows a scenario for Session based charging with a
notification from the CHF triggering a Charging Data Request \[Update\].

Figure 5.3.2.x.1: Session based charging -- Notification with
Re-authorization

**1) Session based charging ongoing:** there is a session based charging
ongoing and there have at least been a Charging Data Request \[Initial\]
sent from the NF (CTF) to the CHF, and the CHF have opened a CDR.

**2) Event triggering notification:** an event is detected in the CHF
that requires a notification to be sent to the NF (CTF). In this
scenario a request for triggering a Charging Data Request \[Update,
Quota Request\] is sent, but also requests for Charging Data Request
\[Update\] (without request for quota) is possible.

**3) Charging Notify Request \[Re-authorization\]:** the CHF sends the
request to the NF (CTF), for a triggering of a Charging Data Request
\[Update, Quota Request\] i.e. Re-authorization.

**4) Charging Notify Response:** the NF (CTF) acknowledges the request
by sending a response.

**5) Charging Data Request \[Update, Quota Requested\]:** the NF (CTF)
sends the request to the CHF, to be granted with more unit for the
service to continue, and also for reporting the used units.

**6) Account, Rating, Reservation Control:** the CHF performs the
process related to the reported usage and the requested reservation,
involving rating entity and user\'s account balance.

**7) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**8) Charging Data Response \[Update, Quota Granted\]:** the CHF grants
quota to NF (CTF) for the service to continue, with the reserved number
of units.

Figure 5.3.2.4.2 shows a scenario for Session based charging with a
notification from the CHF triggering a Charging Data Request
\[Termination\].

Figure 5.3.2.4.2: Session based charging -- Notification with
termination

**1) Session based charging ongoing:** there is a session based charging
ongoing and there have at least been a Charging Data Request \[Initial\]
sent from the NF (CTF) to the CHF, and the CHF have opened a CDR.

**2) Event triggering notification:** an event is detected in the CHF
that requires a notification to be sent to the NF (CTF). In this
scenario a request for triggering a Charging Data Request
\[Termination\] is sent.

**3) Charging Notify Request \[Terminate\]:** the CHF sends the request
to the NF (CTF), for a triggering of a Charging Data Request
\[Termination\] i.e. the termination of the charging session.

**4) Charging Notify Response:** the NF (CTF) acknowledges the request
by sending a response.

**5) Charging Data Request \[Termination\]:** the NF (CTF) sends the
request to the CHF, for charging data related to the service termination
with the final consumed units.

**6) Account, Rating Control:** the CHF performs the process related to
the reported usage, involving rating entity and user\'s account balance.

**7) Close CDR:** based on policies, the CHF **closes** the CDR with
charging data related to the service.

**8) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF) on the result of the request.

#### 5.3.2.5 Switch between quota managed and not quota managed

When converged charging is used for a service delivery it is possible to
in online charging to switch from quota management to quota management
suspended, and in some cases back again.

Figure 5.3.2.5.1 shows a scenario for Session based charging (SCUR) with
a suspension of quota management and resume of quota management.

Figure 5.3.2.5.1: SCUR - Session based charging with suspend and resume
of quota management.

**1) Request for resource usage:** A request for session establishment
is received in the NF (CTF). The service is configured to be authorized
by the CHF to start.

**2) Units Determination:** the NF (CTF)) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.

**3) Charging Data Request \[Initial, Quota Requested\]:** The NF (CTF)
sends the request to the CHF for the service to be granted authorization
to start, and to reserve the number of units if determined in item 2.

**4) Account, Rating, Reservation Control:** the CHF rates the requests
and checks need for quota management. If not needed for the service at
the moment a switch from online to offline type of charging is to be
performed.

**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.

**6) Charging Data Response \[Initial, Result Code\]:** The CHF grants
authorization to NF (CTF) for the service to start, with a result code
indicating that quota management is suspended.

**7) Content/Service Delivery:** the NF (CTF) delivers the
content/service without quota management.

**8) Usage Reporting Trigger:** the NF (CTF) generates charging data
related to the service delivered that is not under quota management,
based on a trigger for usage reporting is met.

**9) Charging Data Request \[Update, Unit Used, Quota Requested\]:** the
NF (CTF) sends the request to the CHF, for units to be granted making it
possible to resume the quota management. It also reports the used units
with an indication that these were used with quota management suspended.

**10) Account, Rating, Reservation Control:** The CHF performs the
process related to the reported usage and checks if quota management
should continue to be suspended or should be resumed. If needed for the
service, CHF checks if corresponding funds can be reserved on the
user\'s account balance.

**11) Update CDR:** based on policies, the CHF updates the CDR with
charging data related to the service.

**12) Charging Data Response \[Update, Quota Granted\]:** The CHF grants
quota to NF (CTF) for the service to continue and with this indicating
that quota management is to be resumed, with the reserved number of
units.

**13) Content/Service Delivery:** the NF (CTF) delivers the
content/service based on the granted quota.

**14) Session released:** the session is released.

**15) Charging Data Request \[Termination\]:** the NF (CTF) sends the
request to the CHF, for charging data related to the service termination
with the final consumed units.

**16) Account, Rating Control:** The CHF performs the service
termination process involving rating entity and user\'s account balance.

**17) Close CDR:** based on policies, the CHF closes the CDR with
charging data related to the service termination and the last reported
units.

**18) Charging Data Response \[Termination\]:** The CHF informs the NF
(CTF) on the result of the request.

5.4 Other functionalities
-------------------------

### 5.4.1 Re-authorization

The CHF (NF Service Producer) may trigger a re-authorization request and
the NF Service Consumer shall report quota usage. The reason for the
quota being reported shall be notified to the CHF (NF Service Producer).
This is described under charging notification procedure in clause
5.3.2.4.

The NF Service Consumer may receive a Charging Notify Request while
waiting for a Charging Data Response from the CHF. In this case the NF
Service Consumer shall not send a new Charging Data Request.

The NF Service Consumer may receive a Charging Notify Request while not
waiting for any Charging Data Response from the CHF. In this case the NF
Service Consumer shall send a new Charging Data Request.

### 5.4.2 Threshold based re-authorization triggers

The CHF (NF Service Producer) may optionally include an indication to
the NF Service Consumer of the remaining quota threshold that shall
trigger a quota re-authorization.

If received quota threshold based re-authorization triggers (i.e.
timeQuotaThreshold, volumeQuotaThreshold, unitQuotaThreshold), the NF
Service Consumer shall seek re-authorization for the quota when the
quota contents fall below the supplied threshold. The NF Service
Consumer allows the service to continue whilst the re-authorization is
progress, until the remaining part had been used up.

### 5.4.3 Termination action

The CHF (NF Service Producer) may specify to the NF Service Consumer the
behaviour on consumption of the final granted units, or zero units
granted in the first place; this is known as termination action.

### 5.4.4 Service termination

The CHF (NF Service Producer) may determine that a service requires
termination. The NF Service Producer may perform this termination
synchronously if it has a request pending processing by returning
response.

If the CHF (NF Service Producer) does not have a pending request
(asynchronous), the NF Service Producer may trigger an abort
notification to terminate the charging session. On reception of an abort
notification, the NF consumer shall terminate the associated charging
session by sending a Nchf\_ConvergedCharging\_Release. If the associated
charging session is not currently active or NF consumer does not
terminate the charging session for any other reason, the corresponding
error response is returned.

The CTF (NF Service Consumer) may determine service termination. For
session based charging the termination request shall include the used
units if any. For event based charging there may be no used unit
reported.

### 5.4.5 Trigger Mechanism

There are a number of mid-session service events, defined as triggers,
which could affect the rating of the current service usage, e.g. QoS
changes or end user location updates. The details for this these
triggers are defined in the service specific document (middle tier TS).
The relationship between service session and charging session is 1:1.

There are two levels of triggers: service session and rating group. The
service session level triggers are applicable for all rating groups
within a charging session, whereas a rating group level trigger is only
applicable to that rating group. Any limit or threshold set on the
service session level is the total limit for the service session
including all the rating groups. The behaviour at trigger detection is
specified by the middle tier TS.

Triggers enabled or disabled by default by the NF consumer, may be
enabled or disabled by CHF in response to the NF consumer.

The CHF may enable one or more triggers at the NF consumer, by including
them in the Triggers element. Each Triggers element can only contain one
trigger of each type. The omitted triggers in the Triggers element shall
be interpreted by the NF consumer as disabled. The enabled and disabled
triggers setting at the NF consumer shall remain in effect until another
Triggers element is received from the CHF for the service session or
rating group. When the NF consumer receives a Triggers element it shall
enable all triggers present in the Triggers element and disable all
other triggers at the same level. The presence of the Triggers element
without any trigger type in a response message allows CHF to disable all
the triggers at the NF Consumer for service session or rating group.

NOTE: This removes the need for the CHF to send trigger information in
every response message when they have not changed.

Two categories of chargeable events are identified:

\- immediate report: chargeable events for which, when occurring, the
current counts are closed and sent together with the charging data
generated by the NF consumer towards the CHF in a Request message.
Counts indicating zero usage may be reported. New counts are started by
the NF consumer.

\- deferred report: chargeable events for which, when occurring, the
current counts are closed and stored together with the charging data
generated by the NF consumer. Counts indicating zero usage may be
included. The stored counts will be sent to the CHF in next a Request
message. New counts are started by the NF consumer.

CHF may change the category of one or more triggers by using the
Triggers element containing category information in the response
message.

For the rating group: the rating group level triggers and category take
precedence over the service session level triggers and category.

### 5.4.6 CHF-controlled quota management

CHF can instruct NF consumer (CTF) to suspend quota management for a
given Rating Group and then subsequently the CHF can instruct the NF
consumer (CTF) to resume quota management for the given Rating Group
with suspended quota management within the charging session.

Upon receiving Charging Data Request \[Initial/Update\] with usage
reporting for a set of rating groups, the CHF may suspend quota
management for particular rating groups, by including in Charging Data
Response messages for these particular rating groups:

\- explicit setting of without quota management or

\- granted quotas with appropriate content to ensure the service to
continue without further quota management related updates.

CHF may instruct NF consumer (CTF) to resume quota management for a
given rating group for which quota management was previously suspended:

\- by using Re-authorization procedure or

\- by granting quotas in the response to any Charging Data Request
\[Update\] generated in situation quota management triggers are not
used, by other existing active triggers of the NF consumer (CTF).

5.5 Error handling
------------------

### 5.5.1 Failure handling 

#### 5.5.1.1 CTF detected failure

The failure handling determines what to do if the sending of charging
data request to the CHF without response in a period of time (request
times out).

In the case of the NF consumer (CTF) request times out, CHF uses
application level failure handling (Terminate, Continue,
Retry\_and\_terminate). Failure handling may be received from the CHF or
may be locally configured. The value received from the CHF in the
charging data response will always override any already existing value.
Failover handling indication informs NF Consumer whether alternative CHF
is supported.

In case there is an application level error response from the CHF, NF
consumer (CTF) action will depend on the type of Application Error.

For protocol level errors, refer to applicable protocol failure handling
mechanisms as described in 32.291 \[58\].

#### 5.5.1.2 CHF detected failure

The CHF closes a CDR and all the reserved resources are freed for the
charging session when it detects that expected charging data request for
a particular session have not been received for a period of time. The
charging session may be kept or released based on local configuration.

A Charging Data Request \[Initial\] received by a CHF, which can be
associated to an existing charging session (i.e. resource in CHF), shall
be handled as a valid request and be answered with Charging Data
Response \[Initial\] with the charging session id (i.e. resource id).

A Charging Data Request \[Update\] received by a CHF, which cannot be
associated to any existing charging session (i.e. resource in CHF),
shall be handled as a valid request with the associated resource
creation and quota usage handling.

A Charging Data Request \[Termination\] received by a CHF, which cannot
be associated to any existing charging session (i.e. resource in CHF),
shall be handled as a valid request with associated new resource
creation, and optional corresponding CDR creation.

The Invocation Sequence Number in Charging Data Request \[Initial\] with
value different from 0 or 1 is faulty and shall be rejected by CHF.

### 5.5.2 Retry handling

In case a NF consumer (CTF) does not receive a Charging Data Response,
it may retransmit the Charging Data Request message. The number of
retries and delay between retries shall be locally configured in the NF
consumer (CTF).

If the retried charging data request \[Initial\] is received by the same
CHF, the uniqueness checking may be based on the Charging Identifier
included in the charging data request. CHF shall respond to the retried
charging data request \[Initial\] with the original charging session
identifier.

If the retried request is charging data request \[Update\] or charging
data request \[Termination\], the uniqueness checking may based on the
inspection of the Charging Session Identifier and Invocation Sequence
Number pair.

If retried message shall have the same Invocation Sequence Number as the
original of the retried message i.e. the Invocation Sequence Number
shall not be incremented when the message is retried. The NF consumer
(CTF) may send the retried message to an alternative CHF if the Session
Failover indication is received from the CHF.

In the case of a notification request time out the CHF may retry the
message. The number of retries and delay between retries shall be
locally configured in the CHF.

### 5.5.3 Response code handling

The Charging Data Response includes a response code (i.e. Invocation
Result Code in Invocation Result) which may indicate an error. The
response codes supported by Nchf\_ConvergedCharging service operations
are specified 3GPP TS 32.291 \[58\].

A NF Consumer (CTF) receiving a Charging Data Response \[Initial\] with
a response code indicating the Charging Data Request \[Initial\] was
unsuccessfully processed, shall perform the error handling applicable to
the response code and may send a Charging Data Request \[Termination\]
to the CHF.

A NF Consumer (CTF) receiving a Charging Data Response \[Termination\]
with a response code indicating the Charging Data Request
\[Termination\] was unsuccessfully processed, shall perform the error
handling applicable to the response code.

A NF Consumer (CTF) receiving a Charging Data Response \[Update\] with a
response code indicating the Charging Data Request \[Update\] was
unsuccessfully processed, shall perform the error handling applicable to
the response code and may send a Charging Data Request \[Termination\]
to the CHF.

The Charging Data Response may also include multiple \"Multiple Unit
Information\" Information Elements, each one indicated with a Result
code (i.e. applicable at Rating group level). The Result code values
supported by Nchf\_ConvergedCharging service operations are specified
3GPP TS 32.291 \[58\]. Any Invocation Result Code value different than
success takes precedence over the set of \"Multiple Unit Information\"
Result Codes.

6 Service definition
====================

6.1 NF service framework
------------------------

5G Charging Function supports to interact with NRF, as specified in
clause 7.1 of TS 23.501 \[201\] and clauses 4.17 and 5.2.7 of
TS 23.502 \[202\] to enable following functionalities:

\- CHF instance(s) registration, CHF service(s) instance(s) registration
in a CHF instance.

\- CHF instance(s) update, CHF service(s) instance(s) update in a CHF
instance.

\- CHF instance(s) deregistration.

\- CHF instance(s) and CHF service(s) instance(s) discovery by CHF
service consumer.

The services specified in clause 7.2.6 TS 23.501 \[201\] may be used and
the interaction is described in TS 29.510 \[300\]:

\- Nnrf\_NFManagement.

\- Nnrf\_NFDiscovery.

\- Nnrf\_AccessToken.

The Nnrf\_NFManagement\_NFRegister service invoked by CHF for CHF
instance(s) and CHF service(s) instance(s) registration described in the
TS 29.510 \[300\] may include in particular:

\- Range(s) of SUPIs.

\- Range(s) of GPSIs.

\- Range(s) of PLMNs.

\- CHF Group ID.

\- CHF set ID.

\- CHF service set ID.

These parameters may also be used by CHF service consumer(s) invoking
the Nnrf\_NFDiscovery service for the CHF instance(s) and CHF service(s)
instance(s) discovery.

A CHF instance is either a part of:

\- a primary CHF instance and secondary CHF instance pair, or

\- a CHF set.

6.2 Nchf\_ConvergedCharging service
-----------------------------------

### 6.2.1 General

**Service description:** The ConvergedCharging service provides charging
for session and event based NF services. This ConvergedCharging service
offers charging:

\- With quota management (online; this includes support for both
blocking mode and non-blocking mode)

\- Without quota management (offline)

\- Charging information record generation

The following table shows the CHF Services and CHF Service Operations.

Table 6.2.1-1: NF services provided by the CHF

+----------------+----------------+----------------+----------------+
| Service Name   | Service        | Operation      | Example        |
|                | Operations     |                | Consumer(s)    |
|                |                | Semantics      |                |
+----------------+----------------+----------------+----------------+
| Nchf\_Con      | Create         | Re             | SMF, SMSF,     |
| vergedCharging |                | quest/Response | AMF,           |
|                |                |                | PGW-C+SMF,     |
|                |                |                | NEF, CEF, MnS  |
|                |                |                | Producer       |
+----------------+----------------+----------------+----------------+
|                | Update         | Re             | SMF, PGW-C+SMF |
|                |                | quest/Response |                |
+----------------+----------------+----------------+----------------+
|                | Release        | Re             | SMF, SMSF,     |
|                |                | quest/Response | AMF, NEF,      |
|                |                |                | PGW-C+SMF      |
+----------------+----------------+----------------+----------------+
|                | Notify         | Notify         | SMF, PGW-C+SMF |
+----------------+----------------+----------------+----------------+

The applicability of ConvergedCharging service to:

\- SMF and SMF+PGW-C as consumer is specified in TS 32.255 \[30\] for 5G
data connectivity domain charging;

\- NEF as consumer is specified in TS 32.254 \[32\] for exposure
function Northbound Application Program Interfaces charging;

\- AMF as consumer is specified in the TS 32.256\[33\] for 5G connection
and mobility domain charging;

\- SMSF as consumer is specified in TS 32.274\[34\] for short message
service charging;

\- CEF as consumer is specified in the TS 28.201\[35\] and TS
28.202\[36\] for Network slice charging;

\- MnS Producer as consumer is specified in the TS 28.201\[35\] and TS
28.202\[36\] for Network slice charging.

The input and output parameters described in the clauses below are
common to all NF Consumers. The usage of these common parameters and
additional NF Consumer specific parameters are specified in dedicated
charging specifications.

### 6.2.2 Nchf\_ConvergedCharging\_Create service operation

**Service operation name:** Nchf\_ConvergedCharging\_Create

**Description:** Provides charging capabilities before service delivery,
offers charging with and without quota management, as well as charging
information record generation. It is used for both session and event
based charging. Provides means for the NF Consumer to create the
resource of the charging session. If it is used for session based
charging the operation also makes an implicit subscribe to notification
of events in CHF that requires re-authorization or abort.

The service operation may be used to request quota authorisation for
service delivery and may open a CDR in the CHF, based on the information
provided by the NF Consumer.

**Known NF Consumers:** SMF, SMSF, AMF, PGW-C+SMF, NEF, CEF, MnS
Producer.

**Inputs, Required:** Subscriber identifier, either service
identification or rating group.

**Inputs, Optional:** Requested service units, one-time event,
destination address, provider, location information, time and date.

**Outputs, Required:** Result indication.

**Outputs, Optional:** Granted service units, validity time, triggers.

### 6.2.3 Nchf\_ConvergedCharging\_Update service operation

**Service operation name:** Nchf\_ConvergedCharging\_Update

**Description:** Provides charging capabilities during service delivery,
offers usage reporting and quota management, as well as charging
information record generation.

The service operation is used to report usage and may request further
quota authorisation, if the trigger conditions occurs, this operation
may cause update of the CDR or production of an interim CDR in the CHF.

**Known NF Consumers:** SMF, PGW-C+SMF.

**Inputs, Required:** Subscriber identifier (Optional for emergency
session), session identifier, reporting reason.

**Inputs, Optional:** Requested service units, used service units.

**Outputs, Required:** Result indication.

**Outputs, Optional:** Granted service units, validity time, triggers.

### 6.2.4 Nchf\_ConvergedCharging\_Release service operation

**Service operation name:** Nchf\_ConvergedCharging\_Release

**Description:** Provides charging capabilities after service delivery,
offers usage reporting and charging information record generation.
Provides means for the NF Consumer to release the resource of charging
session information.

The charging delete request is used to report usage and close the CDR in
the CHF if it has been opened.

**Known NF Consumers:** SMF, AMF, PGW-C+SMF, SMSF, NEF.

**Inputs, Required:** Subscriber identifier, session identifier, release
reason.

**Inputs, Optional:** Used service units.

**Outputs, Required:** Result indication.

**Outputs, Optional:** None.

### 6.2.5 Nchf\_ConvergedCharging\_Notify service operation

**Service operation name:** Nchf\_ConvergedCharging\_Notify

**Description:** Provides notification to NF consumers of the subscribed
events.

CHF provides the re-authorization type notificationthat would lead NF
consumers to send an Nchf\_ConvergedCharging\_Update reporting the
current usage.

CHF provides the abort type notification that would lead NF consumers to
send an Nchf\_ConvergedCharging\_ Release to terminate the charging
session.

**Known NF Consumers:** SMF, PGW-C+SMF.

**Inputs, Required:** Subscriber identifier, notification type
(re-authorization or abort).

**Inputs, Optional:** rating group, service id.

**Outputs, Required:** Result indication.

**Outputs, Optional:** None

6.3 Nchf\_SpendingLimitControl service
--------------------------------------

### 6.3.1 Overview

The \"Nchf\_SpendingLimitControl\" service is defined in 23.502 \[202\]
clause 5.2.17.2.

6.4 Void
--------

6.5 Nchf\_OfflineOnlyCharging service
-------------------------------------

### 6.5.1 General

**Service description:** The OfflineOnlyCharging service provides
charging for session based NF services. This OfflineCharging service
offers charging information record generation.

The following table shows the CHF Services and CHF Service Operations.

Table 6.5.1-1: NF services provided by the CHF

+----------------+----------------+----------------+----------------+
| Service Name   | Service        | Operation      | Example        |
|                | Operations     |                | Consumer(s)    |
|                |                | Semantics      |                |
+----------------+----------------+----------------+----------------+
| Nchf\_Offli    | Create         | Re             | SMF            |
| neOnlyCharging |                | quest/Response |                |
+----------------+----------------+----------------+----------------+
|                | Update         | Re             | SMF            |
|                |                | quest/Response |                |
+----------------+----------------+----------------+----------------+
|                | Release        | Re             | SMF            |
|                |                | quest/Response |                |
+----------------+----------------+----------------+----------------+

The input and output parameters described in the clauses below are
common to all NF Consumers. The usage of these common parameters and
additional NF Consumer specific parameters are specified in dedicated
charging specifications.

### 6.5.2 Nchf\_OfflineOnlyCharging\_Create service operation

**Service operation name:** Nchf\_OfflineOnlyCharging\_Create

**Description:** Provides charging capabilities before service delivery,
offers charging information record generation. Provides means for the NF
Consumer to create the resource of the charging session.

The service operation shall open a CDR in the CHF, based on the
information provided by the NF Consumer.

**Known NF Consumers:** SMF.

**Inputs, Required:** Subscriber identifier, either service
identification or rating group.

**Inputs, Optional:** destination address, provider, location
information, time and date.

**Outputs, Required:** Result indication.

**Outputs, Optional:** triggers.

### 6.5.3 Nchf\_OfflineOnlyCharging\_Update service operation

**Service operation name:** Nchf\_OfflineOnlyCharging\_Update

**Description:** Provides charging capabilities during service delivery,
charging information record generation.

If the trigger conditions occurs, this operation may cause update of the
CDR or production of an interim CDR in the CHF.

**Known NF Consumers:** SMF.

**Inputs, Required:** Subscriber identifier (exception for emergency
session), session identifier, reporting reason.

**Inputs, Optional:** None.

**Outputs, Required:** Result indication.

**Outputs, Optional:** triggers.

### 6.5.4 Nchf\_OfflineOnlyCharging\_Release service operation

**Service operation name:** Nchf\_OfflineOnlyCharging\_Release

**Description:** Provides charging capabilities after service delivery,
charging information record generation. Provides means for the NF
Consumer to release the resource of charging session information.

The charging delete request is used to close the CDR in the CHF if it
has been opened.

**Known NF Consumers:** SMF.

**Inputs, Required:** Subscriber identifier, session identifier, release
reason.

**Inputs, Optional:** None.

**Outputs, Required:** Result indication.

**Outputs, Optional:** None.

7 Message contents
==================

Converged charging or offline only charging is performed by NF (CTF)
consuming service operations exposed by CHF, achieved using Charging
Data Request and Charging Data Response.

The information structure used for these services operations is composed
of two parts:

\- Common structures specified in the present document.

\- NF (CTF) consumer specific structures specified in the middle tier
TSs.

Table 7.1 describes the data structure which is common to operations in
request semantics.

Table 7.1: Common Data structure of Charging Data Request

+----------------+----------------+----------------+----------------+
| **Information  | **Converged    | **Offline Only | *              |
| Element**      | Charging**     | Charging       | *Description** |
|                |                | Category**     |                |
|                | **Category**   |                |                |
+----------------+----------------+----------------+----------------+
| Session        | O~C~           | O~C~           | This field     |
| Identifier     |                |                | identifies the |
|                |                |                | charging       |
|                |                |                | session.       |
+----------------+----------------+----------------+----------------+
| Subscriber     | O~M~           | O~M~           | This field     |
| Identifier     |                |                | contains the   |
|                |                |                | identification |
|                |                |                | of the         |
|                |                |                | individual     |
|                |                |                | subscriber     |
|                |                |                | that uses the  |
|                |                |                | requested      |
|                |                |                | service.       |
+----------------+----------------+----------------+----------------+
| NF Consumer    | M              | M              | This is a      |
| Identification |                |                | grouped field  |
|                |                |                | which contains |
|                |                |                | a set of       |
|                |                |                | information    |
|                |                |                | identifying    |
|                |                |                | the NF         |
|                |                |                | consumer of    |
|                |                |                | the charging   |
|                |                |                | service.       |
+----------------+----------------+----------------+----------------+
| > NF           | M              | M              | This field     |
| >              |                |                | contains the   |
|  Functionality |                |                | function of    |
|                |                |                | the node.      |
+----------------+----------------+----------------+----------------+
| > NF Name      | O~C~           | O~C~           | This fields    |
|                |                |                | holds the name |
|                |                |                | (i.e. UUID) of |
|                |                |                | the NF         |
|                |                |                | consumer. At   |
|                |                |                | least one of   |
|                |                |                | the NF Address |
|                |                |                | or NF Name     |
|                |                |                | shall be       |
|                |                |                | present.       |
+----------------+----------------+----------------+----------------+
| > NF Address   | O~C~           | O~C~           | This field     |
|                |                |                | holds the      |
|                |                |                | address (i.e.  |
|                |                |                | IP address     |
|                |                |                | and/or FQDN)   |
|                |                |                | of NF          |
|                |                |                | consumer. At   |
|                |                |                | least one of   |
|                |                |                | the NF Address |
|                |                |                | or NF Name     |
|                |                |                | shall be       |
|                |                |                | present.       |
+----------------+----------------+----------------+----------------+
| > NF PLMN ID   | O~C~           | O~C~           | This field     |
|                |                |                | holds the PLMN |
|                |                |                | ID of the      |
|                |                |                | network the NF |
|                |                |                | consumer       |
|                |                |                | belongs to.    |
+----------------+----------------+----------------+----------------+
| Charging       | O~M~           | \-             | This field     |
| Identifier     |                |                | contains the   |
|                |                |                | charging       |
|                |                |                | identifier     |
|                |                |                | allowing       |
|                |                |                | correlation of |
|                |                |                | charging       |
|                |                |                | information.   |
|                |                |                | Only           |
|                |                |                | applicable if  |
|                |                |                | not provided   |
|                |                |                | in the NF      |
|                |                |                | (CTF) consumer |
|                |                |                | specific       |
|                |                |                | structure.     |
+----------------+----------------+----------------+----------------+
| Invocation     | M              | M              | This field     |
| Timestamp      |                |                | holds the      |
|                |                |                | timestamp of   |
|                |                |                | the charging   |
|                |                |                | service        |
|                |                |                | invocation by  |
|                |                |                | the NF         |
|                |                |                | consumer       |
+----------------+----------------+----------------+----------------+
| Invocation     | M              | M              | This field     |
| Sequence       |                |                | contains the   |
| Number         |                |                | sequence       |
|                |                |                | number of the  |
|                |                |                | charging       |
|                |                |                | service        |
|                |                |                | invocation by  |
|                |                |                | the NF         |
|                |                |                | consumer in a  |
|                |                |                | charging       |
|                |                |                | session.       |
+----------------+----------------+----------------+----------------+
| Retransmission | O~C~           | O~C~           | This field     |
| Indicator      |                |                | indicates if   |
|                |                |                | included, this |
|                |                |                | is a           |
|                |                |                | retransmitted  |
|                |                |                | request        |
|                |                |                | message.       |
+----------------+----------------+----------------+----------------+
| One-time Event | O~C~           | \-             | This field     |
|                |                |                | indicates, if  |
|                |                |                | included, that |
|                |                |                | this is event  |
|                |                |                | based charging |
|                |                |                | and whether    |
|                |                |                | this is a      |
|                |                |                | one-time event |
|                |                |                | in that there  |
|                |                |                | will be no     |
|                |                |                | update or      |
|                |                |                | termination.   |
+----------------+----------------+----------------+----------------+
| One-time Event | O~C~           | \-             | This field     |
| Type           |                |                | indicated the  |
|                |                |                | type of the    |
|                |                |                | one time       |
|                |                |                | event, i.e.    |
|                |                |                | Immediate or   |
|                |                |                | Post event     |
|                |                |                | charging.      |
+----------------+----------------+----------------+----------------+
| Notify URI     | O~C~           | \-             | This field     |
|                |                |                | contains URI   |
|                |                |                | to which       |
|                |                |                | notifications  |
|                |                |                | are sent by    |
|                |                |                | the CHF. The   |
|                |                |                | latest         |
|                |                |                | received value |
|                |                |                | shall always   |
|                |                |                | be used at     |
|                |                |                | notifications. |
+----------------+----------------+----------------+----------------+
| Supported      | O~C~           | \-             | This field     |
| Features       |                |                | indicates the  |
|                |                |                | features       |
|                |                |                | supported by   |
|                |                |                | the NF         |
|                |                |                | consumer.      |
+----------------+----------------+----------------+----------------+
| Service        | O~C~           | \-             | This field     |
| Specification  |                |                | identifies the |
| Information    |                |                | technical      |
|                |                |                | specification  |
|                |                |                | for the        |
|                |                |                | service (e.g.  |
|                |                |                | TS 32.255) and |
|                |                |                | release        |
|                |                |                | version (e.g.  |
|                |                |                | Release 16)    |
|                |                |                | that applies   |
|                |                |                | to the         |
|                |                |                | request. It is |
|                |                |                | for            |
|                |                |                | information.   |
+----------------+----------------+----------------+----------------+
| Triggers       | O~C~           | O~C~           | This field     |
|                |                |                | identifies the |
|                |                |                | event(s)       |
|                |                |                | triggering the |
|                |                |                | request and is |
|                |                |                | common to all  |
|                |                |                | Multiple Unit  |
|                |                |                | Usage          |
|                |                |                | occurrences.   |
+----------------+----------------+----------------+----------------+
| Multiple Unit  | O~C~           | O~C~           | This field     |
| Usage          |                |                | contains the   |
|                |                |                | parameters for |
|                |                |                | the quota      |
|                |                |                | management     |
|                |                |                | request and/or |
|                |                |                | usage          |
|                |                |                | reporting. It  |
|                |                |                | may have       |
|                |                |                | multiple       |
|                |                |                | occurrences.   |
+----------------+----------------+----------------+----------------+
| > Rating Group | M              | M              | This field     |
|                |                |                | holds the      |
|                |                |                | identifier of  |
|                |                |                | a rating       |
|                |                |                | group.         |
+----------------+----------------+----------------+----------------+
| > Requested    | O~C~           | \-             | This field     |
| > Unit         |                |                | indicates, if  |
|                |                |                | included, that |
|                |                |                | quota          |
|                |                |                | management is  |
|                |                |                | required. It   |
|                |                |                | may            |
|                |                |                | additionally   |
|                |                |                | contain the    |
|                |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | service units  |
|                |                |                | for a          |
|                |                |                | particular     |
|                |                |                | category.      |
+----------------+----------------+----------------+----------------+
| > Time         | O~C~           | \-             | This field     |
|                |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | time.          |
+----------------+----------------+----------------+----------------+
| > Total Volume | O~C~           | \-             | This field     |
|                |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | volume in both |
|                |                |                | uplink and     |
|                |                |                | downlink       |
|                |                |                | directions.    |
+----------------+----------------+----------------+----------------+
| > Uplink       | O~C~           | \-             | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | volume in      |
|                |                |                | uplink         |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Downlink     | O~C~           | \-             | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | volume in      |
|                |                |                | downlink       |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Service      | O~C~           | \-             | This field     |
| > Specific     |                |                | holds the      |
| > Units        |                |                | amount of      |
|                |                |                | requested      |
|                |                |                | service        |
|                |                |                | specific       |
|                |                |                | units.         |
+----------------+----------------+----------------+----------------+
| > Used Unit    | O~C~           | O~C~           | This field     |
| > Container    |                |                | contains the   |
|                |                |                | amount of used |
|                |                |                | non-monetary   |
|                |                |                | service units  |
|                |                |                | measured up to |
|                |                |                | the triggers   |
|                |                |                | and trigger    |
|                |                |                | timestamp. It  |
|                |                |                | may have       |
|                |                |                | multiple       |
|                |                |                | occurrences.   |
+----------------+----------------+----------------+----------------+
| > Service      | O~C~           | O~C~           | This field     |
| > Identifier   |                |                | holds the      |
|                |                |                | Service        |
|                |                |                | Identifier.    |
+----------------+----------------+----------------+----------------+
| > Quota        | O~C~           | \-             | This field     |
| > management   |                |                | holds an       |
| > Indicator    |                |                | indicator on   |
|                |                |                | whether the    |
|                |                |                | reported used  |
|                |                |                | units are with |
|                |                |                | quota          |
|                |                |                | management     |
|                |                |                | control,       |
|                |                |                | without quota  |
|                |                |                | management     |
|                |                |                | control or     |
|                |                |                | with quota     |
|                |                |                | management     |
|                |                |                | control        |
|                |                |                | temporary      |
|                |                |                | suspended. If  |
|                |                |                | the field is   |
|                |                |                | not present,   |
|                |                |                | it indicates   |
|                |                |                | the used unit  |
|                |                |                | is without     |
|                |                |                | quota          |
|                |                |                | management     |
|                |                |                | applied.       |
+----------------+----------------+----------------+----------------+
| > Triggers     | O~C~           | Oc             | This field     |
|                |                |                | holds reason   |
|                |                |                | for charging   |
|                |                |                | information    |
|                |                |                | reporting or   |
|                |                |                | closing for    |
|                |                |                | the used unit  |
|                |                |                | container.     |
+----------------+----------------+----------------+----------------+
| > Trigger      | O~C~           | O~C~           | This field     |
| > Timestamp    |                |                | holds the      |
|                |                |                | timestamp of   |
|                |                |                | the trigger.   |
+----------------+----------------+----------------+----------------+
| > Time         | O~C~           | O~C~           | This field     |
|                |                |                | holds the      |
|                |                |                | amount of used |
|                |                |                | time.          |
+----------------+----------------+----------------+----------------+
| > Total Volume | O~C~           | O~C~           | This field     |
|                |                |                | holds the      |
|                |                |                | amount of used |
|                |                |                | volume in both |
|                |                |                | uplink and     |
|                |                |                | downlink       |
|                |                |                | directions.    |
+----------------+----------------+----------------+----------------+
| > Uplink       | O~C~           | O~C~           | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of used |
|                |                |                | volume in      |
|                |                |                | uplink         |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Downlink     | O~C~           | O~C~           | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of used |
|                |                |                | volume in      |
|                |                |                | downlink       |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Service      | O~C~           | O~C~           | This field     |
| > Specific     |                |                | holds the      |
| > Unit         |                |                | amount of used |
|                |                |                | service        |
|                |                |                | specific       |
|                |                |                | units.         |
+----------------+----------------+----------------+----------------+
| > Event Time   | O~C~           | O~C~           | This field     |
| > Stamps       |                |                | holds the      |
|                |                |                | timestamps of  |
|                |                |                | the event      |
|                |                |                | reported in    |
|                |                |                | the Service    |
|                |                |                | Specific       |
|                |                |                | Units, if the  |
|                |                |                | reported units |
|                |                |                | are event      |
|                |                |                | based.         |
+----------------+----------------+----------------+----------------+
| > Local        | O~M~           | O~M~           | This field     |
| > Sequence     |                |                | holds the      |
| > Number       |                |                | container      |
|                |                |                | sequence       |
|                |                |                | number.        |
+----------------+----------------+----------------+----------------+

Table 7.2 describes the data structure which is common to operations in
response semantics.

Table 7.2: Common Data structure of Charging Data Response

+----------------+----------------+----------------+----------------+
| **Information  | **Converged    | **Offline Only | *              |
| Element**      | Charging**     | Charging       | *Description** |
|                |                | Category**     |                |
|                | **Category**   |                |                |
+----------------+----------------+----------------+----------------+
| Session        | O~C~           | O~C~           | This field     |
| Identifier     |                |                | identifies the |
|                |                |                | charging       |
|                |                |                | session.       |
+----------------+----------------+----------------+----------------+
| Invocation     | M              | M              | This field     |
| Timestamp      |                |                | holds the      |
|                |                |                | timestamp of   |
|                |                |                | the charging   |
|                |                |                | service        |
|                |                |                | response from  |
|                |                |                | the CHF.       |
+----------------+----------------+----------------+----------------+
| Invocation     | O~C~           | O~C~           | This field     |
| Result         |                |                | holds the      |
|                |                |                | failure        |
|                |                |                | handling and   |
|                |                |                | in case of     |
|                |                |                | unsuccessful   |
|                |                |                | result of the  |
|                |                |                | charging       |
|                |                |                | service        |
|                |                |                | invocation by  |
|                |                |                | the NF         |
|                |                |                | consumer the   |
|                |                |                | result code.   |
+----------------+----------------+----------------+----------------+
| > Invocation   | O~C~           | O~C~           | This field     |
| > Result Code  |                |                | contains the   |
|                |                |                | result code in |
|                |                |                | case of        |
|                |                |                | failure.       |
+----------------+----------------+----------------+----------------+
| > Failed       | O~C~           | O~C~           | This field     |
| > parameter    |                |                | holds missing  |
|                |                |                | and/or         |
|                |                |                | unsupported    |
|                |                |                | parameter that |
|                |                |                | caused the     |
|                |                |                | failure.       |
+----------------+----------------+----------------+----------------+
| > Failure      | O~C~           | O~C~           | This field     |
| > Handling     |                |                | holds the      |
|                |                |                | failure        |
|                |                |                | handling to be |
|                |                |                | performed by   |
|                |                |                | the NF         |
|                |                |                | consumer when  |
|                |                |                | failure.       |
+----------------+----------------+----------------+----------------+
| Invocation     | M              | M              | This field     |
| Sequence       |                |                | holds the      |
| Number         |                |                | sequence       |
|                |                |                | number of the  |
|                |                |                | charging       |
|                |                |                | service        |
|                |                |                | invocation by  |
|                |                |                | the NF         |
|                |                |                | consumer.      |
+----------------+----------------+----------------+----------------+
| Session        | O~C~           | O~C~           | This field     |
| Failover       |                |                | indicates      |
|                |                |                | whether        |
|                |                |                | alternative    |
|                |                |                | CHF is         |
|                |                |                | supported for  |
|                |                |                | ongoing        |
|                |                |                | charging       |
|                |                |                | service        |
|                |                |                | failover       |
|                |                |                | handling by NF |
|                |                |                | consumer.      |
+----------------+----------------+----------------+----------------+
| Supported      | O~C~           | \-             | This field     |
| Features       |                |                | indicates from |
|                |                |                | the supported  |
|                |                |                | features       |
|                |                |                | indicated by   |
|                |                |                | the NF         |
|                |                |                | consumer,      |
|                |                |                | those          |
|                |                |                | supported by   |
|                |                |                | the CHF.       |
+----------------+----------------+----------------+----------------+
| Triggers       | O~C~           | O~C~           | This field     |
|                |                |                | holds the      |
|                |                |                | triggers       |
|                |                |                | supplied from  |
|                |                |                | the CHF for    |
|                |                |                | the charging   |
|                |                |                | session that   |
|                |                |                | are            |
|                |                |                | independent of |
|                |                |                | rating group   |
|                |                |                | for quota      |
|                |                |                | management and |
|                |                |                | without quota  |
|                |                |                | management.    |
+----------------+----------------+----------------+----------------+
| Multiple Unit  | O~C~           | \-             | This field     |
| Information    |                |                | holds the      |
|                |                |                | parameters for |
|                |                |                | the quota      |
|                |                |                | management     |
|                |                |                | and/or usage   |
|                |                |                | reporting      |
|                |                |                | information.   |
|                |                |                | It may have    |
|                |                |                | multiple       |
|                |                |                | occurrences.   |
+----------------+----------------+----------------+----------------+
| > Result Code  | O~C~           | \-             | This field     |
|                |                |                | contains the   |
|                |                |                | result of the  |
|                |                |                | Rating Group   |
|                |                |                | quota          |
|                |                |                | allocation.    |
+----------------+----------------+----------------+----------------+
| > Rating Group | O~M~           | \-             | The identifier |
|                |                |                | of a rating    |
|                |                |                | group.         |
+----------------+----------------+----------------+----------------+
| > Granted Unit | O~C~           | \-             | This field     |
|                |                |                | holds the      |
|                |                |                | granted quota. |
+----------------+----------------+----------------+----------------+
| > Tariff Time  | O~C~           | \-             | This field     |
| > Change       |                |                | contains the   |
|                |                |                | switch time    |
|                |                |                | when the       |
|                |                |                | tariff will be |
|                |                |                | changed.       |
+----------------+----------------+----------------+----------------+
| > Time         | O~C~           | \-             | This field     |
|                |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | granted time.  |
+----------------+----------------+----------------+----------------+
| > Total Volume | O~C~           | \-             | This field     |
|                |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | granted volume |
|                |                |                | in both uplink |
|                |                |                | and downlink   |
|                |                |                | directions.    |
+----------------+----------------+----------------+----------------+
| > Uplink       | O~C~           | \-             | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | granted volume |
|                |                |                | in uplink      |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Downlink     | O~C~           | \-             | This field     |
| > Volume       |                |                | holds the      |
|                |                |                | amount of      |
|                |                |                | granted volume |
|                |                |                | in downlink    |
|                |                |                | direction.     |
+----------------+----------------+----------------+----------------+
| > Service      | O~C~           | \-             | This field     |
| > Specific     |                |                | holds the      |
| > Units        |                |                | amount of      |
|                |                |                | granted        |
|                |                |                | requested      |
|                |                |                | service        |
|                |                |                | specific       |
|                |                |                | units.         |
+----------------+----------------+----------------+----------------+
| > Validity     | O~C~           | \-             | This field     |
| > Time         |                |                | defines the    |
|                |                |                | time in order  |
|                |                |                | to limit the   |
|                |                |                | validity of    |
|                |                |                | the granted    |
|                |                |                | quota for a    |
|                |                |                | given category |
|                |                |                | instance.      |
+----------------+----------------+----------------+----------------+
| > Final Unit   | O~C~           | \-             | This field     |
| > Indication   |                |                | indicates the  |
|                |                |                | granted final  |
|                |                |                | units for the  |
|                |                |                | service.       |
+----------------+----------------+----------------+----------------+
| > Time Quota   | OC             | \-             | This field     |
| > Threshold    |                |                | indicates the  |
|                |                |                | threshold in   |
|                |                |                | seconds when   |
|                |                |                | the granted    |
|                |                |                | quota is time  |
+----------------+----------------+----------------+----------------+
| > Volume Quota | OC             | \-             | This field     |
| > Threshold    |                |                | indicates the  |
|                |                |                | threshold in   |
|                |                |                | octets when    |
|                |                |                | the granted    |
|                |                |                | quota is       |
|                |                |                | volume         |
+----------------+----------------+----------------+----------------+
| > Unit Quota   | OC             | \-             | This field     |
| > Threshold    |                |                | indicates the  |
|                |                |                | threshold in   |
|                |                |                | service        |
|                |                |                | specific       |
|                |                |                | units, that    |
|                |                |                | are defined in |
|                |                |                | the service    |
|                |                |                | specific       |
|                |                |                | documents,     |
|                |                |                | when the       |
|                |                |                | granted quota  |
|                |                |                | is service     |
|                |                |                | specific       |
+----------------+----------------+----------------+----------------+
| > Quota        | O~C~           | \-             | This field     |
| > Holding Time |                |                | holds the      |
|                |                |                | quota holding  |
|                |                |                | time in        |
|                |                |                | seconds.       |
+----------------+----------------+----------------+----------------+
| > Triggers     | O~C~           | O~C~           | This field     |
|                |                |                | holds triggers |
|                |                |                | for usage      |
|                |                |                | reporting      |
|                |                |                | associated to  |
|                |                |                | the rating     |
|                |                |                | group, which   |
|                |                |                | is supplied    |
|                |                |                | from the CHF.  |
+----------------+----------------+----------------+----------------+

The CTF NF consumer specific structures which are specified in the
middle tier TSs, are defined as extensions of:

\- common part structure of Charging Data Request and Charging Data
Response.

\- structure of Multiple Unit Usage.

\- structure of Multiple Unit Information.

Table 7.3 describes the data structure which is common to Charging
Notify Request.

Table 7.3: Common Data structure of Charging Notify Request

+-----------------------+--------------------+-----------------------+
| Information Element   | Converged Charging | Description           |
|                       |                    |                       |
|                       | Category           |                       |
+-----------------------+--------------------+-----------------------+
| Notify URI            | M                  | This field holds the  |
|                       |                    | URI previously        |
|                       |                    | supplied by the CHF   |
|                       |                    | for notifications     |
|                       |                    | associated to the     |
|                       |                    | charging session.     |
+-----------------------+--------------------+-----------------------+
| Notification type     | M                  | This field holds the  |
|                       |                    | type of notification  |
|                       |                    | indicating            |
|                       |                    | re-authorization or   |
|                       |                    | termination.          |
+-----------------------+--------------------+-----------------------+
| Reauthorization       | O~C~               | This field holds the  |
| Details               |                    | details of            |
|                       |                    | re-authorization.     |
|                       |                    |                       |
|                       |                    | It's only present     |
|                       |                    | when type of          |
|                       |                    | notification is       |
|                       |                    | re-authorization.If   |
|                       |                    | not present and type  |
|                       |                    | of notification is    |
|                       |                    | re-authorization, the |
|                       |                    | re-authorization      |
|                       |                    | notification applies  |
|                       |                    | to all units.         |
+-----------------------+--------------------+-----------------------+
| > Service Identifier  | O~C~               | This field holds the  |
|                       |                    | Service Identifier to |
|                       |                    | which                 |
|                       |                    | re-authorization      |
|                       |                    | notification applies. |
|                       |                    | If present, the       |
|                       |                    | rating group shall    |
|                       |                    | also be present. If   |
|                       |                    | not present the       |
|                       |                    | re-authorization      |
|                       |                    | notification applies  |
|                       |                    | to all service        |
|                       |                    | identifiers.          |
+-----------------------+--------------------+-----------------------+
| > Rating Group        | O~C~               | This field holds the  |
|                       |                    | rating group to which |
|                       |                    | re-authorization      |
|                       |                    | notification applies. |
|                       |                    | If not present the    |
|                       |                    | re-authorization      |
|                       |                    | notification applies  |
|                       |                    | to all rating groups. |
+-----------------------+--------------------+-----------------------+
| > Quota management    | O~C~               | This field holds an   |
| > Indicator           |                    | indicator on whether  |
|                       |                    | the re-authorization  |
|                       |                    | notification is for   |
|                       |                    | quota management      |
|                       |                    | control or not. If    |
|                       |                    | not present the       |
|                       |                    | re-authorization      |
|                       |                    | notification applies  |
|                       |                    | to both units with    |
|                       |                    | and without quota     |
|                       |                    | management.           |
+-----------------------+--------------------+-----------------------+

Table 7.4 describes the data structure which is common to Charging
Notify Response.

Table 7.4: Common Data structure of Charging Notify Response

+--------------------------+----------+----------------------------+
| Information Element      | Category | Description                |
+--------------------------+----------+----------------------------+
| Invocation Result        | O~C~     | This field holds the       |
|                          |          | result code in case of     |
|                          |          | unsuccessful result of the |
|                          |          | charging notify request.   |
+--------------------------+----------+----------------------------+
| > Invocation Result Code | O~C~     | This field contains the    |
|                          |          | result code in case of     |
|                          |          | failure.                   |
+--------------------------+----------+----------------------------+
| > Failed parameter       | O~C~     | This field holds missing   |
|                          |          | and/or unsupported         |
|                          |          | parameter that caused the  |
|                          |          | failure.                   |
+--------------------------+----------+----------------------------+

######## Annex A (informative): Change history

  -------------------- ------------- ----------- -------- --------- --------- ----------------------------------------------------------------------- -----------------
  **Change history**                                                                                                                                  
  **Date**             **Meeting**   **TDoc**    **CR**   **Rev**   **Cat**   **Subject/Comment**                                                     **New version**
  2018-06              SA\#80                                                 Upgrade to change control version                                       15.0.0
  2018-09              SA\#81        SP-180832   0002     \-        B         Charging Session Definition                                             15.1.0
  2018-09              SA\#81        SP-180832   0003     \-        F         Correction on CTF in 5G Charging                                        15.1.0
  2018-09              SA\#81        SP-180832   0004     1         B         Introduce Use of NRF Framework                                          15.1.0
  2018-09              SA\#81        SP-180832   0005     \-        B         Update combined scenarios                                               15.1.0
  2018-09              SA\#81        SP-180832   0008     1         B         Correction on Message content                                           15.1.0
  2018-09              SA\#81        SP-180832   0009     1         B         Correction on Nchf\_ConvergedCharging\_Notify Service Operation         15.1.0
  2018-09              SA\#81        SP-180832   0010     1         B         Correction on the requirement for Converged Charging                    15.1.0
  2018-09              SA\#81        SP-180832   0011     1         B         Update of service operation                                             15.1.0
  2018-09              SA\#81        SP-180832   0013     1         B         Update of scenarios                                                     15.1.0
  2018-09              SA\#81        SP-180832   0017     \-        B         Converged Charging service definition update                            15.1.0
  2018-12              SA\#82        SP-181059   0019     1         F         Clarification of requested units handling                               15.2.0
  2018-12              SA\#82        SP-181059   0020     1         F         Allow updating of Notify URI                                            15.2.0
  2018-12              SA\#82        SP-181059   0021     1         F         Correction of Invocation result at http ok                              15.2.0
  2018-12              SA\#82        SP-181052   0022     1         B         Addition of event charging                                              15.2.0
  2018-12              SA\#82        SP-181059   0023     1         F         Add description for Charging Notification                               15.2.0
  2019-03              SA\#83        SP-190116   0024     1         F         Correction of NF Consumer Information                                   15.3.0
  2019-03              SA\#83        SP-190117   0027     \-        F         Correction of SMSF as NF Consumer                                       15.3.0
  2019-03              SA\#83        SP-190116   0030     \-        F         Correction of create operation for subscriber identifier                15.3.0
  2019-03              SA\#83        SP-190116   0031     1         F         Correction of Multiple Unit Information in ChargingDataResponse         15.3.0
  2019-03              SA\#83        SP-190116   0034     1         F         Addition of error handling                                              15.3.0
  2019-03              SA\#83        SP-190127   0025     1         B         Add offline only charging                                               16.0.0
  2019-03              SA\#83        SP-190127   0026     1         B         Add offline only charging service definition                            16.0.0
  2019-03              SA\#83        SP-190127   0035     1         B         Add offline only charging service scenario                              16.0.0
  2019-06              SA\#84        SP-190384   0037     1         A         Clarify the trigger mechanism                                           16.1.0
  2019-06              SA\#84        SP-190387   0039     1         C         Addition of message retry                                               16.1.0
  2019-06              SA\#84        SP-190384   0042     1         A         Correction on error handling                                            16.1.0
  2019-06              SA\#84        SP-190382   0043     1         B         Correct offline only charging service API name                          16.1.0
  2019-06              SA\#84        SP-190384   0051     \-        A         Correction of service operation name for Release                        16.1.0
  2019-09              SA\#85        SP-190758   0052     1         B         Add offline only charging service message content                       16.2.0
  2019-09              SA\#85        SP-190761   0053     1         A         Introduce event offline scenario                                        16.2.0
  2019-09              SA\#85        SP-190763   0055     1         B         Introduce AMF as a new NF consumer                                      16.2.0
  2019-09              SA\#85        SP-190761   0057     1         A         Correction of Multiple Quota reference                                  16.2.0
  2019-09              SA\#85        SP-190761   0068     1         A         Add the NF services                                                     16.2.0
  2019-09              SA\#85        SP-190761   0070     1         A         Add the Service Specification Information                               16.2.0
  2019-09              SA\#85        SP-190761   0071     1         A         Correction on Trigger Mechanism                                         16.2.0
  2019-09              SA\#85        SP-190761   0072     1         A         Clarification of Retry handling                                         16.2.0
  2019-09              SA\#85        SP-190761   0074     1         A         Correction of failure handling                                          16.2.0
  2019-09              SA\#85        SP-190761   0076     1         A         Event based charging mechanism                                          16.2.0
  2019-09              SA\#85        SP-190761   0077     1         A         Correction on response code handling                                    16.2.0
  2019-09              SA\#85                                                 Correction in CR0053 (MCC)                                              16.2.1
  2019-12              SA\#86        SP-191160   0084     1         A         Add clarifications to failure handling                                  16.3.0
  2019-12              SA\#86        SP-191159   0086     1         F         Explanation of when Units Usage must be reported                        16.3.0
  2019-12              SA\#86        SP-191159   0087     1         F         Clarification of Units Usage reporting                                  16.3.0
  2019-12              SA\#86        SP-191160   0088     \-        D         Wrong name on CR                                                        16.3.0
  2019-12              SA\#86        SP-191159   0091     1         F         Correction of Converged Charging principles                             16.3.0
  2019-12              SA\#86        SP-191160   0093     \-        A         Correction of ChargingNotifyResponse description                        16.3.0
  2019-12              SA\#86        SP-191159   0094     \-        F         Clarify Retransmission IE                                               16.3.0
  2019-12              SA\#86        SP-191160   0098     1         A         Correction of notify response                                           16.3.0
  2019-12              SA\#86        SP-191159   0101     1         F         Add the group id for CHF registration                                   16.3.0
  2019-12              SA\#86        SP-191160   0103     1         A         Correction to NF consumer identification                                16.3.0
  2020-07              SA\#88-e      SP-200484   0114     1         F         Correction on Service Termination                                       16.4.0
  2020-07              SA\#88-e      SP-200485   0117     1         F         Correction of two SCUR Scenarios figure title and message description   16.4.0
  2020-07              SA\#88-e      SP-200509   0118     1         F         Correction of NF Consumers AMF for Nchf\_ConvergedCharging\_Release     16.4.0
  2020-07              SA\#88-e      SP-200508   0119     1         B         Add CHF-Controlled Quota Management functionality                       16.4.0
  2020-07              SA\#88-e      SP-200508   0123     1         B         Flows for switch to offline                                             16.4.0
  2020-09              SA\#89e       SP-200741   0128     1         F         Add the attributes for CHFQM                                            16.5.0
  2020-09              SA\#89e       SP-200813   0130     1         F         Correction on Converged Charging and Requested Unit handling            16.5.0
  2020-12              SA\#90e       SP-201051   0132     1         F         Failure handling for InvocationSequemceNumber                           16.6.0
  2020-12              SA\#90e       SP-201051   0134     \-        F         Correction on missing PGW-C+SMF and NEF as NF consumers                 16.6.0
  2020-12              SA\#90e       SP-201051   0135     1         F         Correcting trigger of usage reporting                                   16.6.0
  2020-12              SA\#90e       SP-201049   0137     1         A         Correcting handling of charging identifier                              16.6.0
  2020-12              SA\#90e       SP-201069   0138     \-        F         Correction on quota managed scenario                                    16.6.0
  2020-12              SA\#90e       SP-201088   0140     1         F         Add the NB Mode disable                                                 16.6.0
  2020-12              SA\#90e       SP-201051   0142     1         F         Correction on the Quota Management Mode                                 16.6.0
  2021-03              SA\#91e       SP-210146   0145     \-        F         Correction on coverged session based charging                           16.7.0
  2021-03              SA\#91e       SP-210158   0148     1         F         Correction on missing NS charging NF Consumers                          16.7.0
  2021-03              SA\#91e       SP-210146   0150     \-        F         Correction on Supported Features attribute                              16.7.0
  2021-03              SA\#91e       SP-210146   0152     1         F         Trigger Clarification                                                   16.7.0
  2021-06              SA\#92e       SP-210418   0161     1         F         Correction on support of CHF set and CHF service set                    16.8.0
  2021-09              SA\#93e       SP-210886   0166     \-        F         Correcting of trigger type usage                                        16.9.0
  2021-09              SA\#93e       SP-210886   0168     \-        F         Quota threshold clarification                                           16.9.0
  2021-12              SA\#94e       SP-211485   0171     1         F         Addition of the Threshold based re-authorization triggers               16.10.0
  2021-12              SA\#94e       SP-211485   0175     \-        F         Clarify the NF Consumers                                                16.10.0
  -------------------- ------------- ----------- -------- --------- --------- ----------------------------------------------------------------------- -----------------
