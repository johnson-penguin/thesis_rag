![](media/image1.jpeg){width="7.086111111111111in"
height="1.136111111111111in"}

Contents {#contents .TT}
========

[4](#foreword)

[5](#scope)

[5](#references)

[5](#definitions-and-abbreviations)

[5](#definitions)

[6](#abbreviations)

[6](#fixed-point-ansi-c-code-structure)

[6](#contents-of-the-fixed-point-ansi-c-source-code)

[8](#program-execution)

[9](#memory-requirements)

[9](#constants-and-tables)

[14](#static-memory)

[15](#dynamic-memory)

[16](#maximum-stack-size)

[21](#file-formats)

[21](#audio-input-file-encoder-inputdecoder-output)

[21](#bitstream-file-format-encoder-outputdecoder-input)

[21](#error-pattern-file-decoder-input)

[22](#annex-a-informative-weighted-mops)

[23](#annex-b-informative-change-history)Foreword 1 Scope 2 References 3
Definitions and abbreviations 3.1 Definitions 3.2 Abbreviations 4 Fixed
point ANSI-C code structure 4.1 Contents of the fixed point ANSI-C
source code 4.2 Program execution 4.3 Memory requirements 4.3.1
Constants and tables 4.3.2 Static memory 4.3.3 Dynamic memory 4.3.4
Maximum stack size 5 File formats 5.1 Audio input file (encoder
input/decoder output) 5.2 Bitstream file format (encoder output/decoder
input) 5.3 Error pattern file (decoder input) Annex A (informative):
Weighted MOPS Annex B (informative): Change history

Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document contains an electronic copy of the ANSI‑C code for
the Fixed-point Enhanced aacPlus codec \[1\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TS 26.401: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; General description\".

\[2\] 3GPP TS 26.403: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Encoder specification; Advanced
Audio Coding (AAC) part\".

\[3\] 3GPP TS 26.404: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Encoder specification; Spectral
Band Replication (SBR) part\".

\[4\] 3GPP TS 26.405: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Encoder specification; Parametric
stereo part\".

\[5\] ISO/IEC 14496-3 (2001): \"Information technology - Coding of
audio-visual objects - Part 3: Audio\".

\[6\] ISO/IEC 14496-3:2001/Amd.1:2003: \"Bandwidth Extension\".

\[7\] ISO/IEC 14496-3:2001/Amd.1:2003/Cor 1:2004.

\[8\] ISO/IEC 14496-3:2001/ Amd.2:2004: \"Parametric coding for high
quality audio\".

\[9\] 3GPP TS 26.402: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Additional decoder tools\".

\[10\] 3GPP TS 26.244: \"Transparent end-to-end streaming service; 3GPP
file format (3GP)\".

3 Definitions and abbreviations
===============================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions
given in 3GPP TS 26.401 \[1\], 3GPP TS 26.403 \[2\], 3GPP TS 26.404
\[3\], 3GPP TS 26.405 \[4\] and 3GPP TS 26.402 \[9\] apply.

3.2 Abbreviations
-----------------

For the purposes of the present document, the following abbreviations
apply:

> AAC Advanced Audio Coding
>
> aacPlus Combination of MPEG-4 AAC and MPEG-4 Bandwidth extension (SBR)
>
> ANSI American National Standards Institute
>
> Enhanced aacPlus Combination of MPEG-4 AAC, MPEG-4 Bandwidth extension
> (SBR) and MPEG-4 Parametric Stereo
>
> GSM Global System for Mobile communications
>
> I/O Input/Output
>
> MDCT Modified Discrete Cosine Transform
>
> QMF Quadrature Mirror Filter
>
> RAM Random Access Memory
>
> ROM Read Only Memory
>
> SBR Spectral Band Replication

4 Fixed point ANSI-C code structure
===================================

This clause gives an overview of the structure of the fixed point ANSI-C
code and provides an overview of the contents and organization of the C
code attached to the present document.

The C code has been verified on the following systems:

\- IBM PC/AT compatible computers with Windows XP, 2000 and Microsoft
Visual C++ v.6.0 compiler.

\- IBM PC/AT compatible computers with Linux OS and GCC v.3.3 compiler.

ANSI‑C was selected as the programming language because portability was
desirable.

4.1 Contents of the fixed point ANSI-C source code
--------------------------------------------------

The C code distribution is organized in two directories for encoder and
decoder and further into several subdirectories, reflecting the major
building blocks of the Enhanced aacPlus codec. The file descriptions on
root level as well as the directory structure is given as follows.

Table 1: Source code directory structure for the encoder
(ETSI\_aacPlusenc)

  --------------------- ------------------------------------
  Directory             Description
  README.txt            information on how to compile
  Makefile              UNIX style encoder Makefile
  enhAacPlusenc.dsw     Win32 MSVC 6.0 encoder workspace
  enhAacPlusenc.dsp     Win32 MSVC 6.0 encoder makefile
  src/                  directory for the encoder frontend
  etsiop\_fastaacenc/   AAC encoder library
  etsiop\_resamplib/    resampler library
  etsiop\_sbrenclib/    SBR encoder library
  --------------------- ------------------------------------

Table 2: Source code directory structure for the decoder
(ETSI\_aacPlusdec)

  -------------------- ------------------------------------
  Directory            Description
  README.txt           information on how to compile
  Makefile             UNIX style encoder Makefile
  enhAacPlusdec.dsw    Win32 MSVC 6.0 decoder workspace
  src/                 directory for the decoder frontend
  etsiop\_aacdec       AAC decoder library
  etsiop\_sbrdeclib/   SBR decoder library
  -------------------- ------------------------------------

Table 3: Source code directory structure common for encoder and decoder

  ----------------- --------------------------------------------------------------------
  Directory         Description
  etsiop\_bitbuf/   bitstream reading/writing library
  etsiop\_ffrlib/   general purpose functionalities
  etsioplib/        ETSI operators implementation
  3g\_lib/          precompiled libraries for audio and bitstream file format handling
  ----------------- --------------------------------------------------------------------

The distributed files with suffix \"c\" contain the source code and the
files with suffix \"h\" are the header files. Within the respective
libraries, the RAM data is contained in \"xxx\_ram\" files with suffix
\"c\", the ROM data is contained in \"xxx\_rom\" files with suffix
\"c\". Makefiles are provided for the platforms in which the C code has
been verified (listed above).

A list of source code files is given below:

Table 4: Encoder source code files

  --------------------- ----------------------
  Directory             Module
  src/                  main.c
                        mp4file.c
  etsiop\_fastaacenc/   qc\_main.c
                        aacenc.c
                        ms\_stereo.c
                        spreading.c
                        interface.c
                        bit\_cnt.c
                        adj\_thr.c
                        quantize.c
                        psy\_configuration.c
                        sf\_estim.c
                        tns\_param.c
                        grp\_data.c
                        pre\_echo\_control.c
                        stprepro.c
                        tns.c
                        dyn\_bits.c
                        psy\_main.c
                        channel\_map.c
                        block\_switch.c
                        band\_nrg.c
                        transform.c
                        bitenc.c
                        line\_pe.c
                        stat\_bits.c
  etsiop\_sbrenc/       qmf\_enc.c
                        ton\_corr.c
                        fram\_gen.c
                        env\_bit.c
                        env\_est.c
                        mh\_det.c
                        hybrid.c
                        bit\_sbr.c
                        ps\_bitenc.c
                        sbr\_main.c
                        tran\_det.c
                        sbr\_misc.c
                        code\_env.c
                        nf\_est.c
                        freq\_sca.c
                        invf\_est.c
                        ps\_enc.c
  etsiop\_resamplib/    downsample\_FIR.c
  --------------------- ----------------------

Table 5: Decoder source code files

  -------------------- ---------------------
  Directory            Module
  src/                 main.c
                       fileifc.c
                       spline\_resampler.c
  etsiop\_aacdec/      aacdecoder.c
                       streaminfo.c
                       channelinfo.c
                       stereo.c
                       longblock.c
                       shortblock.c
                       pulsedata.c
                       block.c
                       pns.c
                       imdct.c
                       tns.c
                       bitstream.c
                       channel.c
                       conceal.c
                       datastream.c
  etsiop\_sbrdeclib/   env\_dec.c
                       aacpluscheck.c
                       env\_calc.c
                       lpp\_tran.c
                       sbrdecoder.c
                       sbr\_dec.c
                       sbr\_crc.c
                       hybrid.c
                       ps\_bitdec.c
                       env\_extr.c
                       freq\_sca.c
                       ps\_dec.c
                       qmf\_dec.c
  -------------------- ---------------------

Table 6: Common source code files

  ----------------- ---------------------
  Directory         Module
  etsiop\_bitbuf/   bitbuffer.c
  etsiop\_ffrlib/   fft\_32x32.c
                    transcendent.c
                    transcendent\_enc.c
                    intrinsics.c
                    vector.c
  ----------------- ---------------------

4.2 Program execution
---------------------

The Enhanced aacPlus codec is implemented in two programs:

\- enhAacPlusEnc.exe.

\- enhAacPlusDec.exe.

The programs should be called like:

\- enhAacPlusEnc.exe \<wav\_file\> \<bitstream\_file\> \<bitrate\>
\<(m)ono/(s)tereo\>.

\- enhAacPlusDec.exe \<bitstream\_file\> \<wav\_file\> \<mode\>
\[error\_pattern\_file\].

The audio files contain 16-bit linear encoded PCM samples with wav
header, the bitstream files are of 3GPP type an the error pattern file
is a ASCII file, see clause 5.

The encoder and decoder command line handling is also explained by
running the applications without input arguments.

4.3 Memory requirements
-----------------------

The data types of variables and tables used in the fixed-point
implementation are defined by the ETSI operator data types, the
following types are used:

\- Word8.

\- Word16.

\- Word32.

\- Flag.

### 4.3.1 Constants and tables

This clause contains a listing of all constants and tables contributing
to the ROM requirements of the encoder and decoder.

Table 7: Encoder constants and tables

  ---------------------------------- ------------------------ ---------------------- -------------------------- -------------------------------------------------------------------
  Name                               Data type                Size \[16-bit word\]   Allocated in Source File   Description
  LongWindowSine                     Word16                   1 024                  aac\_rom.c                 Window coefficients
  ShortWindowSine                    Word16                   128                    aac\_rom.c                 Window coefficients
  LongWindowKBD                      Word16                   1 024                  aac\_rom.c                 Window coefficients
  fftTwiddleTable                    Word16                   513                    aac\_rom.c                 FFT twiddle coefficients
  formfac\_sqrttable                 Word32                   192                    aac\_rom.c                 Lookup table for efficient sqrt implementation
  mTab\_3\_4                         Word32                   1 024                  aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  mTab\_4\_3                         Word32                   1 024                  aac\_rom.c                 Inverse quantizer table, used for efficient pow () implementation
  pow2tominusNover16                 Word16                   17                     aac\_rom.c                 Lookup table for efficient pow() implementation
  specExpMantTableComb\_enc          Word32                   128                    aac\_rom.c                 Lookup table for efficient inverse quantizer implementation
  specExpTableComb\_enc              Word8                    32                     aac\_rom.c                 Lookup table for efficient inverse quantizer implementation
  quantBorders                       Word16                   16                     aac\_rom.c                 Lookup table for efficient distortion calculation implementation
  quantBorders                       Word16                   12                     aac\_rom.c                 Lookup table for efficient distortion calculation implementation
  p\_8000\_mono\_long                TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_8000\_stereo\_long              TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_8000\_mono\_short               TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_8000\_stereo\_short             TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_16000\_mono\_long               TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_16000\_stereo\_long             TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_16000\_mono\_short              TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_16000\_stereo\_short            TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_24000\_mono\_long               TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_24000\_stereo\_long             TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_24000\_mono\_short              TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_24000\_stereo\_short            TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_32000\_mono\_long               TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_32000\_stereo\_long             TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_32000\_mono\_short              TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  p\_32000\_stereo\_short            TNS\_CONFIG\_TABULATED   5                      aac\_rom.c                 TNS tuning parameters
  m\_log2\_table                     Word32                   64                     aac\_rom.c                 Lookup table for efficient ld() implementation
  tnsCoeff3                          Word32                   16                     aac\_rom.c                 TNS filter coefficients
  tnsCoeff3Borders                   Word32                   16                     aac\_rom.c                 TNS filter borders
  tnsCoeff4                          Word32                   32                     aac\_rom.c                 TNS filter coefficients
  tnsCoeff4Borders                   Word32                   32                     aac\_rom.c                 TNS filter borders
  tnsInfoTab                         TNS\_INFO\_TAB           20                     aac\_rom.c                 TNS bitrate to tuning mapping table
  tnsMaxBandsTab                     TNS\_MAX\_TAB\_ENTRY     12                     aac\_rom.c                 max. TNS bands per sampling rate table
  huff\_ltab1\_2                     Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab3\_4                     Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab5\_6                     Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab7\_8                     Word16                   64                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab9\_10                    Word16                   169                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab11                       Word16                   289                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ltabscf                      Word16                   121                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab1                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab2                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab3                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab4                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab5                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab6                        Word16                   81                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab7                        Word16                   64                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab8                        Word16                   64                     aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab9                        Word16                   169                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab10                       Word16                   169                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab11                       Word16                   289                    aac\_rom.c                 Huffman codeword table AAC
  huff\_ctabscf                      Word32                   242                    aac\_rom.c                 Huffman codeword table AAC
  sfb\_16000\_long\_1024             Word8                    22                     aac\_rom.c                 Scalefactor band table
  sfb\_16000\_short\_128             Word8                    8                      aac\_rom.c                 Scalefactor band table
  sfb\_22050\_long\_1024             Word8                    24                     aac\_rom.c                 Scalefactor band table
  sfb\_22050\_short\_128             Word8                    8                      aac\_rom.c                 Scalefactor band table
  sfb\_24000\_long\_1024             Word8                    24                     aac\_rom.c                 Scalefactor band table
  sfb\_24000\_short\_128             Word8                    8                      aac\_rom.c                 Scalefactor band table
  p4\_13                             Word32                   26                     sbr\_rom.c                 Hybrid filterbank coefficients
  p8\_13                             Word32                   26                     sbr\_rom.c                 Hybrid filterbank coefficients
  sbr\_cos\_twiddle\_L32\_enc        Word16                   16                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_cos\_twiddle\_L64\_enc        Word16                   32                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_sin\_twiddle\_L32\_enc        Word16                   16                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_sin\_twiddle\_L64\_enc        Word16                   32                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_alt\_sin\_twiddle\_L32\_enc   Word16                   17                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_alt\_sin\_twiddle\_L64\_enc   Word16                   33                     sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_qmf\_64\_640\_enc             Word16                   330                    sbr\_rom.c                 QMF window coefficients
  aBookPsIidTimeCode                 Word32                   58                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqCode                 Word32                   58                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aHybridResolution                  Word16                   3                      sbr\_rom.c                 Number of hybrid bands in each QMF band
  hiResBandBorders                   Word8                    11                     sbr\_rom.c                 Borders of Parametric Stereo bins
  groupBordersMix                    Word8                    15                     sbr\_rom.c                 Borders of Parametric Stereo groups
  bins2groupMap                      Word32                   58                     sbr\_rom.c                 Mapping of Parametric Stereo bins to Parametric Stereo groups
  iidQuantLeft                       Word32                   14                     sbr\_rom.c                 IID quant values for Parametric Stereo
  iidQuantRight                      Word32                   14                     sbr\_rom.c                 IID quant values for Parametric Stereo
  iccQuant                           Word32                   16                     sbr\_rom.c                 ICC quant values for Parametric Stereo
                                                                                                                
  v\_Huff\_envelopeLevelC10T         Word32                   242                    sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC10F         Word32                   242                    sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC10F              Word32                   98                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC10T              Word32                   98                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC11T         Word32                   126                    sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_NoiseLevelC11T            Word32                   126                    sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC11T              Word32                   50                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrNoiseBalanceC11T            Word32                   50                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC11F         Word32                   126                    sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC11F              Word32                   50                     sbr\_rom.c                 Huffman codeword table SBR
  aBookPsIidTimeLength               Word8                    15                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqLength               Word8                    15                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccFreqLength               Word8                    8                      sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeLength               Word8                    8                      sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccFreqCode                 Word16                   15                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeCode;                Word16                   15                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  v\_Huff\_envelopeLevelL10T         Word8                    61                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL10F         Word8                    61                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL10F              Word8                    25                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL10T              Word8                    25                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL11T         Word8                    32                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL11T              Word8                    13                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_NoiseLevelL11T            Word8                    32                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrNoiseBalanceL11T            Word8                    13                     sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL11F         Word8                    32                     sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL11F              Word8                    13                     sbr\_rom.c                 Huffman codeword table SBR
  logDualisTable                     Word16                   65                     transcendent.c             Lookup table for efficient log() implementation
  pow2Table                          Word32                   512                    transcendent\_enc.c        Lookup table for efficient pow() implementation
  FIRenc\_band24                     Word16                   49                     downsample\_FIR.c          FIR filter coefficients for 2:1 resampling
  FIRenc\_band63                     Word16                   127                    downsample\_FIR.c          FIR filter coefficients for 3:2 resampling
  tuningTable                        tuningTable              294                    sbr\_main.c                SBR tuning parameters
  **Sum**                                                     **11282**                                         
  ---------------------------------- ------------------------ ---------------------- -------------------------- -------------------------------------------------------------------

Table 8: Decoder constants and tables

  ------------------------------------ ------------------ ---------------------- -------------------------- -----------------------------------------------------------------------------------------------------------
  Name                                 Data type          Size \[16-bit word\]   Allocated in Source File   Description
  tnsCoeff3                            Word16             8                      aac\_rom.c                 TNS filter coefficients
  tnsCoeff4                            Word16             16                     aac\_rom.c                 TNS filter coefficients
  trigData                             Word16             513                    aac\_rom.c                 Sine table, used for efficient sin(), cos()
  OnlyLongWindowKBD                    Word16             1 024                  aac\_rom.c                 Window coefficients
  OnlyShortWindowKBD                   Word16             128                    aac\_rom.c                 Window coefficients
  OnlyLongWindowSine                   Word16             1 024                  aac\_rom.c                 Window coefficients
  OnlyShortWindowSine                  Word16             128                    aac\_rom.c                 Window coefficients
  sfb\_48\_1024                        Word16             50                     aac\_rom.c                 Scalefactor band table
  sfb\_48\_128                         Word16             15                     aac\_rom.c                 Scalefactor band table
  sfb\_32\_1024                        Word16             51                     aac\_rom.c                 Scalefactor band table
  sfb\_24\_1024                        Word16             49                     aac\_rom.c                 Scalefactor band table
  sfb\_24\_128                         Word16             16                     aac\_rom.c                 Scalefactor band table
  sfb\_16\_1024                        Word16             44                     aac\_rom.c                 Scalefactor band table
  sfb\_16\_128                         Word16             16                     aac\_rom.c                 Scalefactor band table
  sfb\_8\_1024                         Word16             41                     aac\_rom.c                 Scalefactor band table
  sfb\_8\_128                          Word16             16                     aac\_rom.c                 Scalefactor band table
  HuffmanCodeBook\_1                   Word16             204                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_2                   Word16             156                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_3                   Word16             156                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_4                   Word16             152                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_5                   Word16             164                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_6                   Word16             160                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_7                   Word16             124                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_8                   Word16             124                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_9                   Word16             336                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_10                  Word16             328                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_11                  Word16             544                    aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_SCL                 Word16             260                    aac\_rom.c                 Huffman codeword table AAC
  SamplingRateInfoTable                Word16             45                     aac\_rom.c                 Sampling rate to scalefactor mapping table AAC
  HuffmanCodeBooks                     mixed              52                     aac\_rom.c                 Huffman codeword table AAC
  specExpTableComb                     Word8              52                     aac\_rom.c                 Lookup table for efficient exponent implementation
  specExpTableMant                     Word32             104                    aac\_rom.c                 Lookup table for efficient exponent implementation, mantissa
  InverseQuantTable                    Word32             514                    aac\_rom.c                 Lookup table for efficient inverse quantizer implementation
  sgn\_mask                            Word16             3                      aac\_rom.c                 Helper vector for efficient bit-wise operations in the TNS module
  neg\_mask                            Word16             3                      aac\_rom.c                 Helper vector for efficient bit-wise operations in the TNS module
  tns\_max\_bands\_tbl                 Word8              18                     aac\_rom.c                 max. TNS bands per sampling rate table
  sbr\_limGains\_m                     Word16             4                      sbr\_rom.c                 SBR limiter gain values. mantissa
  sbr\_limGains\_e                     Word16             4                      sbr\_rom.c                 SBR limiter gain values, exponent
  sbr\_limiterBandsPerOctaveDiv4       Word16             4                      sbr\_rom.c                 Number of SBR limiter bands, divided by 4
  sbr\_smoothFilter                    Word16             4                      sbr\_rom.c                 Smoothing filter for gain values
  sbr\_invIntTable                     Word16             49                     sbr\_rom.c                 Table of 1/x function
  sbr\_randomPhase                     Word16 or Word32   1 120                  sbr\_rom.c                 Random numbers for SBR noise addition and PNS. Note: for mono only case the data type Word16 can be used.
  sbr\_qmf\_64\_640                    Word16             340                    sbr\_rom.c                 QMF window coefficients
  sbr\_ralt\_sin\_twiddle\_L64         Word16             64                     sbr\_rom.c                 FFT twiddle table
  sbr\_ralt\_sin\_twiddle\_L32         Word16             32                     sbr\_rom.c                 FFT twiddle table
  sbr\_cos\_twiddle\_L64               Word16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_cos\_twiddle\_L32               Word16             16                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_sin\_twiddle\_L64               Word16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_sin\_twiddle\_L32               Word16             16                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_alt\_sin\_twiddle\_L64          Word16             33                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_cos\_twiddle\_ds\_L32           Word16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_sin\_twiddle\_ds\_L32           Word16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_t\_cos\_L32                     Wrod16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_t\_sin\_L32                     Word16             32                     sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  pHybridResolution                    Word16             3                      sbr\_rom.c                 Parametric Stereo hybrid filterbank resolution
  groupShift                           Word16             6                      sbr\_rom.c                 Parametric Stereo shift bits for uppermost frequency groups
  aRevLinkDecaySer                     Word16             3                      sbr\_rom.c                 Parametric Stereo all-pass filter coefficients
  aFractDelayPhaseFactorReQmf          Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorImQmf          Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorReSubQmf       Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorImSubQmf       Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReQmf0      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReQmf1      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReQmf2      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImQmf0      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImQmf1      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImQmf2      Word16             20                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReSubQmf0   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReSubQmf1   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerReSubQmf2   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImSubQmf0   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImSubQmf1   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorSerImSubQmf2   Word16             10                     sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerReQmf      Word16             3                      sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerImQmf      Word16             3                      sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerReSubQmf   Word16             3                      sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerImSubQmf   Word16             3                      sbr\_rom.c                 Parametric Stereo phase rotation factor
  scaleFactors                         Word16             15                     sbr\_rom.c                 Parametric Stereo quantization table
  scaleFactorsFine                     Word16             31                     sbr\_rom.c                 Parametric Stereo quantization table
  alphas                               Word16             8                      sbr\_rom.c                 Parametric Stereo quantization table
  p2\_6                                Word16             6                      sbr\_rom.c                 Hybrid filterbank coefficients
  p8\_13                               Word16             13                     sbr\_rom.c                 Hybrid filterbank coefficients
  sbr\_start\_freq\_16                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_22                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_24                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_32                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_44                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_48                 Word8              16                     sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info1\_16                Word16             18                     sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info2\_16                Word16             18                     sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info4\_16                Word16             18                     sbr\_rom.c                 SBR frequency scale index
  sbr\_huffBook\_EnvLevel10T           Word16             120                    sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel10F           Word16             120                    sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance10T         Word16             48                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance10F         Word16             48                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel11T           Word16             62                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel11F           Word16             62                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance11T         Word16             24                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance11F         Word16             24                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_NoiseLevel11T         Word16             62                     sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_NoiseBalance11T       Word16             24                     sbr\_rom.c                 Huffman codeword table SBR
  aRevLinkDelaySer                     Word16             3                      sbr\_rom.c                 Parametric Stereo all-pass delay line lengths
  groupBorders                         Word16             23                     sbr\_rom.c                 Borders of Parametric Stereo groups
  aGroupToBin                          Word16             22                     sbr\_rom.c                 Parametric Stereo group to bin table
  aHybridToBin                         Word16             12                     sbr\_rom.c                 Parametric Stereo hybrid to bin table
  aDelayToBin                          Word16             20                     sbr\_rom.c                 Parametric Stereo delay to bin table
  aBookPsIidTimeDecode                 Word16             28                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqDecode                 Word16             28                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeDecode                 Word16             14                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccFreqDecode                 Word16             14                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFineTimeDecode             Word16             60                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFineFreqDecode             Word16             60                     sbr\_rom.c                 Huffman codeword table Parametric Stereo
  sbr\_defaultHeader                   mixed              22                     sbr\_rom.c                 Default SBR header data
  logDualisTable                       Word16             65                     transcendent.c             Lookup table for efficient log() implementation
  invTable                             Word16             256                    transcendent.c             Lookup table for efficient 1/x implementation
  **Sum**                                                 **10222**                                         
  ------------------------------------ ------------------ ---------------------- -------------------------- -----------------------------------------------------------------------------------------------------------

NOTE: All Parametric Stereo related coefficients which are marked as
such in the table above are obsolete for mono only capable decoders.

### 4.3.2 Static memory

This clause contains a listing of all static buffers contributing to the
RAM requirements of the encoder and decoder.

Table 9: Encoder static memory

  ------------------------------- ---------------------- ---------------------- -------------------------- -----------------------------------------------------------------------------------------
  Name                            Data type              Size \[16-bit word\]   Allocated in Source File   Description
  mdctDelayBuffer                 Word16                 3200                   aac\_ram.c                 Time domain input signal delay , only half the size for mono only encoder
  quantSpec                       Word16                 2048                   aac\_ram.c                 Quantized spectrum, only half the size for mono only encoder
  scf                             Word16                 120                    aac\_ram.c                 Scalefactors, only half the size for mono only encoder
  maxValueInSfb                   Word16                 120                    aac\_ram.c                 Max. value per calefactor, only half the size for mono only encoder
  sideInfoTabLong                 Word16                 52                     aac\_ram.c                 Table lookup for side information, long blocks
  sideInfoTabShort                Word16                 16                     aac\_ram.c                 Table lookup for side information, short blocks
  aacEncoder                      AAC\_ENCODER           6 851                  aacenc.c                   AAC encoder instance, can be reduced to 3809 for mono only encoder
  sbr\_QmfStatesAnalysis          Word16                 1 280                  sbr\_ram.c                 QMF filterbank states buffer, only half the size for mono only encoder
  sbr\_QmfStatesSynthesis         Word32                 640                    sbr\_ram.c                 QMF filterbank states buffer, not needed for mono only encoder
  sbr\_envYBuffer                 Word32                 8 192                  sbr\_ram.c                 QMF band energy buffer, only half the size for mono only encoder
  sbr\_quotaMatrix                Word32                 1 024                  sbr\_ram.c                 Tonality values. only half the size for mono only encoder
  sbr\_thresholds                 Word32                 256                    sbr\_ram.c                 Detector parameters, only half the size for mono only encoder
  sbr\_toncorrBuff                Word32                 2 160                  sbr\_ram.c                 Detector value buffer, only half the size for mono only encoder
  ps\_IccDataBuffer               Word32                 40                     sbr\_ram.c                 ICC buffer, not needed for mono only encoder
  ps\_IidDataBuffer               Word32                 40                     sbr\_ram.c                 Iid buffer, not needed for mono only encoder
  ps\_histQmfBuffer               Word16                 1 608                  sbr\_ram.c                 QMF history buffer, not needed for mono only encoder
  sbr\_freqBandTableLO            Word16                 14                     sbr\_ram.c                 SBR frequency band table, low resolution
  sbr\_freqBandTableHI            Word16                 28                     sbr\_ram.c                 SBR frequency band table, high resolution
  sbr\_v\_k\_master               Word16                 28                     sbr\_ram.c                 SBR frequency band table index
  sbr\_guideScfb                  Word16                 54                     sbr\_ram.c                 Additional sine detection parameter, only half the size for mono only encoder
  sbr\_detectionVectors           Word16                 108                    sbr\_ram.c                 Additional sine detection parameter, only half the size for mono only encoder
  sbr\_prevEnvelopeCompensation   Word16                 54                     sbr\_ram.c                 Additional sine detection parameter, only half the size for mono only encoder
  sbr\_guideVectorDetected        Word16                 108                    sbr\_ram.c                 Additional sine detection parameter, only half the size for mono only encoder
  sbrEncoder                      SBR\_ENCODER           3 650                  sbr\_main.c                SBR encoder instance, can be reduced to 1722 for mono only encoder
  outputBuffer                    Word8                  384                    main.c                     Bitstream output buffer
  inputBuffer                     Word16                 8 234                  main.c                     Time domain input signal buffer, only half the size for mono only encoder
  up2Sampler                      RESAMPLER\_FIR\_2\_1   144                    main.c                     1:2 FIR resampler instance (includes states) , only half the size for mono only encoder
  down3Sampler                    RESAMPLER\_FIR\_3\_2   208                    main.c                     3:2 FIR resampler instance (includes states) , only half the size for mono only encoder
  down2Sampler                    RESAMPLER\_FIR\_2\_1   144                    main.c                     2:1 FIR resampler instance (includes states) , only half the size for mono only encoder
  **Sum**                                                **40 643**                                        
  ------------------------------- ---------------------- ---------------------- -------------------------- -----------------------------------------------------------------------------------------

Table 10: Decoder static memory

  -------------------------------------- ------------------------------ ---------------------- -------------------------- --------------------------------------------------------------------------------
  Name                                   Data type                      Size \[16-bit word\]   Allocated in Source File   Description
  OverlapBuffer\[nChan\]                 Word16                         1 024                  aac\_ram.c                 Delay buffer for overlap and add, only half the size for mono only decoder
  AacDecoderInstance                     AAC\_DECODER\_INSTANCE         12                     aacdecoder.c               AAC decoder instance
  sbrPayloadBuffer                       Word8                          540                    aacdecoder.c               SBR payload buffer
  StreamInfo                             CStreamInfo                    7                      aac\_ram.c                 Bitstream information
  AacDecoderStaticChannelInfo\[nChan\]   CaacDecoderStaticChannelInfo   16                     aac\_ram.c                 Channel information, only half the size for mono only decoder
  PnsStaticInterChannelData              Word16                         2                      aac\_ram.c                 PNS static data
  ConcealmentInfoInstance                CConcealmentInfo               4 127                  aac\_ram.c                 Concealment static data
  sbr\_CodecQmfStatesAnalysis            Word16                         640                    sbr\_ram.c                 QMF analysis filter bank states
  sbr\_GainSmooth\_m                     Word16                         96                     sbr\_ram.c                 Gain smoothing filter states, mantissa
  sbr\_GainSmooth\_e                     Word16                         96                     sbr\_ram.c                 Gain smoothing filter states, exponent
  sbr\_NoiseSmooth\_m                    Word16                         96                     sbr\_ram.c                 Noise level smoothing filter states, mantissa
  sbr\_QmfStatesSynthesis                Word16                         2 560                  sbr\_ram.c                 QMF synthesis filter bank states
  sbr\_OverlapBuffer                     Word32                         3 072                  sbr\_ram.c                 SBR delay buffer, only half the size for mono only decoder
  sbr\_LpcFilterStatesReal               Word32                         256                    sbr\_ram.c                 LPC filter states
  sbr\_LpcFilterStatesImag               Word32                         256                    sbr\_ram.c                 LPC filter states, obsolete for mono only decoder
  sbr\_TransposerSettings                TRANSPOSER\_SETTINGS           61                     sbr\_ram.c                 Transposer configuration parameters
  FreqBandData                           FREQ\_BAND\_DATA               164                    sbr\_ram.c                 SBR Frequency band information
  PrevFrameData\[nChan\]                 SBR\_PREV\_FRAME\_DATA         120                    sbr\_ram.c                 SBR previous frame data, only half the size for mono only decoder
  sbrDecoderInstance                     SBR\_DECODER\_INSTANCE         797                    sbrdecoder.c               SBR decoder instance
  timeData                               Word16                         4 096                  main.c                     Output buffer for time-domain signal, only half the size for mono only decoder
  inBuffer                               short                          768                    main.c                     Input buffer for bitstream
  splineResamplerInstance                SPLINE\_RESAMPLER              19                     spline\_resampler.c        Spline resampler instance
  **Sum**                                                               **18825**                                         
  -------------------------------------- ------------------------------ ---------------------- -------------------------- --------------------------------------------------------------------------------

### 4.3.3 Dynamic memory

This clause contains a listing of all dynamic buffers contributing to
the RAM requirements of the encoder and decoder. Dynamic memory can be
re-used outside of the encoder or decoder application.

Table 11: Encoder dynamic memory

  ------------------- ----------- ---------------------- -------------------------- ---------------------------------------------------------------
  Name                Data type   Size \[16-bit word\]   Allocated in Source File   Description
  ps\_tempQmfBuffer   Word16      1 608                  sbr\_ram.c                 NOTE: reused in AAC encoder, not needed for mono only encoder
  sbr\_envRBuffer     Word16      4 096                  sbr\_ram.c                 NOTE: reused in AAC encoder
  sbr\_envIBuffer     Word16      4 096                  sbr\_ram.c                 NOTE: reused in AAC encoder
  sbr\_transients     Word32      384                    sbr\_ram.c                 NOTE: reused in AAC encoder
  **Sum**                         **10 184**                                        
  ------------------- ----------- ---------------------- -------------------------- ---------------------------------------------------------------

Table 12: Decoder dynamic memory

  ---------------- ----------- ---------------------- -------------------------- ---------------------------------------------
  Name             Data type   Size \[16-bit word\]   Allocated in Source File   Description
  WorkBufferCore   Word32      4 096                  aac\_ram.c                 NOTE: reused in SBR decoder
  WorkBuffer1      Word32      4 096                  sbr\_ram.c                 Work buffer, obsolete for mono only decoder
  **Sum**                      **8 192**                                         
  ---------------- ----------- ---------------------- -------------------------- ---------------------------------------------

### 4.3.4 Maximum stack size

This clause contains tables for the encoder and the decoder which
describe the call stack that results in the maximum stack size usage.

Table 13: Encoder call stack

+---------------------+----------------------+----------------------+
| Function            | Local variables /    | Stack used \[16-bit  |
|                     | Function call        | words\]              |
|                     | arguments            |                      |
+---------------------+----------------------+----------------------+
| main                | AACENC\_CONFIG       | 8                    |
|                     | config;              |                      |
|                     |                      | 1                    |
|                     | Word16 error;        |                      |
|                     |                      | 1                    |
|                     | Flag bEncodeMono;    |                      |
|                     |                      | 1                    |
|                     | Word16 ch;           |                      |
|                     |                      | 1                    |
|                     | Word16 dummy;        |                      |
|                     |                      | 2                    |
|                     | Word32 bitrate;      |                      |
|                     |                      | 2                    |
|                     | Word16 nChannelsAAC, |                      |
|                     | nChannelsSBR;        | 2                    |
|                     |                      |                      |
|                     | Word32               | 2                    |
|                     | sampleRateAAC;       |                      |
|                     |                      | 1                    |
|                     | Word32 frmCnt ;      |                      |
|                     |                      | 2                    |
|                     | Word32 bandwidth;    |                      |
|                     |                      | 64                   |
|                     | UWord16              |                      |
|                     | numAncDataBytes;     | 2                    |
|                     |                      |                      |
|                     | UWord8               | 1                    |
|                     | ancDataBytes\[M      |                      |
|                     | AX\_PAYLOAD\_SIZE\]; | 1                    |
|                     |                      |                      |
|                     | Word32               | 2                    |
|                     | numSamplesRead;      |                      |
|                     |                      | 2                    |
|                     | Flag bDingleRate;    |                      |
|                     |                      | 2                    |
|                     | Flag                 |                      |
|                     | useParametricStereo; | 2                    |
|                     |                      |                      |
|                     | Word32               | 2                    |
|                     | coreWriteOffset;     |                      |
|                     |                      | 1                    |
|                     | Word32               |                      |
|                     | coreReadOffset;      | 1                    |
|                     |                      |                      |
|                     | Word32               | 1                    |
|                     | envWriteOffset;      |                      |
|                     |                      | 1                    |
|                     | Word32               |                      |
|                     | envReadOffset;       | 1                    |
|                     |                      |                      |
|                     | Word32 writeOffset;  | 1                    |
|                     |                      |                      |
|                     | struct AAC\_ENCODER  | 1                    |
|                     | \*hAacEnc;           |                      |
|                     |                      | 1                    |
|                     | struct SBR\_ENCODER  |                      |
|                     | \*hEnvEnc;           | 2                    |
|                     |                      |                      |
|                     | Flag bDoUpsample;    | 2                    |
|                     |                      |                      |
|                     | Flag                 | 1                    |
|                     | upsampleReadOffset;  |                      |
|                     |                      | 1                    |
|                     | Word16 inSamples;    |                      |
|                     |                      | 1                    |
|                     | Flag bDo32Resample;  |                      |
|                     |                      | 1                    |
|                     | Word16 nRuns;        |                      |
|                     |                      | =116                 |
|                     | Word16               |                      |
|                     | \*resamplerScratch;  |                      |
|                     |                      |                      |
|                     | UWord32 numOutBytes; |                      |
|                     |                      |                      |
|                     | Word32 i;            |                      |
|                     |                      |                      |
|                     | UWord8               |                      |
|                     | \*bitstreamOut;      |                      |
|                     |                      |                      |
|                     | Word32 \*nOutBytes;  |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | numEncSamples;       |                      |
|                     |                      |                      |
|                     | Flag downsample;     |                      |
+---------------------+----------------------+----------------------+
| AacEncEncode        | struct AAC\_ENCODER  | 1                    |
|                     | \*aacEnc;            |                      |
|                     |                      | 1                    |
|                     | Word16 \*timeSignal; |                      |
|                     |                      | 1                    |
|                     | const UWord8         |                      |
|                     | \*ancBytes;          | 1                    |
|                     |                      |                      |
|                     | UWord16              | 1                    |
|                     | \*numAncBytes;       |                      |
|                     |                      | 1                    |
|                     | UWord8 \*outBytes;   |                      |
|                     |                      | 1                    |
|                     | Word32               |                      |
|                     | \*numOutBytes;       | 1                    |
|                     |                      |                      |
|                     | ELEMENT\_INFO        | 1                    |
|                     | \*elInfo;            |                      |
|                     |                      | =9                   |
|                     | Word16 globUsedBits; |                      |
|                     |                      |                      |
|                     | Word16 ancDataBytes, |                      |
|                     | ancDataBytesLeft;    |                      |
+---------------------+----------------------+----------------------+
| QCMain              | QC\_STATE\* hQC,     | 1                    |
|                     |                      |                      |
|                     | Word16 nChannels,    | 1                    |
|                     |                      |                      |
|                     | ELEMENT\_BITS\*      | 1                    |
|                     | elBits,              |                      |
|                     |                      | 1                    |
|                     | ATS\_ELEMENT\*       |                      |
|                     | adjThrStateElement,  | 1                    |
|                     |                      |                      |
|                     | PSY\_OUT\_CHANNEL    | 1                    |
|                     | ps                   |                      |
|                     | yOutChannel\[MAX\_CH | 1                    |
|                     | ANNELS\_PER\_ELEM\], |                      |
|                     |                      | 1                    |
|                     | PSY\_OUT\_ELEMENT\*  |                      |
|                     | psyOutElement,       | 1                    |
|                     |                      |                      |
|                     | QC\_OUT\_CHANNEL     | 1                    |
|                     | q                    |                      |
|                     | cOutChannel\[MAX\_CH | 120                  |
|                     | ANNELS\_PER\_ELEM\], |                      |
|                     |                      | 120                  |
|                     | QC\_OUT\_ELEMENT\*   |                      |
|                     | qcOutElement,        | 120                  |
|                     |                      |                      |
|                     | Word16               | 2                    |
|                     | ancillaryDataBytes   |                      |
|                     |                      | 2                    |
|                     | Word16 ch;           |                      |
|                     |                      | =375                 |
|                     | Word16               |                      |
|                     | logSfb               |                      |
|                     | FormFactor\[MAX\_CHA |                      |
|                     | NNELS\_PER\_ELEM\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | sfbNRel              |                      |
|                     | evantLines\[MAX\_CHA |                      |
|                     | NNELS\_PER\_ELEM\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | lo                   |                      |
|                     | gSfbEnergy\[MAX\_CHA |                      |
|                     | NNELS\_PER\_ELEM\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | m                    |                      |
|                     | axChDynBits\[MAX\_CH |                      |
|                     | ANNELS\_PER\_ELEM\]; |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | chBitD               |                      |
|                     | istribution\[MAX\_CH |                      |
|                     | ANNELS\_PER\_ELEM\]; |                      |
+---------------------+----------------------+----------------------+
| AdjustThresholds    | ADJ\_THR\_STATE      | 1                    |
|                     | \*adjThrState;       |                      |
|                     |                      | 1                    |
|                     | ATS\_ELEMENT         |                      |
|                     | \                    | 1                    |
|                     | *AdjThrStateElement; |                      |
|                     |                      | 1                    |
|                     | PSY\_OUT\_CHANNEL    |                      |
|                     | ps                   | 1                    |
|                     | yOutChannel\[MAX\_CH |                      |
|                     | ANNELS\_PER\_ELEM\]; | 1                    |
|                     |                      |                      |
|                     | PSY\_OUT\_ELEMENT    | 1                    |
|                     | \*psyOutElement;     |                      |
|                     |                      | 1                    |
|                     | Word16               |                      |
|                     | \*chBitDistribution; | 1                    |
|                     |                      |                      |
|                     | Word16               | 1                    |
|                     | lo                   |                      |
|                     | gSfbEnergy\[MAX\_CHA | 1                    |
|                     | NNELS\_PER\_ELEM\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; | 1                    |
|                     |                      |                      |
|                     | Word16               | 1                    |
|                     | sfbNRelevantLine     |                      |
|                     | s\[MAX\_CHANNELS\]\[ | 1                    |
|                     | MAX\_GROUPED\_SFB\]; |                      |
|                     |                      | 2                    |
|                     | const Word16         |                      |
|                     | nChannels;           | 1                    |
|                     |                      |                      |
|                     | QC\_OUT\_ELEMENT     | 667                  |
|                     | \*qcOE;              |                      |
|                     |                      | 1                    |
|                     | const Word16         |                      |
|                     | avgBits;             | 1                    |
|                     |                      |                      |
|                     | const Word16         | =686                 |
|                     | bitresBits;          |                      |
|                     |                      |                      |
|                     | const Word16         |                      |
|                     | maxBitresBits;       |                      |
|                     |                      |                      |
|                     | const Word16         |                      |
|                     | maxBitFac;           |                      |
|                     |                      |                      |
|                     | const Word16         |                      |
|                     | sideInfoBits;        |                      |
|                     |                      |                      |
|                     | Word16 noRedPe,      |                      |
|                     | grantedPe,           |                      |
|                     | grantedPeCorr;       |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | curWindowSequence;   |                      |
|                     |                      |                      |
|                     | PE\_DATA peData;     |                      |
|                     |                      |                      |
|                     | Word16 bitFactor;    |                      |
|                     |                      |                      |
|                     | Word16 ch;           |                      |
+---------------------+----------------------+----------------------+
| adaptThresholdsToPe | PSY\_OUT\_CHANNEL    | 1                    |
|                     | ps                   |                      |
|                     | yOutChannel\[MAX\_CH | 1                    |
|                     | ANNELS\_PER\_ELEM\]; |                      |
|                     |                      | 1                    |
|                     | PSY\_OUT\_ELEMENT    |                      |
|                     | \*psyOutElement;     | 1                    |
|                     |                      |                      |
|                     | Word16               | 1                    |
|                     | lo                   |                      |
|                     | gSfbEnergy\[MAX\_CHA | 1                    |
|                     | NNELS\_PER\_ELEM\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; | 1                    |
|                     |                      |                      |
|                     | PE\_DATA \*peData;   | 1                    |
|                     |                      |                      |
|                     | const Word16         | 4                    |
|                     | nChannels;           |                      |
|                     |                      | 2                    |
|                     | const Word16         |                      |
|                     | desiredPe;           | 2                    |
|                     |                      |                      |
|                     | AH\_PARAM \*ahParam; | 1                    |
|                     |                      |                      |
|                     | MINSNR\_ADAPT\_PARAM | 4                    |
|                     | \*msaParam;          |                      |
|                     |                      | 1                    |
|                     | Word16 noRedPe,      |                      |
|                     | redPe, redPeNoAH;    | =22                  |
|                     |                      |                      |
|                     | Word16 constPart,    |                      |
|                     | constPartNoAH;       |                      |
|                     |                      |                      |
|                     | Word16 nActiveLines, |                      |
|                     | nActiveLinesNoAH;    |                      |
|                     |                      |                      |
|                     | Word16               |                      |
|                     | desiredPeNoAH;       |                      |
|                     |                      |                      |
|                     | Word32 redVal,       |                      |
|                     | avgThrExp;           |                      |
|                     |                      |                      |
|                     | Word16 iter;         |                      |
+---------------------+----------------------+----------------------+
| correctThresh       | PSY\_OUT\_CHANNEL    | 1                    |
|                     | ps                   |                      |
|                     | yOutChannel\[MAX\_CH | 1                    |
|                     | ANNELS\_PER\_ELEM\]; |                      |
|                     |                      | 1                    |
|                     | Word16               |                      |
|                     | ahFla                | 1                    |
|                     | g\[MAX\_CHANNELS\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\]; | 2                    |
|                     |                      |                      |
|                     | PE\_DATA \*peData;   | 1                    |
|                     |                      |                      |
|                     | Word32               | 2                    |
|                     | thrEx                |                      |
|                     | p\[MAX\_CHANNELS\]\[ | 3                    |
|                     | MAX\_GROUPED\_SFB\]; |                      |
|                     |                      | 1                    |
|                     | const Word32 redVal; |                      |
|                     |                      | 1                    |
|                     | const Word16         |                      |
|                     | nChannels;           | 2                    |
|                     |                      |                      |
|                     | const Word32         | 242                  |
|                     | deltaPe;             |                      |
|                     |                      | 4                    |
|                     | Word16 ch, sfb,      |                      |
|                     | sfbGrp;              | 2                    |
|                     |                      |                      |
|                     | PSY\_OUT\_CHANNEL    | 2                    |
|                     | \*psyOutChan;        |                      |
|                     |                      | =266                 |
|                     | PE\_CHANNEL\_DATA    |                      |
|                     | \*peChanData;        |                      |
|                     |                      |                      |
|                     | Word32 deltaSfbPe;   |                      |
|                     |                      |                      |
|                     | Word32               |                      |
|                     | sfbPeFactor          |                      |
|                     | s\[MAX\_CHANNELS\]\[ |                      |
|                     | MAX\_GROUPED\_SFB\], |                      |
|                     | normFactor;          |                      |
|                     |                      |                      |
|                     | Word32 sfbEn,        |                      |
|                     | sfbThr;              |                      |
|                     |                      |                      |
|                     | Word32               |                      |
|                     | sfbThrReduced;       |                      |
|                     |                      |                      |
|                     | Word32 thrFactor;    |                      |
+---------------------+----------------------+----------------------+
| ffr\_pow2\_xy       | Word32 x, Word32 y;  | 4                    |
|                     |                      |                      |
|                     | Word32 iPart,fPart;  | 4                    |
|                     |                      |                      |
|                     | Word32 res;          | 2                    |
|                     |                      |                      |
|                     | Word32 tmp, tmp2;    | 4                    |
|                     |                      |                      |
|                     | Word16 shift,        | 2                    |
|                     | shift2;              |                      |
|                     |                      | 2                    |
|                     | Word16 denom\_h,     |                      |
|                     | denom\_l;            | =18                  |
+---------------------+----------------------+----------------------+
|                     | **Sum**              | **992**              |
+---------------------+----------------------+----------------------+

Table 14: Decoder call stack

+------------------------+------------------------+------------------+
| Function               | Local variables /      | Stack used\      |
|                        | Function call          | \[16-bit words\] |
|                        | arguments              |                  |
+------------------------+------------------------+------------------+
| main()                 | Flag endOfFile;        | 1                |
|                        |                        |                  |
|                        | Flag frameOk;          | 1                |
|                        |                        |                  |
|                        | Word32 i;              | 2                |
|                        |                        |                  |
|                        | Word32 written16;      | 2                |
|                        |                        |                  |
|                        | Word8 channelMode;     | 1                |
|                        |                        |                  |
|                        | struct BIT\_BUF        | 14               |
|                        | bitBuf, \*hBitBuf;     |                  |
|                        |                        | 1                |
|                        | AACDECODER             |                  |
|                        | aacDecoderInfo;        | 6                |
|                        |                        |                  |
|                        | SBRBITSTREAM           | 1                |
|                        | streamSBR;             |                  |
|                        |                        | 1                |
|                        | SBRDECODER             |                  |
|                        | sbrDecoderInfo;        | 2                |
|                        |                        |                  |
|                        | HAN                    | 4                |
|                        | DLE\_SPLINE\_RESAMPLER |                  |
|                        | splineResampler;       | 1                |
|                        |                        |                  |
|                        | Word32 frameSize;      | 1                |
|                        |                        |                  |
|                        | Word32 sampleRate,     | 1                |
|                        | outputSampleRate;      |                  |
|                        |                        | 1                |
|                        | Word8 numChannels;     |                  |
|                        |                        | 1                |
|                        | Word8 numChannelsLast; |                  |
|                        |                        | 1                |
|                        | Word16 numOutSamples;  |                  |
|                        |                        | 1                |
|                        | Flag bDownSample;      |                  |
|                        |                        | 1                |
|                        | Flag fosr16;           |                  |
|                        |                        | =44              |
|                        | Flag fosr8;            |                  |
|                        |                        |                  |
|                        | Flag                   |                  |
|                        | bBitstreamDownMix;     |                  |
|                        |                        |                  |
|                        | Flag bValidMode;       |                  |
+------------------------+------------------------+------------------+
| applySBR()             | SBRDECODER self,       | 1                |
|                        |                        |                  |
|                        | SBRBITSTREAM \*        | 1                |
|                        | Bitstr,                |                  |
|                        |                        | 1                |
|                        | Word16 \*timeData,     |                  |
|                        |                        | 1                |
|                        | Word8 \*numChannels,   |                  |
|                        |                        | 1                |
|                        | Flag SbrFrameOK,       |                  |
|                        |                        | 1                |
|                        | Flag bDownSample,      |                  |
|                        |                        | 1                |
|                        | Flag bBitstreamDownMix |                  |
|                        |                        | 1                |
|                        | Word16 lr;             |                  |
|                        |                        | 2                |
|                        | Word32 i;              |                  |
|                        |                        | 2                |
|                        | Word8 prevStereo,      |                  |
|                        | prevPs;                | 1                |
|                        |                        |                  |
|                        | Word8 psPresent;       | 1                |
|                        |                        |                  |
|                        | Word8 stereo;          | 1                |
|                        |                        |                  |
|                        | Word8 readHeader;      | 2                |
|                        |                        |                  |
|                        | Word32 err;            | 1                |
|                        |                        |                  |
|                        | SBR\_CHANNEL           | 1                |
|                        | \*SbrChannel;          |                  |
|                        |                        | 1                |
|                        | struct BIT\_BUF        |                  |
|                        | bitBuf;                | 1                |
|                        |                        |                  |
|                        | HAN                    | 2                |
|                        | DLE\_SBR\_HEADER\_DATA |                  |
|                        | hHeaderData;           | 1                |
|                        |                        |                  |
|                        | SBR\_HEADER\_STATUS    | 1                |
|                        | headerStatus;          |                  |
|                        |                        | 1                |
|                        | Word32 codecFrameSize; |                  |
|                        |                        | 1                |
|                        | SBR\_SYNC\_STATE       |                  |
|                        | initialSyncState;      | =28              |
|                        |                        |                  |
|                        | SBR\_FRAME\_DATA       |                  |
|                        | \*hFrameDataLeft;      |                  |
|                        |                        |                  |
|                        | SBR\_FRAME\_DATA       |                  |
|                        | \*hFrameDataRight;     |                  |
|                        |                        |                  |
|                        | Flag bUseLP;           |                  |
+------------------------+------------------------+------------------+
| sbr\_dec()             | HANDLE\_SBR\_DEC       | 1                |
|                        | hSbrDec,               |                  |
|                        |                        | 1                |
|                        | Word16 \*timeIn,       |                  |
|                        |                        | 1                |
|                        | Word16 \*timeOut,      |                  |
|                        |                        | 1                |
|                        | HAN                    |                  |
|                        | DLE\_SBR\_HEADER\_DATA | 1                |
|                        | hHeaderData,           |                  |
|                        | HA                     | 1                |
|                        | NDLE\_SBR\_FRAME\_DATA |                  |
|                        | hFrameData,            | 1                |
|                        | HANDLE\_SBR\_PREV\_    |                  |
|                        |                        | 1                |
|                        | FRAME\_DATA            |                  |
|                        | hPrevFrameData,        | 1                |
|                        |                        |                  |
|                        | HANDLE\_PS\_DEC hPS,   | 1                |
|                        |                        |                  |
|                        | HANDLE\_               | 1                |
|                        | SBR\_QMF\_FILTER\_BANK |                  |
|                        | h                      | 1                |
|                        | SynthesisQmfBankRight, |                  |
|                        | SBR\_SCALE\_FACTOR     | 4                |
|                        | \*sbrScaleFactorRight, |                  |
|                        |                        | 2                |
|                        | Flag applyProcessing,  |                  |
|                        |                        | 1                |
|                        | Flag bUseLP            |                  |
|                        |                        | 1                |
|                        | Word32 i, k;           |                  |
|                        |                        | 38               |
|                        | Word16 slot, reserve;  |                  |
|                        |                        | 38               |
|                        | Word16 saveLbScale;    |                  |
|                        |                        | 1                |
|                        | Word16 ov\_len;        |                  |
|                        |                        | 1                |
|                        | Word32                 |                  |
|                        | \*QmfBufferR           | = 98             |
|                        | eal\[MAX\_ENV\_COLS\]; |                  |
|                        |                        |                  |
|                        | Word32                 |                  |
|                        | \*QmfBufferI           |                  |
|                        | mag\[MAX\_ENV\_COLS\]; |                  |
|                        |                        |                  |
|                        | Word32 \*ptr;          |                  |
|                        |                        |                  |
|                        | Word16 noCols;         |                  |
+------------------------+------------------------+------------------+
| cplxS                  | Word32 \*\*qmfReal,    | 1                |
| ynthesisQmfFiltering() |                        |                  |
|                        | Word32 \*\*qmfImag,    | 1                |
|                        |                        |                  |
|                        | Word32 splitSlot,      | 2                |
|                        |                        |                  |
|                        | SBR\_SCALE\_FACTOR     | 1                |
|                        | \*sbrScaleFactor,      |                  |
|                        |                        | 1                |
|                        | Word16 \*timeOut,      |                  |
|                        |                        | 1                |
|                        | HANDLE\_               |                  |
|                        | SBR\_QMF\_FILTER\_BANK | 1                |
|                        | qmfBank,               |                  |
|                        | HANDLE\_PS\_DEC hPS,   | 1                |
|                        |                        |                  |
|                        | Flag active,           | 1                |
|                        |                        |                  |
|                        | Flag bUseLP            | 2                |
|                        |                        |                  |
|                        | Word16 i, j;           | 1                |
|                        |                        |                  |
|                        | Word16 codScalefactor; | 1                |
|                        |                        |                  |
|                        | Word16 sbrScalefactor; | 1                |
|                        |                        |                  |
|                        | Word16 outScalefactor; | 1                |
|                        |                        |                  |
|                        | Word16                 | 1                |
|                        | scaleFactorLowBand;    |                  |
|                        |                        | 1                |
|                        | Word16                 |                  |
|                        | scaleFactorHighBand;   | 128              |
|                        |                        |                  |
|                        | Word16 \*filterStates; | 1                |
|                        |                        |                  |
|                        | Word32                 | 128              |
|                        | qmfReal2\[NO\_         |                  |
|                        | SYNTHESIS\_CHANNELS\]; | 1                |
|                        |                        |                  |
|                        | Word16                 | 1                |
|                        | no                     |                  |
|                        | \_synthesis\_channels; | 1                |
|                        |                        |                  |
|                        | Word32                 | 1                |
|                        | qmfRealTmp\[NO\_       |                  |
|                        | SYNTHESIS\_CHANNELS\]; | = 277            |
|                        |                        |                  |
|                        | Word32 \*qmfImagTmp;   |                  |
|                        |                        |                  |
|                        | Word8 env;             |                  |
|                        |                        |                  |
|                        | Word16                 |                  |
|                        | sc                     |                  |
|                        | aleFactorLowBandSplit; |                  |
|                        |                        |                  |
|                        | Word32 \*imagSlot;     |                  |
+------------------------+------------------------+------------------+
| inverseModulationLP()  | Word32 \*qmfReal,      | 1                |
|                        |                        |                  |
|                        | Word32 \*qmfReal2,     | 1                |
|                        |                        |                  |
|                        | const Word16           | 1                |
|                        | scaleFactorLowBand,    |                  |
|                        |                        | 1                |
|                        | const Word16           |                  |
|                        | scaleFactorHighBand,   | 1                |
|                        | HANDLE\_               |                  |
|                        | SBR\_QMF\_FILTER\_BANK | 1                |
|                        | synQmf                 |                  |
|                        |                        | 1                |
|                        | Word16 i;              |                  |
|                        |                        | 1                |
|                        | const Word16 L;        |                  |
|                        |                        | 256              |
|                        | const Word16 M;        |                  |
|                        |                        | = 264            |
|                        | Word32                 |                  |
|                        | timeOut\[2\*NO\_       |                  |
|                        | SYNTHESIS\_CHANNELS\]; |                  |
+------------------------+------------------------+------------------+
| dct2 ()                | Word32 \*data,         | 1                |
|                        |                        |                  |
|                        | Word32 \*tmp,          | 1                |
|                        |                        |                  |
|                        | Word32 L,              | 2                |
|                        |                        |                  |
|                        | HANDLE\_               | 1                |
|                        | SBR\_QMF\_FILTER\_BANK |                  |
|                        | qmfBank                | 2                |
|                        |                        |                  |
|                        | Word16 cosphi,sinphi;  | 1                |
|                        |                        |                  |
|                        | Word16 i;              | 2                |
|                        |                        |                  |
|                        | Word32 M;              | 2                |
|                        |                        |                  |
|                        | Word32 N;              | 12               |
|                        |                        |                  |
|                        | Word32                 | = 24             |
|                        | a1,a2,a3,a4,a5,a6;     |                  |
+------------------------+------------------------+------------------+
| DSP\_fft32x32s()       | Word32 npoints         | 2                |
|                        |                        |                  |
|                        | Word32 \*ptr\_x        | 1                |
|                        |                        |                  |
|                        |                        | = 3              |
+------------------------+------------------------+------------------+
| \_\_fft32()            | Word32 x\[\]           | 2                |
|                        |                        |                  |
|                        | Word16 m;              | 1                |
|                        |                        |                  |
|                        | Word32 re, ie, ro, io, | 12               |
|                        | rx, ix ;               |                  |
|                        |                        | 4                |
|                        | Word32 \*x1m, \*x2m,   |                  |
|                        | \*x1mm, \*x2mm;        | = 19             |
+------------------------+------------------------+------------------+
| \_\_fft2x16()          | Word32 x\[\]           | 2                |
|                        |                        |                  |
|                        | Word16 sch, sh, ch;    | 3                |
|                        |                        |                  |
|                        | Word32 a0, a1, a2, a3, | 16               |
|                        | a00, a10, a20, a30 ;   |                  |
|                        |                        | 8                |
|                        | Word32 tr, ti, vr, vi  |                  |
|                        | ;                      | 128              |
|                        |                        |                  |
|                        | Word32 even \[32\],    | = 157            |
|                        | odd \[32\] ;           |                  |
+------------------------+------------------------+------------------+
| fixmul\_32x16b()       | Word32 a;\             | 2                |
|                        | Word16 b;              |                  |
|                        |                        | 1                |
|                        | Word16 hi1 lo1         |                  |
|                        |                        | 2                |
|                        |                        |                  |
|                        |                        | = 5              |
+------------------------+------------------------+------------------+
|                        | **Sum**                | **919**          |
+------------------------+------------------------+------------------+

5 File formats
==============

This clause describes the file formats used by the encoder and decoder
programs.

5.1 Audio input file (encoder input/decoder output)
---------------------------------------------------

The audio input files read by the encoder and written by the decoder are
16-bit PCM wave files. For convenient handling of wave files a
precompiled audio-file format library is used.

5.2 Bitstream file format (encoder output/decoder input)
--------------------------------------------------------

The encoder program writes and the decoder program reads raw frames
packetized in access units as described by 3GPP TS 26.244 \[10\]. For
packetization the ISO media library is used. A precompiled library is
used.

5.3 Error pattern file (decoder input)
--------------------------------------

The decoder program can optionally process an additional input file
which describes an error pattern. The format of the error pattern file
is 1 character per line. Each line corresponds to one frame, where a
\"0\" indicates that the respective frame has been transmitted without
errors, while a \"1\" indicates that the corresponding frame has been
lost and error concealment shall be applied by the decoder.

######## Annex A (informative): Weighted MOPS

The complexity numbers for the Enhanced aacPlus audio codec can be found
in the following tables, the numbers have been derived using the
\"allcat.wav\" item, which holds all the material from the selection
test concatenated in one single item. For every test case the average
and worst frame weighted MOPS figure has been derived. The worst case
wMOPS figure over all test cases has been marked in **blue**.

The fixed-point C-code contains a pre-compiler directive named
\"ACCOUNT\_ETSIOP\_OVERHEAD\_SPLITWORD32\". If this pre-compiler
directive is set during compilation, the complexity figures will be as
given in Table 15. If this pre-compiler directive is not set during
compilation, the complexity figures will be as given in Table 16.
Regarding the details of the corresponding difference in the fixed-point
C-code, please see the comments in the SplitWord32() function in
intrinsics.c.

Table A.1: Weighted MOPS figures with
ACCOUNT\_ETSIOP\_OVERHEAD\_SPLITWORD32 set

+----------+----------+----------+----------+----------+----------+
|          | Test     | Mono     | Stereo   | Decoder  | Decoder, |
|          | Case     | Encoder  | Encoder  |          | mono     |
|          |          |          |          |          | only     |
+----------+----------+----------+----------+----------+----------+
| *        | 14m      | 26.51 /  | 26.50 /  | 19.15 /  | 14.73 /  |
| *wMOPS** |          | 28.87    | 31.61    | 21.20    | 16.80    |
|          |          |          |          |          |          |
| **\      |          |          |          |          |          |
| [average |          |          |          |          |          |
| /\       |          |          |          |          |          |
| worst    |          |          |          |          |          |
| f        |          |          |          |          |          |
| rame\]** |          |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
|          | 18s      | \-\--    | 61.38 /  | 35.18 /  | 15.14 /  |
|          |          |          | 65.25    | 38.04    | 17.39    |
+----------+----------+----------+----------+----------+----------+
|          | 24m      | 29.51 /  | 29.51 /  | 20.98 /  | 15.93 /  |
|          |          | 34.28    | 34.26    | 23.84    | 18.74    |
+----------+----------+----------+----------+----------+----------+
|          | 24s      | \-\--    | 63.47 /  | 37.35 /  | 15.93 /  |
|          |          |          | 68.17    | 40.98    | 18.72    |
+----------+----------+----------+----------+----------+----------+
|          | 32s      | \-\--    | 64.61 /  | **38.39  | 16.47 /  |
|          |          |          | 71.02    | /        | 19.60    |
|          |          |          |          | 42.28**  |          |
+----------+----------+----------+----------+----------+----------+
|          | 48s      | \-\--    | **64.17  | 32.65 /  | 21.96 /  |
|          |          |          | /        | 38.46    | 26.83    |
|          |          |          | 77.63**  |          |          |
+----------+----------+----------+----------+----------+----------+

Table A.2: Weighted MOPS figures with
ACCOUNT\_ETSIOP\_OVERHEAD\_SPLITWORD32 not set

+----------+----------+----------+----------+----------+----------+
|          | Test     | Mono     | Stereo   | Decoder  | Decoder, |
|          | Case     | Encoder  | Encoder  |          | mono     |
|          |          |          |          |          | only     |
+----------+----------+----------+----------+----------+----------+
| *        | 14m      | 23.80 /  | 23.79 /  | 15.86 /  | 12.38 /  |
| *wMOPS** |          | 25.41    | 29.04    | 17.73    | 14.38    |
|          |          |          |          |          |          |
| **\      |          |          |          |          |          |
| [average |          |          |          |          |          |
| /\       |          |          |          |          |          |
| worst    |          |          |          |          |          |
| f        |          |          |          |          |          |
| rame\]** |          |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
|          | 18s      | \-\--    | 51.14 /  | 29.35 /  | 12.77 /  |
|          |          |          | 53.92    | 32.07    | 14.95    |
+----------+----------+----------+----------+----------+----------+
|          | 24m      | 26.52    | 26.52 /  | 17.53 /  | 13.51 /  |
|          |          | /29.60   | 29.66    | 20.13    | 16.21    |
+----------+----------+----------+----------+----------+----------+
|          | 24s      | \-\--    | 53.08 /  | 31.17 /  | 13.57 /  |
|          |          |          | 56.06    | 34.64    | 16.22    |
+----------+----------+----------+----------+----------+----------+
|          | 32s      | \-\--    | 54.11 /  | **32.08  | 14.05 /  |
|          |          |          | 58.39    | /        | 17.09    |
|          |          |          |          | 35.75**  |          |
+----------+----------+----------+----------+----------+----------+
|          | 48s      | \-\--    | **57.46  | 27.88 /  | 18.53 /  |
|          |          |          | /        | 33.43    | 23.22    |
|          |          |          | 65.89**  |          |          |
+----------+----------+----------+----------+----------+----------+

######## Annex B (informative): Change history

  -------------------- -------------- -------------- -------- --------- --------------------------------------------------------------------------------------------------------- --------- ---------
  **Change history**                                                                                                                                                                        
  **Date**             **TSG SA\#**   **TSG Doc.**   **CR**   **Rev**   **Subject/Comment**                                                                                       **Old**   **New**
  2005-03              27             SP-050146                         Approved at TSG SA\#27                                                                                    1.0.0     6.0.0
  2005-06              28             SP-050251      001                Correction to C-code: Corrections to ETSI operator usage                                                  6.0.0     6.1.0
  2005-06              28             SP-050251      002                Correction to C-code: Avoid reading of non-initialized variable                                           6.0.0     6.1.0
  2005-06              28             SP-050251      003                Correction to C-code: fixes for error concealment                                                         6.0.0     6.1.0
  2005-09              29             SP-050426      0004               Correction to C-code: enable 44.1 kHz input material encoding (fixed-point code)                          6.1.0     6.2.0
  2005-09              29             SP-050426      0005               Correction to C-Code: Bitrate dependancy of AAC block switching threshold                                 6.1.0     6.2.0
  2005-09              29             SP-050426      0006               Correction to C-Code: prevent overflow in parameter estimation of Parametric Stereo IID value             6.1.0     6.2.0
  2005-09              29             SP-050426      0007               Correction to C-Code: smoothing of SBR noise values                                                       6.1.0     6.2.0
  2005-09              29             SP-050426      0008               Correction to C-Code: removal of obsolete table (fixed-point code)                                        6.1.0     6.2.0
  2005-09              29             SP-050426      0009               Correction to C-Code: rounding in TNS parcor coefficient calculation                                      6.1.0     6.2.0
  2005-12              30             SP-050786      0011               Correction to C-code: encoder tuning table entry for 44.1 kHz was wrong                                   6.2.0     6.3.0
  2005-12              30             SP-050786      0012               Correction to C-code: encoder bitrate switching simulation toolset                                        6.2.0     6.3.0
  2006-09              33             SP-060595      0015     1         Correction of written specification: correct memory tables (fixed-point code)                             6.3.0     6.4.0
  2006-09              33             SP-060601      0013     2         Modification of C-code: Change of encoder bitrate border for Parametric Stereo usage (fixed-point code)   6.4.0     7.0.0
  2006-12              34             SP-060849      0016               Correction to C-code: Correct the maximum possible SBR payload size (fixed point code)                    7.0.0     7.1.0
  2007-03              35             SP-070030      0018               Bugfix for the Enhanced aacPlus fixed point arithmetic library                                            7.1.0     7.2.0
  2007-09              37             SP-070628      0020     1         Adding safety code to avoid encoder runtime-assertion                                                     7.2.0     7.3.0
  2007-09              37             SP-070628      0022     1         Prevent arithmetic overflow during estimation of perceptual entropy in AAC encoder                        7.2.0     7.3.0
  2007-09              37             SP-070628      0024     1         Prevent out-of-bounds memory access of encoder in parametric stereo mode                                  7.2.0     7.3.0
  2008-12              42                                               Version for Release 8                                                                                     7.3.0     8.0.0
  2009-12              46                                               Version for Release 9                                                                                     8.0.0     9.0.0
  2011-03              51                                               Version for Release 10                                                                                    9.0.0     10.0.0
  2012-09              57                                               Version for Release 11                                                                                    10.0.0    11.0.0
  2014-09              65                                               Version for Release 12                                                                                    11.0.0    12.0.0
  2015-12              70                                               Version for Release 13                                                                                    12.0.0    13.0.0
  -------------------- -------------- -------------- -------- --------- --------------------------------------------------------------------------------------------------------- --------- ---------

  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
  **Change history**                                                                                          
  **Date**             **Meeting**   **TDoc**   **CR**   **Rev**   **Cat**   **Subject/Comment**              **New version**
  2017-03              75                                                    Version for Release 14           14.0.0
  2018-06              80                                                    Version for Release 15           15.0.0
  2020-07              \-            \-         \-       \-        \-        Update to Rel-16 version (MCC)   **16.0.0**
  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
