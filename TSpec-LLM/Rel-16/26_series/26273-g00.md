![](media/image1.jpeg){width="7.086111111111111in"
height="1.136111111111111in"}

Contents {#contents .TT}
========

[4](#foreword)

[5](#scope)

[5](#references)

[5](#definitions-and-abbreviations)

[5](#definitions)

[5](#abbreviations)

[6](#c-code-structure)

[6](#contents-of-the-c-source-code)

[6](#program-execution)

[6](#code-hierarchy)

[19](#variables-constants-and-tables)

[19](#description-of-fixed-tables-used-in-the-c-code)

[20](#static-variables-used-in-the-c-code)

[25](#file-formats)

[25](#audio-file-encoder-inputdecoder-output)

[25](#parameter-bitstream-file-encoder-outputdecoder-input)

[26](#annex-a-informative-change-history)Foreword 1 Scope 2 References 3
Definitions and abbreviations 3.1 Definitions 3.2 Abbreviations 4 C code
structure 4.1 Contents of the C source code 4.2 Program execution 4.3
Code hierarchy 4.5 Variables, constants and tables 4.5.1 Description of
fixed tables used in the C-code 4.5.2 Static variables used in the
C-code 5 File formats 5.1 Audio file (encoder input/decoder output) 5.2
Parameter bitstream file (encoder output/decoder input) Annex A
(informative): Change history

Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document contains an electronic copy of the ANSI‑C code for
the Fixed-point Extended Adaptive Multi‑Rate Wideband codec.
Alternatively, floating-point ANSI-C code is specified in 3GPP TS 26.304
\[1\]. The fixed-point codec/encoder/decoder specified in the present
document or the floating-point codec/encoder/decoder specified in
3GPP TS 26.304 \[1\] may be used depending on if the implementation
platform is better suited for a floating-point or a fixed-point
implementation. It has been verified that the fixed-point and
floating-point codecs interoperate with each other without any
artifacts.

The fixed-point ANSI‑C code in the present document defines, besides the
floating-point c-code specified in 3GPP TS 26.304 \[1\], one valid
reference implementation of the Extended Adaptive Multi-Rate Wideband
transcoder (3GPP TS 26.290 \[2\]). Standard conformance it is enforced
by meeting the conformance criteria defined in 3GPP TS 26.274 \[3\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TS 26.304: \"Extended Adaptive Multi-Rate - Wideband
(AMR-WB+) codec; Floating-point ANSI-C code\".

\[2\] 3GPP TS 26.290: \"Audio codec processing functions; Extended
Adaptive Multi-Rate - Wideband (AMR-WB+) codec; Transcoding functions\".

\[3\] 3GPP TS 26.274: \"Speech codec speech processing functions;
Extended Adaptive Multi-Rate - Wideband (AMR-WB+) speech codec;
Conformance testing\".

\[4\] 3GPP TS 26.244: \"Transparent end-to-end packet switched streaming
service (PSS); 3GPP file format (3GP)\".

3 Definitions and abbreviations
===============================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions are
given in 3GPP TS 26.290 \[1\].

3.2 Abbreviations
-----------------

For the purposes of the present document, the following abbreviations
apply:

AMR-WB+ Extended Adaptive Multi-Rate WideBand

ANSI American National Standards Institute

ETS European Telecommunication Standard

GSM Global System for Mobile communications

I/O Input/Output

RAM Random Access Memory

ROM Read Only Memory

4 C code structure
==================

This clause gives an overview of the structure of the bit‑exact C code
and provides an overview of the contents and organization of the C code
attached to the present document.

The C code has been verified on the following systems:

\- IBM PC/AT compatible computers with Windows 2000 SP4 and Microsoft
Visual C++ v.6.0 compiler.

ANSI‑C was selected as the programming language because portability was
desirable.

4.1 Contents of the C source code
---------------------------------

The C code distribution has the files divided in six different
directories, all present in the directory *c-code*. The directories are:
*common\_fx, decoder\_fx, encoder\_fx, lib\_amr\_fx* *include\_fx* and
*basic\_op*. The distributed files with suffix \"c\" contain the source
code and the files with suffix \"h\" are the header files.

Project and workspace files are provided in the directory *MSVC*.

4.2 Program execution
---------------------

The Extended Adaptive Multi-Rate Wideband codec is implemented in two
programs:

*-* (*encoder*) audio encoder;

*-* (*decoder*) audio decoder.

The programs should be called like:

\- encoder \[encoder options\] -if \<audio input file\> -of \<parameter
file\>;

\- decoder \[decoder options\] -if \<parameter file\> -of \<audio output
file\>.

The input files contain one or two channels of 16-bit linear encoded PCM
audio samples stored in the *wav* file format and the parameter files
contain encoded audio data and some additional flags.

The encoder and decoder options will be explained by running the
applications without input arguments. Detailed information explaining
the use of the AMR-WB+ encoder and decoder programs is provided in the
user\'s guide in Annex A of \[1\]. See also the file readme.txt for
condensed information on how to run the *encoder* and *decoder*
programs.

4.3 Code hierarchy
------------------

Tables 1 and 2 are call graphs that show the functions used in the audio
codec.

Each column represents a call level and each cell a function. The
functions contain calls to the functions in rightwards neighbouring
cells. The time order in the call graphs is from the top downwards as
the processing of a frame advances. All standard C functions: printf(),
fwrite(), etc. have been omitted. Also, no basic operations (add(),
L\_add(), mac(), etc.) or double precision extended operations (e.g.
L\_Extract(), Copy() or Set\_zero()) appear in the graphs. The
initialization of the static RAM (i.e. calling the \_init functions) is
also omitted.

The basic operations are not counted as extending the depth, therefore
the deepest level in this software is level 6.

Table 1: Encoder call structure

  ---------------------------- --------------------------- --------------------- ------------------------------ ------------------------- --------------------------- --------------------------------------------- ---------------- ------------------------
  coder\_amrwb\_plus\_stereo                                                                                                                                                                                                         
                               Scale\_speech\_st                                                                                                                                                                                     
                               Rescale\_enc\_mem\_st                                                                                                                                                                                 
                                                           Scale\_sig                                                                                                                                                                
                               Decim\_12k8\_p                                                                                                                                                                                        
                                                           Interpol                                                                                                                                                                  
                               HP50\_12k8\_p                                                                                                                                                                                         
                               Mix\_ch                                                                                                                                                                                               
                               Preemph\_scaled                                                                                                                                                                                       
                               Rescale\_enc\_mem\_st                                                                                                                                                                                 
                               Coder\_lf                                                                                                                                                                                             
                                                           AutocorrPlus                                                                                                                                                              
                                                           Lag\_window\_p                                                                                                                                                            
                                                           Levinson                                                                                                                                                                  
                                                           Az\_isp                                                                                                                                                                   
                                                                                 Chebps2                                                                                                                                             
                                                           Int\_lpc                                                                                                                                                                  
                                                                                 Isp\_Az                                                                                                                                             
                                                                                                                Get\_isp\_pol                                                                                                        
                                                           Find\_wsp                                                                                                                                                                 
                                                                                 Weight\_a                                                                                                                                           
                                                                                 Residu2                                                                                                                                             
                                                                                 Deemph                                                                                                                                              
                                                           LP\_Decim2                                                                                                                                                                
                                                           Scale\_sig                                                                                                                                                                
                                                           scale\_mem\_Hp\_wsp                                                                                                                                                       
                                                           Pitch\_med\_ol                                                                                                                                                            
                                                                                 Hp\_wsp                                                                                                                                             
                                                           Isp\_isf                                                                                                                                                                  
                                                           Qpisf\_2s\_46b                                                                                                                                                            
                                                                                 VQ\_stage1                                                                                                                                          
                                                                                 Sub\_VQ                                                                                                                                             
                                                                                 Dpisf\_2s\_46b                                                                                                                                      
                                                                                                                Reorder\_isf                                                                                                         
                                                           coder\_acelp                                                                                                                                                              
                                                                                 Scale\_sig                                                                                                                                          
                                                                                 Residu                                                                                                                                              
                                                                                 Weight\_a                                                                                                                                           
                                                                                 Syn\_filt                                                                                                                                           
                                                                                 Deemph2                                                                                                                                             
                                                                                 Preemph                                                                                                                                             
                                                                                 Syn\_filt\_s                                                                                                                                        
                                                                                 Pitch\_fr4                                                                                                                                          
                                                                                                                Norm\_Corr                                                                                                           
                                                                                                                                          Convolve                                                                                   
                                                                                                                Interpol\_4                                                                                                          
                                                                                 Pred\_lt4                                                                                                                                           
                                                                                 Convolve                                                                                                                                            
                                                                                 G\_pitch                                                                                                                                            
                                                                                 Updt\_tar                                                                                                                                           
                                                                                 Pit\_shrp                                                                                                                                           
                                                                                 cor\_h\_x                                                                                                                                           
                                                                                 ACELP\_4t64\_fx                                                                                                                                     
                                                                                                                cor\_h\_vec                                                                                                          
                                                                                                                search\_ixiy                                                                                                         
                                                                                                                Quant\_2p\_2N1                                                                                                       
                                                                                                                Quant\_1p\_N1                                                                                                        
                                                                                                                Quant\_3p\_3N1                                                                                                       
                                                                                                                                          Quant\_2p\_2N1                                                                             
                                                                                                                Quant\_4p\_4N                                                                                                        
                                                                                                                                          Quant\_4p\_4N1                                                                             
                                                                                                                                                                      Quant\_2p\_2N1                                                 
                                                                                                                Quant\_5p\_5N                                                                                                        
                                                                                                                                          Quant\_3p\_3N1                                                                             
                                                                                                                                                                      Quant\_2p\_2N1                                                 
                                                                                                                Quant\_6p\_6N\_2                                                                                                     
                                                                                                                                          Quant\_5p\_5N                                                                              
                                                                                                                                                                      Quant\_3p\_3N1                                                 
                                                                                                                                                                                                                    Quant\_2p\_2N1   
                                                                                                                                          Quant\_4p\_4N                                                                              
                                                                                                                                                                      Quant\_4p\_4N1                                                 
                                                                                                                                                                                                                    Quant\_2p\_2N1   
                                                                                                                                          Quant\_3p\_3N1                                                                             
                                                                                                                                                                      Quant\_2p\_2N1                                                 
                                                                                                                                          Quant\_2p\_2N1                                                                             
                                                                                                                                          Quant\_1p\_N1                                                                              
                                                                                 Q\_gain2\_plus                                                                                                                                      
                                                           Segsnr                                                                                                                                                                    
                                                           Coder\_tcx                                                                                                                                                                
                                                                                 Cos\_window                                                                                                                                         
                                                                                 Weight\_a                                                                                                                                           
                                                                                 Residu2                                                                                                                                             
                                                                                 Deemph                                                                                                                                              
                                                                                 fft9\_fx                                                                                                                                            
                                                                                                                init\_r\_fft\_fx                                                                                                     
                                                                                                                r\_fft\_fx                                                                                                           
                                                                                 FFT\_reorder                                                                                                                                        
                                                                                 Adap\_low\_freq\_emph                                                                                                                               
                                                                                                                SpPeak1k6                                                                                                            
                                                                                 AVQ\_Cod                                                                                                                                            
                                                                                                                RE8\_PPV\_FX                                                                                                         
                                                                                                                                          Nearest\_neighbor\_2D8                                                                     
                                                                                 Scale\_tcx\_ifft                                                                                                                                    
                                                                                                                Scale\_sig                                                                                                           
                                                                                 Adap\_low\_freq\_deemph                                                                                                                             
                                                                                                                SpPeak1k6                                                                                                            
                                                                                                                Deemph1k6                                                                                                            
                                                                                 Ifft\_reorder                                                                                                                                       
                                                                                 ifft9\_fx                                                                                                                                           
                                                                                                                r\_fft\_fx                                                                                                           
                                                                                 Get\_gain                                                                                                                                           
                                                                                 Q\_gain\_tcx                                                                                                                                        
                                                                                 Preemph                                                                                                                                             
                                                                                 Scale\_sig                                                                                                                                          
                                                                                 Syn\_filt\_s                                                                                                                                        
                               Scale\_speech                                                                                                                                                                                         
                               Rescale\_enc\_mem\_hf                                                                                                                                                                                 
                               coder\_hf                                                                                                                                                                                             
                                                           AutocorrPlus                                                                                                                                                              
                                                           Lag\_window\_p                                                                                                                                                            
                                                           Levinson\_p                                                                                                                                                               
                                                           Az\_isp\_p                                                                                                                                                                
                                                                                 Chebps2                                                                                                                                             
                                                           Int\_lpc                                                                                                                                                                  
                                                                                 Isp\_Az                                                                                                                                             
                                                                                                                Get\_isp\_pol                                                                                                        
                                                           Isp\_isf                                                                                                                                                                  
                                                           Q\_isf\_hf                                                                                                                                                                
                                                                                 Sub\_VQ                                                                                                                                             
                                                                                 Reorder\_isf                                                                                                                                        
                                                           Isf\_isp                                                                                                                                                                  
                                                           Match\_gain\_6k4                                                                                                                                                          
                                                                                 Residu                                                                                                                                              
                                                                                 Syn\_filt                                                                                                                                           
                                                                                 Scale\_sig                                                                                                                                          
                                                           Int\_gain                                                                                                                                                                 
                                                           Residu2                                                                                                                                                                   
                                                           Syn\_filt\_s                                                                                                                                                              
                                                           E\_LPC\_a\_weight                                                                                                                                                         
                                                           Weight\_a                                                                                                                                                                 
                                                           Q\_gain\_hf                                                                                                                                                               
                               Band\_split\_taligned\_2k                                                                                                                                                                             
                                                           Decim\_2k                                                                                                                                                                 
                                                                                 Interpol\_st                                                                                                                                        
                                                           Oversamp\_2k                                                                                                                                                              
                                                                                 Interpol\_st                                                                                                                                        
                               Coder\_stereo\_x                                                                                                                                                                                      
                                                           Cod\_hi\_stereo                                                                                                                                                           
                                                                                 Residu2                                                                                                                                             
                                                                                 Compute\_exc\_side                                                                                                                                  
                                                                                 Compute\_cross\_corr\_vector                                                                                                                        
                                                                                 Cholsolc                                                                                                                                            
                                                                                 Cholsolc\_repair                                                                                                                                    
                                                                                 Smooth\_ener\_filter                                                                                                                                
                                                                                 quant\_filt                                                                                                                                         
                                                                                                                Pmsvq2                                                                                                               
                                                                                                                                          Msvq2                                                                                      
                                                                                                                                                                      M\_cbcod                                                       
                                                                                 Fir\_filt                                                                                                                                           
                                                                                 Compute\_gain\_match                                                                                                                                
                                                                                 Quant\_gain                                                                                                                                         
                                                           Cod\_tcx\_stereo                                                                                                                                                          
                                                                                 Ctcx\_stereo                                                                                                                                        
                                                                                                                Cos\_window                                                                                                          
                                                                                                                Windowing                                                                                                            
                                                                                                                Comp\_gain\_shap\_cod                                                                                                
                                                                                                                Apply\_gain\_shap                                                                                                    
                                                                                                                Get\_gain                                                                                                            
                                                                                                                Q\_gain\_pan                                                                                                         
                                                                                                                Compute\_xn\_target                                                                                                  
                                                                                                                Fft3                                                                                                                 
                                                                                                                                          r\_fft\_fx                                                                                 
                                                                                                                FFT\_reorder                                                                                                         
                                                                                                                Adap\_low\_freq\_emph                                                                                                
                                                                                                                                          SpPeak1k6                                                                                  
                                                                                                                AVQ\_Cod                                                                                                             
                                                                                                                                          RE8\_PPV\_FX                                                                               
                                                                                                                                                                      Nearest\_neighbor\_2D8                                         
                                                                                                                Scale\_tcx\_ifft                                                                                                     
                                                                                                                                          Scale\_sig                                                                                 
                                                                                                                Adap\_low\_freq\_deemph                                                                                              
                                                                                                                                          SpPeak1k6                                                                                  
                                                                                                                                          Deemph1k6                                                                                  
                                                                                                                Ifft\_reorder                                                                                                        
                                                                                                                Ifft3                                                                                                                
                                                                                                                                          r\_fft\_fx                                                                                 
                                                                                                                Q\_gain\_tcx                                                                                                         
                                                                                                                Apply\_tcx\_overlap                                                                                                  
                                                                                 Segsnr                                                                                                                                              
                               Int2bin                                                                                                                                                                                               
                               Enc\_prm                                                                                                                                                                                              
                                                           Int2bin                                                                                                                                                                   
                                                           AVQ\_encmux                                                                                                                                                               
                                                                                 split\_idx\_noovf                                                                                                                                   
                                                                                                                sort(avq\_cod.c)                                                                                                     
                                                                                                                RE8\_cod                                                                                                             
                                                                                                                                          RE8\_vor                                                                                   
                                                                                                                                                                      Re8\_identify\_absolute                       Leader           
                                                                                                                                                                      Re8\_coord                                                     
                                                                                                                                                                      Re8\_k2y                                                       
                                                                                                                                                                                                                    RE8\_PPV\_FX     
                                                                                                                                                                                                                                     Nearest\_neighbor\_2D8
                                                                                                                                          Re8\_compute\_base\_index                                                                  
                                                                                                                                                                      Re8\_compute\_rank\_of\_permutation\_and\_s                    
                                                                                                                calc\_bits                                                                                                           
                                                                                 writ\_all\_nq                                                                                                                                       
                                                                                                                calc\_bits                                                                                                           
                                                                                 writ\_all\_i                                                                                                                                        
                                                                                                                init\_pos\_i\_ovf                                                                                                    
                                                                                                                                          chk\_ovf                                                                                   
                                                                                                                chk\_ovf                                                                                                             
                                                                                                                writ\_I                                                                                                              
                                                                                                                writ\_k                                                                                                              
                                                                                                                writ\_ovf                                                                                                            
                                                           Unpack4bits                                                                                                                                                               
                                                                                 Int2bin                                                                                                                                             
                               Enc\_prm\_stereo\_x                                                                                                                                                                                   
                                                           Iint2bin                                                                                                                                                                  
                                                           AVQ\_encmux                                                                                                                                                               
                                                                                 split\_idx\_noovf                                                                                                                                   
                                                                                                                sort(avq\_cod.c)                                                                                                     
                                                                                                                RE8\_cod                                                                                                             
                                                                                                                                          RE8\_vor                                                                                   
                                                                                                                                                                      re8\_identify\_absolute                       Leader           
                                                                                                                                                                      re8\_coord                                                     
                                                                                                                                                                      re8\_k2y                                                       
                                                                                                                                                                                                                    RE8\_PPV\_FX     
                                                                                                                                                                                                                                     nearest\_neighbor\_2D8
                                                                                                                                          re8\_compute\_base\_index                                                                  
                                                                                                                                                                      re8\_compute\_rank\_of\_permutation\_and\_s                    
                                                                                                                calc\_bits                                                                                                           
                                                                                 writ\_all\_nq                                                                                                                                       
                                                                                                                calc\_bits                                                                                                           
                                                                                 writ\_all\_i                                                                                                                                        
                                                                                                                init\_pos\_i\_ovf                                                                                                    
                                                                                                                                          chk\_ovf                                                                                   
                                                                                                                chk\_ovf                                                                                                             
                                                                                                                writ\_I                                                                                                              
                                                                                                                writ\_ovf                                                                                                            
                                                                                                                writ\_k                                                                                                              
                                                           unpack4bits\_d                                                                                                                                                            
                                                                                 int2bin                                                                                                                                             
                               Enc\_prm\_hf                                                                                                                                                                                          
                                                           int2bin                                                                                                                                                                   
  ---------------------------- --------------------------- --------------------- ------------------------------ ------------------------- --------------------------- --------------------------------------------- ---------------- ------------------------

Table 2: Decoder call structure

  ---------------------- ------------------------- --------------------------- ----------------------- -------------------------- ------------------------------------ -------------------------- ------------------------------------ ------------------------
  Decoder\_amrwb\_plus                                                                                                                                                                                                                 
                         Bin2int                                                                                                                                                                                                       
                         Dec\_prm                                                                                                                                                                                                      
                                                   Bin2int                                                                                                                                                                             
                                                   Pack4bits                                                                                                                                                                           
                                                                               Bin2int                                                                                                                                                 
                         Dec\_prm\_stereo\_x                                                                                                                                                                                           
                                                   Bin2int                                                                                                                                                                             
                                                   Pack4bits\_d                                                                                                                                                                        
                                                                               Bin2int                                                                                                                                                 
                                                   AVQ\_Demuxdec                                                                                                                                                                       
                                                                               Read\_all\_nq                                                                                                                                           
                                                                                                       Read\_nq                                                                                                                        
                                                                               Read\_all\_i                                                                                                                                            
                                                                                                       Init\_pos\_i\_ovf                                                                                                               
                                                                                                                                  Chk\_ovf                                                                                             
                                                                                                       Split\_n                                                                                                                        
                                                                                                       Chk\_ovf                                                                                                                        
                                                                                                       Read\_I                                                                                                                         
                                                                                                       Read\_ovf                                                                                                                       
                                                                                                       Read\_k                                                                                                                         
                                                                               RE8\_Dec                                                                                                                                                
                                                                                                       Re8\_decode\_base\_index                                                                                                        
                                                                                                                                  Re8\_decode\_rank\_of\_permutation                                                                   
                                                                                                       Re8\_k2y                                                                                                                        
                                                                                                                                  RE8\_PPV\_FX                                                                                         
                                                                                                                                                                       Nearest\_neighbor\_2D8                                          
                         Dec\_prm\_hf                                                                                                                                                                                                  
                                                   Bin2int                                                                                                                                                                             
                         Decoder\_amrwb\_plus\_1                                                                                                                                                                                       
                                                   Decoder\_lf                                                                                                                                                                         
                                                                               Dpisf\_2s\_46b\_2                                                                                                                                       
                                                                                                       Reorder\_isf                                                                                                                    
                                                                               Isf\_isp                                                                                                                                                
                                                                               Int\_lpc                                                                                                                                                
                                                                                                       Isp\_Az                                                                                                                         
                                                                                                                                  Get\_isp\_pol                                                                                        
                                                                               decoder\_tcx                                                                                                                                            
                                                                                                       AVQ\_Demuxdec                                                                                                                   
                                                                                                                                  Read\_all\_nq                                                                                        
                                                                                                                                                                       Read\_nq                                                        
                                                                                                                                  Read\_all\_i                                                                                         
                                                                                                                                                                       Init\_pos\_i\_ovf                                               
                                                                                                                                                                                                  Chk\_ovf                             
                                                                                                                                                                       Split\_n                                                        
                                                                                                                                                                       Chk\_ovf                                                        
                                                                                                                                                                       Read\_I                                                         
                                                                                                                                                                       Read\_k                                                         
                                                                                                                                                                       Read\_ovf                                                       
                                                                                                                                  RE8\_dec                                                                                             
                                                                                                                                                                       Re8\_decode\_base\_index                                        
                                                                                                                                                                                                  Re8\_decode\_rank\_of\_permutation   
                                                                                                                                                                       Re8\_k2y                                                        
                                                                                                                                                                                                  RE8\_PPV\_FX                         
                                                                                                                                                                                                                                       Nearest\_neighbor\_2D8
                                                                                                       Scale\_tcx\_ifft                                                                                                                
                                                                                                                                  Scale\_sig                                                                                           
                                                                                                       NoiseFill                                                                                                                       
                                                                                                                                  Rnd\_ph16                                                                                            
                                                                                                                                                                       Random                                                          
                                                                                                       Adap\_low\_freq\_deemph                                                                                                         
                                                                                                                                  SpPeak1k6                                                                                            
                                                                                                                                  Deemph1k6                                                                                            
                                                                                                       Find\_mpitch                                                                                                                    
                                                                                                       Ifft\_reorder                                                                                                                   
                                                                                                       ifft9\_fx                                                                                                                       
                                                                                                                                  r\_fft\_fx                                                                                           
                                                                                                       Cos\_window                                                                                                                     
                                                                                                       D\_gain\_tcx                                                                                                                    
                                                                                                       Scale\_mem\_tcx                                                                                                                 
                                                                                                                                  Scale\_sig                                                                                           
                                                                                                       Preemph                                                                                                                         
                                                                                                       Weight\_a                                                                                                                       
                                                                                                       Syn\_filt\_s                                                                                                                    
                                                                                                       Residu2                                                                                                                         
                                                                               Decoder\_acelp                                                                                                                                          
                                                                                                       Pred\_lt4                                                                                                                       
                                                                                                       DEC\_ACELP\_4t64\_fx                                                                                                            
                                                                                                                                  Dec\_1p\_N1                                                                                          
                                                                                                                                  Dec\_2p\_2N1                                                                                         
                                                                                                                                  Dec\_3p\_3N1                                                                                         
                                                                                                                                                                       Dec\_2p\_2N1                                                    
                                                                                                                                                                       Dec\_1p\_N1                                                     
                                                                                                                                  Dec\_4p\_4N                                                                                          
                                                                                                                                                                       Dec\_4p\_4N1                                                    
                                                                                                                                                                                                  Dec\_1p\_N1                          
                                                                                                                                                                       Dec\_1p\_N1                                                     
                                                                                                                                                                       Dec\_2p\_2N1                                                    
                                                                                                                                                                       Dec\_3p\_3N1                                                    
                                                                                                                                                                                                  Dec\_2p\_2N1                         
                                                                                                                                                                                                  Dec\_1p\_N1                          
                                                                                                                                  Dec\_5p\_5N                                                                                          
                                                                                                                                                                       Dec\_2p\_2N1                                                    
                                                                                                                                                                       Dec\_3p\_3N1                                                    
                                                                                                                                                                                                  Dec\_2p\_2N1                         
                                                                                                                                                                                                  Dec\_1p\_N1                          
                                                                                                                                  Dec\_6p\_6N\_2                                                                                       
                                                                                                                                                                       Dec\_1p\_N1                                                     
                                                                                                                                                                       Dec\_2p\_2N1                                                    
                                                                                                                                                                       Dec\_3p\_3N1                                                    
                                                                                                                                                                                                  Dec\_2p\_2N1                         
                                                                                                                                                                                                  Dec\_1p\_N1                          
                                                                                                                                                                       Dec\_4p\_4N                                                     
                                                                                                                                                                                                  Dec\_4p\_4N1                         
                                                                                                                                                                                                                                       Dec\_1p\_N1
                                                                                                                                                                       Dec\_5p\_5N                                                     
                                                                                                                                                                                                  Dec\_2p\_2N1                         
                                                                                                                                                                                                  Dec\_3p\_3N1                         
                                                                                                                                                                                                                                       Dec\_2p\_2N1
                                                                                                                                                                                                                                       Dec\_1p\_N1
                                                                                                                                  add\_pulses                                                                                          
                                                                                                       Preemph                                                                                                                         
                                                                                                       Pit\_shrp                                                                                                                       
                                                                                                       D\_gain2\_plus                                                                                                                  
                                                                                                       Scale\_exc                                                                                                                      
                                                                                                                                  Scale\_sig                                                                                           
                                                                                                       Scale\_sig                                                                                                                      
                                                                                                       voice\_factor                                                                                                                   
                                                                                                       Rescale\_mem                                                                                                                    
                                                                                                                                  Scale\_sig                                                                                           
                                                                                                       Syn\_filt\_s                                                                                                                    
                                                                                                       Weight\_a                                                                                                                       
                                                                                                       Residu                                                                                                                          
                                                                                                       Deemph2                                                                                                                         
                                                                               Updt\_mem\_q                                                                                                                                            
                                                   Scale\_mem2                                                                                                                                                                         
                                                                               Scale\_sig                                                                                                                                              
                                                   Deemph                                                                                                                                                                              
                                                   Bass\_postfilter                                                                                                                                                                    
                                                                               Scale\_sig                                                                                                                                              
                                                                               Short\_pitch\_tracker                                                                                                                                   
                                                   Decoder\_hf                                                                                                                                                                         
                                                                               D\_isf\_hf                                                                                                                                              
                                                                                                       Reorder\_isf                                                                                                                    
                                                                               Isf\_isp                                                                                                                                                
                                                                               Int\_lpc                                                                                                                                                
                                                                                                       Isp\_Az                                                                                                                         
                                                                                                                                  Get\_isp\_pol                                                                                        
                                                                               Match\_gain\_6k4                                                                                                                                        
                                                                                                       Residu                                                                                                                          
                                                                                                       Syn\_filt                                                                                                                       
                                                                                                       Scale\_sig                                                                                                                      
                                                                               Int\_gain                                                                                                                                               
                                                                               D\_gain\_chan                                                                                                                                           
                                                                               D\_gain\_hf                                                                                                                                             
                                                                               Soft\_exc\_hf                                                                                                                                           
                                                                               Syn\_filt\_s                                                                                                                                            
                                                                               Smooth\_ener\_hf                                                                                                                                        
                                                   Delay                                                                                                                                                                               
                                                   Oversamp\_12k8                                                                                                                                                                      
                                                                               Interpol                                                                                                                                                
                         Decoder\_stereo\_x                                                                                                                                                                                            
                                                   Band\_split\_taligned\_2k                                                                                                                                                           
                                                                               Decim\_2k                                                                                                                                               
                                                                                                       Interpol\_st                                                                                                                    
                                                                               Oversamp\_2k                                                                                                                                            
                                                                                                       Interpol\_st                                                                                                                    
                                                   Dec\_tcx\_stereo                                                                                                                                                                    
                                                                               Dtcx\_stereo                                                                                                                                            
                                                                                                       Cos\_window                                                                                                                     
                                                                                                       Scale\_tcx\_ifft                                                                                                                
                                                                                                                                  Scale\_sig                                                                                           
                                                                                                       Windowing                                                                                                                       
                                                                                                       Comp\_gain\_shap                                                                                                                
                                                                                                       adap\_lo\_freq\_deemph                                                                                                          
                                                                                                                                  SpPeak1k6                                                                                            
                                                                                                                                  Deemph1k6                                                                                            
                                                                                                       Ifft\_reorder                                                                                                                   
                                                                                                       Ifft3                                                                                                                           
                                                                                                                                  ifft\_rel                                                                                            
                                                                                                       Balance                                                                                                                         
                                                                                                                                  D\_Balance                                                                                           
                                                                                                       D\_gain\_tcx                                                                                                                    
                                                                                                       Apply\_xnq\_gain2                                                                                                               
                                                                                                       Apply\_wien\_filt                                                                                                               
                                                                                                       Crosscorr\_2                                                                                                                    
                                                                                                       Glev\_s                                                                                                                         
                                                                                                       Apply\_tcx\_overlap                                                                                                             
                                                   Get\_alpha                                                                                                                                                                          
                                                   Ch\_sep                                                                                                                                                                             
                         Dec\_hi\_stereo                                                                                                                                                                                               
                                                   Dec\_filt                                                                                                                                                                           
                                                   Dec\_gain                                                                                                                                                                           
                                                   Residu                                                                                                                                                                              
                                                   Fir\_filt                                                                                                                                                                           
                                                   Get\_exc\_win                                                                                                                                                                       
                                                   Get\_exc                                                                                                                                                                            
                                                   Syn\_filt\_s                                                                                                                                                                        
                         Delay                                                                                                                                                                                                         
                         Band\_join\_2k                                                                                                                                                                                                
                                                   Interpol\_st                                                                                                                                                                        
                         HP50\_12k8                                                                                                                                                                                                    
                         Oversamp\_12k8                                                                                                                                                                                                
                                                   Interpol                                                                                                                                                                            
  ---------------------- ------------------------- --------------------------- ----------------------- -------------------------- ------------------------------------ -------------------------- ------------------------------------ ------------------------

4.5 Variables, constants and tables
-----------------------------------

The data types of variables and tables used in the fixed point
implementation are signed integers in 2\'s complement representation,
defined by:

\- **Word16** 16 bit variable;

\- **Word32** 32 bit variable.

### 4.5.1 Description of fixed tables used in the C-code

This clause contains a listing of all fixed tables sorted by source file
name and table name. All table data is declared as **Word16**.

Table 3: Encoder fixed tables

  ----------------------- ---------------------------------- -------------- ------------------------------------------- ----------
  Format                  Table name                         Size           Description                                 Format
  Word16                  MonoRate                           54             Predefined mono rate                        Q6/Q0/Q0
  Word16                  StereoRate                         81             Predefined stereo rate                      Q6/Q0/Q0
  Word16                  NBITS\_CORE\_AMR\_WB\_FX           9 miMode\_fx   AMR WB Core bits                            Q0
  Word16                  miMode\_fx                         48             Stereo Mode Index                           Q0
  Word16                  isfIndex\_fx                       14             Internal sampling Frequency                 Q0
  Word16                  NBITS\_CORE\_FX                    8              Core bit-rates                              Q0
  Word16                  t\_sinFxS4                         1440           FFT Sine&Cos table                          Q13
  Word16                  Filter\_32k                        61             FIR table for decimation/oversampling       Q13
  Word16                  Filter\_32k\_hf                    61             FIR table for decimation/oversampling       Q13
  Word16                  Filter\_32k\_7k                    61             FIR table for decimation/oversampling       Q13
  Word16                  Filter\_48k                        185            FIR table for decimation/oversampling       Q13
  Word16                  Filter\_48k\_hf                    185            FIR table for decimation/oversampling       Q13
  Word16                  Filter\_8k                         61             FIR table for decimation/oversampling       Q13
  Word16                  Isf\_init                          16             Initial ISF memory                          
  Word16                  Isp\_init                          16             Initial ISP memory                          Q15
  Word16                  Isp\_init\_HF                      8              HF Initial ISP memory                       Q15
  Word16                  Mean\_isf                          16             Means of ISFs                               
  Word16                  Dico1\_isf                         2304           1st stage codebook, isf0 to isf8            
  Word16                  Dico2\_isf                         1792           1st stage codebook, isf9 to isf15           
  Word16                  Dico21\_isf                        192            2nd stage codebook, isf2\_0 to isf 2\_2     
  Word16                  Dico22\_isf                        384            2nd stage codebook, isf2\_3 to isf 2\_5     
  Word16                  Dico23\_isf                        384            2nd stage codebook, isf2\_6 to isf 2\_8     
  Word16                  Dico24\_isf                        96             2nd stage codebook, isf2\_9 to isf 2\_11    
  Word16                  Dico25\_isf                        128            2nd stage codebook, isf2\_12 to isf 2\_15   
  Word16                  Dico21\_isf\_36b                   640            1st stage codebook, (36b) split 1           
  Word16                  Dico22\_isf\_36b                   512            1st stage codebook, (36b) split 2           
  Word16                  Dico23\_isf\_36b                   448            1st stage codebook, (36b) split 3           
  Word16                  Dico\_gain\_hf                     512            Quantization table for one-stage HF gain    Q8
  Word16                  Mean\_isf\_hf\_12k8                8              Means of ISFs (full band)                   
  Word16                  Dico1\_isf\_hf\_12k8               32             1st stage isf codebook (full band)          
  Word16                  Mean\_isf\_hf\_low\_rate           8              Means of isfs                               
  Word16                  Dico1\_isf\_hf\_low\_rate          32             1st stage isf codebook                      
  Word16                  Dico2\_isf\_hf                     1024           2nd stage isf codebook                      
  Word16                  Filt\_lp                           13             Low-pass fir filter for bass post filter    Q15
  Word16                  Sin20                              20             Random phase                                Q15
  Word16                  Inter4\_2                          128            1/4 resolution interpolation filter         Q14
  Word16                  VadFiltBandFreqs                   12             Open-loop classifier                        Q0
  Word16                  Bw\_inv                            12             Open-loop classifier                        Q22
  Word16                  Lwg                                8              Open-loop claissifier                       Q15
  Word16                  Gain\_hf\_ramp                     64             HF gain ramp for wb-\>wb+ switiching        Q15
  Word16                  Inter2\_coef                       12             Filter coefficients for band join/split     Q13
  Word16                  Filter\_LP180                      2341           Filter for 48 kHz interpolation             Q14
  Word16                  StereoNbits\_FX                    18             Stereo bit-rates                            Q0
  Word16                  Filter\_2k\_fxQ14\_32              321            2k decimation filter                        Q14
  Word16                  Filter\_2k\_fxQ14\_5               321            2k decimation filter                        Q14
  Word16                  cb\_filt\_hi\_mean\_fx             9              Average filter                              Q14
  Word16                  Filt\_hi\_mscb\_4a\_fx             16\*9                                                      Q14
  Word16                  Filt\_hi\_mscb\_7a\_fx             16\*9                                                      Q14
  Word16                  Filt\_hi\_mscb\_7b\_fx             8\*9                                                       Q14
  Word16                  Cb\_gain\_hi\_mean\_fx             2              Average gain vector                         Q10
  Word16                  Gain\_hi\_mscb\_2a\_fx             4\*2                                                       Q10
  Word16                  Gain\_hi\_mscb\_5a\_fx             32\*2                                                      Q10
  Word16                  Dico1\_isf\_hf\_high\_rate         32             1st stage isf codebook                      
  Word16                  Mean\_isf\_hf\_high\_rate          8              Means of isfs                               
  Word16                  Filter\_LP45                       586            Filter for 48 kHz interpolation             Q14
  Word16                  t\_qua\_gain6b                     128            Gain pitch and gain code                    Q14/Q11
  Word16 t\_qua\_gain7b   t\_qua\_gain7b                     256            Gain pitch and gain code                    Q14/Q11
  Word16                  Overlap\_wind                      63             Overlap window                              Q15
  Word16                  Cos\_wind                          128            Cos window                                  Q15
  Word16                  Cos\_wind\_LR                      224            Cos \_window (Low rate)                     Q15
  Word16                  TXV                                31             Arctan piece table                          Q15
  Word16                  Len\_tbl                           6              Inverse length                              Q15
  Word16                  interpol\_frac4                    4              Interpolation Window 4 sub-frame            Q15
  Word16                  interpol\_frac8                    8              Interpolation Window 8 sub-frame            Q15
  Word16                  interpol\_frac16                   16             Interpolation Window 16 sub-frame           Q15
  Word16                  **size\_filt\_hi\_msvq\_4\_fx**    16             Stereo param                                
  Word16                  **\*cbs\_filt\_hi\_msvq\_4\_fx**   16             Stereo param                                
  PMSQ\_fx                **filt\_hi\_pmsvq4\_fx**                                                                      
  Word16                  **size\_filt\_hi\_msvq\_7\_fx**    16             Stereo param                                
  Word16                  **\*cbs\_filt\_hi\_msvq\_7\_fx**   16             Stereo param                                
  PMSQ\_fx                **filt\_hi\_pmsvq7\_fx**                                                                      
  Word16                  **Size\_gain\_hi\_msvq\_2\_fx**    16             Stereo param                                
  Word16                  **\*cbs\_gain\_hi\_msvq\_2\_fx**   16             Stereo param                                
  PMSQ\_fx                **gain\_hi\_pmsvq2\_fx**                                                                      
  Word16                  **size\_gain\_hi\_msvq\_5\_fx**    16             Stereo param                                
  Word16                  **\*cbs\_gain\_hi\_msvq\_5\_fx**   16             Stereo param                                
  PMSQ\_fx                **gain\_hi\_pmsvq5\_fx**                                                                      
  ----------------------- ---------------------------------- -------------- ------------------------------------------- ----------

Table 4: Decoder fixed tables

+-----------------+------------+------+-------------+
| Format          | Table name | Size | Description |
+-----------------+------------+------+-------------+
| Same as encoder |            |      |             |
|                 |            |      |             |
| Same as encoder |            |      |             |
+-----------------+------------+------+-------------+

### 4.5.2 Static variables used in the C-code

In this clause two tables that specify the static variables for the
encoder and decoder respectively are shown. All static variables are
declared within a C **struct.**

Table 6: Encoder static variables

  ------------------------ -------------------- ------------------------- ---------------- ---------------------------------------
  Struct name              Type                 Variable                  Type\[Length\]   Description
  Coder\_StState\_fx                                                                       
                           Word16               mem\_decim                1608             speech decimated filter memory
                           Word16               decim\_frac               1                Fractional decimation factor
                           Word16               mem\_sig\_in              6                hp filter memory
                           Word16               mem\_preemph              1                speech preemphasis filter mem
                           Word16               mem\_decim\_hf            46               HF filter memory
                           Word16               old\_speech\_hf           528              HF old speech vector
                           Word16               past\_q\_isf\_hf          8                HF past quantized isf
                           Word16               ispold\_hf                8                HF old isp
                           Word16               ispold\_q\_hf             8                HF quantized old isp
                           Word16               old\_gain;                1                HF old gain match
                           Word16               mem\_hf1                  8                HF memory for gain 1
                           Word16               mem\_hf2                  8                HF memory for gain 2
                           Word16               mem\_hf3                  8                HF memory for gain 3
                           Word16               old\_exc                  375              old excitation
                           Word16               Q\_sp\_hf                 1                Scaling hf speech
                           Word16               OldQ\_sp\_hf              2                old scaling hf speech
                           Word16\*             mean\_isf\_hf             1                isf codebook mean
                           Word16\*             dico1\_isf\_hf            1                isf codebook first stage
  Coder\_State\_Plus\_fx                                                                   
                           Coder\_StState\_fx   Left                      2617             state for left channel
                           Coder\_StState\_fx   Right                     2617             state for right channel
                           Word16               old\_chan                 528              old left signal
                           Word16               old\_chan\_2k             140              old left signal 2 kHz sampl. rate
                           Word16               old\_chan\_hi             448              old left signal HB
                           Word16               old\_speech\_2k           140              old mono signal 2 kHz sampl. rate
                           Word16               old\_speech\_hi           448              old mono signal HB
                           Word16               old\_speech\_pe           528              past pre-emphasised mono
                           Word16               old\_wh                   9                past weighted filter
                           Word16               old\_wh\_q                9                past quantized weighted filter
                           Word16               old\_gm\_gain             2                past gain matching
                           Word16               old\_exc\_mono            9                past mono excitation
                           Word16               filt\_energy\_threshold   1                filter energy thershold
                           Word16               w\_window                 64               weighting window
                           PMSVQ\_fx\*          \*filt\_hi\_pmsvq         1                MSVQ quantizer
                           PMSVQ\_fx\*          \*gain\_hi\_pmsvq         1                MSVQ quantizer
                           Word16               mem\_stereo\_ovlp\_size   1                past stereo overlap size
                           Word16               mem\_stereo\_ovlp         32               past stereo overlap
                           NCLASSDATA           \*stClass                 1                use case B classifier
                           VadVars              \*vadSt                   1                VAD state
                           Word16               vad\_hist                 1                VAD history
                           Word16               old\_speech               528              old speech
                           Word16               old\_synth                16               synthesis memory
                           Word16               past\_isfq                16               past isf quantizer
                           Word16               old\_wovlp                128              last tcx overlap
                           Word16               old\_d\_wsp               187              Weighted speech vector
                           Word16               old\_exc                  392              old excitation vector
                           Word16               old\_mem\_wsyn            1                weighted synthesis memory
                           Word16               old\_mem\_w0              1                weighted speech memory
                           Word16               old\_mem\_xnq             1                quantized target memory
                           Word16               old\_ovlp\_size           1                last tcx overlap size
                           Word16               Isfold                    16               old isf frequency domain
                           Word16               Ispold                    16               old isp
                           Word16               ispold\_q                 16               quantized old isp
                           Word16               mem\_wsp                  1                wsp vector mem
                           Word16               mem\_lp\_decim2           3                wsp decimator filter mem
                           Word16               ada\_w                    1                open loop LTP
                           Word16               ol\_gain                  1                open loop LTP
                           Word16               ol\_wght\_flg             1                open loop LTP
                           Word16               old\_ol\_lag              5                past openloop lag
                           Word16               old\_T0\_med              1                past pitch
                           Word16               hp\_old\_wsp              699              past HP weighted speech
                           Word16               hp\_ol\_ltp\_mem          9                past HP openloop long term prediction
                           Word16               window                    512              LP analysis window
                           Word16               SwitchFlagPlusToWB        1                flag for switching to AMR-WB
                           Word16               mem\_gain\_code           4                past code gain
                           Word16               prev\_mod                 1                past frame type
                           Word16               Q\_sp                     1                Scaling of speech
                           Word16               OldQ\_sp                  1                Old scaling of speech
                           Word16               i\_offset                 1                
                           Word16               pit\_max                  1                Mem of pit\_max
                           Word16               lev\_mem                  18               Levinson durbin memory
                           Word16               old\_wsp\_max             4                Weight speech scaling memory
                           Word16               old\_wsp\_shift           1                limit dynamic at 12 bits
                           Word16               scale\_fac                1                scaling factor (preemph speech)
                           Word16               Q\_new                    1                scaling factor of speech
                           Word16               Q\_max                    2                Q\_new limitation
                           Word16               OldQ\_sp\_deci            2                Q\_new memory
                           Word16               Q\_exc                    1                excitation scaling
                           Word16               Old\_Qexc                 1                excitation scaling memory
                           Word16               LastQMode                 1                Last subfr mode (acelp/tcx)
  Encoder Config                                                                           
                           Word16               mode                      1                AMR\_WB core mode: 0..8
                           Word16               extension                 1                0=AMRWB, 1=WB+
                           Word16               st\_mode                  1                stereo mode
                           Word16               fscale                    1                frequency scaling
                           Word16               use\_case\_mode           1                use case (for AMRWB+ only)
                           Word16               allow\_dtx                1                dtx (for AMRWB only)
                           Word16               FileFormat                1                3gp or raw
                           Word16               mode\_index               1                index of wb+ mode used
                           Word16               fscale\_index             1                index of internal frequency sampling
                           Word16               bc                        1                Backward compatible file format
  ------------------------ -------------------- ------------------------- ---------------- ---------------------------------------

Table 7: Decoder static variables

+-------------+-------------+-------------+-------------+-------------+
| Struct name | Type        | Variable    | Typ         | Description |
|             |             |             | e\[Length\] |             |
+-------------+-------------+-------------+-------------+-------------+
| Decod       |             |             |             |             |
| er\_StState |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wme         | 72          | Memory      |
|             |             | m\_oversamp |             | o           |
|             |             |             |             | versampling |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wover\_frac | 1           | Fractional  |
|             |             |             |             | overcloking |
|             |             |             |             | factor      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wmem\_o     | 24          | memory      |
|             |             | versamp\_hf |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wpast\      | 8           | HF past     |
|             |             | _q\_isf\_hf |             | quantized   |
|             |             |             |             | isf         |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wp          | 8           | HF past     |
|             |             | ast\_q\_isf |             | quantized   |
|             |             | \_hf\_other |             | isf for the |
|             |             |             |             | other       |
|             |             |             |             |             |
|             |             |             |             | channel     |
|             |             |             |             | when mono   |
|             |             |             |             | decoding    |
|             |             |             |             | stereo      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wpast\_     | 1           | HF past     |
|             |             | q\_gain\_hf |             | quantized   |
|             |             |             |             | gain        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wpa         | 1           | HF past     |
|             |             | st\_q\_gain |             | quantized   |
|             |             | \_hf\_other |             | gain for    |
|             |             |             |             | the other   |
|             |             |             |             |             |
|             |             |             |             | channel     |
|             |             |             |             | when mono   |
|             |             |             |             | decoding    |
|             |             |             |             | stereo      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_gain  | 1           | HF old gain |
|             |             |             |             | match       |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wispold\_hf | 8           | HF old isp  |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | Lthreshold; | 1           | HF memory   |
|             |             |             |             | for smooth  |
|             |             |             |             | ener        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wm          | 8           | HF          |
|             |             | em\_syn\_hf |             | synthesis   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\        | 96          | delay       |
|             |             | _d\_tcx\_fx |             | c           |
|             |             |             |             | ompensation |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wm          | 64          | Non         |
|             |             | em\_d\_nonc |             | causality   |
|             |             |             |             | delay       |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem         | 16          | High band   |
|             |             | \_synth\_hi |             | sunthesis   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wme         | 6           | hp filter   |
|             |             | m\_sig\_out |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold        | 512         | synch delay |
|             |             | \_synth\_hf |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | Lp\_amp     | 1           | memory for  |
|             |             |             |             | soft exc    |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16\*    | me          | 1           | isf         |
|             |             | an\_isf\_hf |             | codebook    |
|             |             |             |             | mean        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16\*    | dic         | 1           | isf         |
|             |             | o1\_isf\_hf |             | codebook    |
|             |             |             |             | first stage |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Q\_synHF    | 1           | scaling of  |
|             |             |             |             | hf synth    |
+-------------+-------------+-------------+-------------+-------------+
| Decoder\_   |             |             |             |             |
| State\_Plus |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | Decod       | left        | 833         | State for   |
|             | er\_StState |             |             | left        |
|             |             |             |             | channel     |
+-------------+-------------+-------------+-------------+-------------+
|             | Decod       | right       | 833         | State for   |
|             | er\_StState |             |             | right       |
|             |             |             |             | channel     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_l      | 20          | 2kHz memory |
|             |             | eft\_2k\_fx |             | on left     |
|             |             |             |             | chan        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_ri     | 20          | 2kHz memory |
|             |             | ght\_2k\_fx |             | on right    |
|             |             |             |             | chan        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_l      | 64          | HB memory   |
|             |             | eft\_hi\_fx |             | left        |
|             |             |             |             | channel     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_ri     | 64          | HB memory   |
|             |             | ght\_hi\_fx |             | right       |
|             |             |             |             | channel     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | my\_old\_sy | 35          | old 2kHz    |
|             |             | nth\_2k\_fx |             | synthesis   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | my\_old\_sy | 128         | old HB      |
|             |             | nth\_hi\_fx |             | synthesis   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | my\_old     | 148         | old stereo  |
|             |             | \_synth\_fx |             | synth       |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | ol          | 85          | old         |
|             |             | d\_AqLF\_fx |             | quantized   |
|             |             |             |             | LPC         |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_wh\_fx | 9           | old decoded |
|             |             |             |             | filter      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | o           | 9           | old decoded |
|             |             | ld\_wh2\_fx |             | filter 2    |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_ex     | 9           | old mono    |
|             |             | c\_mono\_fx |             | excitation  |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_gai    | 4           | old gain on |
|             |             | n\_left\_fx |             | left chan   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_gain   | 4           | old gain on |
|             |             | \_right\_fx |             | right chan  |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old         | 9           | past        |
|             |             | \_wh\_q\_fx |             | quantized   |
|             |             |             |             | filter      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_g      | 2           | past gain   |
|             |             | m\_gain\_fx |             | matching    |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | W\_window   | 64          | weighted    |
|             |             |             |             | synthesis   |
|             |             |             |             | window      |
+-------------+-------------+-------------+-------------+-------------+
|             | PMSVQ       | \*filt\_hi  | 1           | past MSVQ   |
|             |             | \_pmsvq\_fx |             | filter      |
+-------------+-------------+-------------+-------------+-------------+
|             | PMSVQ       | \*gain\_hi  | 1           | past MSVQ   |
|             |             | \_pmsvq\_fx |             | gain        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_       | 1           | past stereo |
|             |             | stereo\_ovl |             | overlap     |
|             |             | p\_size\_fx |             | size        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_stere  | 32          | past stereo |
|             |             | o\_ovlp\_fx |             | overlap     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | last\_s     | 1           | past stereo |
|             |             | tereo\_mode |             | mode        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | si          | 1           | side signal |
|             |             | de\_rms\_fx |             | RMS         |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | H\_fx       | 9           | current     |
|             |             |             |             | filter      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_xri   | 1 148       | old         |
|             |             |             |             | spectral    |
|             |             |             |             | c           |
|             |             |             |             | oefficeints |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | last\_mode  | 1           | last mode   |
|             |             |             |             | in previous |
|             |             |             |             | 80ms frame  |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wme         | 6           | hp50 filter |
|             |             | m\_sig\_out |             | memory for  |
|             |             |             |             | synthesis   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | w           | 1           | speech      |
|             |             | mem\_deemph |             | deemph      |
|             |             |             |             | filter      |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | prev        | 1           | previous    |
|             |             | \_lpc\_lost |             | lpc is lost |
|             |             |             |             | when = 1    |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_synth | 16          | synthesis   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_exc   | 392         | old         |
|             |             |             |             | excitation  |
|             |             |             |             | vector      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wisfold     | 16          | old isf     |
|             |             |             |             | (frequency  |
|             |             |             |             | domain)     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wispold     | 16          | old isp     |
|             |             |             |             | (immittance |
|             |             |             |             | spectral    |
|             |             |             |             | pairs)      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wpast\_isfq | 16          | past isf    |
|             |             |             |             | quantizer   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wovlp       | 128         | last        |
|             |             |             |             | weighted    |
|             |             |             |             | synthesis   |
|             |             |             |             | for overlap |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | ovlp\_size  | 1           | overlap     |
|             |             |             |             | size        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wisf\_buf   | 51          | old isf     |
|             |             |             |             | (for frame  |
|             |             |             |             | recovery)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_T0    | 1           | old pitch   |
|             |             |             |             | value (for  |
|             |             |             |             | frame       |
|             |             |             |             | recovery)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wol         | 1           | old pitch   |
|             |             | d\_T0\_frac |             | value (for  |
|             |             |             |             | frame       |
|             |             |             |             | recovery)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | seed\_ace   | 1           | seed memory |
|             |             |             |             | (for random |
|             |             |             |             | function)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wmem\_wsyn  | 1           | TCX         |
|             |             |             |             | synthesis   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | seed\_tcx   | 1           | seed memory |
|             |             |             |             | (for random |
|             |             |             |             | function)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wwsyn\_rms  | 1           | rms value   |
|             |             |             |             | of weighted |
|             |             |             |             | synthesis   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wpast\_gpit | 1           | past gain   |
|             |             |             |             | of pitch    |
|             |             |             |             | (for frame  |
|             |             |             |             | recovery)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | L           | 1           | past gain   |
|             |             | past\_gcode |             | of code     |
|             |             |             |             | (for frame  |
|             |             |             |             | recovery)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | pitch\_tcx  | 1           | for bfi     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | L\_gc       | 1           | GC          |
|             |             | \_threshold |             | threshold   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold        | 503         | Bass        |
|             |             | \_synth\_pf |             | p           |
|             |             |             |             | ost-filter: |
|             |             |             |             | old         |
|             |             |             |             | synthesis   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold        | 24          | bass        |
|             |             | \_noise\_pf |             | p           |
|             |             |             |             | ost-filter: |
|             |             |             |             | noise       |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wold\_T\_pf | 2           | bass        |
|             |             |             |             | p           |
|             |             |             |             | ost-filter: |
|             |             |             |             | old pitch   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wol         | 2           | Bass        |
|             |             | d\_gain\_pf |             | p           |
|             |             |             |             | ost-filter: |
|             |             |             |             | old pitch   |
|             |             |             |             | gain        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | \*me        | 1           | HF isf      |
|             |             | an\_isf\_hf |             | codebook    |
|             |             |             |             | in-use      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | \*dic       | 1           | HF isf      |
|             |             | o1\_isf\_hf |             | codebook    |
|             |             |             |             | in-use      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wmem\       | 4           | past code   |
|             |             | _gain\_code |             | gain        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wm          | 9           | past HF lpc |
|             |             | em\_lpc\_hf |             | filter      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | wme         | 1           | past HF     |
|             |             | m\_gain\_hf |             | gain        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | w           | 1           | ramp state  |
|             |             | ramp\_state |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | cp\         | 16          | old         |
|             |             | _old\_synth |             | synthesis   |
|             |             |             |             | switching   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Q\_old      | 1           | Old scaling |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Q\_exc      | 1           | excitation  |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Q\_syn      | 1           | synthesis   |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Old\_Q\_syn | 1           | Old         |
|             |             |             |             | synthesis   |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Old\_Q\_exc | 1           | Old         |
|             |             |             |             | excitation  |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | p           | 1           | Limitation  |
|             |             | rev\_Q\_syn |             | on          |
|             |             |             |             | synthesis   |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mem\_syn2   | 16          | Switching   |
|             |             |             |             | synthesis   |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Old\_Qxnq   | 1           | Old xnq     |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | O           | 1           | Old maximum |
|             |             | ld\_QxnqMax |             | xnq scaling |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Old\_Qxri   | 1           | Old xri     |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Old\        | 1           | noise buf   |
|             |             | _bpf\_scale |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | me          | 7           | subfr       |
|             |             | m\_subfr\_q |             | maximum     |
|             |             |             |             | excitation  |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | ol          | 16          | subfr true  |
|             |             | d\_subfr\_q |             | excitation  |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | old\_syn\_q | 16          | subfr true  |
|             |             |             |             | synthesis   |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | i\_offset   | 1           | offset      |
|             |             |             |             | memory      |
+-------------+-------------+-------------+-------------+-------------+
| De          |             |             |             |             |
| coderConfig |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | mode        | 1           | AMR\_WB     |
|             |             |             |             | core modes  |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | extension   | 1           | 0 = AMR\_WB |
|             |             |             |             | 1 = WB+     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | st\_mode    | 1           | Stereo      |
|             |             |             |             | modes       |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | fscale      | 1           | Internal    |
|             |             |             |             | Frequency   |
|             |             |             |             | scaling     |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | fs          | 1           | Sampling    |
|             |             |             |             | rate        |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | mono\_      | 1           | decode mono |
|             |             | dec\_stereo |             | a stereo    |
|             |             |             |             | bitstream   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word32      | limiter\_on | 1           | Limite      |
|             |             |             |             | clipping    |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | Fileformat  | 1           | File format |
|             |             |             |             | used        |
|             |             |             |             | (raw/3gp)   |
+-------------+-------------+-------------+-------------+-------------+
|             | Word16      | fer\_sim    | 1           | Frame       |
|             |             |             |             | erasure     |
|             |             |             |             | simulation  |
+-------------+-------------+-------------+-------------+-------------+

5 File formats
==============

This clause describes the file formats used by the encoder and decoder
programs.

5.1 Audio file (encoder input/decoder output)
---------------------------------------------

Audio files read by the encoder must be formatted as 16 bits PCM wave
(\*.wav) files. The decoder output is written as a 16 bit PCM wave file
(\*.wav).

Note that the decoder, with proper command line switch, can produce a
mono file from a stereo bit-stream.

5.2 Parameter bitstream file (encoder output/decoder input)
-----------------------------------------------------------

For AMR-WB+ operation, the files produced by the audio encoder/expected
by the audio decoder are either according to the raw format defined in
3GPP TS 26.290 \[2\], clause 8.2, or according to the 3GP file format
(3GPP TS 26.244 \[4\]), whereby the storage sample definition is found
in 3GPP TS 26.290 \[2\], clause 8.3.

######## Annex A (informative): Change history

  -------------------- -------------- -------------- -------- --------- ---------------------------------------------------------------------------------------------------------- --------- ---------
  **Change history**                                                                                                                                                                         
  **Date**             **TSG SA\#**   **TSG Doc.**   **CR**   **Rev**   **Subject/Comment**                                                                                        **Old**   **New**
  2005-03              27             SP-050083                         Approved at TSG SA\#27 Plenary                                                                             2.0.0     6.0.0
  2005-06              28             SP-050252      001                Prevent an access outside a buffer when simulating frame erasures                                          6.0.0     6.1.0
  2005-06              28             SP-050252      002      1         Remove unused code                                                                                         6.0.0     6.1.0
  2005-06              28             SP-050252      003                Remove IF2 header in AMR-WB bitstream                                                                      6.0.0     6.1.0
  2005-06              28             SP-050252      004                Prevent an access outside a buffer in Reconst\_spect function                                              6.0.0     6.1.0
  2005-06              28             SP-050252      005                Decoder synchronization after frame erasures                                                               6.0.0     6.1.0
  2005-06              28             SP-050252      006                Correction of mode switching using configuration file                                                      6.0.0     6.1.0
  2005-06              28             SP-050252      007                Prevent encoding end of wave file information                                                              6.0.0     6.1.0
  2005-06              28             SP-050252      008                Correction of library function for 3GP file format                                                         6.0.0     6.1.0
  2005-06              28             SP-050252      009                Support for input files with sampling frequency other than 48 kHz                                          6.0.0     6.1.0
  2005-09              29             SP-050425      0010               Correction to frame erasure concealment                                                                    6.1.0     6.2.0
  2005-09              29             SP-050425      0011               Correction to threshold value in bandwidth extension                                                       6.1.0     6.2.0
  2005-09              29             SP-050425      0012               Removal of copyright statements and unused files                                                           6.1.0     6.2.0
  2005-12              30             SP-050785      0013               Correction to scaling of decimation filter memory                                                          6.2.0     6.3.0
  2006-03              31             SP-060012      0014               Correction to end-of-file logic and initialisation in AMR-WB modes                                         6.3.0     6.4.0
  2006-03              31             SP-060012      0015               Correction to unnecessary look ahead in encoder                                                            6.3.0     6.4.0
  2006-03              31             SP-060012      0016               Correction to memory initialization and memory overwrite when switching between AMR-WB and AMR-WB+ modes   6.3.0     6.4.0
  2006-06              32             SP-060353      0017               Correction to switching between AMR-WB and AMR-WB+ modes                                                   6.4.0     6.5.0
  2006-06              32             SP-060353      0018               Correction to default stereo codec configurations                                                          6.4.0     6.5.0
  2007-03              35             SP-070029      0019               Reference to users guide                                                                                   6.5.0     7.0.0
  2008-12              42                                               Version for Release 8                                                                                      7.0.0     8.0.0
  2009-12              46                                               Version for Release 9                                                                                      8.0.0     9.0.0
  2011-03              51                                               Version for Release 10                                                                                     9.0.0     10.0.0
  2012-09              57                                               Version for Release 11                                                                                     10.0.0    11.0.0
  2014-09              65                                               Version for Release 12                                                                                     11.0.0    12.0.0
  2015-12              70                                               Version for Release 13                                                                                     12.0.0    13.0.0
  -------------------- -------------- -------------- -------- --------- ---------------------------------------------------------------------------------------------------------- --------- ---------

  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
  **Change history**                                                                                          
  **Date**             **Meeting**   **TDoc**   **CR**   **Rev**   **Cat**   **Subject/Comment**              **New version**
  2017-03              75                                                    Version for Release 14           14.0.0
  2018-06              80                                                    Version for Release 15           15.0.0
  2020-07              \-            \-         \-       \-        \-        Update to Rel-16 version (MCC)   **16.0.0**
  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
