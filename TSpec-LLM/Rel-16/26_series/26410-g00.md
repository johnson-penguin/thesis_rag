![](media/image1.jpeg){width="7.086111111111111in"
height="1.136111111111111in"}

Contents {#contents .TT}
========

[4](#foreword)

[5](#scope)

[5](#references)

[5](#definitions-and-abbreviations)

[5](#definitions)

[5](#abbreviations)

[6](#floating-point-ansi-c-code-structure)

[6](#contents-of-the-floating-point-ansi-c-source-code)

[8](#program-execution)

[9](#memory-requirements)

[9](#constants-and-tables)

[14](#static-memory)

[15](#dynamic-memory)

[16](#maximum-stack-size)

[20](#file-formats)

[20](#audio-input-file-encoder-inputdecoder-output)

[20](#bitstream-file-format-encoder-outputdecoder-input)

[20](#error-pattern-file-decoder-input)

[21](#annex-a-informative-weighted-mops-and-prom)

[22](#annex-b-informative-change-history)Foreword 1 Scope 2 References 3
Definitions and abbreviations 3.1 Definitions 3.2 Abbreviations 4
Floating point ANSI-C code structure 4.1 Contents of the floating point
ANSI-C source code 4.2 Program execution 4.3 Memory requirements 4.3.1
Constants and tables 4.3.2 Static memory 4.3.3 Dynamic memory 4.3.4
Maximum stack size 5 File formats 5.1 Audio input file (encoder
input/decoder output) 5.2 Bitstream file format (encoder output/decoder
input) 5.3 Error pattern file (decoder input) Annex A (informative):
Weighted MOPS and PROM Annex B (informative): Change history

Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document contains an electronic copy of the ANSI‑C code for
the Floating-point Enhanced aacPlus codec \[1\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TS 26.401: \"Enhanced aacPlus general audio codec; General
Description\".

\[2\] 3GPP TS 26.403: \"Enhanced aacPlus general audio codec; Encoder
Specification AAC part\".

\[3\] 3GPP TS 26.404: \"Enhanced aacPlus general audio codec; Encoder
Specification SBR part\".

\[4\] 3GPP TS 26.405: \"Enhanced aacPlus general audio codec; Encoder
Specification Parametric Stereo part\".

\[5\] ISO/IEC 14496-3:2001: \"Information technology - Coding of
audio-visual objects - Part 3: Audio\".

\[6\] ISO/IEC 14496-3:2001/Amd.1:2003: \"Bandwidth Extension\".

\[7\] ISO/IEC 14496-3:2001/Amd.1:2003/DCOR1\".

\[8\] ISO/IEC 14496-3:2001/ Amd.2:2004: \"Parametric Coding for High
Quality Audio.

\[9\] 3GPP TS 26.402: Enhanced aacPlus general audio codec; Additional
Decoder Tools\".

3 Definitions and abbreviations
===============================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions
given in TS 26.401 \[1\], TS 26.403 \[2\], TS 26.404 \[3\], TS 26.405
\[4\] and TS 26.402 \[9\] apply.

3.2 Abbreviations
-----------------

For the purposes of the present document, the following abbreviations
apply:

AAC Advanced Audio Coding

aacPlus Combination of MPEG-4 AAC and MPEG-4 Bandwidth extension (SBR)

Enhanced aacPlus Combination of MPEG-4 AAC, MPEG-4 Bandwidth extension
(SBR) and MPEG-4 Parametric Stereo

MDCT Modified Discrete Cosine Transform

QMF Quadrature Mirror Filter

SBR Spectral Band Replication

ANSI American National Standards Institute

GSM Global System for Mobile communications

I/O Input/Output

RAM Random Access Memory

ROM Read Only Memory

4 Floating point ANSI-C code structure
======================================

This clause gives an overview of the structure of the floating point
ANSI-C code and provides an overview of the contents and organization of
the C code attached to the present document.

The C code has been verified on the following systems:

\- IBM PC/AT compatible computers with Windows XP, 2000 and Microsoft
Visual C++ v.6.0 compiler.

\- IBM PC/AT compatible computers with Linux OS and GCC v.3.3 compiler.

ANSI‑C was selected as the programming language because portability was
desirable.

4.1 Contents of the floating point ANSI-C source code
-----------------------------------------------------

The C code distribution is organised in two directories for encoder and
decoder and further into several subdirectories, reflecting the major
building blocks of the Enhanced aacPlus codec. The file descriptions on
root level as well as the directory structure is given as follows:

Table 1: Source code directory structure for the encoder
(FloatFR\_aacPlusenc)

  ------------------------- ------------------------------------
  Directory                 Description
  README.txt                information on how to compile
  Makefile                  UNIX style encoder Makefile
  FloatFR\_aacPlusEnc.dsw   Win32 MSVC 6.0 encoder workspace
  FloatFR\_aacPlusEnc.dsp   Win32 MSVC 6.0 encoder makefile
  src/                      directory for the encoder frontend
  FloatFR\_fastaacenc/      AAC encoder library
  FloatFR\_resamplib/       resampler library
  FloatFR\_sbrenclib/       SBR encoder library
  ------------------------- ------------------------------------

Table 2: Source code directory structure for the decoder
(FloatFR\_aacPlusdec)

  -------------------------------- ------------------------------------
  Directory                        Description
  README.txt                       information on how to compile
  Makefile                         UNIX style encoder Makefile
  FloatFR\_aacPlusdec\_mpeg4.dsw   Win32 MSVC 6.0 decoder workspace
  FloatFR\_aacPlusdec\_mpeg4.dsp   Win32 MSVC 6.0 decodec makefile
  src/                             directory for the decoder frontend
  FloatFR\_aacdec                  AAC decoder library
  FloatFR\_sbrdeclib/              SBR decoder library
  -------------------------------- ------------------------------------

Table 3: Source code directory structure common for encoder and decoder

  --------------------- --------------------------------------------------------------------
  Directory             Description
  FloatFR\_bitbuflib/   bitstream reading/writing library
  FloatFRlib/           general purpose functionalities
  lib/                  precompiled libraries for audio and bitstream file format handling
  --------------------- --------------------------------------------------------------------

The distributed files with suffix \"c\" contain the source code and the
files with suffix \"h\" are the header files. Within the respective
libraries, the RAM data is contained in \"xxx\_ram\" files with suffix
\"c\", the ROM data is contained in \"xxx\_rom\" files with suffix
\"c\". Makefiles are provided for the platforms in which the C code has
been verified (listed above).

Note that the FloatFRlib/, FloatFR\_bitbuflib/ and lib/ directory are
identical for encoder and decoder. A list of source code files with the
respective lines of code (pure C instructions) is given below:

Table 4: Encoder source code files and lines of code

  ------------------------- ---------------------- ---------------
  Directory                 Module                 Lines of code
  src/                      main.c                 332
                            mp4file.c              255
  FloatFR\_fastaacenclib/   qc\_main.c             224
                            aacenc.c               136
                            ms\_stereo.c           50
                            spreading.c            10
                            interface.c            44
                            bit\_cnt.c             588
                            adj\_thr.c             592
                            quantize.c             56
                            psy\_configuration.c   175
                            sf\_estim.c            508
                            tns\_param.c           45
                            grp\_data.c            114
                            pre\_echo\_control.c   22
                            stprepro.c             149
                            tns.c                  358
                            dyn\_bits.c            281
                            psy\_main.c            232
                            channel\_map.c         52
                            block\_switch.c        201
                            band\_nrg.c            34
                            transform.c            151
                            bitenc.c               262
                            line\_pe.c             55
                            stat\_bits.c           107
  FloatFR\_sbrenclib/       qmf\_enc.c             565
                            ton\_corr.c            287
                            fram\_gen.c            688
                            env\_bit.c             56
                            env\_est.c             630
                            mh\_det.c              515
                            hybrid.c               139
                            bit\_sbr.c             375
                            ps\_bitenc.c           225
                            sbr\_main.c            355
                            tran\_det.c            183
                            sbr\_misc.c            49
                            code\_env.c            290
                            nf\_est.c              195
                            freq\_sca.c            309
                            invf\_est.c            140
                            ps\_enc.c              299
  FloatFR\_resamplib/       iir32resample.c        71
                            resampler.c            68
  ------------------------- ---------------------- ---------------

Table 5: Decoder source code files and lines of code

  --------------------- --------------------- ---------------
  Directory             Module                Lines of code
  src/                  main.c                299
                        fileifc.c             173
                        spline\_resampler.c   172
  FloatFR\_aacdec/      aacdecoder.c          172
                        streaminfo.c          10
                        channelinfo.c         102
                        stereo.c              78
                        longblock.c           234
                        shortblock.c          241
                        pulsedata.c           24
                        block.c               163
                        pns.c                 89
                        imdct.c               50
                        tns.c                 137
                        bitstream.c           15
                        channel.c             92
                        conceal.c             245
                        dse.c                 9
  FloatFR\_sbrdeclib/   env\_dec.c            370
                        FFR\_aacPLUScheck.c   32
                        sbr\_bitb.c           37
                        env\_calc.c           775
                        lpp\_tran.c           504
                        sbrdecoder.c          514
                        sbr\_dec.c            218
                        sbr\_crc.c            45
                        sbr\_fft.c            615
                        hybrid.c              140
                        ps\_bitdec.c          223
                        huff\_dec.c           9
                        env\_extr.c           655
                        freq\_sca.c           337
                        ps\_dec.c             317
                        qmf\_dec.c            526
  --------------------- --------------------- ---------------

Table 6: Common source code files and lines of code

  --------------------- ---------------- ---------------
  Directory             Module           Lines of code
  FloatFR\_bitbuflib/   bitbuffer.c      111
  FloatFRlib/           cfftn.c          649
                        transcendent.c   15
  --------------------- ---------------- ---------------

4.2 Program execution
---------------------

The Enhanced aacPlus codec is implemented in two programs:

\- enhAacPlusEnc.exe

\- enhAacPlusDec.exe

The programs should be called like:

\- enhAacPlusEnc.exe \<wav\_file\> \<bitstream\_file\> \<bitrate\>
\<(m)ono/(s)tereo\>

\- enhAacPlusDec.exe \<bitstream\_file\> \<wav\_file\> \<mode\>
\[error\_pattern\_file\]

The audio files contain 16-bit linear encoded PCM samples with wav
header, the bitstream files are of 3GPP type an the error patter file is
a ASCII file, see section 5.

The encoder and decoder command line handling is also explained by
running the applications without input arguments.

4.3 Memory requirements
-----------------------

The data types of variables and tables used in the floating-point
implementation are plain ANSI-C data types, the following types are
used:

\- char

\- unsigned char

\- short

\- int

\- unsigned int

\- float

### 4.3.1 Constants and tables

This clause contains a listing of all constants and tables contributing
to the ROM requirements of the encoder and decoder.

Table 7: Encoder constants and tables

  ---------------------------- ------------- --------------- -------------------------- ---------------------------------------------------------------
  Name                         Data type     Size \[word\]   Allocated in Source File   Description
  LongWindowSine               float         1024            aac\_rom.c                 Window coefficients
  ShortWindowSine              float         128             aac\_rom.c                 Window coefficients
  LongWindowKBD                float         1024            aac\_rom.c                 Window coefficients
  fftTwiddleTab                float         513             aac\_rom.c                 FFT twiddle coefficients
  quantTableQ                  float         16              aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  quantTableE                  float         17              aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  invQuantTableQ               float         16              aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  invQuantTableE               float         17              aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  pow4\_3\_tab                 float         64              aac\_rom.c                 Quantizer table, used for efficient pow () implementation
  p\_8000\_mono\_long          float         4               aac\_rom.c                 TNS tuning parameters
  p\_8000\_stereo\_long        float         4               aac\_rom.c                 TNS tuning parameters
  p\_8000\_mono\_short         float         4               aac\_rom.c                 TNS tuning parameters
  p\_8000\_stereo\_short       float         4               aac\_rom.c                 TNS tuning parameters
  p\_16000\_mono\_long         float         4               aac\_rom.c                 TNS tuning parameters
  p\_16000\_stereo\_long       float         4               aac\_rom.c                 TNS tuning parameters
  p\_16000\_mono\_short        float         4               aac\_rom.c                 TNS tuning parameters
  p\_16000\_stereo\_short      float         4               aac\_rom.c                 TNS tuning parameters
  p\_24000\_mono\_long         float         4               aac\_rom.c                 TNS tuning parameters
  p\_24000\_stereo\_long       float         4               aac\_rom.c                 TNS tuning parameters
  p\_24000\_mono\_short        float         4               aac\_rom.c                 TNS tuning parameters
  p\_24000\_stereo\_short      float         4               aac\_rom.c                 TNS tuning parameters
  p\_32000\_mono\_long         float         4               aac\_rom.c                 TNS tuning parameters
  p\_32000\_stereo\_long       float         4               aac\_rom.c                 TNS tuning parameters
  p\_32000\_mono\_short        float         4               aac\_rom.c                 TNS tuning parameters
  p\_32000\_stereo\_short      float         4               aac\_rom.c                 TNS tuning parameters
  tnsCoeff3                    float         8               aac\_rom.c                 TNS filter coefficients
  tnsCoeff3Borders             float         8               aac\_rom.c                 TNS filter borders
  tnsCoeff4                    float         16              aac\_rom.c                 TNS filter coefficients
  tnsCoeff4Borders             float         16              aac\_rom.c                 TNS filter borders
  tnsInfoTab                   int           24              aac\_rom.c                 TNS bitrate to tuning mapping table
  tnsMaxBandsTab               int           27              aac\_rom.c                 max. TNS bands per sampling rate table
  huff\_ltab1\_2               short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab3\_4               short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab5\_6               short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab7\_8               short         64              aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab9\_10              short         168             aac\_rom.c                 Huffman codeword table AAC
  huff\_ltab11                 short         288             aac\_rom.c                 Huffman codeword table AAC
  huff\_ltabscf                short         120             aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab1                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab2                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab3                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab4                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab5                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab6                  short         80              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab7                  short         64              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab8                  short         64              aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab9                  short         168             aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab10                 short         168             aac\_rom.c                 Huffman codeword table AAC
  huff\_ctab11                 short         288             aac\_rom.c                 Huffman codeword table AAC
  huff\_ctabscf                short         242             aac\_rom.c                 Huffman codeword table AAC
  sfb\_11025\_long\_1024       char          43              aac\_rom.c                 Scalefactor band table
  sfb\_11025\_short\_128       char          15              aac\_rom.c                 Scalefactor band table
  sfb\_12000\_long\_1024       char          43              aac\_rom.c                 Scalefactor band table
  sfb\_12000\_short\_128       char          15              aac\_rom.c                 Scalefactor band table
  sfb\_16000\_long\_1024       char          43              aac\_rom.c                 Scalefactor band table
  sfb\_16000\_short\_128       char          15              aac\_rom.c                 Scalefactor band table
  sfb\_22050\_long\_1024       char          47              aac\_rom.c                 Scalefactor band table
  sfb\_22050\_short\_128       char          15              aac\_rom.c                 Scalefactor band table
  sfb\_24000\_long\_1024       char          47              aac\_rom.c                 Scalefactor band table
  sfb\_24000\_short\_128       char          15              aac\_rom.c                 Scalefactor band table
  panClass                     float         7               sbr\_rom.c                 Parametric Stereo quantization table
  saClass                      float         7               sbr\_rom.c                 Parametric Stereo quantization table
  p4\_13                       float         13              sbr\_rom.c                 Hybrid filterbank coefficients
  p8\_13                       float         13              sbr\_rom.c                 Hybrid filterbank coefficients
  sbr\_cos\_twiddle            float         16              sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_sin\_twiddle            float         16              sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_alt\_sin\_twiddle       float         17              sbr\_rom.c                 QMF filterbank twiddle table
  sbr\_qmf\_64\_640            float         325             sbr\_rom.c                 QMF window coefficients
  p\_64\_640\_qmf              float         640             sbr\_rom.c                 QMF window coefficients (Note: could be made obsolete)
  trigData\_fct4\_32           float         32              sbr\_rom.c                 FFT twiddle table
  trigData\_fct4\_16           float         16              sbr\_rom.c                 FFT twiddle table
  trigData\_fct4\_8            float         8               sbr\_rom.c                 FFT twiddle table
  aBookPsIidTimeCode           int           29              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqCode           int           29              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aHybridResolution            int           3               sbr\_rom.c                 Number of hybrid bands in each QMF band
  hiResBandBorders             int           21              sbr\_rom.c                 Borders of Parametric Stereo bins
  groupBordersMix              int           29              sbr\_rom.c                 Borders of Parametric Stereo groups
  bins2groupMap                int           29              sbr\_rom.c                 Mapping of Parametric Stereo bins to Parametric Stereo groups
  v\_Huff\_envelopeLevelC10T   int           121             sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC10F   int           121             sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC10F        int           49              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC10T        int           49              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC11T   int           63              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_NoiseLevelC11T      int           63              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC11T        int           25              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrNoiseBalanceC11T      int           25              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelC11F   int           63              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceC11F        int           25              sbr\_rom.c                 Huffman codeword table SBR
  aBookPsIidTimeLength         char          29              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqLength         char          29              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccFreqLength         char          15              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeLength         char          15              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  v\_Huff\_envelopeLevelL10T   char          121             sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL10F   char          121             sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL10F        char          49              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL10T        char          49              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL11T   char          63              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL11T        char          25              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_NoiseLevelL11T      char          63              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrNoiseBalanceL11T      char          25              sbr\_rom.c                 Huffman codeword table SBR
  v\_Huff\_envelopeLevelL11F   char          63              sbr\_rom.c                 Huffman codeword table SBR
  bookSbrEnvBalanceL11F        char          25              sbr\_rom.c                 Huffman codeword table SBR
  aBookPsIccFreqCode           short         15              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeCode;          short         15              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  logDualisTable               float         65              transcendent.c             Lookup table for efficient log() implementation
  set1\_a                      float         14              resampler.c                IIR filter coefficients for 2:1 resampling
  set1\_b                      float         14              resampler.c                IIR filter coefficients for 2:1 resampling
  set1                         float         5               resampler.c                IIR filter coefficients for 2:1 resampling
  coeffNum                     float         8               iir32resample.c            IIR filter coefficients for 3:2 resampling
  coeffDen                     float         8               iir32resample.c            IIR filter coefficients for 3:2 resampling
  tuningTable                  tuningTable   231             sbr\_main.c                SBR tuning parameters
  **Sum**                                    **8555**                                   
  ---------------------------- ------------- --------------- -------------------------- ---------------------------------------------------------------

Table 8: Decoder constants and tables

  ------------------------------------ ----------- --------------- -------------------------- ---------------------------------------------------------------
  Name                                 Data type   Size \[word\]   Allocated in Source File   Description
  tnsCoeff3                            float       8               aac\_rom.c                 TNS filter coefficients
  tnsCoeff4                            float       16              aac\_rom.c                 TNS filter coefficients
  trigData                             float       513             aac\_rom.c                 Sine table, used for efficient sin(), cos()
  OnlyLongWindowKBD                    float       1024            aac\_rom.c                 Window coefficients
  OnlyShortWindowKBD                   float       128             aac\_rom.c                 Window coefficients
  OnlyLongWindowSine                   float       1024            aac\_rom.c                 Window coefficients
  OnlyShortWindowSine                  float       128             aac\_rom.c                 Window coefficients
  sfb\_48\_1024                        short       50              aac\_rom.c                 Scalefactor band table
  sfb\_48\_128                         short       15              aac\_rom.c                 Scalefactor band table
  sfb\_32\_1024                        short       51              aac\_rom.c                 Scalefactor band table
  sfb\_24\_1024                        short       49              aac\_rom.c                 Scalefactor band table
  sfb\_24\_128                         short       16              aac\_rom.c                 Scalefactor band table
  sfb\_16\_1024                        short       44              aac\_rom.c                 Scalefactor band table
  sfb\_16\_128                         short       16              aac\_rom.c                 Scalefactor band table
  sfb\_8\_1024                         short       41              aac\_rom.c                 Scalefactor band table
  sfb\_8\_128                          short       16              aac\_rom.c                 Scalefactor band table
  HuffmanCodeBook\_1                   short       204             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_2                   short       156             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_3                   short       156             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_4                   short       152             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_5                   short       164             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_6                   short       160             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_7                   short       124             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_8                   short       124             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_9                   short       336             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_10                  short       328             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_11                  short       544             aac\_rom.c                 Huffman codeword table AAC
  HuffmanCodeBook\_SCL                 short       260             aac\_rom.c                 Huffman codeword table AAC
  SamplingRateInfoTable                mixed       45              aac\_rom.c                 Sampling rate to scalefactor mapping table AAC
  HuffmanCodeBooks                     mixed       52              aac\_rom.c                 Huffman codeword table AAC
  tns\_max\_bands\_tbl                 char        18              aac\_rom.c                 max. TNS bands per sampling rate table
  sbr\_limGains                        float       4               sbr\_rom.c                 SBR limiter gain values
  sbr\_limiterBandsPerOctave           float       4               sbr\_rom.c                 Number of SBR limiter bands
  sbr\_smoothFilter                    float       4               sbr\_rom.c                 Smoothing filter for gain values
  sbr\_invIntTable                     float       55              sbr\_rom.c                 Table of 1/x function
  sbr\_randomPhase                     float       1024            sbr\_rom.c                 Random numbers for SBR noise addition and PNS
  sbr\_qmf\_64\_640                    float       325             sbr\_rom.c                 QMF window coefficients
  sbr\_cos\_twiddle\_L04               float       2               sbr\_rom.c                 FFT twiddle table
  sbr\_cos\_twiddle\_L08               float       4               sbr\_rom.c                 FFT twiddle table
  sbr\_cos\_twiddle\_L16               float       8               sbr\_rom.c                 FFT twiddle table
  sbr\_cos\_twiddle\_L32               float       16              sbr\_rom.c                 FFT twiddle table
  sbr\_sin\_twiddle\_L04               float       2               sbr\_rom.c                 FFT twiddle table
  sbr\_sin\_twiddle\_L08               float       4               sbr\_rom.c                 FFT twiddle table
  sbr\_sin\_twiddle\_L16               float       8               sbr\_rom.c                 FFT twiddle table
  sbr\_sin\_twiddle\_L32               float       16              sbr\_rom.c                 FFT twiddle table
  sbr\_alt\_sin\_twiddle\_L04          float       3               sbr\_rom.c                 FFT twiddle table
  sbr\_alt\_sin\_twiddle\_L08          float       5               sbr\_rom.c                 FFT twiddle table
  sbr\_alt\_sin\_twiddle\_L16          float       9               sbr\_rom.c                 FFT twiddle table
  sbr\_alt\_sin\_twiddle\_L32          float       17              sbr\_rom.c                 FFT twiddle table
  sbr\_cos\_twiddle\_ds\_L32           float       32              sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_sin\_twiddle\_ds\_L32           float       32              sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_cos\_twiddle\_L64               float       32              sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_sin\_twiddle\_L64               float       32              sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_alt\_sin\_twiddle\_L64          float       33              sbr\_rom.c                 FFT twiddle table, obsolete for mono only decoder
  sbr\_t\_cos\_L32                     float       32              sbr\_rom.c                 FFT twiddle table
  sbr\_t\_sin\_L32                     float       32              sbr\_rom.c                 FFT twiddle table
  aRevLinkDecaySer                     float       3               sbr\_rom.c                 Parametric Stereo all-pass filter coefficients
  aFractDelayPhaseFactorReQmf          float       20              sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorImQmf          float       20              sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorReSubQmf       float       10              sbr\_rom.c                 Parametric Stereo phase rotation factor
  aFractDelayPhaseFactorImSubQmf       float       10              sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerReQmf      float       3               sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerImQmf      float       3               sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerReSubQmf   float       3               sbr\_rom.c                 Parametric Stereo phase rotation factor
  aaFractDelayPhaseFactorSerImSubQmf   float       3               sbr\_rom.c                 Parametric Stereo phase rotation factor
  scaleFactors                         float       15              sbr\_rom.c                 Parametric Stereo quantization table
  scaleFactorsFine                     float       41              sbr\_rom.c                 Parametric Stereo quantization table
  alphas                               float       8               sbr\_rom.c                 Parametric Stereo quantization table
  p2\_6                                float       6               sbr\_rom.c                 Hybrid filterbank coefficients
  p8\_13                               float       14              sbr\_rom.c                 Hybrid filterbank coefficients
  sbr\_whFactorsTable                  float       54              sbr\_rom.c                 Tuning parameters for inverse filtering
  bins2groupMap                        short       22              sbr\_rom.c                 Mapping of Parametric Stereo bins to Parametric Stereo groups
  sbr\_whFactorsIndex                  short       9               sbr\_rom.c                 Tuning parameter index for inverse filtering
  sbr\_start\_freq\_16                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_22                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_24                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_32                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_44                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_start\_freq\_48                 char        16              sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info1\_16                char        18              sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info2\_16                char        18              sbr\_rom.c                 SBR frequency scale index
  sbr\_frame\_info4\_16                char        18              sbr\_rom.c                 SBR frequency scale index
  sbr\_huffBook\_EnvLevel10T           char        240             sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel10F           char        240             sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance10T         char        96              sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance10F         char        96              sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel11T           char        124             sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvLevel11F           char        124             sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance11T         char        48              sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_EnvBalance11F         char        48              sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_NoiseLevel11T         char        124             sbr\_rom.c                 Huffman codeword table SBR
  sbr\_huffBook\_NoiseBalance11T       char        48              sbr\_rom.c                 Huffman codeword table SBR
  aRevLinkDelaySer                     char        3               sbr\_rom.c                 Parametric Stereo all-pass delay line lengths
  groupBorders                         char        23              sbr\_rom.c                 Borders of Parametric Stereo groups
  aBookPsIidTimeDecode                 char        56              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFreqDecode                 char        56              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccTimeDecode                 char        28              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIccFreqDecode                 char        28              sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFineTimeDecode             char        120             sbr\_rom.c                 Huffman codeword table Parametric Stereo
  aBookPsIidFineFreqDecode             char        120             sbr\_rom.c                 Huffman codeword table Parametric Stereo
  sbr\_defaultHeader                   char        32              sbr\_rom.c                 Default SBR header data
  logDualisTable                       float       65              transcendent.c             Lookup table for efficient log() implementation
  **Sum**                                          **9866**                                   
  ------------------------------------ ----------- --------------- -------------------------- ---------------------------------------------------------------

### 4.3.2 Static memory

This clause contains a listing of all static buffers contributing to the
RAM requirements of the encoder and decoder.

Table 9: Encoder static memory

  ------------------------------- ------------------------ --------------- -------------------------- -----------------------------------------------------------------------------------------
  Name                            Data type                Size \[word\]   Allocated in Source File   Description
  mdctDelayBuffer                 float                    3200            aac\_ram.c                 Time domain input signal delay
  sideInfoTabLong                 int                      52              aac\_ram.c                 Table lookup for side information, long blocks
  sideInfoTabShort                int                      16              aac\_ram.c                 Table lookup for side information, short blocks
  aacEncoder                      AAC\_ENCODER             3554            aacenc.c                   AAC encoder instance
  sbr\_QmfStatesAnalysis          float                    1280            sbr\_ram.c                 QMF filterbank states buffer
  sbr\_envYBuffer                 float                    4096            sbr\_ram.c                 QMF band energy buffer
  sbr\_quotaMatrix                float                    512             sbr\_ram.c                 Tonality values
  sbr\_thresholds                 float                    128             sbr\_ram.c                 Detector parameters
  sbr\_toncorrBuff                float                    1256            sbr\_ram.c                 Detector value buffer
  EnvChannel\[nChan\]             ENV\_CHANNEL             1794            sbr\_main.c                SBR channel instance, only half the size for mono only encoder
  sbrEncoder                      SBR\_ENCODER             200             sbr\_main.c                SBR encoder instance
  SynthesisQmfBank                SBR\_QMF\_FILTER\_BANK   7               sbr\_main.c                QMF synthesis filterbank instance
  psEncoder                       PS\_ENC                  281             sbr\_main.c                Parametric Stereo encoder instance
  sbr\_freqBandTableLO            char                     14              sbr\_ram.c                 SBR frequency band table, low resolution
  sbr\_freqBandTableHI            char                     28              sbr\_ram.c                 SBR frequency band table, high resolution
  sbr\_v\_k\_master               char                     28              sbr\_ram.c                 SBR frequency band table index
  sbr\_guideScfb                  char                     54              sbr\_ram.c                 Additional sine detection parameter
  sbr\_detectionVectors           char                     216             sbr\_ram.c                 Additional sine detection parameter
  sbr\_prevEnvelopeCompensation   char                     54              sbr\_ram.c                 Additional sine detection parameter
  sbr\_guideVectorDetected        char                     216             sbr\_ram.c                 Additional sine detection parameter
  outputBuffer                    int                      384             main.c                     Bitstream output buffer
  inputBuffer\[nChan\]            float                    7202            main.c                     Time domain input signal buffer, only half the size for mono only encoder
  IIR21\_resampler\[nChan\]       float                    144             main.c                     2:1 IIR resampler instance (includes states) , only half the size for mono only encoder
  statesIIR                       float                    16              iir32resample.c            3:2 IIR resampler states buffer
  **Sum**                                                  **24732**                                  
  ------------------------------- ------------------------ --------------- -------------------------- -----------------------------------------------------------------------------------------

Table 10: Decoder static memory

  -------------------------------------- ------------------------------ --------------- -------------------------- --------------------------------------------------------------------------------
  Name                                   Data type                      Size \[word\]   Allocated in Source File   Description
  OverlapBuffer\[nChan\]                 float                          1024            aac\_ram.c                 Delay buffer for overlap and add, only half the size for mono only decoder
  AacDecoderInstance                     AAC\_DECODER\_INSTANCE         11              aacdecoder.c               AAC decoder instance
  StreamInfo                             CStreamInfo                    7               aac\_ram.c                 Bitstream information
  AacDecoderStaticChannelInfo\[nChan\]   CaacDecoderStaticChannelInfo   16              aac\_ram.c                 Channel information, only half the size for mono only decoder
  sbr\_CodecQmfStatesAnalysis            float                          640             sbr\_ram.c                 QMF analysis filter bank states
  sbr\_GainSmooth                        float                          96              sbr\_ram.c                 Gain smoothing filter states
  sbr\_NoiseSmooth                       float                          96              sbr\_ram.c                 Noise level smoothing filter states
  sbr\_QmfStatesSynthesis                float                          1280            sbr\_ram.c                 QMF synthesis filter bank states
  sbr\_OverlapBuffer                     float                          1536            sbr\_ram.c                 SBR delay buffer, only half the size for mono only decoder
  sbr\_LpcFilterStatesReal               float                          128             sbr\_ram.c                 LPC filter states
  sbr\_LpcFilterStatesImag               float                          128             sbr\_ram.c                 LPC filter states, obsolete for mono only decoder
  sbr\_TransposerSettings                float                          18              sbr\_ram.c                 Transposer configuration parameters
  FreqBandData                           FREQ\_BAND\_DATA               164             sbr\_ram.c                 SBR Frequency band information
  PrevFrameData\[nChan\]                 SBR\_PREV\_FRAME\_DATA         120             sbr\_ram.c                 SBR previous frame data, only half the size for mono only decoder
  sbr\_PrevBitstream                     SBRBITSTREAM                   146             sbr\_ram.c                 SBR previous frame bitstream
  sbrDecoderInstance                     SBR\_DECODER\_INSTANCE         797             sbrdecoder.c               SBR decoder instance
  TimeDataFloat\[nChan\]                 float                          4096            main.c                     Output buffer for time-domain signal, only half the size for mono only decoder
  inBuffer                               int                            384             main.c                     Input buffer for bitstream
  splineResamplerInstance                SPLINE\_RESAMPLER              21              spline\_resampler.c        Spline resampler instance
  **Sum**                                                               **10708**                                  
  -------------------------------------- ------------------------------ --------------- -------------------------- --------------------------------------------------------------------------------

###  4.3.3 Dynamic memory

This clause contains a listing of all dynamic buffers contributing to
the RAM requirements of the encoder and decoder. Dynamic memory can be
re-used outside of the encoder or decoder application.

Table 11: Encoder dynamic memory

  ----------------- ----------- --------------- -------------------------- -----------------------------
  Name              Data type   Size \[word\]   Allocated in Source File   Description
  PsBuf3            float       1024            sbr\_ram.c                 Note: reused in AAC encoder
  sbr\_envRBuffer   float       4096            sbr\_ram.c                 Note: reused in AAC encoder
  sbr\_envIBuffer   float       4096            sbr\_ram.c                 Note: reused in AAC encoder
  sbr\_transients   float       192             sbr\_ram.c                 Note: reused in AAC encoder
  **Sum**                       **9408**                                   
  ----------------- ----------- --------------- -------------------------- -----------------------------

Table 12: Decoder dynamic memory

  ---------------- ----------- --------------- -------------------------- -----------------------------
  Name             Data type   Size \[word\]   Allocated in Source File   Description
  WorkBufferCore   float       2048            aac\_ram.c                 Note: reused in SBR decoder
  InterimResult    float       1024            sbr\_ram.c                 
  **Sum**                      **3072**                                   
  ---------------- ----------- --------------- -------------------------- -----------------------------

### 4.3.4 Maximum stack size

This clause contains tables for the encoder and the decoder which
describe the call stack that results in the maximum stack size usage.

Table 13: Encoder call stack

+----------------------+----------------------+----------------------+
| Function             | Local variables      | Stack used \[bytes\] |
+----------------------+----------------------+----------------------+
| main                 | struct config;       | 20                   |
|                      |                      |                      |
|                      | int error;           | 4                    |
|                      |                      |                      |
|                      | int bEncodeMono;     | 4                    |
|                      |                      |                      |
|                      | int bitrate;         | 4                    |
|                      |                      |                      |
|                      | int nChannelsAAC,    | 8                    |
|                      | nChannelsSBR;        |                      |
|                      |                      | 4                    |
|                      | int sampleRateAAC;   |                      |
|                      |                      | 4                    |
|                      | int bandwidth;       |                      |
|                      |                      | 4                    |
|                      | unsigned int         |                      |
|                      | numAncDataBytes;     | 256                  |
|                      |                      |                      |
|                      | unsigned char        | 4                    |
|                      | ancDataBytes\[256\]; |                      |
|                      |                      | 4                    |
|                      | unsigned int         |                      |
|                      | ancDataLength;       | 4                    |
|                      |                      |                      |
|                      | int numSamplesRead;  | 4                    |
|                      |                      |                      |
|                      | int                  | 4                    |
|                      | bDoIIR2Downsample;   |                      |
|                      |                      | 4                    |
|                      | int bDingleRate;     |                      |
|                      |                      | 4                    |
|                      | int                  |                      |
|                      | useParametricStereo; | 4                    |
|                      |                      |                      |
|                      | int coreWriteOffset; | 4                    |
|                      |                      |                      |
|                      | int coreReadOffset;  | 4                    |
|                      |                      |                      |
|                      | int envWriteOffset;  | 4                    |
|                      |                      |                      |
|                      | int envReadOffset;   | 4                    |
|                      |                      |                      |
|                      | int writeOffset;     | 4                    |
|                      |                      |                      |
|                      | struct \*aacEnc;     | 4                    |
|                      |                      |                      |
|                      | int bDoUpsample;     | 4                    |
|                      |                      |                      |
|                      | int                  | 4                    |
|                      | upsampleReadOffset;  |                      |
|                      |                      | 4                    |
|                      | int inSamples;       |                      |
|                      |                      | 4                    |
|                      | int                  |                      |
|                      | bDoIIR32Resample;    | 4                    |
|                      |                      |                      |
|                      | int                  | 16                   |
|                      | nSamplesPerChannel;  |                      |
|                      |                      | = 400                |
|                      | const int nRuns;     |                      |
|                      |                      |                      |
|                      | float                |                      |
|                      | \*resamplerScratch;  |                      |
|                      |                      |                      |
|                      | struct \*hEnvEnc;    |                      |
|                      |                      |                      |
|                      | int i, ch,           |                      |
|                      | outSamples,          |                      |
|                      | numOutBytes;         |                      |
+----------------------+----------------------+----------------------+
| EnvEncodeFrame       | struct               | 4                    |
|                      | \*hEnvEncoder;       |                      |
|                      |                      | 4                    |
|                      | float \*samples;     |                      |
|                      |                      | 4                    |
|                      | float \*pCoreBuffer; |                      |
|                      |                      | 4                    |
|                      | unsigned int         |                      |
|                      | timeInStride;        | 4                    |
|                      |                      |                      |
|                      | unsigned int         | 4                    |
|                      | \*numAncBytes;       |                      |
|                      |                      | 4                    |
|                      | unsigned char        |                      |
|                      | \*ancData;           | = 28                 |
|                      |                      |                      |
|                      | struct               |                      |
|                      | \*sbrBitstreamData;  |                      |
+----------------------+----------------------+----------------------+
| extractSbrEnvelope   | float \*timeInPtr;   | 4                    |
|                      |                      |                      |
|                      | float \*pCoreBuffer; | 4                    |
|                      |                      |                      |
|                      | unsigned int         | 4                    |
|                      | timeInStride;        |                      |
|                      |                      | 4                    |
|                      | struct \*h\_con;     |                      |
|                      |                      | 4                    |
|                      | struct               |                      |
|                      | \*sbrHeaderData;     | 4                    |
|                      |                      |                      |
|                      | struct               | 4                    |
|                      | \*sbrBitstreamData;  |                      |
|                      |                      | 4                    |
|                      | struct               |                      |
|                      | \*h\_envChan\[\];    | 4                    |
|                      |                      |                      |
|                      | struct \*h\_ps\_e;   | 4                    |
|                      |                      |                      |
|                      | struct               | 16                   |
|                      | \*hSynthesisQmfBank; |                      |
|                      |                      | 8                    |
|                      | struct \*hCmonData;  |                      |
|                      |                      | 16                   |
|                      | int ch, i, j, c;     |                      |
|                      |                      | 8                    |
|                      | int nEnvelopes\[2\]; |                      |
|                      |                      | 8                    |
|                      | int                  |                      |
|                      | transi               | 4                    |
|                      | ent\_info\[2\]\[2\]; |                      |
|                      |                      | 40                   |
|                      | const struct         |                      |
|                      | \*frame\_info\[2\];  | 24                   |
|                      |                      |                      |
|                      | int nChannels,       | 1080                 |
|                      | nInChannels;         |                      |
|                      |                      | 80                   |
|                      | enum stereoMode;     |                      |
|                      |                      | 80                   |
|                      | enum res\[10\];      |                      |
|                      |                      | 1080                 |
|                      | int v\_tuning\[6\];  |                      |
|                      |                      | 80                   |
|                      | int sfb\_nrg         |                      |
|                      | \[2\]\[135\];        | 4                    |
|                      |                      |                      |
|                      | float                | = 2568               |
|                      | no                   |                      |
|                      | iseFloor\[2\]\[10\]; |                      |
|                      |                      |                      |
|                      | int                  |                      |
|                      | nois                 |                      |
|                      | e\_level\[2\]\[10\]; |                      |
|                      |                      |                      |
|                      | int                  |                      |
|                      | sfb\_nrg\_c          |                      |
|                      | oupling\[2\]\[135\]; |                      |
|                      |                      |                      |
|                      | int                  |                      |
|                      | noise\_level\_       |                      |
|                      | coupling\[2\]\[10\]; |                      |
|                      |                      |                      |
|                      | int maxQuantError;   |                      |
+----------------------+----------------------+----------------------+
| EncodePsFrame        | struct \*pms;        | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*iBufferLeft,     |                      |
|                      |                      | 4                    |
|                      | float                |                      |
|                      | \*\*rBufferLeft,     | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*iBufferRight,    |                      |
|                      |                      | 28                   |
|                      | float                |                      |
|                      | \*\*rBufferRight     | 16                   |
|                      |                      |                      |
|                      | int env, i, bin,     | = 64                 |
|                      | subband, maxSubband, |                      |
|                      | startSample,         |                      |
|                      | stopSample;          |                      |
|                      |                      |                      |
|                      | float                |                      |
|                      | \*\*hybrLeftImag,    |                      |
|                      | \*\*hybrLeftReal,    |                      |
|                      | \*\*hybrRightImag,   |                      |
|                      | \*\*hybrRightReal;   |                      |
+----------------------+----------------------+----------------------+
| HybridAnalysis       | const float          | 4                    |
|                      | \*\*mQmfReal;        |                      |
|                      |                      | 4                    |
|                      | const float          |                      |
|                      | \*\*mQmfImag;        | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*mHybridReal;     |                      |
|                      |                      | 4                    |
|                      | float                |                      |
|                      | \*\*mHybridImag;     | 8                    |
|                      |                      |                      |
|                      | struct \*hHybrid;    | 4                    |
|                      |                      |                      |
|                      | int n, band;         | 4                    |
|                      |                      |                      |
|                      | enum hybridRes;      | = 36                 |
|                      |                      |                      |
|                      | int chOffset;        |                      |
+----------------------+----------------------+----------------------+
| e                    | const float          | 4                    |
| ightChannelFiltering | \*pQmfReal;          |                      |
|                      |                      | 4                    |
|                      | const float          |                      |
|                      | \*pQmfImag;          | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*mHybridReal;     |                      |
|                      |                      | 8                    |
|                      | float                |                      |
|                      | \*\*mHybridImag;     | 8                    |
|                      |                      |                      |
|                      | int i, n;            | 4                    |
|                      |                      |                      |
|                      | float real, imag;    | 64                   |
|                      |                      |                      |
|                      | int midTap;          | = 100                |
|                      |                      |                      |
|                      | float cum\[16\];     |                      |
+----------------------+----------------------+----------------------+
| CFFTN                | float \*afftData;    | 4                    |
|                      |                      |                      |
|                      | int len;             | 4                    |
|                      |                      |                      |
|                      | int isign;           | 4                    |
|                      |                      |                      |
|                      |                      | = 12                 |
+----------------------+----------------------+----------------------+
| cfftn                | float Re\[\];        | 4                    |
|                      |                      |                      |
|                      | float Im\[\];        | 4                    |
|                      |                      |                      |
|                      | int nTotal;          | 4                    |
|                      |                      |                      |
|                      | int nPass;           | 4                    |
|                      |                      |                      |
|                      | int nSpan;           | 4                    |
|                      |                      |                      |
|                      | int iSign;           | 4                    |
|                      |                      |                      |
|                      | int ii, mfactor,     | 76                   |
|                      | kspan, ispan, inc,   |                      |
|                      | j, jc, jf, jj, k,    | 72                   |
|                      | k1, k2, k3, k4, kk,  |                      |
|                      | kt, nn, ns, nt;      | 56                   |
|                      |                      |                      |
|                      | double radf, c1, c2, | 184                  |
|                      | c3, cd, s1, s2, s3,  |                      |
|                      | sd;                  | 368                  |
|                      |                      |                      |
|                      | float ak, bk, akp,   | 836                  |
|                      | bkp, ajp, bjp, ajm,  |                      |
|                      | bjm, akm, bkm, aj,   | 44                   |
|                      | bj, aa, bb;          |                      |
|                      |                      | 32                   |
|                      | float Rtmp\[23\],    |                      |
|                      | Itmp\[23\];          | = 1692               |
|                      |                      |                      |
|                      | double Cos\[23\],    |                      |
|                      | Sin\[23\];           |                      |
|                      |                      |                      |
|                      | int Perm\[209\];     |                      |
|                      |                      |                      |
|                      | int factor \[11\];   |                      |
|                      |                      |                      |
|                      | double s60, c72,     |                      |
|                      | s72, pi2;            |                      |
+----------------------+----------------------+----------------------+
|                      | **Sum**              | **4900**             |
+----------------------+----------------------+----------------------+

Table 14: Decoder call stack

+----------------------+----------------------+----------------------+
| Function             | Local variables      | Stack used \[bytes\] |
+----------------------+----------------------+----------------------+
| main()               | int endOfFile;       | 4                    |
|                      |                      |                      |
|                      | char frameOk;        | 1                    |
|                      |                      |                      |
|                      | int i;               | 4                    |
|                      |                      |                      |
|                      | int written16;       | 4                    |
|                      |                      |                      |
|                      | char channelMode;    | 1                    |
|                      |                      |                      |
|                      | struct \*hBitBuf;    | 4                    |
|                      |                      |                      |
|                      | struct               | 4                    |
|                      | \*aacDecoderInfo;    |                      |
|                      |                      | 576                  |
|                      | struct \*streamSBR;  |                      |
|                      |                      | 4                    |
|                      | struct               |                      |
|                      | \*sbrDecoderInfo;    | 4                    |
|                      |                      |                      |
|                      | struct \*            | 4                    |
|                      | splineResampler;     |                      |
|                      |                      | 8                    |
|                      | int frameSize;       |                      |
|                      |                      | 4                    |
|                      | int sampleRate,      |                      |
|                      | outputSampleRate;    | 4                    |
|                      |                      |                      |
|                      | int numChannels;     | 4                    |
|                      |                      |                      |
|                      | int numOutSamples;   | 8                    |
|                      |                      |                      |
|                      | int bDownSample;     | 4                    |
|                      |                      |                      |
|                      | int fosr16, fosr8;   | 4                    |
|                      |                      |                      |
|                      | int                  | = 646                |
|                      | bBitstreamDownMix;   |                      |
|                      |                      |                      |
|                      | int bValidMode;      |                      |
+----------------------+----------------------+----------------------+
| applySBR()           | struct \*self;       | 4                    |
|                      |                      |                      |
|                      | struct \*Bitstr;     | 4                    |
|                      |                      |                      |
|                      | float \*timeData;    | 4                    |
|                      |                      |                      |
|                      | int \*numChannels;   | 4                    |
|                      |                      |                      |
|                      | int SbrFrameOK;      | 4                    |
|                      |                      |                      |
|                      | int bDownSample;     | 4                    |
|                      |                      |                      |
|                      | int                  | 4                    |
|                      | bBitstreamDownMix;   |                      |
|                      |                      | 2                    |
|                      | unsigned char i,     |                      |
|                      | dualMono;            | 20                   |
|                      |                      |                      |
|                      | int stereo, CRCLen,  | 4                    |
|                      | crcEnable,           |                      |
|                      | readHeader, err;     | 16                   |
|                      |                      |                      |
|                      | struct \*SbrChannel; | 4                    |
|                      |                      |                      |
|                      | struct bitBuf;       | 4                    |
|                      |                      |                      |
|                      | struct               | 4                    |
|                      | \*hHeaderData;       |                      |
|                      |                      | 4                    |
|                      | enum headerStatus;   |                      |
|                      |                      | 4                    |
|                      | int codecFrameSize;  |                      |
|                      |                      | 4                    |
|                      | enum                 |                      |
|                      | initialSyncState;    | 4                    |
|                      |                      |                      |
|                      | struct               | 4                    |
|                      | \*hConcealData;      |                      |
|                      |                      | = 102                |
|                      | float                |                      |
|                      | \*pWorkBuffer1;      |                      |
|                      |                      |                      |
|                      | struct               |                      |
|                      | \*hFrameDataLeft;    |                      |
|                      |                      |                      |
|                      | struct               |                      |
|                      | \*hFrameDataRight;   |                      |
+----------------------+----------------------+----------------------+
| sbr\_dec()           | struct \*hSbrDec;    | 4                    |
|                      |                      |                      |
|                      | float \*timeIn;      | 4                    |
|                      |                      |                      |
|                      | float \*timeOut;     | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*interimResult;     |                      |
|                      |                      | 4                    |
|                      | struct               |                      |
|                      | \*hHeaderData;       | 4                    |
|                      |                      |                      |
|                      | struct \*hFrameData; | 4                    |
|                      |                      |                      |
|                      | struct               | 4                    |
|                      | \*hPrevFrameData;    |                      |
|                      |                      | 4                    |
|                      | int applyProcessing; |                      |
|                      |                      | 4                    |
|                      | struct \*h\_ps\_d;   |                      |
|                      |                      | 4                    |
|                      | struct               |                      |
|                      | \*hSy                | 20                   |
|                      | nthesisQmfBankRight; |                      |
|                      |                      | 152                  |
|                      | int nChannels;       |                      |
|                      |                      | 152                  |
|                      | int i, k, slot,      |                      |
|                      | ov\_len, bUseLP;     | 4                    |
|                      |                      |                      |
|                      | float                | 12                   |
|                      | \*                   |                      |
|                      | QmfBufferReal\[38\]; | = 384                |
|                      |                      |                      |
|                      | float                |                      |
|                      | \*                   |                      |
|                      | QmfBufferImag\[38\]; |                      |
|                      |                      |                      |
|                      | float \*ptr;         |                      |
|                      |                      |                      |
|                      | int noCols, halflen, |                      |
|                      | islots;              |                      |
+----------------------+----------------------+----------------------+
| cplxSyn              | float \*\*qmfReal;   | 4                    |
| thesisQmfFiltering() |                      |                      |
|                      | float \*\*qmfImag;   | 4                    |
|                      |                      |                      |
|                      | float \*timeout;     | 4                    |
|                      |                      |                      |
|                      | struct \*synQmf;     | 4                    |
|                      |                      |                      |
|                      | int bUseLP;          | 4                    |
|                      |                      |                      |
|                      | struct \*h\_ps\_dec; | 4                    |
|                      |                      |                      |
|                      | int active;          | 4                    |
|                      |                      |                      |
|                      | int i, j;            | 8                    |
|                      |                      |                      |
|                      | float                | 8                    |
|                      | \*ptr\_time\_out,    |                      |
|                      | \*filterStates;      | 4                    |
|                      |                      |                      |
|                      | float accu;          | 4                    |
|                      |                      |                      |
|                      | int p;               | 256                  |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | qmfReal2\[64\];      |                      |
|                      |                      | 4                    |
|                      | float \*imagSlot;    |                      |
|                      |                      | 4                    |
|                      | int                  |                      |
|                      | no\_                 | 256                  |
|                      | synthesis\_channels; |                      |
|                      |                      | 256                  |
|                      | int                  |                      |
|                      | qmf\_filte           | 4                    |
|                      | r\_state\_syn\_size; |                      |
|                      |                      | 4                    |
|                      | float                |                      |
|                      | mfRealTmp\[64\];     | = 840                |
|                      |                      |                      |
|                      | float                |                      |
|                      | qmfImagTmp\[64\];    |                      |
|                      |                      |                      |
|                      | int env;             |                      |
|                      |                      |                      |
|                      | const float          |                      |
|                      | \*p\_filter;         |                      |
+----------------------+----------------------+----------------------+
| ApplyPsSlot()        | struct \*h\_ps\_dec; | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*rIntBufferLeft;  |                      |
|                      |                      | 4                    |
|                      | float                |                      |
|                      | \*\*iIntBufferLeft;  | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*rIntBufferRight;   |                      |
|                      |                      | = 20                 |
|                      | float                |                      |
|                      | \*iIntBufferRight;   |                      |
+----------------------+----------------------+----------------------+
| HybridAnalysis()     | const float          | 4                    |
|                      | \*\*mQmfReal;        |                      |
|                      |                      | 4                    |
|                      | const float          |                      |
|                      | \*\*mQmfImag;        | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*mHybridReal;     |                      |
|                      |                      | 4                    |
|                      | float                |                      |
|                      | \*\*mHybridImag;     | 8                    |
|                      |                      |                      |
|                      | struct \*hHybrid;    | 4                    |
|                      |                      |                      |
|                      | int n, band;         | 4                    |
|                      |                      |                      |
|                      | enum hybridRes;      | = 36                 |
|                      |                      |                      |
|                      | int chOffset;        |                      |
+----------------------+----------------------+----------------------+
| eig                  | const float          | 4                    |
| htChannelFiltering() | \*pQmfReal;          |                      |
|                      |                      | 4                    |
|                      | const float          |                      |
|                      | \*pQmfImag;          | 4                    |
|                      |                      |                      |
|                      | float                | 4                    |
|                      | \*\*mHybridReal;     |                      |
|                      |                      | 8                    |
|                      | float                |                      |
|                      | \*\*mHybridImag;     | 8                    |
|                      |                      |                      |
|                      | int i, n;            | 4                    |
|                      |                      |                      |
|                      | float real, imag;    | 64                   |
|                      |                      |                      |
|                      | int midTap;          | = 100                |
|                      |                      |                      |
|                      | float cum\[16\];     |                      |
+----------------------+----------------------+----------------------+
| CFFTN()              | float \*afftData;    | 4                    |
|                      |                      |                      |
|                      | int len;             | 4                    |
|                      |                      |                      |
|                      | int isign;           | 4                    |
|                      |                      |                      |
|                      |                      | = 12                 |
+----------------------+----------------------+----------------------+
| cfftn()              | float Re\[\];        | 4                    |
|                      |                      |                      |
|                      | float Im\[\];        | 4                    |
|                      |                      |                      |
|                      | int nTotal;          | 4                    |
|                      |                      |                      |
|                      | int nPass;           | 4                    |
|                      |                      |                      |
|                      | int nSpan;           | 4                    |
|                      |                      |                      |
|                      | int iSign;           | 4                    |
|                      |                      |                      |
|                      | int ii, mfactor,     | 76                   |
|                      | kspan, ispan, inc,   |                      |
|                      | j, jc, jf, jj, k,    | 72                   |
|                      | k1, k2, k3, k4, kk,  |                      |
|                      | kt, nn, ns, nt;      | 56                   |
|                      |                      |                      |
|                      | double radf, c1, c2, | 184                  |
|                      | c3, cd, s1, s2, s3,  |                      |
|                      | sd;                  | 368                  |
|                      |                      |                      |
|                      | float ak, bk, akp,   | 836                  |
|                      | bkp, ajp, bjp, ajm,  |                      |
|                      | bjm, akm, bkm, aj,   | 44                   |
|                      | bj, aa, bb;          |                      |
|                      |                      | 32                   |
|                      | float Rtmp\[23\],    |                      |
|                      | Itmp\[23\];          | = 1692               |
|                      |                      |                      |
|                      | double Cos\[23\],    |                      |
|                      | Sin\[23\];           |                      |
|                      |                      |                      |
|                      | int Perm\[209\];     |                      |
|                      |                      |                      |
|                      | int factor \[11\];   |                      |
|                      |                      |                      |
|                      | double s60, c72,     |                      |
|                      | s72, pi2;            |                      |
+----------------------+----------------------+----------------------+
|                      | **Sum**              | **3832**             |
+----------------------+----------------------+----------------------+

5 File formats
==============

This clause describes the file formats used by the encoder and decoder
programs.

5.1 Audio input file (encoder input/decoder output)
---------------------------------------------------

The audio input files read by the encoder and written by the decoder are
16-bit PCM wave files. For convenient handling of wave files a
precompiled audio-fileformat library is used.

5.2 Bitstream file format (encoder output/decoder input)
--------------------------------------------------------

The encoder program writes and the decoder program reads raw frames
packetized in access units as described by 3GPP TS 26.244. For
packetization the ISO media library is used. A precompiled library is
used.

5.3 Error pattern file (decoder input)
--------------------------------------

The decoder program can optionally process an additional input file
which describes an error pattern. The format of the error pattern file
is 1 character per line. Each line corresponds to one frame, where a
\"0\" indicates that the respective frame has been transmitted without
errors, while a \"1\" indicates that the corresponding frame has been
lost and error concealment shall be applied by the decoder.

######## Annex A (informative): Weighted MOPS and PROM

The complexity numbers for the Enhanced aacPlus audio codec can be found
in the following table, the numbers have been derived using the
\"allcat.wav\" item, which holds all the material from the selection
test concatenated in one single item. For every test case the average
and worst frame weighted MOPS figure has been derived. The worst case
wMOPS figure over all test cases has been marked in **blue**.

Table A.1 : Weighted MOPS and PROM figures

+----------+----------+----------+----------+----------+----------+
|          | Test     | Mono     | Stereo   | Decoder  | Decoder, |
|          | Case     | Encoder  | Encoder  |          | mono     |
|          |          |          |          |          | only     |
+----------+----------+----------+----------+----------+----------+
| *        | 14m      | 15.23 /  | 15.36 /  | 9.38 /   | 8.07 /   |
| *wMOPS** |          | 16.98    | 17.21    | 10.07    | 8.78     |
|          |          |          |          |          |          |
| **\      |          |          |          |          |          |
| [average |          |          |          |          |          |
| /\       |          |          |          |          |          |
| worst    |          |          |          |          |          |
| f        |          |          |          |          |          |
| rame\]** |          |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
|          | 18s      | \-\--    | 25.79 /  | 19.48 /  | 8.31 /   |
|          |          |          | 28.36    | 20.35    | 9.17     |
+----------+----------+----------+----------+----------+----------+
|          | 24m      | **16.72  | 16.86 /  | 10.30 /  | 8.89 /   |
|          |          | /        | 19.14    | 11.39    | 9.94     |
|          |          | 18.93**  |          |          |          |
+----------+----------+----------+----------+----------+----------+
|          | 24s      | \-\--    | 27.01 /  | 20.45 /  | 8.82 /   |
|          |          |          | 29.85    | 21.63    | 9.93     |
+----------+----------+----------+----------+----------+----------+
|          | 32s      | \-\--    | 27.49 /  | **21.08  | 9.28 /   |
|          |          |          | 29.97    | /        | 10.58    |
|          |          |          |          | 22.42**  |          |
+----------+----------+----------+----------+----------+----------+
|          | 48s      | \-\--    | **35.22  | 17.96 /  | **12.42  |
|          |          |          | /        | 20.26    | /        |
|          |          |          | 42.22**  |          | 14.32**  |
+----------+----------+----------+----------+----------+----------+
|          | 14m, 16  | 15.42 /  | 15.47 /  | 7.85 /   | 7.85 /   |
|          | kHz      | 18.41    | 18.46    | 8.61     | 8.60     |
+----------+----------+----------+----------+----------+----------+
|          | 14m, 3%  | \-\--    | \-\--    | 9.38 /   | 8.07 /   |
|          | FER      |          |          | 10.07    | 8.78     |
+----------+----------+----------+----------+----------+----------+
|          | 24s, 3%  | \-\--    | \-\--    | 20.45 /  | 8.81 /   |
|          | FER      |          |          | 21.63    | 9.93     |
+----------+----------+----------+----------+----------+----------+
|          | 32s,     | \-\--    | \-\--    | **21.08  | 9.28 /   |
|          | 1%FER    |          |          | /        | 10.58    |
|          |          |          |          | 22.42**  |          |
+----------+----------+----------+----------+----------+----------+
|          | 32s,     | \-\--    | \-\--    | 21.08 /  | 9.27 /   |
|          | 3%FER    |          |          | 22.38    | 10.58    |
+----------+----------+----------+----------+----------+----------+
| Program  | *        | *        | *        | **8048** | **6209** |
| ROM      | *\-\--** | *12540** | *14365** |          |          |
| \[ops\]  |          |          |          |          |          |
+----------+----------+----------+----------+----------+----------+

######## Annex B (informative): Change history

  -------------------- -------------- -------------- -------- --------- ------------------------------------------------------------------------------------------------------------ --------- ---------
  **Change history**                                                                                                                                                                           
  **Date**             **TSG SA\#**   **TSG Doc.**   **CR**   **Rev**   **Subject/Comment**                                                                                          **Old**   **New**
  2004-09              25             SP-040638                         Approved at SA\#25                                                                                           2.0.0     6.0.0
  2004-12              26             SP-040840      001                Correction to C-code to increase error robustness                                                            6.0.0     6.1.0
  2004-12              26             SP-040840      002                Correction to C-code: Missing memory re-initialization                                                       6.0.0     6.1.0
  2004-12              26             SP-040840      003                Correction to C-code: Memory initialization added                                                            6.0.0     6.1.0
  2004-12              26             SP-040840      004                Correction to C-code: Wrong calculation of sine levels                                                       6.0.0     6.1.0
  2004-12              26             SP-040840      005                Correction to C-code: Prevent multiple reading of bitstream elements                                         6.0.0     6.1.0
  2004-12              26             SP-040840      006      2         Correction to C-code: Corrected wrong table values                                                           6.0.0     6.1.0
  2004-12              26             SP-040840      007                Correction to C-code: Modify instrumentation                                                                 6.0.0     6.1.0
  2004-12              26             SP-040840      008      1         Correction of C-code: Output data was copied into wrong array                                                6.0.0     6.1.0
  2004-12              26             SP-040840      009      1         Correction to C-code: Bug in resampler                                                                       6.0.0     6.1.0
  2004-12              26             SP-040840      010      1         Correction to C-code: Modify data types for FFT                                                              6.0.0     6.1.0
  2004-12              26             SP-040840      011      1         Correction to decoder C-Code: Alignment with MPEG specification                                              6.0.0     6.1.0
  2004-12              26             SP-040840      012                Correction to C-code: Reset of Missing Harmonics flags during concealment added                              6.0.0     6.1.0
  2004-12              26             SP-040840      013                Removal of Complexity counters                                                                               6.0.0     6.1.0
  2005-01                                                               File \"env\_calc.c\" replaced in the attached ANSI-C code                                                    6.1.0     6.1.1
  2005-03              27             SP-050095      014      1         Correction to C-code: 3GPP file format wrong writing of brand                                                6.1.1     6.2.0
  2005-03              27             SP-050095      015      1         Correction to C-code: remove copyright notice from 3GPP file format header files                             6.1.1     6.2.0
  2005-03              27             SP-050095      016      1         Correction to C-code: add capability for 10 kbit/s, mono encoding                                            6.1.1     6.2.0
  2005-03              27             SP-050095      017      1         Correction to C-code: add capability for data stream element parsing                                         6.1.1     6.2.0
  2005-03              27             SP-050095      018      1         Correction to C-code: PNS decoding algorithm not conform to MPEG                                             6.1.1     6.2.0
  2005-03              27             SP-050095      019      1         Correction to C-code: the decoder mono only compile target not working correctly                             6.1.1     6.2.0
  2005-03              27             SP-050095      020      1         Correction to C-code: PS-decoding with varying upper frequency border not working correctly                  6.1.1     6.2.0
  2005-03              27             SP-050095      021      1         Correction to C-code: PS-decoding with variable framing not working correctly                                6.1.1     6.2.0
  2005-03              27             SP-050095      022                Correction to written specification: move WMOPS numbers to informative Annex                                 6.1.1     6.2.0
  2005-06              28             SP-050251      023                Correction to C-code: 10 kbit/s mono encoding with stereo input files failed                                 6.2.0     6.3.0
  2005-09              29             SP-050426      0024               Correction to C-Code: Enable 44.1 kHz input material encoding (floating-point code)                          6.3.0     6.4.0
  2005-09              29             SP-050426      0025               Correction of C-Code: removal of obsolete table (floating-point code)                                        6.3.0     6.4.0
  2005-12              30             SP-050786      0027               Correction to C-code: encoder bitrate switching simulation toolset                                           6.4.0     6.5.0
  2005-12              30             SP-050786      0028               Correction to C-code: encoder tuning table entry for 44.1 kHz was wrong                                      6.4.0     6.5.0
  2005-12              30             SP-050786      0029               Correction to C-code: fix to make decoder more robust against corrupt input data                             6.4.0     6.5.0
  2005-12              30             SP-050786      0030               Correction to C-code: removal of unused coefficients in resampler                                            6.4.0     6.5.0
  2006-03              31             SP-060013      0031               Correction to C-code: encoder switch is wrong                                                                6.5.0     6.6.0
  2006-09              33             SP-060595      0034     1         Correction of written specification: correct memory tables (floating-point code)                             6.6.0     6.7.0
  2006-09              33             SP-060601      0032     2         Modification of C-code: Change of encoder bitrate border for Parametric Stereo usage (floating-point code)   6.7.0     7.0.0
  2006-12              34             SP-060849      0035               Correction to C-code: Correct the maximum possible SBR payload size (floating point code)                    7.0.0     7.1.0
  2007-09              37             SP-070628      0038     1         Adding safety code to avoid encoder runtime-assertion                                                        7.1.0     7.2.0
  2008-12              42                                               Version for Release 8                                                                                        7.2.0     8.0.0
  2009-12              46                                               Version for Release 9                                                                                        8.0.0     9.0.0
  2011-03              51                                               Version for Release 10                                                                                       9.0.0     10.0.0
  2012-09              57                                               Version for Release 11                                                                                       10.0.0    11.0.0
  2014-09              65                                               Version for Release 12                                                                                       11.0.0    12.0.0
  2015-12              70                                               Version for Release 13                                                                                       12.0.0    13.0.0
  -------------------- -------------- -------------- -------- --------- ------------------------------------------------------------------------------------------------------------ --------- ---------

  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
  **Change history**                                                                                          
  **Date**             **Meeting**   **TDoc**   **CR**   **Rev**   **Cat**   **Subject/Comment**              **New version**
  2017-03              75                                                    Version for Release 14           14.0.0
  2018-06              80                                                    Version for Release 15           15.0.0
  2020-07              \-            \-         \-       \-        \-        Update to Rel-16 version (MCC)   **16.0.0**
  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
