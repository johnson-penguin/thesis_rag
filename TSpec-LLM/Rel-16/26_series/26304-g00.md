![](media/image1.jpeg){width="7.086111111111111in"
height="1.136111111111111in"}

Contents {#contents .TT}
========

[4](#foreword)

[5](#scope)

[5](#references)

[5](#definitions-symbols-and-abbreviations)

[5](#definitions)

[5](#abbreviations)

[6](#c-code-structure)

[6](#contents-of-the-c-source-code)

[6](#program-execution)

[6](#code-hierarchy)

[19](#variables-constants-and-tables)

[19](#description-of-fixed-tables-used-in-the-c-code)

[20](#static-variables-used-in-the-c-code)

[24](#file-formats)

[24](#audio-file-encoder-inputdecoder-output)

[25](#parameter-bitstream-file-encoder-outputdecoder-input)

[26](#annex-a-informative-amr-wb-user-guide)

[26](#a.1-encoder-usage)

[26](#a.1.1-simple-mode)

[27](#a.1.2-flexible-mode)

[31](#a.2-decoder-usage)

[32](#annex-b-informative-change-history)Foreword 1 Scope 2 References 3
Definitions, symbols and abbreviations 3.1 Definitions 3.2 Abbreviations
4 C code structure 4.1 Contents of the C source code 4.2 Program
execution 4.3 Code hierarchy 4.4 Variables, constants and tables 4.4.1
Description of fixed tables used in the C-code 4.4.2 Static variables
used in the C-code 5 File formats 5.1 Audio file (encoder input/decoder
output) 5.2 Parameter bitstream file (encoder output/decoder input)
Annex A (informative): AMR-WB+ user guide A.1 Encoder usage A.1.1 Simple
mode A.1.2 Flexible mode A.2 Decoder usage Annex B (informative): Change
history

Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

1 Scope
=======

The present document contains an electronic copy of the ANSI‑C code for
the Floating-point Extended Adaptive Multi-Rate Wideband codec.
Alternatively, fixed-point ANSI-C code is specified in 3GPP TS 26.273
\[1\]. The floating-point codec/encoder/decoder specified in this
document or the fixed-point codec/encoder/decoder specified in \[1\] may
be used depending on if the implementation platform is better suited for
a floating-point or a fixed-point implementation. It has been verified
that the fixed-point and floating-point codecs interoperate with each
other without any artifacts.

The floating-point ANSI‑C code in the present document defines, besides
the fixed-point c-code specified in \[1\], one valid reference
implementation of the Extended Adaptive Multi-Rate Wideband transcoder
(3GPP TS 26.290 \[2\]). Standard conformance is enforced by meeting the
conformance criteria defined in \[3\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TS 26.273: \"ANSI-C code for the Fixed-point Extended AMR
Wideband codec\".

\[2\] 3GPP TS 26.290: \" Audio codec processing functions; Extended AMR
Wideband codec; Transcoding functions \".

\[3\] 3GPP TS 26.274: \" Audio codec processing functions; Extended
Adaptive Multi-Rate - Wideband (AMR-WB+) codec; Conformance testing \".

\[4\] 3GPP TS 26.244: \"Transparent end-to-end packet switched streaming
service (PSS); 3GPP file format (3GP)\"

3 Definitions, symbols and abbreviations
========================================

3.1 Definitions
---------------

For the purposes of the present document, the terms and definitions are
given in TS 26.290 \[2\].

3.2 Abbreviations
-----------------

For the purposes of the present document, the following abbreviations
apply:

AMR-WB+ Extended Adaptive Multi-Rate WideBand

ANSI American National Standards Institute

GSM Global System for Mobile communications

I/O Input/Output

RAM Random Access Memory

ROM Read Only Memory

4 C code structure
==================

This clause gives an overview of the structure of the C code and
provides an overview of the contents and organization of the C code
attached to the present document.

The C code has been verified on the following systems:

\- IBM PC/AT compatible computers with Windows 2000 SP4 and Microsoft
Visual C++ v.6.0 compiler.

ANSI‑C was selected as the programming language because portability was
desirable.

4.1 Contents of the C source code
---------------------------------

The C code distribution has the files divided in five different
directories, all present in the directory *c-code*. The directories are:
*common, decoder, encoder, lib\_amr* and *include*. The distributed
files with suffix \"c\" contain the source code and the files with
suffix \"h\" are the header files.

Project and workspace files are provided in the directory *MSVC*.

4.2 Program execution
---------------------

The Extended Adaptive Multi-Rate Wideband codec is implemented in two
programs:

*-* (*encoder*) audio encoder;

*-* (*decoder*) audio decoder.

The programs should be called like:

\- encoder \[encoder options\] --if \<audio input file\> -of \<parameter
file\>;

\- decoder \[decoder options\] --if \<parameter file\> -of \<audio
output file\>.

The input files contain one or two channels of 16-bit linear encoded PCM
audio samples stored in the *wav* file format and the parameter files
contain encoded audio data and some additional flags.

The encoder and decoder options will be explained by running the
applications without input arguments. See the file readme.txt for more
information on how to run the *encoder* and *decoder* programs.

4.3 Code hierarchy
------------------

Tables 1 and 2 are call graphs that show the functions used in the audio
codec.

Each column represents a call level and each cell a function. The
functions contain calls to the functions in rightwards neighbouring
cells. The time order in the call graphs is from the top downwards as
the processing of a frame advances. All standard C functions: memcpy(),
fwrite(), etc. have been omitted. The initialization of the static RAM
(i.e. calling the \_init functions) is also omitted.

Table 1: Encoder call structure

  ---------------------------- --------------------------- ------------------------------ ------------------------------------ ---------------------------------- --------------------------- --------------------------------------------- ---------- ------------------------
  coder\_amrwb\_plus\_stereo                                                                                                                                                                                                                           
                               decim\_12k8                                                                                                                                                                                                             
                                                           interpol                                                                                                                                                                                    
                               hp50\_12k8                                                                                                                                                                                                              
                               mix\_ch                                                                                                                                                                                                                 
                               E\_UTIL\_f\_preemph                                                                                                                                                                                                     
                               mvr2r                                                                                                                                                                                                                   
                               coder\_lf                                                                                                                                                                                                               
                                                           mvr2r                                                                                                                                                                                       
                                                           E\_UTIL\_autocorr                                                                                                                                                                           
                                                           lag\_wind                                                                                                                                                                                   
                                                           E\_LPC\_lev\_dur                                                                                                                                                                            
                                                           E\_LPC\_a\_isp\_conversion                                                                                                                                                                  
                                                                                          E\_LPC\_chebyshev                                                                                                                                            
                                                           int\_lpc\_npl                                                                                                                                                                               
                                                                                          E\_LPC\_f\_isp\_a\_conversion                                                                                                                                
                                                                                                                               E\_LPC\_isp\_f\_pol\_get                                                                                                
                                                           find\_wsp                                                                                                                                                                                   
                                                                                          E\_LPC\_a\_weight                                                                                                                                            
                                                                                          E\_UTIL\_residu                                                                                                                                              
                                                                                          E\_UTIL\_deemph                                                                                                                                              
                                                           E\_GAIN\_lp\_decim2                                                                                                                                                                         
                                                           E\_GAIN\_open\_loop\_search                                                                                                                                                                 
                                                           E\_GAIN\_olag\_med                                                                                                                                                                          
                                                                                          E\_GAIN\_sort                                                                                                                                                
                                                           E\_LPC\_isp\_isf\_conversion                                                                                                                                                                
                                                           qpisf\_2s\_46b                                                                                                                                                                              
                                                                                          VQ\_stage1(qpisf\_2s.c)                                                                                                                                      
                                                                                          sub\_VQ(qpisf\_2c.c)                                                                                                                                         
                                                                                          qpisf\_2s\_46b                                                                                                                                               
                                                                                                                               E\_LPC\_isf\_reorderPlus                                                                                                
                                                           isf2isp                                                                                                                                                                                     
                                                           coder\_acelp                                                                                                                                                                                
                                                                                          E\_UTIL\_residu                                                                                                                                              
                                                                                          E\_LPC\_a\_weight                                                                                                                                            
                                                                                          E\_UTIL\_deemph                                                                                                                                              
                                                                                          mvr2r                                                                                                                                                        
                                                                                          set\_zero                                                                                                                                                    
                                                                                          E\_UTIL\_synthesis                                                                                                                                           
                                                                                          E\_UTIL\_f\_preemph                                                                                                                                          
                                                                                          E\_GAIN\_closed\_loop\_search                                                                                                                                
                                                                                                                               E\_GAIN\_norm\_corr                                                                                                     
                                                                                                                                                                  E\_UTIL\_f\_convolve                                                                 
                                                                                                                               E\_GAIN\_norm\_corr\_interpolate                                                                                        
                                                                                          pred\_lt4                                                                                                                                                    
                                                                                          E\_UTIL\_f\_convolve                                                                                                                                         
                                                                                          E\_ACELP\_xy1\_corr                                                                                                                                          
                                                                                          E\_ACELP\_codebook\_target\_update                                                                                                                           
                                                                                          E\_GAIN\_f\_pitch\_sharpening                                                                                                                                
                                                                                          E\_ACELP\_xh\_corr                                                                                                                                           
                                                                                          E\_ACELP\_4t                                                                                                                                                 
                                                                                                                               E\_ACELP\_h\_vec\_corr1                                                                                                 
                                                                                                                               E\_ACELP\_h\_vec\_corr2                                                                                                 
                                                                                                                               E\_ACELP\_2pulse\_search                                                                                                
                                                                                                                               E\_ACELP\_quant\_4p\_4N                                                                                                 
                                                                                                                                                                  E\_ACELP\_quant\_1p\_N1                                                              
                                                                                                                                                                  E\_ACELP\_quant\_3p\_3N1                                                             
                                                                                                                                                                                              E\_ACELP\_quant\_2p\_2N2                                 
                                                                                                                                                                                              E\_ACELP\_quant\_1p\_N1                                  
                                                                                                                                                                  E\_ACELP\_quant\_4p\_4N1                                                             
                                                                                                                                                                                              E\_ACELP\_quant\_2p\_2N2                                 
                                                                                                                                                                  E\_ACELP\_quant\_2p\_2N2                                                             
                                                                                          E\_ACELP\_xy2\_corr                                                                                                                                          
                                                                                          q\_gain2\_plus                                                                                                                                               
                                                           segsnr                                                                                                                                                                                      
                                                           coder\_tcx                                                                                                                                                                                  
                                                                                          cos\_window                                                                                                                                                  
                                                                                          E\_LPC\_a\_weight                                                                                                                                            
                                                                                          E\_UTIL\_residu                                                                                                                                              
                                                                                          E\_UTIL\_deemph                                                                                                                                              
                                                                                          fft9                                                                                                                                                         
                                                                                                                               fft\_rel                                                                                                                
                                                                                          adap\_low\_freq\_emph                                                                                                                                        
                                                                                          AVQ\_cod                                                                                                                                                     
                                                                                                                               RE8\_PPV                                                                                                                
                                                                                                                                                                  nearest\_neighbor\_2D8                                                               
                                                                                          adap\_lo\_freq\_deemph                                                                                                                                       
                                                                                          ifft9                                                                                                                                                        
                                                                                                                               ifft\_rel                                                                                                               
                                                                                          get\_gain                                                                                                                                                    
                                                                                          q\_gain\_tcx                                                                                                                                                 
                                                                                          E\_UTIL\_f\_preemph                                                                                                                                          
                                                                                          E\_UTIL\_synthesis                                                                                                                                           
                                                           mvi2i                                                                                                                                                                                       
                               coder\_hf                                                                                                                                                                                                               
                                                           E\_UTIL\_autocorr                                                                                                                                                                           
                                                           lag\_wind                                                                                                                                                                                   
                                                           E\_LPC\_lev\_dur                                                                                                                                                                            
                                                           E\_LPC\_a\_isp\_conversion                                                                                                                                                                  
                                                                                          E\_LPC\_chebyshev                                                                                                                                            
                                                           int\_lpc\_npl                                                                                                                                                                               
                                                                                          E\_LPC\_f\_isp\_a\_conversion                                                                                                                                
                                                                                                                               E\_LPC\_isp\_f\_pol\_get                                                                                                
                                                           mvr2r                                                                                                                                                                                       
                                                           E\_LPC\_isp\_isf\_conversion                                                                                                                                                                
                                                           q\_isf\_hf                                                                                                                                                                                  
                                                                                          sub\_VQ(q\_isf\_hf.c)                                                                                                                                        
                                                                                          E\_LPC\_isf\_reorderPlus                                                                                                                                     
                                                           isf2isp                                                                                                                                                                                     
                                                           match\_gain\_6k4                                                                                                                                                                            
                                                                                          set\_zero                                                                                                                                                    
                                                                                          E\_UTIL\_residu                                                                                                                                              
                                                                                          E\_UTIL\_synthesisPlus                                                                                                                                       
                                                           int\_gain                                                                                                                                                                                   
                                                           E\_UTIL\_residu                                                                                                                                                                             
                                                           E\_UTIL\_synthesisPlus                                                                                                                                                                      
                                                           E\_LPC\_a\_weight                                                                                                                                                                           
                                                           E\_UTIL\_residuPlus                                                                                                                                                                         
                                                           q\_gn\_hf                                                                                                                                                                                   
                               band\_split\_taligned\_2k                                                                                                                                                                                               
                                                           interpol                                                                                                                                                                                    
                               coder\_stereo\_x                                                                                                                                                                                                        
                                                           cod\_hi\_stereo                                                                                                                                                                             
                                                                                          mvr2r                                                                                                                                                        
                                                                                          residu                                                                                                                                                       
                                                                                          cholsolc                                                                                                                                                     
                                                                                          smooth\_ener\_filter                                                                                                                                         
                                                                                          quant\_filt                                                                                                                                                  
                                                                                                                               pmsvq                                                                                                                   
                                                                                                                                                                  msvq                                                                                 
                                                                                                                                                                                              m\_cbcod                                                 
                                                                                                                                                                                              min\_msvq                                                
                                                                                          fir\_filt                                                                                                                                                    
                                                                                          my\_max                                                                                                                                                      
                                                                                          quant\_gain                                                                                                                                                  
                                                                                                                               pmsvq                                                                                                                   
                                                                                                                                                                  msvq                                                                                 
                                                                                                                                                                                              m\_cbcod                                                 
                                                           cod\_tcx\_stereo                                                                                                                                                                            
                                                                                          set\_zero                                                                                                                                                    
                                                                                          mvr2r                                                                                                                                                        
                                                                                          ctcx\_stereo                                                                                                                                                 
                                                                                                                               cos\_window                                                                                                             
                                                                                                                               get\_gain                                                                                                               
                                                                                                                               q\_gain\_pan                                                                                                            
                                                                                                                               fft3                                                                                                                    
                                                                                                                                                                  fft\_rel                                                                             
                                                                                                                               adap\_low\_freq\_emph                                                                                                   
                                                                                                                               AVQ\_cod                                                                                                                
                                                                                                                                                                  RE8\_PPV                                                                             
                                                                                                                                                                                              nearest\_neighbor\_2D8                                   
                                                                                                                               adap\_lo\_freq\_deemph                                                                                                  
                                                                                                                               ifft3                                                                                                                   
                                                                                                                                                                  ifft\_rel                                                                            
                                                                                                                               q\_gain\_tcx                                                                                                            
                                                                                          segsnr                                                                                                                                                       
                                                                                          mvi2i                                                                                                                                                        
                               int2bin                                                                                                                                                                                                                 
                               enc\_prm                                                                                                                                                                                                                
                                                           AVQ\_encmux                                                                                                                                                                                 
                                                                                          split\_idx\_noovf                                                                                                                                            
                                                                                                                               sort(avq\_cod.c)                                                                                                        
                                                                                                                               RE8\_cod                                                                                                                
                                                                                                                                                                  RE8\_vor                                                                             
                                                                                                                                                                                              re8\_identify\_absolute                       Leader     
                                                                                                                                                                                              re8\_coord                                               
                                                                                                                                                                                              re8\_k2y                                                 
                                                                                                                                                                                                                                            RE8\_PPV   
                                                                                                                                                                                                                                                       nearest\_neighbor\_2D8
                                                                                                                                                                  re8\_compute\_base\_index                                                            
                                                                                                                                                                                              re8\_compute\_rank\_of\_permutation\_and\_s              
                                                                                                                               calc\_bits                                                                                                              
                                                                                          writ\_all\_nq                                                                                                                                                
                                                                                                                               calc\_bits                                                                                                              
                                                                                          writ\_all\_i                                                                                                                                                 
                                                                                                                               init\_pos\_i\_ovf                                                                                                       
                                                                                                                                                                  chk\_ovf                                                                             
                                                                                                                               chk\_ovf                                                                                                                
                                                                                                                               writ\_I                                                                                                                 
                                                                                                                               writ\_k                                                                                                                 
                                                                                                                               writ\_ovf                                                                                                               
                                                           int2bin                                                                                                                                                                                     
                                                           unpack4bits                                                                                                                                                                                 
                                                                                          int2bin                                                                                                                                                      
                               enc\_prm\_stereo\_x                                                                                                                                                                                                     
                                                           int2bin                                                                                                                                                                                     
                                                           AVQ\_encmux                                                                                                                                                                                 
                                                                                          split\_idx\_noovf                                                                                                                                            
                                                                                                                               sort(avq\_cod.c)                                                                                                        
                                                                                                                               RE8\_cod                                                                                                                
                                                                                                                                                                  RE8\_vor                                                                             
                                                                                                                                                                                              re8\_identify\_absolute                       Leader     
                                                                                                                                                                                              re8\_coord                                               
                                                                                                                                                                                              re8\_k2y                                                 
                                                                                                                                                                                                                                            RE8\_PPV   
                                                                                                                                                                                                                                                       nearest\_neighbor\_2D8
                                                                                                                                                                  re8\_compute\_base\_index                                                            
                                                                                                                                                                                              re8\_compute\_rank\_of\_permutation\_and\_s              
                                                                                                                               calc\_bits                                                                                                              
                                                                                          writ\_all\_nq                                                                                                                                                
                                                                                                                               calc\_bits                                                                                                              
                                                                                          writ\_all\_i                                                                                                                                                 
                                                                                                                               init\_pos\_i\_ovf                                                                                                       
                                                                                                                                                                  chk\_ovf                                                                             
                                                                                                                               chk\_ovf                                                                                                                
                                                                                                                               writ\_I                                                                                                                 
                                                                                                                               writ\_ovf                                                                                                               
                                                                                                                               writ\_k                                                                                                                 
                                                           unpack4bits\_d                                                                                                                                                                              
                                                                                          int2bin                                                                                                                                                      
                               enc\_prm\_hf                                                                                                                                                                                                            
                                                           int2bin                                                                                                                                                                                     
  ---------------------------- --------------------------- ------------------------------ ------------------------------------ ---------------------------------- --------------------------- --------------------------------------------- ---------- ------------------------

Table 2: Decoder call structure

  ---------------------- ------------------------- --------------------------- ----------------------------------- ------------------------------- ------------------------------------ ------------------------------- ------------------------------------ ------------------------
  decoder\_amrwb\_plus                                                                                                                                                                                                                                       
                         bin2int                                                                                                                                                                                                                             
                         dec\_prm                                                                                                                                                                                                                            
                                                   bin2int                                                                                                                                                                                                   
                                                   pack4bits(dec\_prm.c)                                                                                                                                                                                     
                                                                               bin2int                                                                                                                                                                       
                         dec\_prm\_stereo\_x                                                                                                                                                                                                                 
                                                   bin2int                                                                                                                                                                                                   
                                                   pack4bits\_d                                                                                                                                                                                              
                                                                               bin2int                                                                                                                                                                       
                                                   AVQ\_demuxdec                                                                                                                                                                                             
                                                                               read\_all\_nq(avq\_dec.c)                                                                                                                                                     
                                                                                                                   read\_nq(avq\_dec.c)                                                                                                                      
                                                                               read\_all\_i(avq\_dec.c)                                                                                                                                                      
                                                                                                                   init\_pos\_i\_ovf(avq\_dec.c)                                                                                                             
                                                                                                                                                   chk\_ovf(avq\_dec.c)                                                                                      
                                                                                                                   split\_n(avq\_dec.c)                                                                                                                      
                                                                                                                   chk\_ovf(avq\_dec.c)                                                                                                                      
                                                                                                                   read\_I(avq\_dec.c)                                                                                                                       
                                                                                                                   read\_ovf(avq\_dec.c)                                                                                                                     
                                                                                                                   read\_k(avq\_dec.c)                                                                                                                       
                                                                               RE8\_dec                                                                                                                                                                      
                                                                                                                   re8\_decode\_base\_index                                                                                                                  
                                                                                                                                                   re8\_decode\_rank\_of\_permutation                                                                        
                                                                                                                   re8\_k2y                                                                                                                                  
                                                                                                                                                   RE8\_PPV                                                                                                  
                                                                                                                                                                                        nearest\_neighbor\_2D8                                               
                         dec\_prm\_hf                                                                                                                                                                                                                        
                                                   bin2int                                                                                                                                                                                                   
                         decoder\_amrwb\_plus\_1                                                                                                                                                                                                             
                                                   mvr2r                                                                                                                                                                                                     
                                                   decoder\_lf                                                                                                                                                                                               
                                                                               mvr2r                                                                                                                                                                         
                                                                               qpisf\_2s\_46b                                                                                                                                                                
                                                                                                                   E\_LPC\_isf\_reorderPlus                                                                                                                  
                                                                               isf2isp                                                                                                                                                                       
                                                                               int\_lpc\_npl                                                                                                                                                                 
                                                                                                                   E\_LPC\_f\_isp\_a\_conversion                                                                                                             
                                                                                                                                                   E\_LPC\_isp\_f\_pol\_get                                                                                  
                                                                               decoder\_tcx                                                                                                                                                                  
                                                                                                                   AVQ\_demuxdec                                                                                                                             
                                                                                                                                                   read\_all\_nq(avq\_dec.c)                                                                                 
                                                                                                                                                                                        read\_nq(avq\_dec.c)                                                 
                                                                                                                                                   read\_all\_i(avq\_dec.c)                                                                                  
                                                                                                                                                                                        init\_pos\_i\_ovf(avq\_dec.c)                                        
                                                                                                                                                                                                                        chk\_ovf(avq\_dec.c)                 
                                                                                                                                                                                        Split\_n(avq\_dec.c)                                                 
                                                                                                                                                                                        chk\_ovf(avq\_dec.c)                                                 
                                                                                                                                                                                        read\_I(avq\_dec.c)                                                  
                                                                                                                                                                                        read\_k(avq\_dec.c)                                                  
                                                                                                                                                                                        read\_ovf(avq\_dec.c)                                                
                                                                                                                                                   RE8\_dec                                                                                                  
                                                                                                                                                                                        re8\_decode\_base\_index                                             
                                                                                                                                                                                                                        re8\_decode\_rank\_of\_permutation   
                                                                                                                                                                                        re8\_k2y                                                             
                                                                                                                                                                                                                        RE8\_PPV                             
                                                                                                                                                                                                                                                             nearest\_neighbor\_2D8
                                                                                                                   set\_zero                                                                                                                                 
                                                                                                                   rnd\_ph16                                                                                                                                 
                                                                                                                                                   E\_UTIL\_random                                                                                           
                                                                                                                   adap\_lo\_freq\_deemph                                                                                                                    
                                                                                                                   mvr2r                                                                                                                                     
                                                                                                                   find\_mpitch(dec\_tcx.c)                                                                                                                  
                                                                                                                   ifft9                                                                                                                                     
                                                                                                                                                   ifft\_rel                                                                                                 
                                                                                                                   d\_gain\_tcx                                                                                                                              
                                                                                                                   cos\_window                                                                                                                               
                                                                                                                   E\_UTIL\_f\_preemph                                                                                                                       
                                                                                                                   E\_LPC\_a\_weight                                                                                                                         
                                                                                                                   E\_UTIL\_synthesis                                                                                                                        
                                                                                                                   E\_UTIL\_residu                                                                                                                           
                                                                               decoder\_acelp                                                                                                                                                                
                                                                                                                   pred\_lt4                                                                                                                                 
                                                                                                                   D\_ACELP\_decode\_4t                                                                                                                      
                                                                                                                                                   D\_ACELP\_decode\_4p\_4N                                                                                  
                                                                                                                                                                                        D\_ACELP\_decode\_1p\_N1                                             
                                                                                                                                                                                        D\_ACELP\_decode\_3p\_3N1                                            
                                                                                                                                                                                                                        D\_ACELP\_decode\_2p\_2N1            
                                                                                                                                                                                                                        D\_ACELP\_decode\_1p\_N1             
                                                                                                                                                                                        D\_ACELP\_decode\_2p\_2N1                                            
                                                                                                                                                                                        D\_ACELP\_decode\_4p\_4N1                                            
                                                                                                                                                                                                                        D\_ACELP\_decode\_2p\_2N1            
                                                                                                                                                   D\_ACELP\_add\_pulse                                                                                      
                                                                                                                   E\_UTIL\_f\_preemph                                                                                                                       
                                                                                                                   E\_GAIN\_f\_pitch\_sharpening                                                                                                             
                                                                                                                   d\_gain2\_plus                                                                                                                            
                                                                                                                   E\_UTIL\_synthesis                                                                                                                        
                                                                                                                   E\_LPC\_a\_weight                                                                                                                         
                                                                                                                   E\_UTIL\_residu                                                                                                                           
                                                                                                                   E\_UTIL\_deemph                                                                                                                           
                                                                                                                   mvr2r                                                                                                                                     
                                                                                                                   set\_zero                                                                                                                                 
                                                   E\_UTIL\_deemph                                                                                                                                                                                           
                                                   bass\_postfilter                                                                                                                                                                                          
                                                                               mvr2r                                                                                                                                                                         
                                                                               short\_pitch\_tracker(bass\_pf.c)                                                                                                                                             
                                                   decoder\_hf                                                                                                                                                                                               
                                                                               d\_isf\_hf                                                                                                                                                                    
                                                                                                                   E\_LPC\_isf\_reorderPlus                                                                                                                  
                                                                               isf2isp                                                                                                                                                                       
                                                                               int\_lpc\_npl                                                                                                                                                                 
                                                                                                                   E\_LPC\_f\_isp\_a\_conversion                                                                                                             
                                                                                                                                                   E\_LPC\_isp\_f\_pol\_get                                                                                  
                                                                               mvr2r                                                                                                                                                                         
                                                                               match\_gain\_6k4                                                                                                                                                              
                                                                                                                   set\_zero                                                                                                                                 
                                                                                                                   E\_UTIL\_residu                                                                                                                           
                                                                                                                   E\_UTIL\_synthesisPlus                                                                                                                    
                                                                               int\_gain                                                                                                                                                                     
                                                                               d\_gain\_hf                                                                                                                                                                   
                                                                               soft\_exc\_hf                                                                                                                                                                 
                                                                               E\_UTIL\_synthesisPlus                                                                                                                                                        
                                                                               smooth\_ener\_hf                                                                                                                                                              
                                                   delay                                                                                                                                                                                                     
                                                   oversamp\_12k8                                                                                                                                                                                            
                                                                               interpol                                                                                                                                                                      
                         decoder\_stereo\_x                                                                                                                                                                                                                  
                                                   mvr2r                                                                                                                                                                                                     
                                                   band\_split\_taligned\_2k                                                                                                                                                                                 
                                                                               interpol                                                                                                                                                                      
                                                   dec\_tcx\_stereo                                                                                                                                                                                          
                                                                               dtcx\_stereo                                                                                                                                                                  
                                                                                                                   cos\_window                                                                                                                               
                                                                                                                   adap\_lo\_freq\_deemph                                                                                                                    
                                                                                                                   ifft3                                                                                                                                     
                                                                                                                                                   ifft\_rel                                                                                                 
                                                                                                                   d\_gain\_tcx                                                                                                                              
                                                                                                                   crosscorr                                                                                                                                 
                                                                                                                   glev\_s                                                                                                                                   
                                                                               my\_min                                                                                                                                                                       
                                                                               my\_max                                                                                                                                                                       
                                                   dec\_hi\_stereo                                                                                                                                                                                           
                                                                               dec\_filt                                                                                                                                                                     
                                                                                                                   pmsvq\_inv                                                                                                                                
                                                                                                                                                   msvq\_inv                                                                                                 
                                                                               dec\_gain                                                                                                                                                                     
                                                                                                                   pmsvq\_inv                                                                                                                                
                                                                                                                                                   msvq\_inv                                                                                                 
                                                                               mvr2r                                                                                                                                                                         
                                                                               residu                                                                                                                                                                        
                                                                               fir\_filt                                                                                                                                                                     
                                                                               syn\_filt                                                                                                                                                                     
                                                   delay                                                                                                                                                                                                     
                                                   band\_join\_2k                                                                                                                                                                                            
                                                                               interpol                                                                                                                                                                      
                         hp50\_12k8                                                                                                                                                                                                                          
                         oversamp\_12k8                                                                                                                                                                                                                      
                                                   interpol                                                                                                                                                                                                  
  ---------------------- ------------------------- --------------------------- ----------------------------------- ------------------------------- ------------------------------------ ------------------------------- ------------------------------------ ------------------------

4.4 Variables, constants and tables
-----------------------------------

### 4.4.1 Description of fixed tables used in the C-code

This clause contains a listing of all fixed tables declared in
tables\_plus.c and tables\_stereo.c files.

Table 3: Encoder fixed tables

  --------- --------------------------- ------- -------------------------------------------
  Format    Table name                  Size    Description
  Float32   NBITS\_CORE                 8       Core bit-rates
  Float32   T\_sin                      1152    FFT Sine table
  Float32   T\_cos                      1152    FFT Cosine table
  Float32   filter\_32k                 61      FIR table for decimation/oversampling
  Float32   filter\_32k\_hf             61      FIR table for decimation/oversampling
  Float32   filter\_32k\_7k             61      FIR table for decimation/oversampling
  Float32   filter\_48k                 185     FIR table for decimation/oversampling
  Float32   Filter\_48k\_hf             185     FIR table for decimation/oversampling
  Float32   filter\_8k                  61      FIR table for decimation/oversampling
  Float32   isf\_init                   16      Initial ISF memory
  Float32   Mean\_isf                   16      Means of ISFs
  Float32   Dico1\_isf                  2304    1st stage codebook, isf0 to isf8
  Float32   Dico2\_isf                  1792    1st stage codebook, isf9 to isf15
  Float32   Dico21\_isf                 192     2nd stage codebook, isf2\_0 to isf 2\_2
  Float32   Dico22\_isf                 384     2nd stage codebook, isf2\_3 to isf 2\_5
  Float32   Dico23\_isf                 384     2nd stage codebook, isf2\_6 to isf 2\_8
  Float32   Dico24\_isf                 96      2nd stage codebook, isf2\_9 to isf 2\_11
  Float32   Dico25\_isf                 128     2nd stage codebook, isf2\_12 to isf 2\_15
  Float32   Dico21\_isf\_36b            640     1st stage codebook, (36b) split 1
  Float32   Dico22\_isf\_36b            512     1st stage codebook, (36b) split 2
  Float32   Dico23\_isf\_36b            448     1st stage codebook, (36b) split 3
  Float32   Dico\_gain\_hf              512     Quantization table for one-stage HF gain
  Float32   Mean\_isf\_hf\_12k8         8       Means of ISFs (full band)
  Float32   dico1\_isf\_hf\_12k8        32      1nd stage isf codebook (full band)
  Float32   mean\_isf\_hf\_low\_rate    8       Means of isfs
  Float32   Dico1\_isf\_hf\_low\_rate   32      1st stage isf codebook
  Float32   dico2\_isf\_hf              1024    2nd stage isf codebook
  Float32   Lag\_window                 17      Lag window
  Float32   Filt\_lp                    13      Low-pass fir filter for bass post filter
  Float32   Sin20                       20      Random phase
  Float32   Inter4\_2                   65      ¼ resolution interpolation filter
  Float32   VadFiltBandFreqs            12      Open-loop classifier
  Float32   Bw                          12      Open-loop classifier
  Float32   Lwg                         8       Open-loop claissifier
  Float32   Gain\_hf\_ramp              64      HF gain ramp for wb-\>wb+ switching
  Float32   Inter2\_coef                12      Filter coefficients for band join/split
  Float32   Filter\_LP180               2341    Filter for 48 kHz interpolation
  Float32   StereoNbits                 18      Stereo bit-rates
  Float32   Filter\_2k                  321     2k decimation filter
  Float32   Cb\_filt\_hi\_mean          9       Average filter
  Float32   Filt\_hi\_mscb4a            16\*9   
  Float32   Filt\_hi\_mscb\_7a          16\*9   
  Float32   Filt\_hi\_mscb\_7b          8\*9    
  Float32   Cb\_gain\_hi\_mean          2       Average gain vector
  Float32   Gain\_hi\_mscb\_2a          4\*2    
  Float32   Gain\_hi\_mscb\_5a          32\*2   
            TBC                                 
                                                
  --------- --------------------------- ------- -------------------------------------------

Table 4: Decoder fixed tables

+-----------------+------------+------+-------------+
| Format          | Table name | Size | Description |
+-----------------+------------+------+-------------+
| Same as encoder |            |      |             |
|                 |            |      |             |
| Same as encoder |            |      |             |
+-----------------+------------+------+-------------+

### 4.4.2 Static variables used in the C-code

In this clause two tables that specify the static variables for the
encoder and decoder respectively are shown. All static variables are
declared within a C **struct.**

Table 5: Encoder static variables

  -------------------- ---------------- ------------------------- ------ ---------------------------------------
  struct name          type             variable                  size   description
  Coder\_StState                                                         
                       float            mem\_decim                1608   speech decimated filter memory
                       int              decim\_frac               1      Fractional decimation factor
                       float            mem\_sig\_in              4      hp filter memory
                       float            mem\_preemph              1      speech preemphasis filter mem
                       float            mem\_decim\_hf            46     HF filter memory
                       float            old\_speech\_hf           528    HF old speech vector
                       float            past\_q\_isf\_hf          8      HF past quantized isf
                       float            ispold\_hf                8      HF old isp
                       float            ispold\_q\_hf             8      HF quantized old isp
                       float            old\_gain;                1      HF old gain match
                       float            mem\_hf1                  8      HF memory for gain 1
                       float            mem\_hf2                  8      HF memory for gain 2
                       float            mem\_hf3                  8      HF memory for gain 3
                       float            old\_exc                  375    old excitation
                       float\*          mean\_isf\_hf             1      isf codebook mean
                       float\*          dico1\_isf\_hf            1      isf codebook first stage
  Coder\_State\_Plus                                                     
                       Coder\_StState   left                      2614   state for left channel
                       Coder\_StState   right                     2614   state for right channel
                       float            old\_chan                 528    old left signal
                       float            old\_chan\_2k             140    old left signal 2kHz sampl. rate
                       float            old\_chan\_hi             448    old left signal HB
                       float            old\_speech\_2k           140    old mono signal 2kHz sampl. rate
                       float            old\_speech\_hi           448    old mono signal HB
                       float            old\_speech\_pe           528    past pre-emphasised mono
                       float            old\_wh                   9      past weighted filter
                       float            old\_wh\_q                9      past quantized weighted filter
                       float            old\_gm\_gain             2      past gain matching
                       float            old\_exc\_mono            9      past mono excitation
                       float            filt\_energy\_threshold   1      filter energy thershold
                       float            w\_window                 64     weighting window
                       PMSVQ\*          \*filt\_hi\_pmsvq         1      MSVQ quantizer
                       PMSVQ\*          \*gain\_hi\_pmsvq         1      MSVQ quantizer
                       int              mem\_stereo\_ovlp\_size   1      past stereo overlap size
                       float            mem\_stereo\_ovlp         32     past stereo overlap
                       NCLASSDATA       \*stClass                 1      use case B classifier
                       VadVars          \*vadSt                   1      VAD state
                       short            vad\_hist                 1      VAD history
                       float            old\_speech               528    old speech
                       float            old\_synth                16     synthesis memory
                       float            past\_isfq                16     past isf quantizer
                       float            old\_wovlp                128    last tcx overlap
                       float            old\_d\_wsp               187    Weighted speech vector
                       float            old\_exc                  392    old excitation vector
                       float            old\_mem\_wsyn            1      weighted synthesis memory
                       float            old\_mem\_w0              1      weighted speech memory
                       float            old\_mem\_xnq             1      quantized target memory
                       int              old\_ovlp\_size           1      last tcx overlap size
                       float            isfold                    16     old isf frequency domain
                       float            ispold                    16     old isp
                       float            ispold\_q                 16     quantized old isp
                       float            mem\_wsp                  1      wsp vector mem
                       float            mem\_lp\_decim2           3      wsp decimator filter mem
                       float            ada\_w                    1      open loop LTP
                       float            ol\_gain                  1      open loop LTP
                       short            ol\_wght\_flg             1      open loop LTP
                       long int         old\_ol\_lag              5      past openloop lag
                       int              old\_T0\_med              1      past pitch
                       float            hp\_old\_wsp              699    past HP weighted speech
                       float            hp\_ol\_ltp\_mem          7      past HP openloop long term prediction
                       float            window                    512    LP analysis window
                       short            SwitchFlagPlusToWB        1      flag for switching to AMR-WB
                       float            mem\_gain\_code           4      past code gain
                       short            prev\_mod                 1      past frame type
  -------------------- ---------------- ------------------------- ------ ---------------------------------------

Table 6: Decoder static variables

+--------------+--------------+--------------+------+--------------+
| struct name  | type         | variable     | size | description  |
+--------------+--------------+--------------+------+--------------+
| Deco         |              |              |      |              |
| der\_StState |              |              |      |              |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 72   | Memory       |
|              |              | em\_oversamp |      | oversampling |
+--------------+--------------+--------------+------+--------------+
|              | int          | over\_frac   | 1    | Fractional   |
|              |              |              |      | overcloking  |
|              |              |              |      | factor       |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_        | 24   | memory       |
|              |              | oversamp\_hf |      |              |
+--------------+--------------+--------------+------+--------------+
|              | float        | past         | 8    | HF past      |
|              |              | \_q\_isf\_hf |      | quantized    |
|              |              |              |      | isf          |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\_q\_is  | 8    | HF past      |
|              |              | f\_hf\_other |      | quantized    |
|              |              |              |      | isf for the  |
|              |              |              |      | other        |
|              |              |              |      |              |
|              |              |              |      | channel when |
|              |              |              |      | mono         |
|              |              |              |      | decoding     |
|              |              |              |      | stereo       |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\        | 1    | HF past      |
|              |              | _q\_gain\_hf |      | quantized    |
|              |              |              |      | gain         |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\_q\_gai | 1    | HF past      |
|              |              | n\_hf\_other |      | quantized    |
|              |              |              |      | gain for the |
|              |              |              |      | other        |
|              |              |              |      |              |
|              |              |              |      | channel when |
|              |              |              |      | mono         |
|              |              |              |      | decoding     |
|              |              |              |      | stereo       |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_gain    | 1    | HF old gain  |
|              |              |              |      | match        |
+--------------+--------------+--------------+------+--------------+
|              | float        | ispold\_hf   | 8    | HF old isp   |
+--------------+--------------+--------------+------+--------------+
|              | float        | threshold;   | 1    | HF memory    |
|              |              |              |      | for smooth   |
|              |              |              |      | ener         |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_syn\_hf | 8    | HF synthesis |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_d\_tcx  | 96   | delay        |
|              |              |              |      | compensation |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_d\_nonc | 64   | Non          |
|              |              |              |      | causality    |
|              |              |              |      | delay        |
+--------------+--------------+--------------+------+--------------+
|              | float        | me           | 16   | High band    |
|              |              | m\_synth\_hi |      | sunthesis    |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 4    | hp filter    |
|              |              | em\_sig\_out |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | ol           | 512  | synch delay  |
|              |              | d\_synth\_hf |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | lp\_amp      | 1    | memory for   |
|              |              |              |      | soft exc     |
+--------------+--------------+--------------+------+--------------+
|              | float\*      | m            | 1    | isf codebook |
|              |              | ean\_isf\_hf |      | mean         |
+--------------+--------------+--------------+------+--------------+
|              | float\*      | di           | 1    | isf codebook |
|              |              | co1\_isf\_hf |      | first stage  |
+--------------+--------------+--------------+------+--------------+
| Decoder\     |              |              |      |              |
| _State\_Plus |              |              |      |              |
+--------------+--------------+--------------+------+--------------+
|              | Deco         | left         | 828  | State for    |
|              | der\_StState |              |      | left channel |
+--------------+--------------+--------------+------+--------------+
|              | Deco         | right        | 828  | State for    |
|              | der\_StState |              |      | right        |
|              |              |              |      | channel      |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 20   | 2kHz memory  |
|              |              | em\_left\_2k |      | on left chan |
+--------------+--------------+--------------+------+--------------+
|              | float        | me           | 20   | 2kHz memory  |
|              |              | m\_right\_2k |      | on right     |
|              |              |              |      | chan         |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 64   | HB memory    |
|              |              | em\_left\_hi |      | left channel |
+--------------+--------------+--------------+------+--------------+
|              | float        | me           | 64   | HB memory    |
|              |              | m\_right\_hi |      | right        |
|              |              |              |      | channel      |
+--------------+--------------+--------------+------+--------------+
|              | float        | my\_ol       | 35   | old 2kHz     |
|              |              | d\_synth\_2k |      | synthesis    |
+--------------+--------------+--------------+------+--------------+
|              | float        | my\_ol       | 128  | old HB       |
|              |              | d\_synth\_hi |      | synthesis    |
+--------------+--------------+--------------+------+--------------+
|              | float        | my           | 148  | old stereo   |
|              |              | \_old\_synth |      | synth        |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_AqLF    | 85   | old          |
|              |              |              |      | quantized    |
|              |              |              |      | LPC          |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_wh      | 9    | old decoded  |
|              |              |              |      | filter       |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_wh2     | 9    | old decoded  |
|              |              |              |      | filter 2     |
+--------------+--------------+--------------+------+--------------+
|              | float        | ol           | 9    | old mono     |
|              |              | d\_exc\_mono |      | excitation   |
+--------------+--------------+--------------+------+--------------+
|              | float        | old          | 4    | old gain on  |
|              |              | \_gain\_left |      | left chan    |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\         | 4    | old gain on  |
|              |              | _gain\_right |      | right chan   |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_wh\_q   | 9    | past         |
|              |              |              |      | quantized    |
|              |              |              |      | filter       |
+--------------+--------------+--------------+------+--------------+
|              | float        | o            | 2    | past gain    |
|              |              | ld\_gm\_gain |      | matching     |
+--------------+--------------+--------------+------+--------------+
|              | float        | w\_window    | 64   | weighted     |
|              |              |              |      | synthesis    |
|              |              |              |      | window       |
+--------------+--------------+--------------+------+--------------+
|              | PMSVQ        | \*fil        | 1    | past MSVQ    |
|              |              | t\_hi\_pmsvq |      | filter       |
+--------------+--------------+--------------+------+--------------+
|              | PMSVQ        | \*gai        | 1    | past MSVQ    |
|              |              | n\_hi\_pmsvq |      | gain         |
+--------------+--------------+--------------+------+--------------+
|              | int          | mem\_stereo  | 1    | past stereo  |
|              |              | \_ovlp\_size |      | overlap size |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_        | 32   | past stereo  |
|              |              | stereo\_ovlp |      | overlap      |
+--------------+--------------+--------------+------+--------------+
|              | int          | last\_       | 1    | past stereo  |
|              |              | stereo\_mode |      | mode         |
+--------------+--------------+--------------+------+--------------+
|              | float        | side\_rms    | 1    | side signal  |
|              |              |              |      | RMS          |
+--------------+--------------+--------------+------+--------------+
|              | float        | h            | 9    | current      |
|              |              |              |      | filter       |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_balance | 1    | past balance |
|              |              |              |      | factor       |
+--------------+--------------+--------------+------+--------------+
|              | int          | fer\_hist    | 500  | frame        |
|              |              |              |      | errasure     |
|              |              |              |      | history      |
+--------------+--------------+--------------+------+--------------+
|              | int          | fe           | 1    | frame        |
|              |              | r\_hist\_ptr |      | erasure      |
|              |              |              |      | pointer      |
+--------------+--------------+--------------+------+--------------+
|              | float        | fer\_mean    | 1    | frame        |
|              |              |              |      | erasure mean |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_xri     | 1148 | old spectral |
|              |              |              |      | coefficeints |
+--------------+--------------+--------------+------+--------------+
|              | int          | last\_mode   | 1    | last mode in |
|              |              |              |      | previous     |
|              |              |              |      | 80ms frame   |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 4    | hp50 filter  |
|              |              | em\_sig\_out |      | memory for   |
|              |              |              |      | synthesis    |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_deemph  | 1    | speech       |
|              |              |              |      | deemph       |
|              |              |              |      | filter       |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | int          | pre          | 1    | previous lpc |
|              |              | v\_lpc\_lost |      | is lost when |
|              |              |              |      | = 1          |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_synth   | 16   | synthesis    |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | float        | old\_exc     | 392  | old          |
|              |              |              |      | excitation   |
|              |              |              |      | vector       |
+--------------+--------------+--------------+------+--------------+
|              | float        | isfold       | 16   | old isf      |
|              |              |              |      | (frequency   |
|              |              |              |      | domain)      |
+--------------+--------------+--------------+------+--------------+
|              | float        | ispold       | 16   | old isp      |
|              |              |              |      | (immittance  |
|              |              |              |      | spectral     |
|              |              |              |      | pairs)       |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\_isfq   | 16   | past isf     |
|              |              |              |      | quantizer    |
+--------------+--------------+--------------+------+--------------+
|              | float        | wovlp        | 128  | last         |
|              |              |              |      | weighted     |
|              |              |              |      | synthesis    |
|              |              |              |      | for overlap  |
+--------------+--------------+--------------+------+--------------+
|              | int          | ovlp\_size   | 1    | overlap size |
+--------------+--------------+--------------+------+--------------+
|              | float        | isf\_buf     | 51   | old isf (for |
|              |              |              |      | frame        |
|              |              |              |      | recovery)    |
+--------------+--------------+--------------+------+--------------+
|              | int          | old\_T0      | 1    | old pitch    |
|              |              |              |      | value (for   |
|              |              |              |      | frame        |
|              |              |              |      | recovery)    |
+--------------+--------------+--------------+------+--------------+
|              | int          | o            | 1    | old pitch    |
|              |              | ld\_T0\_frac |      | value (for   |
|              |              |              |      | frame        |
|              |              |              |      | recovery)    |
+--------------+--------------+--------------+------+--------------+
|              | short        | seed\_ace    | 1    | seed memory  |
|              |              |              |      | (for random  |
|              |              |              |      | function)    |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_wsyn    | 1    | TCX          |
|              |              |              |      | synthesis    |
|              |              |              |      | memory       |
+--------------+--------------+--------------+------+--------------+
|              | short        | seed\_tcx    | 1    | seed memory  |
|              |              |              |      | (for random  |
|              |              |              |      | function)    |
+--------------+--------------+--------------+------+--------------+
|              | float        | wsyn\_rms    | 1    | rms value of |
|              |              |              |      | weighted     |
|              |              |              |      | synthesis    |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\_gpit   | 1    | past gain of |
|              |              |              |      | pitch (for   |
|              |              |              |      | frame        |
|              |              |              |      | recovery)    |
+--------------+--------------+--------------+------+--------------+
|              | float        | past\_gcode  | 1    | past gain of |
|              |              |              |      | code (for    |
|              |              |              |      | frame        |
|              |              |              |      | recovery)    |
+--------------+--------------+--------------+------+--------------+
|              | int          | pitch\_tcx   | 1    | for bfi      |
+--------------+--------------+--------------+------+--------------+
|              | float        | g            | 1    | GC threshold |
|              |              | c\_threshold |      |              |
+--------------+--------------+--------------+------+--------------+
|              | float        | ol           | 503  | Bass         |
|              |              | d\_synth\_pf |      | post-filter: |
|              |              |              |      | old          |
|              |              |              |      | synthesis    |
+--------------+--------------+--------------+------+--------------+
|              | float        | ol           | 24   | bass         |
|              |              | d\_noise\_pf |      | post-filter: |
|              |              |              |      | noise memory |
+--------------+--------------+--------------+------+--------------+
|              | int          | old\_T\_pf   | 2    | bass         |
|              |              |              |      | post-filter: |
|              |              |              |      | old pitch    |
+--------------+--------------+--------------+------+--------------+
|              | float        | o            | 2    | Bass         |
|              |              | ld\_gain\_pf |      | post-filter: |
|              |              |              |      | old pitch    |
|              |              |              |      | gain         |
+--------------+--------------+--------------+------+--------------+
|              | float        | \*m          | 1    | HF isf       |
|              |              | ean\_isf\_hf |      | codebook     |
|              |              |              |      | in-use       |
+--------------+--------------+--------------+------+--------------+
|              | float        | \*di         | 1    | HF isf       |
|              |              | co1\_isf\_hf |      | codebook     |
|              |              |              |      | in-use       |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem          | 4    | past code    |
|              |              | \_gain\_code |      | gain         |
+--------------+--------------+--------------+------+--------------+
|              | float        | mem\_lpc\_hf | 9    | past HF lpc  |
|              |              |              |      | filter       |
+--------------+--------------+--------------+------+--------------+
|              | float        | m            | 1    | past HF gain |
|              |              | em\_gain\_hf |      |              |
+--------------+--------------+--------------+------+--------------+
|              | short        | ramp\_state  | 1    | ramp state   |
+--------------+--------------+--------------+------+--------------+

5 File formats
==============

This clause describes the file formats used by the encoder and decoder
programs.

5.1 Audio file (encoder input/decoder output)
---------------------------------------------

Audio files read by the encoder must be formatted as 16 bits PCM wave
(\*.wav) files. The decoder output is written as a 16 bit PCM wave file
(\*.wav).

Note that the decoder, with proper command line switch, can produce a
mono file from a stereo bit-stream.

5.2 Parameter bitstream file (encoder output/decoder input)
-----------------------------------------------------------

For AMR-WB+ operation, the files produced by the audio encoder/expected
by the audio decoder are either according to the raw format defined in
Reference \[2\] Section 8.2, or according to the 3GP file format \[4\],
whereby the storage sample definition is found in Reference \[2\]
Section 8.3.

######## Annex A (informative): AMR-WB+ user guide

This Annex contains a user guide on how to configure AMR-WB+ codec
parameters. Due to the codec flexibility, different configurations can
be used to operate the codec at a certain bit rate. The aim of this
annex is ease the understanding of how to set the parameters of the
AMR-WB+ audio codec.

There are two ways to set the AMR-WB+ parameters: in simple mode and
flexible (\"expert\") mode. The simple mode uses a predefined set of
configurations at different bit rates. In the flexible mode, the user
chooses the core bit rate and the stereo extension rate, in case of
stereo operation, and the internal sampling frequency, to attain a
certain bit rate.

The AMR-WB+ audio codec processes input frames always equal to 2048
samples at an internal sampling frequency *F~s~*. The internal sampling
frequency (ISF) is independent from the audio sampling rate and is
limited to the range from 12800-38400 Hz. The 2048-sample frames are
split into two critically sampled equal frequency bands. This results in
two superframes of 1024 samples corresponding to the low frequency (LF)
and high frequency (HF) bands. Each superframe is divided into four
256-sample frames. Because the codec always requires 2048 samples then
the input frame size or frame duration will vary for different ISFs.

A.1 Encoder usage
=================

A.1.1 Simple mode
-----------------

Simple mode is easy to use and requires no knowledge of AMR-WB+ to use
the full capacity of the codec. The usage is as follows:

+----------------------------------+----------------------------------+
| AmrwbPlusEncode -rate \<bit      |                                  |
| rate\> \[-mono\] \[--ff          |                                  |
| \<3gp\|raw\>\] -if               |                                  |
| \<infile.wav\> -of               |                                  |
| \<outfile.wb+\>                  |                                  |
+----------------------------------+----------------------------------+
| Where                            |                                  |
+----------------------------------+----------------------------------+
| AmrwbPlusEncode                  | Name of the AMR-WB+ encoder      |
|                                  | program either compiled from the |
|                                  | floating-point C-code of this    |
|                                  | specification or from the        |
|                                  | fixed-point C-code of \[1\].     |
+----------------------------------+----------------------------------+
| -rate                            | Bit rate from 6-36 kbps for mono |
|                                  | encoding or 7-48 kbps for stereo |
|                                  | encoding                         |
+----------------------------------+----------------------------------+
| -mono                            | Forces mono encoding for stereo  |
|                                  | inputs.                          |
|                                  |                                  |
|                                  | If this option is not used the   |
|                                  | encoder performs mono encoding   |
|                                  | for mono WAV files and stereo    |
|                                  | encoding for stereo WAV files.   |
+----------------------------------+----------------------------------+
| -ff                              | File format:                     |
|                                  |                                  |
|                                  | > 3gp                            |
|                                  | >                                |
|                                  | > raw                            |
|                                  |                                  |
|                                  | The default is 3gp file format.  |
+----------------------------------+----------------------------------+
| -if                              | Input audio WAV file with one    |
|                                  | (mono) or two (stereo) channels  |
|                                  |                                  |
|                                  | Supported audio sampling rates   |
|                                  | are 8, 16, 24, 32, 48, 11.025,   |
|                                  | 22.05, 44.1 kHz                  |
+----------------------------------+----------------------------------+
| -of                              | Output file (according to the    |
|                                  | -ff argument)                    |
+----------------------------------+----------------------------------+

The codec will use the best combination of mono and stereo bit rates and
internal sampling frequency (ISF) according to the bit rate specified by
the user. In this simple mode, the codec uses a set of predefined
configurations in the bit rate range from 6-48 kbps. The codec will
choose the closest configuration to the required bit rates. The
configurations have been chosen to optimize the quality/bandwidth
trade-off at a certain bit rate for 48 kHz sampled input.

Tables A.1 and A.2 show the default codec configurations for mono and
stereo operation, respectively. In the tables, the mapping from selected
bit rate to mode index and ISF index are given, and in addition the
resulting bit rate factor and coded audio bandwidth (BW). The mode index
(or frame type) is defined and explained in Table 25 of 26.290 \[2\]
(modes 16 to 23 are mono modes and modes 24 to 47 are stereo modes). The
mapping from ISF index to ISF, corresponding frame size and bit rate
factor is defined in Table 24 of 26.290 \[2\].

Table A.1 Mono default configurations

  ----------------- -------------------------------------------------- -------------------------------- ----------------- ----------
  bit rate (kbps)   Mode Index (bit rate at nominal ISF of 25.6 kHz)   ISF index (sampling frequency)   Bit rate factor   BW (kHz)
  5.85              16 (10.4 kbps)                                     2 (14.4 kHz)                     9/16              7.2
  6.933             16 (10.4 kbps)                                     4 (17.067)                       2/3               8.533
  7.8               16 (10.4 kbps)                                     5 (19.2 kHz)                     3/4               9.6
  8.667             16 (10.4 kbps)                                     6 (21.33 kHz)                    5/6               10.67
  9.75              16 (10.4 kbps)                                     7 (24 kHz)                       15/16             12
  11.25             17 (12 kbps)                                       7 (24 kHz)                       15/16             12
  12                17 (12 kbps)                                       8 (25.6 kHz)                     1                 12.8
  13.6              18 (13.6 kbps)                                     8 (25.6 kHz)                     1                 12.8
  15.2              19 (15.2 kbps)                                     8 (25.6 kHz)                     1                 12.8
  17.1              19 (15.2 kbps)                                     9 (28.8 kHz)                     9/8               14.4
  18.9              20 (16.8 kbps)                                     9 (28.8 kHz)                     9/8               14.4
  21.6              21 (19.2 kbps)                                     9 (28.8 kHz)                     9/8               14.4
  24                21 (19.2 kbps)                                     10 (32 kHz)                      5/4               16
  26                22 (20.8 kbps)                                     10 (32 kHz)                      5/4               16
  30                23 (24 kbps)                                       10 (32 kHz)                      5/4               16
  32                23 (24 kbps)                                       11 (34.13 kHz)                   4/3               17.06
  33.75             23 (24 kbps)                                       12 (36 kHz)                      45/32             18
  36                23 (24 kbps)                                       13 (38.4 kHz)                    3/2               19.2
  ----------------- -------------------------------------------------- -------------------------------- ----------------- ----------

Table A.2: Stereo default configurations

  ----------------- -------------------------------------------------- -------------------------------- ----------------- ----------
  bit rate (kbps)   Mode Index (bit rate at nominal ISF of 25.6 kHz)   ISF index (sampling frequency)   Bit rate factor   BW (kHz)
  6.975             24 (12.4 kbps)                                     2 (14.4 kHz)                     9/16              7.2
  8.267             24 (12.4 kbps)                                     4 (17.067 kHz)                   2/3               8.533
  9.3               24 (12.4 kbps)                                     5 (19.2 kHz)                     3/4               9.6
  10.33             24 (12.4 kbps)                                     6 (21.33 kHz)                    5/6               10.67
  11.65             24 (12.4 kbps)                                     7 (24 kHz)                       15/16             12
  13.125            26 (14 kbps)                                       7 (24 kHz)                       15/16             12
  14.25             28 (15.2 kbps)                                     7 (24 kHz)                       15/16             12
  15                29 (16 kbps)                                       7 (24 kHz)                       15/16             12
  16                29 (16 kbps)                                       8 (25.6 kHz)                     1                 12.8
  17.2              31 (17.2 kbps)                                     8 (25.6 kHz)                     1                 12.8
  18                32 (18 kbps)                                       8 (25.6 kHz)                     1                 12.8
  19.2              34 (19.2 kbps)                                     8 (25.6 kHz)                     1                 12.8
  20                35 (20 kbps)                                       8 (25.6 kHz)                     1                 12.8
  22.5              35 (20 kbps)                                       9 (28.8 kHz)                     9/8               14.4
  23.85             37 (21.2 kbps)                                     9 (28.8 kHz)                     9/8               14.4
  25.2              38 (22.4 kbps)                                     9 (28.8 kHz)                     9/8               14.4
  27                40 (24 kbps)                                       9 (28.8 kHz)                     9/8               14.4
  30                40 (24 kbps)                                       10 (32 kHz)                      5/4               16
  32                40 (24 kbps)                                       11 (34.13 kHz)                   4/3               17.06
  34.13             41 (25.6 kbps)                                     11 (34.13 kHz)                   4/3               17.06
  36                41 (25.6 kbps)                                     12 (36 kHz)                      45/32             18
  37.6875           43 (26.8 kbps)                                     12 (36 kHz)                      45/32             18
  40.2              43 (26.8 kbps)                                     13 (38.4 kHz)                    3/2               19.2
  43.2              44 (28.8 kbps)                                     13 (38.4 kHz)                    3/2               19.2
  45                46 (30 kbps)                                       13 (38.4 kHz)                    3/2               19.2
  48                47 (32 kbps)                                       13 (38.4 kHz)                    3/2               19.2
  ----------------- -------------------------------------------------- -------------------------------- ----------------- ----------

A.1.2 Flexible mode
-------------------

Flexible (\"expert\") mode requires more knowledge of AMR-WB+ to use the
full capacity of the codec. In this mode, the user can choose the core
bit rate and the stereo extension rate, in case of stereo operation, and
the internal sampling frequency, to attain a certain bit rate.

The usage is as follows:

+----------------------------------+----------------------------------+
| AmrwbPlusEncode -mi \<mode\>     |                                  |
| \[-isf \<factor\>\] \[-lc\]      |                                  |
| \[-dtx\] \[-ff \<3gp/raw\>\]     |                                  |
| --if \<infile.wav\> -of          |                                  |
| \<outfile.wb+\> \[-cf            |                                  |
| \<configfile.txt\>\]             |                                  |
+----------------------------------+----------------------------------+
| Where                            |                                  |
+----------------------------------+----------------------------------+
| AmrwbPlusEncode                  | Name of the AMR-WB+ encoder      |
|                                  | program either compiled from the |
|                                  | floating-point C-code of this    |
|                                  | specification or from the        |
|                                  | fixed-point C-code of \[1\].     |
+----------------------------------+----------------------------------+
| -mi                              | Mode Index                       |
|                                  |                                  |
|                                  | > 0..8 AMR-WB                    |
|                                  | >                                |
|                                  | > 10..13 AMR-WB+ special modes   |
|                                  | >                                |
|                                  | > 16..23 AMR-WB+ mono modes      |
|                                  | >                                |
|                                  | > 24..47 AMR-WB+ stereo modes    |
+----------------------------------+----------------------------------+
| -isf                             | Internal Sampling Frequency      |
|                                  | factor                           |
|                                  |                                  |
|                                  | > 0.5..1.5                       |
|                                  |                                  |
|                                  | If this option is missing, the   |
|                                  | default is 1.0                   |
+----------------------------------+----------------------------------+
| -lc                              | Low complexity (for AMR-WB+      |
|                                  | modes)                           |
|                                  |                                  |
|                                  | If this option is missing, the   |
|                                  | default is to use normal         |
|                                  | encoding.                        |
|                                  |                                  |
|                                  | **Note:** This option is         |
|                                  | designed for terminal-based      |
|                                  | encoding. For optimal quality,   |
|                                  | it is recommended to not use     |
|                                  | this parameter.                  |
+----------------------------------+----------------------------------+
| -dtx                             | Enables VAD/DTX functionality    |
|                                  | (only for AMR-WB modes)          |
|                                  |                                  |
|                                  | If this option is missing, the   |
|                                  | default is NO DTX                |
+----------------------------------+----------------------------------+
| -ff                              | File format:                     |
|                                  |                                  |
|                                  | > 3gp                            |
|                                  | >                                |
|                                  | > raw                            |
|                                  |                                  |
|                                  | If this option is missing, the   |
|                                  | default is 3gp file format.      |
+----------------------------------+----------------------------------+
| -if                              | Input audio WAV file             |
|                                  |                                  |
|                                  | Supported audio sampling rates   |
|                                  | are 8, 16, 24, 32, 48, 11.025,   |
|                                  | 22.05, 44.1 kHz                  |
|                                  |                                  |
|                                  | Modes 0..8 require 16 kHz input  |
|                                  | audio sampling rate.             |
|                                  |                                  |
|                                  | Modes 10..13 require 16 or 24    |
|                                  | kHz audio sampling rate.         |
+----------------------------------+----------------------------------+
| -of                              | Output file (according to the    |
|                                  | -ff argument)                    |
+----------------------------------+----------------------------------+
| -cf                              | Configuration file: an auxiliary |
|                                  | file that can be used for bit    |
|                                  | rate switching                   |
+----------------------------------+----------------------------------+

The mode index (mi) can be found in Tables 21 and 25 of 26.290 \[2\] and
the Internal Sampling Frequency (ISF) in Table 24 of 26.290 \[2\].

Table 21 of 26.290 \[2\] contains the AMR-WB--compatible modes and four
AMR-WB+ special modes (mode index 10-13). The AMR-WB+ special modes have
a fixed ISF (ISF index = 0 from Table 24 of 26.290 \[2\]). The codec can
switch dynamically between the AMR-WB and AMR-WB+ special modes (Table
21 of 26.290 \[2\]) if AMR-WB+ is operated at 16 kHz.

Table 25 of 26.290 \[2\] contains the AMR-WB+ mono and stereo modes. The
core and stereo mode indices of Table 25 of 26.290 \[2\] correspond to
Tables 22 and 23 of 26.290 \[2\]. The bit rates specified in Table 25 of
26.290 \[2\] are for a nominal ISF of 25600 Hz (bit rate factor = 1.0).
The output bit rate can be computed by multiplying the bit rate value
from Table 25 of 26.290 \[2\] and the bit rate factor from Table 24 of
26.290 \[2\].

**Stereo flexibility**

In case of stereo operation, the flexible mode provides some degree of
flexibility for trade-off between mono and stereo extension bit rates.
This can be content dependent where higher or lower stereo extension bit
rates can be used depending on the correlation between the two channels.
In Table 25 of 26.290 \[2\], there are 24 stereo modes (mode indices 24
to 47). These modes correspond to the 8 core mono modes where 3
different extension rates are combined with each core mode. For example,
mode indices 39, 40, and 41 correspond to a core bit rate of 19.2 kbps
combined with stereo extension rates of 4.0, 4.8, and 6.4 kbps,
respectively. This results in total bit rates of 23.2, 24.0, and 25.6
kbps. In these stereo modes, the ratio between the stereo extension rate
and the total bit rate is 17.1%, 20%, and 25%, respectively.

**Choosing encoded bandwidth**

The flexibility in choosing the ISF gives the user the choice to adjust
the coded audio bandwidth depending on the input signal. For instance,
in case of speech signals, a bandwidth up to 14 kHz is sufficient to
attain transparent quality.

To determine the AMR-WB+ mode, one approach could be to first determine
the bandwidth of the signal that required to be encoded. Table 24 of
26.290 \[2\] can be used to choose the ISF. Then the core and stereo
rates are chosen from Tables 25, 22, and 23 of 26.290 \[2\]. (Note that
these bit rates should be scaled with the bit rate factor from Table 24
of 26.290 \[2\].)

Further tuning can be done by adjusting the ISF. The HF encoding uses
relatively few bits compared to the LF; therefore, the LF part of the
signal has a higher definition than the HF. Therefore, increasing the
ISF can be considered even in cases where the resulting bandwidth might
exceed the input signal bandwidth if the bit budget allows it.

The graph below explains the three different possibilities.

![](media/image3.wmf){width="6.375in" height="5.375in"}

Case A is when the ISF is set to be smaller than the signal spectrum.
This can be used when the bit rate or the CPU load has to be reduced.

Case B is probably the most usual situation. The signal spectrum is
matched with the ISF.

Case C can be used when high quality is required and an adequate bit
rate budget is available. In this case, the HF exceeds the signal
bandwidth, but the bits allocated for the HF will be used to encode the
active part only. For example, this case can be used to encode a signal
with input bandwidth limited to 14 kHz at a bit rate of 36 kbps. If we
use mode index 36 (24 kbps at nominal ISF) and ISF of 38.4 kHz (bit rate
factor 1.5), the resulting bit rate will be 36 kbps with the LF encoded
up to 9.6 kHz and the HF from 9.6 to 14 kHz.

**Bit rate switching using a configuration file**

Bit rate switching can be simulated using an auxiliary configuration
file. The option -cf refers to a text file that allows for changing Mode
Index and ISF dynamically during a program run. The configuration file
contains a time reference, a specific extension (AMR-WB or AMR-WB+),
mode index (mi), and an internal sampling frequency (ISF), used to
encode at that specific time. The encoder keeps the last setting to
encode the remaining part of the file. To use -cf option to switch
between AMR-WB and AMR-WB+ special modes, input files at 16 kHz sampling
rate need to be used and the decoder needs to use the option -fs 16000
(see Section A.2 below).

Each configuration file consists of 4 columns consisting of \"time\"
\"ext\" \"mode\_index\" \"fscale\".

\"time\" is specified in seconds and must always be \> 0.

\"extension\" is 0 or 1 for choosing AMR-WB or AMR-WB+ modes.

\"mi\" = \[0..47\], where \[0..15\] is AMR-WB and AMR-WB+ special modes,
and \[16..47\] is for AMR-WB+ extension modes

\"isf\"= \[0.5..1.5\] for AMR-WB+ extension modes, and represent the bit
rate factor. \"isf\" is set to zero for mode indices 0 to 15.

The following is an example of a configuration file for switching
between AMR-WB and AMR-WB+ special modes.

  -------- ----------- ---- -----
  \#time   Extension   mi   isf
  0.08     1           10   0.0
  1.08     0           7    0.0
  2.08     1           10   0.0
  3.08     0           0    0.0
  -------- ----------- ---- -----

Here, \"time\" is in seconds, and \"extension\"=0 means AMR-WB and
\"extension\"=1 means AMR-WB+. The value of \"isf\" for modes 0-15 must
be zero. In this example, the encoder will use the initial configuration
up to first 80 ms. At 80 ms it will start encoding with AMR-WB+ mode 10
(13.6 kbps). At time instant 1080 ms, it will start encoding with AMR-WB
mode 7 (23.05 kbps). At time instant 2080 ms, it will start encoding
with AMR-WB+ mode 10. Finally, at time instant 3080 ms, it will start
encoding with AMR-WB mode 0 (6.6 kbps) till the end of the file. This
can be seen as using the initial configuration for the first 80 ms,
using mode 10 for 1 second, using mode 7 for 1 second, using mode 10 for
1 second, and using mode 0 for the remaining of the file.

In the above example, if the following command line is used:

AmrwbPlusEncode -ff raw -mi 12 -cf switch\_amrwb.txt -if Input.wav -of
bit\_stream

then the first 80 ms will be encoded with AMR-WB+ mode 12.

The example below shows a configuration file where mode index and ISF
are switched.

  -------- ----------- ---- -----
  \#time   Extension   mi   isf
  0.5      1           16   1.0
  1.0      1           20   1.5
  2.0      1           23   1.5
  3.0      1           35   0.8
  4.0      1           40   1.0
  5.0      1           47   1.5
  10.0     1           23   1.0
  -------- ----------- ---- -----

A.2 Decoder usage
=================

The decoder usage is as follows:

+----------------------------------+----------------------------------+
| AmrwbPlusDecode \[-ff            |                                  |
| \<3gp/raw\>\] \[-fs              |                                  |
| \<fs\_Hz\>\]\[-mono\]            |                                  |
| \[-limiter\] -if \<infile.wb+\>  |                                  |
| -of \<outfile.wav\> \[-fer       |                                  |
| \<error.txt\>\]                  |                                  |
+----------------------------------+----------------------------------+
| Where                            |                                  |
+----------------------------------+----------------------------------+
| AmrwbPlusDecode                  | Name of the AMR-WB+ decoder      |
|                                  | executable either compiled from  |
|                                  | the floating-point C-code of     |
|                                  | this specification or from the   |
|                                  | fixed-point C-code of \[1\].     |
+----------------------------------+----------------------------------+
| -ff                              | File format:                     |
|                                  |                                  |
|                                  | > 3gp                            |
|                                  | >                                |
|                                  | > raw                            |
|                                  |                                  |
|                                  | The default is 3gp file format.  |
+----------------------------------+----------------------------------+
| -fs                              | Output sampling rate (if this    |
|                                  | option is missing the default    |
|                                  | value of 48 kHz is used)         |
+----------------------------------+----------------------------------+
| -mono                            | Forces mono decoding for stereo  |
|                                  | encoded inputs.                  |
+----------------------------------+----------------------------------+
| -limiter                         | To avoid output clipping         |
|                                  | (recommended)                    |
+----------------------------------+----------------------------------+
| -if                              | Input AMR-WB+ bitstream file     |
|                                  | (according to the -ff argument ) |
+----------------------------------+----------------------------------+
| -of                              | Output audio WAV file            |
+----------------------------------+----------------------------------+
| -fer                             | Frame erasure file for           |
|                                  | simulating frame erasures.       |
+----------------------------------+----------------------------------+

The output sampling rate can be chosen in function of the hardware. The
decoder is able to support 8, 16, 24, 32 and 48kHz or 11.025, 22.050 and
44.1kHz. The sampling rate cannot be changed at run time. The default
value is 48 kHz which is recommended. If the decoder receives modes 0 to
15 the default sampling frequency is 16 kHz.

The limiter option will increase quality when the signal contains
saturations and will not degrade otherwise. It is recommended to always
activate the limiter option.

Frame erasure text files can be used for simulating frame erasures. They
are constructed as text files (ASCII) with one flag \"0\" or \"1\" per
line. There is one line per codec (transmission) frame. \"0\" indicates
proper reception of the frame and \"1\" a frame erasure.

######## Annex B (informative): Change history

  -------------------- -------------- -------------- -------- --------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------- ---------
  **Change history**                                                                                                                                                                                                                                                                              
  **Date**             **TSG SA\#**   **TSG Doc.**   **CR**   **Rev**   **Subject/Comment**                                                                                                                                                                                             **Old**   **New**
  2004-09              25             SP-040640      \-       \-        Approved at TSG SA\#25                                                                                                                                                                                          2.0.0     6.0.0
  2004-12              26             SP-040841      001                **Incorrect definition of mode index for SID frames**                                                                                                                                                           6.0.0     6.1.0
  2004-12              26             SP-040841      002                **Correction of TCX coding selection for MMS encoder**                                                                                                                                                          6.0.0     6.1.0
  2004-12              26             SP-040841      003                **Misread of energy buffer in coding mode selection in MMS encoder. Correction of energy buffer initialisation**                                                                                                6.0.0     6.1.0
  2004-12              26             SP-040841      004                **Correction of stereo bit allocation tables**                                                                                                                                                                  6.0.0     6.1.0
  2004-12              26             SP-040841      005      1         **Optimization of error concealment operation**                                                                                                                                                                 6.0.0     6.1.0
  2004-12              26             SP-040841      006      1         **Stereo operation of pre-echo mode, saturation of gain\_shape**                                                                                                                                                6.0.0     6.1.0
  2004-12              26             SP-040841      007                Stereo operation of pre-echo mode, alignment of encoder and decoder                                                                                                                                             6.0.0     6.1.0
  2004-12              26             SP-040841      008      1         Addition of support for file formats and improved command line                                                                                                                                                  6.0.0     6.1.0
  2004-12              26             SP-040841      009      1         Source code editorial changes                                                                                                                                                                                   6.0.0     6.1.0
  2004-12              26             SP-040841      010                Removal of complexity counters                                                                                                                                                                                  6.0.0     6.1.0
  2004-12              26             SP-040841      011      1         Editorial changes                                                                                                                                                                                               6.0.0     6.1.0
  2004-12              26             SP-040841      012                Void. This CR in S4-040722 (Title: Editorial changes) was meant to TS 26.290 (as CR 004) and not to TS 26.304 ! The CR was implemented instead in TS 26.290 v. 6.1.0 and a remark was put in the CR database.   6.0.0     6.1.0
  2004-12              26             SP-040841      013                Removal of the eid tool                                                                                                                                                                                         6.0.0     6.1.0
  2004-12              26             SP-040841      014      1         Addition of frame erasure simulation at the decoder                                                                                                                                                             6.0.0     6.1.0
  2004-12              26             SP-040841      015                Removal of two unused stereo rates                                                                                                                                                                              6.0.0     6.1.0
  2004-12              26             SP-040841      016                Removal of extStMode                                                                                                                                                                                            6.0.0     6.1.0
  2005-03              27             SP-050096      019      1         AMR-WB/AMR-WB+ switching                                                                                                                                                                                        6.1.0     6.2.0
  2005-03              27             SP-050096      020      2         Clean-up of unused C-code functions                                                                                                                                                                             6.1.0     6.2.0
  2005-03              27             SP-050096      021      1         Correction of misbehaviour of constrained cholesky                                                                                                                                                              6.1.0     6.2.0
  2005-03              27             SP-050096      022      1         Source code bit exact editorial changes                                                                                                                                                                         6.1.0     6.2.0
  2005-03              27             SP-050096      023      2         Correction of last frame processing                                                                                                                                                                             6.1.0     6.2.0
  2005-03              27             SP-050096      024      1         Correction of frame erasure concealment                                                                                                                                                                         6.1.0     6.2.0
  2005-03              27             SP-050096      025      1         Correction of references and terminology                                                                                                                                                                        6.1.0     6.2.0
  2005-06              28             SP-050252      026                Correction of DTX handling in AMR-WB modes                                                                                                                                                                      6.2.0     6.3.0
  2005-06              28             SP-050252      027                Remove IF2 header in AMR-WB bitstream                                                                                                                                                                           6.2.0     6.3.0
  2005-06              28             SP-050252      028                Decoder synchronization after frame erasures                                                                                                                                                                    6.2.0     6.3.0
  2005-06              28             SP-050252      029                Correction for buffer reading in low complexity encoder                                                                                                                                                         6.2.0     6.3.0
  2005-06              28             SP-050252      030                Correction to a wrong function call                                                                                                                                                                             6.2.0     6.3.0
  2005-06              28             SP-050252      031                Correction of mode switching using configuration file                                                                                                                                                           6.2.0     6.3.0
  2005-06              28             SP-050252      032                Correction of information printed by decoder in DTX frames                                                                                                                                                      6.2.0     6.3.0
  2005-06              28             SP-050252      033                Correction of library function for 3GP file format                                                                                                                                                              6.2.0     6.3.0
  2005-06              28             SP-050252      034                Support for input files with sampling frequency other than 48 kHz                                                                                                                                               6.2.0     6.3.0
  2005-09              29             SP-050425      0035               Correction to frame erasure concealment                                                                                                                                                                         6.3.0     6.4.0
  2006-03              31             SP-060012      0036               Correction to end-of-file logic and initialisation in AMR-WB modes                                                                                                                                              6.4.0     6.5.0
  2006-03              31             SP-060012      0037               Correction to unnecessary look ahead in encoder                                                                                                                                                                 6.4.0     6.5.0
  2006-03              31             SP-060012      0038               Correction to memory initialization and memory overwrite when switching between AMR-WB and AMR-WB+ modes                                                                                                        6.4.0     6.5.0
  2006-03              31             SP-060012      0039               Correction to VC 6.0 compilation warnings                                                                                                                                                                       6.4.0     6.5.0
  2006-06              32             SP-060353      0040               Correction to switching between AMR-WB and AMR-WB+ modes                                                                                                                                                        6.5.0     6.6.0
  2006-06              32             SP-060353      0041               Correction to default stereo codec configurations                                                                                                                                                               6.5.0     6.6.0
  2007-03              35             SP-070029      0042               Reference to users guide                                                                                                                                                                                        6.6.0     7.0.0
  2008-12              42                                               Version for Release 8                                                                                                                                                                                           7.0.0     8.0.0
  2009-12              46                                               Version for Release 9                                                                                                                                                                                           8.0.0     9.0.0
  2011-03              51                                               Version for Release 10                                                                                                                                                                                          9.0.0     10.0.0
  2012-09              57                                               Version for Release 11                                                                                                                                                                                          10.0.0    11.0.0
  2012-10                                                               Correction of Change History                                                                                                                                                                                    11.0.0    11.0.1
  2014-09              65                                               Version for Release 12                                                                                                                                                                                          11.0.1    12.0.0
  2015-12              70                                               Version for Release 13                                                                                                                                                                                          12.0.0    13.0.0
  -------------------- -------------- -------------- -------- --------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------- ---------

  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
  **Change history**                                                                                          
  **Date**             **Meeting**   **TDoc**   **CR**   **Rev**   **Cat**   **Subject/Comment**              **New version**
  2017-03              75                                                    Version for Release 14           14.0.0
  2018-06              80                                                    Version for Release 15           15.0.0
  2020-07              \-            \-         \-       \-        \-        Update to Rel-16 version (MCC)   **16.0.0**
  -------------------- ------------- ---------- -------- --------- --------- -------------------------------- -----------------
