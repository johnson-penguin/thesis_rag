+----------------------------------+----------------------------------+
| 3GPP TS 33.535 V16.2.0 (2020-12) |                                  |
+==================================+==================================+
| Technical Specification          |                                  |
+----------------------------------+----------------------------------+
| 3rd Generation Partnership       |                                  |
| Project;                         |                                  |
|                                  |                                  |
| Technical Specification Group    |                                  |
| Services and System Aspects;     |                                  |
|                                  |                                  |
| Authentication and Key           |                                  |
| Management for Applications      |                                  |
| (AKMA)\                          |                                  |
| based on 3GPP credentials in the |                                  |
| 5G System (5GS)                  |                                  |
|                                  |                                  |
| (Release 16)                     |                                  |
+----------------------------------+----------------------------------+
|                                  |                                  |
+----------------------------------+----------------------------------+
| !                                | ![3GPP-logo\_web](media/image2.p |
| [5G-logo\_175px](media/image1.jp | ng){width="1.7715277777777778in" |
| eg){width="1.3222222222222222in" | height="1.0340277777777778in"}   |
| height="0.9152777777777777in"}   |                                  |
+----------------------------------+----------------------------------+
|                                  |                                  |
+----------------------------------+----------------------------------+
| The present document has been    |                                  |
| developed within the 3rd         |                                  |
| Generation Partnership Project   |                                  |
| (3GPP ^TM^) and may be further   |                                  |
| elaborated for the purposes of   |                                  |
| 3GPP.\                           |                                  |
| The present document has not     |                                  |
| been subject to any approval     |                                  |
| process by the 3GPP              |                                  |
| Organizational Partners and      |                                  |
| shall not be implemented.\       |                                  |
| This Specification is provided   |                                  |
| for future development work      |                                  |
| within 3GPP only. The            |                                  |
| Organizational Partners accept   |                                  |
| no liability for any use of this |                                  |
| Specification.\                  |                                  |
| Specifications and Reports for   |                                  |
| implementation of the 3GPP ^TM^  |                                  |
| system should be obtained via    |                                  |
| the 3GPP Organizational          |                                  |
| Partners\' Publications Offices. |                                  |
+----------------------------------+----------------------------------+

+----------------------------------------------------------------------+
|                                                                      |
+======================================================================+
| > ***3GPP***                                                         |
| >                                                                    |
| > Postal address                                                     |
| >                                                                    |
| > 3GPP support office address                                        |
| >                                                                    |
| > 650 Route des Lucioles - Sophia Antipolis                          |
| >                                                                    |
| > Valbonne - FRANCE                                                  |
| >                                                                    |
| > Tel.: +33 4 92 94 42 00 Fax: +33 4 93 65 47 16                     |
| >                                                                    |
| > Internet                                                           |
| >                                                                    |
| > http://www.3gpp.org                                                |
+----------------------------------------------------------------------+
| ***Copyright Notification***                                         |
|                                                                      |
| No part may be reproduced except as authorized by written            |
| permission.\                                                         |
| The copyright and the foregoing restriction extend to reproduction   |
| in all media.                                                        |
|                                                                      |
| © 2020, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, |
| TTA, TTC).                                                           |
|                                                                      |
| All rights reserved.                                                 |
|                                                                      |
| UMTS™ is a Trade Mark of ETSI registered for the benefit of its      |
| members                                                              |
|                                                                      |
| 3GPP™ is a Trade Mark of ETSI registered for the benefit of its      |
| Members and of the 3GPP Organizational Partners\                     |
| LTE™ is a Trade Mark of ETSI registered for the benefit of its       |
| Members and of the 3GPP Organizational Partners                      |
|                                                                      |
| GSM® and the GSM logo are registered and owned by the GSM            |
| Association                                                          |
+----------------------------------------------------------------------+

 Contents {#contents .TT}
========

Foreword 5

1 Scope 7

2 References 7

3 Definitions of terms, symbols and abbreviations 7

3.1 Terms 7

3.2 Symbols 7

3.3 Abbreviations 7

4 Architecture for AKMA 8

4.1 Reference model 8

4.2 Network elements 9

4.2.1 AAnF 9

4.2.2 AF 9

4.2.3 NEF 9

4.2.4 AUSF 9

4.2.5 UDM 9

4.3 AKMA Service Based Interfaces(SBIs) 9

4.3.0 General 9

4.3.1 Void 10

4.4 Security requirements and principles for AKMA 10

4.4.0 General 10

4.4.1 Requirements on Ua\* reference point 10

4.4.2 Requirements on AKMA Key Identifier (A-KID) 10

4.5 AKMA reference points 10

5 Key management 11

5.1 AKMA key hierarchy 11

5.2 AKMA key lifetimes 11

6 AKMA Procedures 12

6.1 Deriving AKMA key after primary authentication 12

6.2 Deriving AKMA Application Key for a specific AF 13

6.3 AKMA Application Key request via NEF 14

6.4 AKMA key change 15

6.4.1 K~AKMA~ re-keying 15

6.4.2 K~AF~ re-keying 15

6.4.3 K~AF~ refresh 15

6.5 Initiation of AKMA 15

7 Security related services 16

7.1 Services provided by AAnF 16

7.1.1 General 16

7.1.2 Naanf\_AKMA\_AnchorKey\_Register service operation 16

7.2 Void 16

7.3 Services provided by NEF 16

7.3.1 General 16

7.3.2 Nnef\_AKMA\_ApplicationKey\_Getservice operation 16

7.4 Services provided by UDM 17

Annex A (normative): Key derivation functions 18

A.1 KDF interface and input parameter construction 18

A.1.1 General 18

A.1.2 FC value allocations 18

A.2 K~AKMA~ derivation function 18

A.3 A-TID derivation function 18

A.4 K~AF~ derivation function 19

Annex B (informative): Change history 20

Foreword
========

This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

In the present document, modal verbs have the following meanings:

**shall** indicates a mandatory requirement to do something

**shall not** indicates an interdiction (prohibition) to do something

The constructions \"shall\" and \"shall not\" are confined to the
context of normative provisions, and do not appear in Technical Reports.

The constructions \"must\" and \"must not\" are not used as substitutes
for \"shall\" and \"shall not\". Their use is avoided insofar as
possible, and they are not used in a normative context except in a
direct citation from an external, referenced, non-3GPP document, or so
as to maintain continuity of style when extending or modifying the
provisions of such a referenced document.

**should** indicates a recommendation to do something

**should not** indicates a recommendation not to do something

**may** indicates permission to do something

**need not** indicates permission not to do something

The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\"
are used instead, depending upon the meaning intended.

**can** indicates that something is possible

**cannot** indicates that something is impossible

The constructions \"can\" and \"cannot\" are not substitutes for \"may\"
and \"need not\".

**will** indicates that something is certain or expected to happen as a
result of action taken by an agency the behaviour of which is outside
the scope of the present document

**will not** indicates that something is certain or expected not to
happen as a result of action taken by an agency the behaviour of which
is outside the scope of the present document

**might** indicates a likelihood that something will happen as a result
of action taken by some agency the behaviour of which is outside the
scope of the present document

**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside
the scope of the present document

In addition:

**is** (or any other verb in the indicative mood) indicates a statement
of fact

**is not** (or any other negative verb in the indicative mood) indicates
a statement of fact

The constructions \"is\" and \"is not\" do not indicate requirements.

 1 Scope
=======

The present document specifies the security features and mechanisms to
support authentication and key management aspects for applications based
on subscription credential(s) in 5G system as defined in TS 33.501
\[2\].

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".

\[2\] 3GPP TS 33.501: \"Security architecture and procedures for 5G
system\".

\[3\] 3GPP TS 23.501: \"System Architecture for the 5G System\".

\[4\] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA);
Generic Bootstrapping Architecture (GBA)\".

\[5\] 3GPP TS 23.222: \"Common API Framework for 3GPP Northbound APIs\".

\[6\] IETF RFC 7542: \"The Network Access Identifier\".

3 Definitions of terms, symbols and abbreviations
=================================================

3.1 Terms
---------

For the purposes of the present document, the terms given in
TR 21.905 \[1\] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any,
in 3GPP TR 21.905 \[1\].

**AKMA subscription data:** The data in the home operator\'s network
indicating whether or not the subscriber is allowed to use AKMA.

**AKMA context: A set of parameters stored in AAnF, including SUPI,
K~AKMA~ and A-KID.**

3.2 Symbols
-----------

Void.

3.3 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
3GPP TR 21.905 \[1\] and the following apply. An abbreviation defined in
the present document takes precedence over the definition of the same
abbreviation, if any, in 3GPP TR 21.905 \[1\].

A-KID AKMA Key IDentifier

A-TID *AKMA Temporary UE IDentifier*

AAnF AKMA Anchor Function

AF Application Function

AKMA Authentication and Key Management for Applications

AMF Access and Mobility Management Function

AUSF AUthentication Server Function

K~AF~ AKMA Application Key

K~AKMA~ AKMA Anchor Key

KDF Key Derivation Function

NEF Network Exposure Function

UDM Unified Data Management

4 Architecture for AKMA
=======================

4.1 Reference model
-------------------

Figure 4.1-1 shows a fundamental network model of AKMA, as well as the
interfaces between them.

Figure 4.1-1: Fundamental Network Model for AKMA

NOTE: Figure 4.1-1 shows the case where AAnF is deployed as a standalone
function. Deployments can choose to collocate AAnF with AUSF or with NEF
according to operators\' deployment scenarios.

Figure 4.1-2 shows the AKMA architecture using the reference point
representation.

Figure 4.1-2: AKMA Architecture in reference point representation for
(a) internal AFs and (b) external AFs

The AKMA service requires a new logical entity, called the AKMA Anchor
Function (AAnF).

4.2 Network elements
--------------------

### 4.2.1 AAnF

The AAnF is the anchor function in the HPLMN. The AAnF stores the AKMA
Anchor Key (K~AKMA~) for AKMA service, which is received from the AUSF
after the UE completes a successful 5G primary authentication. The AAnF
also generates the key material to be used between the UE and the
Application Function (AF) and maintains UE AKMA contexts.

### 4.2.2 AF

The AF is defined in TS 23.501 \[3\] with additional functions:

\- AF with the AKMA service enabling requests for AKMA Application Key,
called K~AF,~ from the AAnF using A-KID.

\- AF shall be authenticated and authorized by the operator network
before providing the K~AF~ to the AF.

### 4.2.3 NEF

The NEF is defined in TS 23.501 \[3\] with additional functions:

\- The NEF enables and authorizes the external AF assessing AKMA service
and forwards the request towards the AAnF.

\- The NEF performs the AAnF selection.

### 4.2.4 AUSF

The AUSF is defined in TS 23.501 \[3\] with additional functions:

\- AUSF provides the SUPI and AKMA key material (A-KID,K~AKMA~) of the
UE to the AAnF.

### 4.2.5 UDM

The UDM is defined in TS 23.501 \[3\] with the additional functions:

\- UDM stores AKMA subscription data of the subscriber.

4.3 AKMA Service Based Interfaces(SBIs)
---------------------------------------

### 4.3.0 General

The following interfaces are involved in AKMA network architecture:

**- Nnef:** Service-based interface exhibited by NEF.

**- Nudm:** Service-based interface exhibited by UDM.

NOTE 1: UDM services related to AKMA service are defined in
TS 33.501 \[2\] clause 14.2.2.

**- Naanf:** Service-based interface exhibited by AAnF.

The AAnF interacts with the AUSF and the AF using Service-based
Interfaces. When the AF is located in the operator\'s network, the AAnF
shall use Service-Based Interface to communicate with the AF directly.
When the AF is located outside the operator\'s network, the NEF shall be
used to exchange the messages between the AF and the AAnF.

### 4.3.1 Void

4.4 Security requirements and principles for AKMA
-------------------------------------------------

4.4.0 General
-------------

The following security requirements are applicable to AKMA:

\- AKMA shall reuse the same UE subscription and the same credentials
used for 5G access.

\- AKMA shall reuse the 5G primary authentication procedure and methods
specified in TS 33.501 \[2\] for the sake of implicit authentication for
AKMA services.

\- The SBA interface between the AAnF and the AUSF shall be
confidentiality, integrity and replay protected.

\- The SBA interface between AAnF and AF/NEF shall be confidentiality,
integrity and replay protected.

\- The AKMA Application Key (K~AF~) shall be provided with a maximum
lifetime.

NOTE: Roaming aspects are not considered in the present document.

### 4.4.1 Requirements on Ua\* reference point

The Ua\* reference point is application specific. The generic
requirements for Ua\* are:

\- Ua\* protocol shall be able to carry AKMA Key Identifier (A-KID);

\- the UE and the AKMA AF shall be able to secure the reference point
Ua\* using the AKMA Application Key derived from the AKMA Anchor Key.

NOTE 1: The exact method of securing the reference point Ua\* depends on
the application protocol used over reference point Ua\*.

NOTE 2: Specifying Ua\* protocol identifier is not considered in the
present document.

\- The Ua\* protocol shall be able to handle the expiration of K~AF.~

### 4.4.2 Requirements on AKMA Key Identifier (A-KID)

Requirements for AKMA Key Identifier (A-KID) are:

\- A-KID shall be globally unique;

\- A-KID shall be usable as a key identifier in protocols used in the
reference point Ua\*;

\- AKMA AF shall be able to identify the AAnF serving the UE from the
A-KID.

4.5 AKMA reference points
-------------------------

The AKMA architecture reuses the following reference point from the 5GC
for the execution of the primary authentication procedure:

**N1:** Reference point between the UE and the AMF.

**N2:** Reference point between the (R)AN and the AMF.

**N12:** Reference point between AMF and AUSF.

**N13:** Reference point between the UDM and the AUSF.

**N33:** Reference point between NEF and an external AF.

The AKMA architecture defines the following reference points:

**N61**: Reference point between the AAnF and the AUSF.

**N62**: Reference point between the AAnF and an internal AF.

**N63**: Reference point between the AAnF and NEF.

**Ua\***: Reference point between the UE and an AF.

NOTE: The reference point Ua\* carries the application protocol, which
is secured using the key material agreed between UE and AAnF as a result
of successful AKMA procedures.

5 Key management 
================

5.1 AKMA key hierarchy
----------------------

The key hierarchy (see Figure 5.1-1) includes the following keys:
K~AUSF~, K~AKMA~, K~AF.~ K~AUSF~ is generated by AUSF as specified in
clause 6 of TS 33.501 \[2\].

Keys for AAnF:

\- K~AKMA~ is a key derived by ME and AUSF from K~AUSF~.

Keys for AF:

\- K~AF~ is a key derived by ME and AAnF from K~AKMA~.

K~AKMA~ and K~AF~ are derived according to the procedures of clauses 6.1
and 6.2.

Figure 5.1-1: AKMA Key Hierarchy

5.2 AKMA key lifetimes
----------------------

The K~AKMA~ and A-KID are valid until the next successful primary
authentication is performed (implicit lifetime), in which case the
K~AKMA~ and A-KID are replaced.

AKMA Application Keys K~AF~ shall use explicit lifetimes based on the
operator\'s policy. The lifetime of K~AF~ shall be sent by the AAnF as
described in clauses 6.2 and 6.3. In case that a new AKMA Anchor Key
K~AKMA~ is established, the AKMA Application Key K~AF~ can continue to
be used until its lifetime expires. When the K~AF~ lifetime expires, a
new AKMA Application Key is established based on the current AKMA Anchor
Key K~AKMA~.

6 AKMA Procedures
=================

6.1 Deriving AKMA key after primary authentication
--------------------------------------------------

There is no separate authentication of the UE to support AKMA
functionality. Instead, AKMA reuses the 5G primary authentication
procedure executed e.g. during the UE Registration to authenticate the
UE. A successful 5G primary authentication results in K~AUSF~ being
stored at the AUSF and the UE. Figure 6.1-1 shows the procedure to
derive K~AKMA~ after a successful primary authentication.

Figure 6.1-1: Deriving K~AKMA~ after primary authentication

1\) During the primary authentication procedure, the AUSF interacts with
the UDM in order to fetch authentication information such as
subscription credentials (e.g. AKA Authentication vectors) and the
authentication method using the Nudm\_UEAuthentication\_Get Request
service operation.

2\) In the response, the UDM may also indicate to the AUSF whether AKMA
Anchor keys need to be generated for the UE.

3\) If the AUSF receives the AKMA indication from the UDM, the AUSF
shall store the K~AUSF~ and generate the AKMA Anchor Key (K~AKMA~) and
the A-KID from K~AUSF~ after the primary authentication procedure is
successfully completed.

The UE shall generate the AKMA Anchor Key (K~AKMA~) and the A-KID from
the K~AUSF~ before initiating communication with an AKMA Application
Function.

4\) After AKMA key material is generated, the AUSF shall send the
generated A-KID, and K~AKMA~ to the AAnF together with the SUPI of the
UE using the Naanf\_AKMA\_KeyRegistration Request service operation. The
AAnF shall store the latest information sent by the AUSF.

NOTE 1: The AUSF need not store any AKMA key material after delivery to
the AAnF.

NOTE 1a: When re-authentication runs, the AUSF generates a new A-KID,
and a new K~AKMA~ and sends the new generated A-KID and K~AKMA~ to the
AAnF. After receiving the new generated A-KID and K~AKMA~, the AAnF
deletes the old A-KID and K~AKMA~ and stores the new generated A-KID and
K~AKMA~.

5\) The AAnF sends the response to the AUSF using the
Naanf\_AKMA\_AnchorKey\_Register Response service operation.

A-KID identifies the K~AKMA~ key of the UE.

A-KID shall be in NAI format as specified in clause 2.2 of IETF RFC 7542
\[6\], i.e. username\@realm. The username part shall include the Routing
Identifier and the A-TID (*AKMA Temporary UE Identifier*), and the realm
part shall include Home Network Identifier.

The A-TID shall be derived from K~AUSF~ as specified in Annex A.3.

NOTE 2: The chance of A-TID collision is not zero but practically low as
the A-TID derivation is based on KDF specified in Annex B of TS 33.220
\[4\]. The detection of A-TID collision as well as potential handling of
collision is not addressed in the present document.

K~AKMA~ shall be derived from K~AUSF~ as specified in Annex A.2. Since
K~AKMA~ and A-TID in A-KID are both derived from K~AUSF~ based on
primary authentication run, the K~AKMA~ and A-KID can only be refreshed
by a new successful primary authentication.

6.2 Deriving AKMA Application Key for a specific AF
---------------------------------------------------

Figure 6.2-1 shows the procedure used by the AF to request application
function specific AKMA keys from the AAnF, when the AF is located inside
the operator\'s network.

Figure 6.2-1: K~AF~ generation from K~AKMA~

Before communication between the UE and the AKMA AF can start, the UE
and the AKMA AF needs to know whether to use AKMA. This knowledge is
implicit to the specific application on the UE and the AKMA AF or
indicated by the AKMA AF to the UE (see clause 6.5).

1\. The UE shall generate the AKMA Anchor Key (K~AKMA~) and the A-KID
from the K~AUSF~ before initiating communication with an AKMA
Application Function. When the UE initiates communication with the AKMA
AF, it shall include the derived A-KID (see clause 6.1) in the
Application Session Establishment request message.

2\. If the AF does not have an active context associated with the A-KID,
then the AF sends a Naanf\_AKMA\_ApplicationKey\_Get request to AAnF
with the A-KID to request the K~AF~ for the UE. The AF also includes its
identity (AF\_ID) in the request.

AF\_ID consists of the FQDN of the AF and the Ua\* security protocol
identifier. The latter parameter identifies the security protocol that
the AF will use with the UE.

The AAnF shall check whether the AAnF can provide the service to the AF
based on the configured local policy or based on the authorization
information or policy provided by the NRF using the AF\_ID. If it
succeeds, the following procedures are executed. Otherwise, the AAnF
shall reject the procedure.

The AAnF shall verify whether the subscriber is authorized to use AKMA
based on the presence of the UE specific K~AKMA~ key identified by the
A-KID.

If K~AKMA~ is present in AAnF, the AAnF shall continue with step 3.

If K~AKMA~ is not present in the AAnF, the AAnF shall continue with step
4 with an error response.

3\. The AAnF derives the AKMA Application Key (K~AF~) from K~AKMA~ if it
does not already have K~AF~.

The key derivation of K~AF~ shall be performed as specified in Annex
A.4.

4\. The AAnF sends Naanf\_AKMA\_ApplicationKey\_Get response to the AF
with K~AF~ and the K~AF~ expiration time.

5\. The AF sends the Application Session Establishment Response to the
UE. If the information in step 4 indicates failure of AKMA key request,
the AF shall reject the Application Session Establishment by including a
failure cause. Afterwards, UE may trigger a new Application Session
Establishment request with the latest A-KID to the AKMA AF.

6.3 AKMA Application Key request via NEF
----------------------------------------

Figure 6.3-1 shows the procedure used by the AF to request K~AF~ from
the AAnF via NEF, when the AF is located outside the operator\'s
network.

Figure 6.3-1: AKMA Application Key request via NEF

1\. When the AF is about to request AKMA Application Key for the UE from
the AAnF, e.g. when UE initiates application session establishment
request as in clause 6.2, the AF discovers the HPLMN of the UE based on
the A-KID and sends the request towards the AAnF via NEF service API.
The request shall include the A-KID and the AF\_ID.

NOTE: In the case of architecture without CAPIF support, the AF is
locally configured with the API termination points for the service. In
the case of architecture with CAPIF support, the AF obtains the service
API information from the CAPIF core function via the Availability of
service APIs event notification or Service Discover Response as
specified in TS 23.222 \[5\].

2\. If the AF is authorized by the NEF to request K~AF~, the NEF
discovers and selects an AAnF based on local configuration or via NRF in
the same way as the AF selects the AAnF in clause 6.2.

3\. The NEF forwards the K~AF~ request to the selected AAnF.

4\. The AAnF generates the K~AF~ as specified in clause 6.2 and sends
the response to the NEF with the K~AF~, the K~AF~ expiration time
(K~AF~exptime) and potentially other parameters.

5\. The NEF forwards the response to the AF.

Editor\'s Note: Whether other parameters are to be returned to the AF
via NEF is FFS.

6.4 AKMA key change
-------------------

### 6.4.1 K~AKMA~ re-keying

K~AKMA~ shall be re-keyed by running a successful primary authentication
as described in clause 6.1.

### 6.4.2 K~AF~ re-keying

The K~AF~ re-keying depends on the lifetime of the K~AF~ and may be
trigged by the AF, which means that when a new K~AKMA~ is derived, the
K~AF~ will not be re-keyed automatically.

When the lifetime of K~AF~ expires, the AF may reject UE's access to the
AF or refresh the K~AF~ as description in clause 6.4.3 based on its
policy. If there has been a change of K~AUSF~ (e.g., due to a successful
run of primary authentication), the UE may re-try accessing the AF by
using the A-KID derived from the new K~AUSF~ .

### 6.4.3 K~AF~ refresh

Ua\* protocol may support refresh of K~AF~. If the Ua\* protocol
supports refresh of K~AF~, the AF may refresh the K~AF~ at any time
using the Ua\* protocol.

6.5 Initiation of AKMA
----------------------

In case when the UE does not know to use AKMA for a service, then the
following procedure shown in figure 6.5-1 applies.

![](media/image10.png){width="2.716666666666667in" height="1.85in"}

Figure 6.5-1: Initiation of AKMA

1\. The UE may start communication over reference point Ua\* with the AF
with or without any AKMA-related parameters.

2\. If the AF requires the use of shared keys obtained by means of the
AKMA, but the request from UE does not include AKMA-related parameters,
the AF replies with an AKMA initiation message. The form of this
initiation message may depend on the particular reference point Ua\*.

In case the UE knows to use AKMA for a service, then it directly
initiates the procedure in clause 6.2.

7 Security related services
===========================

7.1 Services provided by AAnF
-----------------------------

### 7.1.1 General

The following table shows the AAnF Services and AAnF Service Operations.

Table 7.1.1-1: List of AAnF Services

+--------------+---------------------+------------------+---------------------+
| Service Name | Service Operations  | Operation        | Example Consumer(s) |
|              |                     |                  |                     |
|              |                     | Semantics        |                     |
+==============+=====================+==================+=====================+
| Naanf\_AKMA  | AnchorKey\_Register | Request/Response | AUSF                |
+--------------+---------------------+------------------+---------------------+
|              | ApplicationKey\_Get | Request/Response | AF, NEF             |
+--------------+---------------------+------------------+---------------------+

### 7.1.2 Naanf\_AKMA\_AnchorKey\_Register service operation

**Service operation name:** Naanf\_AKMA\_AnchorKey\_Register.

**Description:** The NF consumer requests the AAnF to store the AKMA
related key material.

**Input, Required:** SUPI, A-KID, K~AKMA~

**Input, Optional:** None.

**Output, Required:** None.

**Output, Optional:** None.

7.2 Void
--------

7.3 Services provided by NEF
----------------------------

### 7.3.1 General

The NEF exposes AKMA Application Key derivation service to the requester
NF.

The following table shows the NEF Services and NEF Service Operations
related to AKMA service.

Table 7.1.1-1: List of AAnF Services

+--------------+---------------------+------------------+---------------------+
| Service Name | Service Operations  | Operation        | Example Consumer(s) |
|              |                     |                  |                     |
|              |                     | Semantics        |                     |
+==============+=====================+==================+=====================+
| Nnef\_AKMA   | ApplicationKey\_Get | Request/Response | AF                  |
+--------------+---------------------+------------------+---------------------+

### 7.3.2 Nnef\_AKMA\_ApplicationKey\_Getservice operation 

**Service operation name:** Nnef\_AKMA\_ApplicationKey\_Get.

**Description:** The NF consumer requests the NEF to provide AF related
key material.

**Input, Required:** A-KID, AF\_ID

**Input, Optional:** None.

**Output, Required:** K~AF~, K~AF~ expiration time.

**Output, Optional:** None.

7.4 Services provided by UDM
----------------------------

UDM services related to AKMA service are defined in TS 33.501 \[2\]
clause 14.2.2.

######## Annex A (normative): Key derivation functions

A.1 KDF interface and input parameter construction
==================================================

A.1.1 General
-------------

All key derivations for AKMA shall be performed using the key derivation
function (KDF) specified in Annex B.2.2 of TS 33.220 \[4\].

This clause specifies how to construct the input string, S, and the
input key, KEY, for each distinct use of the KDF. Note that \"KEY\" is
denoted \"Key\" in TS 33.220 \[4\].

A.1.2 FC value allocations
--------------------------

The FC number space used is controlled by TS 33.220 \[4\], FC values
allocated for the present document are in the range of 0x80 -- 0x82.

A.2 K~AKMA~ derivation function
===============================

When deriving a K~AKMA~ from K~AUSF~, the following parameters shall be
used to form the input S to the KDF:

\- FC = 0x80;

\- P0 = \"AKMA\";

\- L0 = length of \"AKMA\"; (i.e. 0x00 0x04)

\- P1 = SUPI;

\- L1 = length of SUPI.

The input key KEY shall be K~AUSF~.

SUPI shall be have the same value as parameter P0 in Annex A.7.0 of TS
33.501 \[2\].

A.3 A-TID derivation function
=============================

When deriving the A-TID from K~AUSF~, the following parameters shall be
used to form the input S to the KDF:

\- FC = 0x81;

\- P0 = \"A-TID\";

\- L0 = length of \"A-TID\"; (i.e. 0x00 0x05)

\- P1 = SUPI;

\- L1 = length of SUPI.

The input key KEY shall be K~AUSF~.

SUPI shall be have the same value as parameter P0 in Annex A.7.0 of TS
33.501 \[2\].

A.4 K~AF~ derivation function
=============================

When deriving a K~AF~ from K~AKMA~, the following parameters shall be
used to form the input S to the KDF:

\- FC = 0x82;

\- P0 =AF\_ID;

\- L0 = length of AF\_ID

The input key KEY shall be K~AKMA~.

AF\_ID is constructed as follows:

AF\_ID = FQDN of the AF \|\| Ua\* security protocol identifier, where
the Ua\* security protocol identifier is specified as Ua security
protocol identifier in Annex H of TS 33.220 \[4\].

######## Annex B (informative): Change history

+-------+-------+-------+-------+-------+-------+-------+-------+
| **C   |       |       |       |       |       |       |       |
| hange |       |       |       |       |       |       |       |
| hist  |       |       |       |       |       |       |       |
| ory** |       |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| **D   | *     | **T   | *     | **    | **    | **Su  | **New |
| ate** | *Meet | Doc** | *CR** | Rev** | Cat** | bject | vers  |
|       | ing** |       |       |       |       | /Comm | ion** |
|       |       |       |       |       |       | ent** |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  |       |       |       | Edi   | 1.0.0 |
| 20-06 | #88-e | 00381 |       |       |       | tHelp |       |
|       |       |       |       |       |       | re    |       |
|       |       |       |       |       |       | view. |       |
|       |       |       |       |       |       |       |       |
|       |       |       |       |       |       | Pres  |       |
|       |       |       |       |       |       | ented |       |
|       |       |       |       |       |       | for   |       |
|       |       |       |       |       |       | i     |       |
|       |       |       |       |       |       | nform |       |
|       |       |       |       |       |       | ation |       |
|       |       |       |       |       |       | and   |       |
|       |       |       |       |       |       | app   |       |
|       |       |       |       |       |       | roval |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   |       |       |       |       | Up    | 1     |
| 20-07 | #88-e |       |       |       |       | grade | 6.0.0 |
|       |       |       |       |       |       | to    |       |
|       |       |       |       |       |       | c     |       |
|       |       |       |       |       |       | hange |       |
|       |       |       |       |       |       | co    |       |
|       |       |       |       |       |       | ntrol |       |
|       |       |       |       |       |       | ve    |       |
|       |       |       |       |       |       | rsion |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0001  | \-    | D     | Add   | 1     |
| 20-09 | #89-e | 00708 |       |       |       | Abb   | 6.1.0 |
|       |       |       |       |       |       | revia |       |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | to    |       |
|       |       |       |       |       |       | c     |       |
|       |       |       |       |       |       | lause |       |
|       |       |       |       |       |       | 3.3   |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0009  | 1     | F     | Clar  | 1     |
| 20-09 | #89-e | 00708 |       |       |       | ifica | 6.1.0 |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | on    |       |
|       |       |       |       |       |       | error |       |
|       |       |       |       |       |       | res   |       |
|       |       |       |       |       |       | ponse |       |
|       |       |       |       |       |       | han   |       |
|       |       |       |       |       |       | dling |       |
|       |       |       |       |       |       | in    |       |
|       |       |       |       |       |       | AKMA  |       |
|       |       |       |       |       |       | pr    |       |
|       |       |       |       |       |       | ocess |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0013  | 1     | F     | Re    | 1     |
| 20-09 | #89-e | 00708 |       |       |       | -auth | 6.1.0 |
|       |       |       |       |       |       | entic |       |
|       |       |       |       |       |       | ation |       |
|       |       |       |       |       |       | in    |       |
|       |       |       |       |       |       | AKMA  |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0020  | \-    | F     | A     | 1     |
| 20-09 | #89-e | 00708 |       |       |       | dding | 6.1.0 |
|       |       |       |       |       |       | AKMA  |       |
|       |       |       |       |       |       | co    |       |
|       |       |       |       |       |       | ntext |       |
|       |       |       |       |       |       | d     |       |
|       |       |       |       |       |       | escri |       |
|       |       |       |       |       |       | ption |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0023  | 1     | F     | C     | 1     |
| 20-09 | #89-e | 00708 |       |       |       | orrec | 6.1.0 |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | and   |       |
|       |       |       |       |       |       | clar  |       |
|       |       |       |       |       |       | ifica |       |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | to    |       |
|       |       |       |       |       |       | c     |       |
|       |       |       |       |       |       | lause |       |
|       |       |       |       |       |       | 4     |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0024  | 1     | F     | C     | 1     |
| 20-09 | #89-e | 00708 |       |       |       | orrec | 6.1.0 |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | to    |       |
|       |       |       |       |       |       | AKMA  |       |
|       |       |       |       |       |       | key   |       |
|       |       |       |       |       |       | life  |       |
|       |       |       |       |       |       | times |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0025  | 1     | F     | C     | 1     |
| 20-09 | #89-e | 00708 |       |       |       | orrec | 6.1.0 |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | and   |       |
|       |       |       |       |       |       | clar  |       |
|       |       |       |       |       |       | ifica |       |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | to    |       |
|       |       |       |       |       |       | AKMA  |       |
|       |       |       |       |       |       | proce |       |
|       |       |       |       |       |       | dures |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0026  | 1     | F     | Assig | 1     |
| 20-09 | #89-e | 00708 |       |       |       | nment | 6.1.0 |
|       |       |       |       |       |       | of FC |       |
|       |       |       |       |       |       | v     |       |
|       |       |       |       |       |       | alues |       |
|       |       |       |       |       |       | for   |       |
|       |       |       |       |       |       | key   |       |
|       |       |       |       |       |       | d     |       |
|       |       |       |       |       |       | eriva |       |
|       |       |       |       |       |       | tions |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0027  | \-    | F     | Spe   | 1     |
| 20-09 | #89-e | 00708 |       |       |       | cific | 6.1.0 |
|       |       |       |       |       |       | ation |       |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | value |       |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | SUPI  |       |
|       |       |       |       |       |       | for   |       |
|       |       |       |       |       |       | key   |       |
|       |       |       |       |       |       | d     |       |
|       |       |       |       |       |       | eriva |       |
|       |       |       |       |       |       | tions |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0032  | 1     | F     | AKMA  | 1     |
| 20-09 | #89-e | 00708 |       |       |       | SBA   | 6.1.0 |
|       |       |       |       |       |       | inte  |       |
|       |       |       |       |       |       | rface |       |
|       |       |       |       |       |       | clar  |       |
|       |       |       |       |       |       | ifica |       |
|       |       |       |       |       |       | tions |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA\   | SP-2  | 0034  | 1     | F     | Se    | 1     |
| 20-09 | #89-e | 00708 |       |       |       | veral | 6.1.0 |
|       |       |       |       |       |       | clar  |       |
|       |       |       |       |       |       | ifica |       |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | and   |       |
|       |       |       |       |       |       | edito |       |
|       |       |       |       |       |       | rials |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA    | SP-2  | 0043  | \-    | F     | Lif   | 1     |
| 20-12 | \#90e | 01006 |       |       |       | etime | 6.2.0 |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | KAF   |       |
|       |       |       |       |       |       | expir |       |
|       |       |       |       |       |       | ation |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA    | SP-2  | 0045  | \-    | F     | C     | 1     |
| 20-12 | \#90e | 01006 |       |       |       | orrec | 6.2.0 |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | c     |       |
|       |       |       |       |       |       | lause |       |
|       |       |       |       |       |       | 6.1   |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA    | SP-2  | 0046  | \-    | F     | Edit  | 1     |
| 20-12 | \#90e | 01006 |       |       |       | orial | 6.2.0 |
|       |       |       |       |       |       | mod   |       |
|       |       |       |       |       |       | ifica |       |
|       |       |       |       |       |       | tions |       |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | AKMA  |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | SA    | SP-2  | 0053  | 1     | F     | U     | 1     |
| 20-12 | \#90e | 01006 |       |       |       | pdate | 6.2.0 |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | the   |       |
|       |       |       |       |       |       | refe  |       |
|       |       |       |       |       |       | rence |       |
|       |       |       |       |       |       | point |       |
|       |       |       |       |       |       | inte  |       |
|       |       |       |       |       |       | rface |       |
|       |       |       |       |       |       | names |       |
|       |       |       |       |       |       | of    |       |
|       |       |       |       |       |       | AKMA  |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
