Foreword
========

This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work
within the TSG and may change following formal TSG approval. Should the
TSG modify the contents of the present document, it will be re-released
by the TSG with an identifying change of release date and an increase in
version number as follows:

Version x.y.z

where:

x the first digit:

1 presented to TSG for information;

2 presented to TSG for approval;

3 or greater indicates TSG approved document under change control.

y the second digit is incremented for all changes of substance, i.e.
technical enhancements, corrections, updates, etc.

z the third digit is incremented when editorial only changes have been
incorporated in the document.

 1 Scope
=======

The present document describes the physical channels for evolved UTRA.

2 References
============

The following documents contain provisions which, through reference in
this text, constitute provisions of the present document.

\- References are either specific (identified by date of publication,
edition number, version number, etc.) or non‑specific.

\- For a specific reference, subsequent revisions do not apply.

\- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a
non-specific reference implicitly refers to the latest version of that
document *in the same Release as the present document*.

\[1\] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".

\[2\] 3GPP TS 36.201: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); LTE physical layer; General description\".

\[3\] 3GPP TS 36.212: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Multiplexing and channel coding\".

\[4\] 3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Physical layer procedures\".

\[5\] 3GPP TS 36.214: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Physical layer; Measurements\".

\[6\] 3GPP TS 36.104: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Base Station (BS) radio transmission and reception\".

\[7\] 3GPP TS 36.101: \"Evolved Universal Terrestrial Radio Access
(E-UTRA); User Equipment (UE) radio transmission and reception\".

\[8\] 3GPP TS 36.321, \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Medium Access Control (MAC) protocol specification\".

\[9\] 3GPP TS 36.331, \"Evolved Universal Terrestrial Radio Access
(E-UTRA); Radio Resource Control (RRC) Protocol specification\"

\[10\] 3GPP TS 36.304, \"Evolved Universal Terrestrial Radio Access
(E-UTRA); User Equipment (UE) procedures in idle mode\"

\[11\] 3GPP TS 37.213: \"Physical layer procedures for shared spectrum
channel access\"

\[12\] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access
(E-UTRA) and Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); Overall description; Stage 2\"

3 Symbols and abbreviations
===========================

3.1 Symbols
-----------

For the purposes of the present document, the following symbols apply:

Resource element with frequency-domain index and time-domain index

Value of resource element \[for antenna port\]

Matrix for supporting cyclic delay diversity

Density of random access opportunities per radio frame

Carrier frequency

PRACH resource frequency index within the considered time-domain
location

PRACH frequency hopping offset, expressed as a number of resource blocks

Start symbol in slot 0 for NPDCCH

Start symbol in slot 0 for NPDSCH

Bandwidth for PSBCH transmission, expressed as a number of subcarriers

Bandwidth for PSBCH transmission, expressed as a number of resource
blocks

Bandwidth for PSCCH transmission, expressed as a number of subcarriers

Bandwidth for PSCCH transmission, expressed as a number of resource
blocks

Bandwidth for PSDCH transmission, expressed as a number of subcarriers

Bandwidth for PSDCH transmission, expressed as a number of resource
blocks

Scheduled bandwidth for PSSCH transmission, expressed as a number of
subcarriers

Scheduled bandwidth for PSSCH transmission, expressed as a number of
resource blocks

Scheduled bandwidth for uplink transmission, expressed as a number of
subcarriers

Scheduled bandwidth for uplink transmission, expressed as a number of
resource blocks

> Scheduled number of repetitions of a NPUSCH transmission

Scheduled number of repetitions of a NPDSCH transmission

Scheduled bandwidth for uplink NPUSCH transmission, expressed as a
number of subcarriers

Number of repetitions of identical slots for NPUSCH

Number of coded bits to transmit on a physical channel \[for codeword \]

Number of modulation symbols to transmit on a physical channel \[for
codeword \]

Number of modulation symbols to transmit per layer for a physical
channel

Number of modulation symbols to transmit per antenna port for a physical
channel

> ![](media/image32.wmf) Number of consecutive subcarriers in an UL
> resource unit for PUSCH sub-PRB allocation
>
> ![](media/image33.wmf) Number of slots in an UL resource unit for
> PUSCH sub-PRB allocation
>
> ![](media/image34.wmf) Number of SC-FDMA symbols in an uplink slot for
> PUSCH sub-PRB allocation
>
> Number of subcarriers in the frequency domain for PUSCH sub-PRB
> allocation
>
> $M_{\text{seq}}^{\text{RU}}$ Number of reference signal sequences
> available for the UL resource unit size for PUSCH sub-PRB allocation
>
> $M_{\text{RU}}$ Number of scheduled UL resource units for PUSCH
> sub-PRB allocation

A constant equal to 2048 for , 4096 for and 8192 for

Downlink cyclic prefix length for OFDM symbol in a slot

Cyclic shift value used for random access preamble generation

Number of cyclic shifts used for PUCCH formats 1/1a/1b in a resource
block with a mix of formats 1/1a/1b and 2/2a/2b

Bandwidth available for use by PUCCH formats 2/2a/2b, expressed in
multiples of

The offset used for PUSCH frequency hopping, expressed in number of
resource blocks (set by higher layers)

Physical layer cell identity

Narrowband physical layer cell identity

MBSFN area identity

Physical layer sidelink synchronization identity

Positioning reference signal identity

Downlink bandwidth configuration, expressed in multiples of

Smallest downlink bandwidth configuration, expressed in multiples of

Largest downlink bandwidth configuration, expressed in multiples of

Uplink bandwidth configuration, expressed in multiples of

Smallest uplink bandwidth configuration, expressed in multiples of

Largest uplink bandwidth configuration, expressed in multiples of

Sidelink bandwidth configuration, expressed in multiples of

$N_{\text{RSS}}$ Duration of RSS measured in subframes

Number of scheduled subframes for NPDSCH transmission

Number of symbols for NPSS in a subframe

Number of symbols for NSSS in a subframe

Number of consecutive subcarriers in an UL resource unit for NB-IoT

Number of reference signal sequences available for the UL resource unit
size

Number of scheduled UL resource units for NB-IoT

Total number of uplink narrowbands

Total number of uplink widebands

Number of subcarriers in the frequency domain for NB-IoT

Number of consecutive absolute subframes over which the scrambling
sequence stays the same

Total number of absolute subframes a PUSCH with repetition spans
expressed as a number of absolute subframes

Number of repetitions of a PUSCH transmission

Number of consecutive absolute subframes over which PUCCH or PUSCH stays
at the same narrowband before hopping to another narrowband, expressed
as a number of absolute subframes

Narrowband offset between one narrowband and the next narrowband a PUSCH
hops to, expressed as a number of uplink narrowbands

Total number of absolute subframes a PUCCH with repetition spans,
expressed as a number of absolute subframes

Number of repetitions of a PUCCH transmission

Number of PRACH repetitions per preamble transmission attempt

Number of subframes allowed for preamble transmission within a
1024-frame interval

PRACH starting subframe periodicity

Number of NPRACH repetitions per preamble transmission attempt

*NPRACH resource periodicity*

*Frequency location of the first sub-carrier allocated to NPRACH*

*Number of sub-carriers allocated to NPRACH*

*Number of starting sub-carriers allocated for UE initiated random
access*

NPRACH starting subframe

Fraction for starting subcarrier index for UE support for multi-tone
msg3 transmission

Periodicity for NPDSCH/NPDCCH gaps

Duration for NPDSCH/NPDCCH gaps

Threshold for applying NPDSCH/NPDCCH gaps

Total number of downlink narrowbands

Total number of downlink widebands

Total number of absolute subframes a PDSCH with repetition spans,
expressed as a number of absolute subframes

Number of repetitions of a PDSCH transmission

Number of consecutive absolute subframes over which MPDCCH or PDSCH
stays at the same narrowband before hopping to another narrowband,
expressed as a number of absolute subframes

Number of narrowbands over which MPDCCH or PDSCH frequency hops

Narrowband offset between one narrowband and the next narrowband an
MPDCCH or PDSCH hops to, expressed as a number of downlink narrowbands

Number of times a PDSCH carrying SIB1-BR is transmitted over 8 radio
frames

Total number of absolute subframes a MPDCCH with repetition spans,
expressed as a number of absolute subframes

Number of repetitions of a MPDCCH transmission

Total number of absolute subframes a MPDCCH search space with maximum
repetition level spans, expressed as a number of absolute subframes

Maximum repetition level of a MPDCCH search space

Number of ECCEs in a subframe for one MPDCCH

Number of OFDM symbols in a downlink slot

Number of SC-FDMA symbols in an uplink slot

Number of symbols in a guard period for narrowband or wideband retuning

Number of consecutive slots in an UL resource unit for NB-IoT

Number of SC-FDMA symbols in a sidelink slot

Resource block size in the frequency domain, expressed as a number of
subcarriers

Number of sub-bands for PUSCH frequency-hopping with predefined hopping
pattern

Size of each sub-band for PUSCH frequency-hopping with predefined
hopping pattern, expressed as a number of resource blocks

Size of narrow-band random-access resource in number of subcarriers

Number of downlink to uplink switch points within the radio frame

Number of reference symbols per slot for PUCCH

> ![](media/image109.wmf) Number of reference symbols per subslot or per
> slot for SPUCCH

Timing offset between uplink and downlink radio frames at the UE,
expressed in units of

Fixed timing advance offset, expressed in units of

Timing offset between sidelink and timing reference frames at the UE,
expressed in units of

Resource index for PUCCH formats 1/1a/1b

Resource index for PUCCH formats 2/2a/2b

Resource index for PUCCH format 3

Number of PDCCHs present in a subframe

Physical resource block number

First physical resource block occupied by PRACH resource considered

First physical resource block available for PRACH

$n_{\text{PRB},\text{RSS}}$ Lowest PRB number of RSS

Subcarrier occupied by NPRACH resource considered

Virtual resource block number

Radio network temporary identifier

Sidelink group destination identity

System frame number

Slot number within a radio frame

*Absolute subframe number*

Index for subframes allowed for preamble transmission

$O_{\text{RSS}}$ Starting frame offset of RSS in each RSS period

Number of antenna ports used for transmission of a channel

Antenna port number

$P_{\text{RSS}}$ Period of RSS measured in frames

Codeword number

Index for PRACH versions with same preamble format and PRACH density

*Q~m~* Modulation order: 1 for π/2-BPSK, 2 for QPSK, 4 for 16QAM, 6 for
64QAM and 8 for 256QAM transmissions

Time-continuous baseband signal for antenna port and SC-FDMA/OFDM symbol
in a slot

Radio frame indicator index of PRACH opportunity

Half frame index of PRACH opportunity within the radio frame

Uplink subframe number for start of PRACH opportunity within the half
frame

Radio frame duration

Basic time unit

Slot duration

Precoding matrix for downlink spatial multiplexing

Amplitude scaling for PRACH

Amplitude scaling for NPRACH

Amplitude scaling for PUCCH

Amplitude scaling for PUSCH

Amplitude scaling for NPUSCH

Amplitude scaling for SPUCCH

Amplitude scaling for sounding reference symbols

Subcarrier spacing

Subcarrier spacing for the random access preamble

Number of transmission layers

3.2 Abbreviations
-----------------

For the purposes of the present document, the abbreviations given in
TR 21.905 \[1\] and the following apply.\
An abbreviation defined in the present document takes precedence over
the definition of the same abbreviation, if any, in TR 21.905 \[1\].

CCE Control Channel Element

CDD Cyclic Delay Diversity

CRS Cell-specific Reference Signal

CSI Channel-State Information

DCI Downlink Control Information

DM-RS Demodulation Reference Signal

ECCE Enhanced Control Channel Element

EPDCCH Enhanced Physical Downlink Control CHannel

EREG Enhanced Resource-Element Group

MPDCCH MTC Physical Downlink Control Channel

MWUS MTC Wake-Up Signal

NCCE Narrowband Control Channel Element

NPBCH Narrowband Physical Broadcast CHannel

NPDCCH Narrowband Physical Downlink Control CHannel

NPDSCH Narrowband Physical Downlink Shared CHannel

NPRACH Narrowband Physical Random Access CHannel

NPUSCH Narrowband Physical Uplink Shared CHannel

NPRS Narrowband Positioning Reference Signal

NPSS Narrowband Primary Synchronization Signal

NSSS Narrowband Secondary Synchronization Signal

NRS Narrowband Reference Signal PBCH Physical Broadcast CHannel

PCFICH Physical Control Format Indicator CHannel

PDCCH Physical Downlink Control CHannel

PDSCH Physical Downlink Shared CHannel

PHICH Physical Hybrid-ARQ Indicator CHannel

PMCH Physical Multicast CHannel

PRACH Physical Random Access CHannel

PRB Physical Resource Block

PRG Precoding Resource Block Group

PRS Positioning Reference Signal

PSBCH Physical Sidelink Broadcast CHannel

PSCCH Physical Sidelink Control CHannel

PSDCH Physical Sidelink Discovery CHannel

PSSCH Physical Sidelink Shared CHannel

PUCCH Physical Uplink Control CHannel

PUSCH Physical Uplink Shared CHannel

REG Resource-Element Group

RSS Resynchronization Signal

SCCE Short Control Channel Element

SCG Secondary Cell Group

SPDCCH Short Physical Downlink Control CHannel

SPUCCH Short Physical Uplink Control CHannel

SREG Short Resource-Element Group

SRS Sounding Reference Signal

VRB Virtual Resource Block

4 Frame structure
=================

Throughout this specification, unless otherwise noted, the size of
various fields in the time domain is expressed as a number of time units
seconds.

Downlink, uplink and sidelink transmissions are organized into radio
frames with duration.\
Three radio frame structures are supported:

\- Type 1, applicable to FDD only,

\- Type 2, applicable to TDD only,

\- Type 3, applicable to LAA secondary cell operation only.

NOTE: LAA secondary cell operation only applies to frame structure type
3.

Transmissions in multiple cells can be aggregated where up to 31
secondary cells can be used in addition to the primary cell. Unless
otherwise noted, the description in this specification applies to each
of the up to 32 serving cells. In case of multi-cell aggregation,
different frame structures can be used in the different serving cells.

4.1 Frame structure type 1
--------------------------

Frame structure type 1 is applicable to both full duplex and half duplex
FDD only. Each radio frame is long and consists of 10 subframes of
length , numbered from 0 to 9. Subframe in frame has an absolute
subframe number *where is the system frame number.*

*For subframes using* $\Delta f = 2.5\ kHz$*,* , or , *subframe is*
defined as two slots, and , of length each.

For subframes using , *subframe is* defined as one slot, , *of length*
*.*

*For transmissions using*
$\Delta f = \frac{1}{\left( 82944T_{\text{s}} \right)} \approx 0.37\ \text{kHz}$*,
a slot has a length of 92160*$T_{\text{s}} = 3\text{\ ms}$*. There are
13 slots, numbered in increasing order from 0 to 12, in a 40 ms period
starting at* $n_{\text{f}}\text{\ mod\ }4 = 0$ *with slot 0 starting at*
$30720T_{\text{s}}$ in the 40 ms period.

*For subframes using* , *the subframe can further be divided into six
subslots according to Table 4.1-1.* Downlink subslot pattern 1 is
applied i*f the* number of symbols used for PDCCH is equal to 1 or 3 and
downlink subslot pattern 2 is applied if *the* number of symbols used
for PDCCH is equal to 2. For system bandwidths ![](media/image164.wmf),
subslot transmission is not supported in case 4 symbols used for PDCCH.

For FDD, 10 subframes, 20 slots, or up to 60 subslots are available for
downlink transmission and 10 subframes, 20 slots, or up to 60 subslots
are available for uplink transmissions in each 10 ms interval. Uplink
and downlink transmissions are separated in the frequency domain. In
half-duplex FDD operation, the UE cannot transmit and receive at the
same time while there are no such restrictions in full-duplex FDD.

Figure 4.1-1: Frame structure type 1 (assuming
$\mathbf{\Delta}\mathbf{\text{fϵ}}\left\{ \mathbf{2.5,\ 7.5,\ 15} \right\}\mathbf{\ }\text{kHz}$).

Table 4.1-1: SC-FDMA/OFDM symbols in different subslots of subframe *i*

  Subslot number               0         1         2      3      4      5
  ---------------------------- --------- --------- ------ ------ ------ ---------
  Slot number                  *2i*      *2i+1*                         
  Uplink subslot pattern       0, 1, 2   3, 4      5, 6   0, 1   2, 3   4, 5, 6
  Downlink subslot pattern 1   0, 1, 2   3, 4      5, 6   0, 1   2, 3   4, 5, 6
  Downlink subslot pattern 2   0, 1      2, 3, 4   5, 6   0, 1   2, 3   4, 5, 6

 4.2 Frame structure type 2
--------------------------

Frame structure type 2 is applicable to TDD only. Each radio frame of
length consists of two half-frames of length each. Each half-frame
consists of five subframes of length. Each subframe *is* defined as two
slots, and, of length each. Subframe in frame has an absolute subframe
number *where is the system frame number.*

The uplink-downlink configuration in a cell may vary between frames and
controls in which subframes uplink or downlink transmissions may take
place in the current frame. The uplink-downlink configuration in the
current frame is obtained according to Clause 13 in \[4\].

The supported uplink-downlink configurations are listed in Table 4.2-2
where, for each subframe in a radio frame, \"D\" denotes a downlink
subframe reserved for downlink transmissions, \"U\" denotes an uplink
subframe reserved for uplink transmissions and \"S\" denotes a special
subframe with the three fields DwPTS, GP and UpPTS. The length of DwPTS
and UpPTS is given by Table 4.2-1 subject to the total length of DwPTS,
GP and UpPTS being equal to where X is the number of additional SC-FDMA
symbols in UpPTS provided by the higher layer parameter *srs-UpPtsAdd*
if configured otherwise X is equal to 0. The UE is not expected to be
configured with 2 additional UpPTS SC-FDMA symbols for special subframe
configurations {3, 4, 7, 8} for normal cyclic prefix in downlink and
special subframe configurations {2, 3, 5, 6} for extended cyclic prefix
in downlink and 4 additional UpPTS SC-FDMA symbols for special subframe
configurations {1, 2, 3, 4, 6, 7, 8} for normal cyclic prefix in
downlink and special subframe configurations {1, 2, 3, 5, 6} for
extended cyclic prefix in downlink.

Uplink-downlink configurations with both 5 ms and 10 ms
downlink-to-uplink switch-point periodicity are supported.

\- In case of 5 ms downlink-to-uplink switch-point periodicity, the
special subframe exists in both half-frames.

\- In case of 10 ms downlink-to-uplink switch-point periodicity, the
special subframe exists in the first half-frame only.

Subframes 0 and 5 and DwPTS are always reserved for downlink
transmission. *For special subframe configurations 1, 2, 3, 4, 6, 7 and
8, DwPTS is split into two parts, of which the first part is a slot and
the second part is of X-symbol duration within the second slot.*
Downlink subframes, downlink slots in the downlink subframe and DwPTS,
and the X--symbol duration *in the second slot of DwPTS* are available
for downlink transmission. The X-symbol transmission opportunity is only
available for special subframe configuration 3,4 and 8.

UpPTS and the subframe immediately following the special subframe are
always reserved for uplink transmission. Uplink subframes, uplink slots
and UpPTS with special subframe configuration 10 are available for
uplink transmission. Note that UpPTS with special subframe configuration
10 are not available for SPUCCH transmission.

In case multiple cells are aggregated, the UE may assume that the guard
period of the special subframe in the cells using frame structure type 2
have an overlap of at least .

In case multiple cells with different uplink-downlink configurations in
the current radio frame are aggregated and the UE is not capable of
simultaneous reception and transmission in the aggregated cells, the
following constraints apply:

\- if the subframe in the primary cell is a downlink subframe, the UE
shall not transmit any signal or channel on a secondary cell in the same
subframe

\- if the subframe in the primary cell is an uplink subframe, the UE is
not expected to receive any downlink transmissions on a secondary cell
in the same subframe

\- if the subframe in the primary cell is a special subframe and the
same subframe in a secondary cell is a downlink subframe, the UE is not
expected to receive PDSCH/EPDCCH/PMCH/PRS transmissions in the secondary
cell in the same subframe, and the UE is not expected to receive any
other signals on the secondary cell in OFDM symbols that overlaps with
the guard period or UpPTS in the primary cell.

For frame structure type 2, the higher-layer parameters for symbol-level
resource reservation for BL/CE UEs (*symbolBitmap1* and *symbolBitmap2*)
do not apply to special subframes.

Figure 4.2-1: Frame structure type 2 (for 5 ms switch-point periodicity)

Table 4.2-1: Configuration of special subframe (lengths of
DwPTS/GP/UpPTS)

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Special subframe configuration   Normal cyclic prefix in downlink   Extended cyclic prefix in downlink                                                                      
  -------------------------------- ---------------------------------- ------------------------------------ ------------------------- ------- -------------------------------- ----------------------------------
                                   DwPTS                              UpPTS                                DwPTS                     UpPTS                                    

                                                                      Normal cyclic prefix\                Extended cyclic prefix\           Normal cyclic prefix in uplink   Extended cyclic prefix in uplink
                                                                      in uplink                            in uplink                                                          

  0                                                                                                                                                                           

  1                                                                                                                                                                           

  2                                                                                                                                                                           

  3                                                                                                                                                                           

  4                                                                                                                                                                           

  5                                                                                                                                                                           

  6                                                                                                                                                                           

  7                                                                                                                                                                           

  8                                                                                                                                  \-      \-                               \-

  9                                                                                                                                  \-      \-                               \-

  10                                                                                                                                 \-      \-                               \-
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Table 4.2-2: Uplink-downlink configurations

<table>
<thead>
<tr class="header">
<th><p>Uplink-downlink</p>
<p>configuration</p></th>
<th><p>Downlink-to-Uplink</p>
<p>Switch-point periodicity</p></th>
<th>Subframe number</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
</tr>
<tr class="even">
<td>0</td>
<td>5 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>U</td>
</tr>
<tr class="odd">
<td>1</td>
<td>5 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>D</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>D</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>D</td>
<td>D</td>
</tr>
<tr class="odd">
<td>3</td>
<td>10 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
</tr>
<tr class="even">
<td>4</td>
<td>10 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
</tr>
<tr class="odd">
<td>5</td>
<td>10 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
<td>D</td>
</tr>
<tr class="even">
<td>6</td>
<td>5 ms</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>D</td>
<td>S</td>
<td>U</td>
<td>U</td>
<td>D</td>
</tr>
</tbody>
</table>

4.3 Frame structure type 3
--------------------------

Frame structure type 3 is applicable to LAA secondary cell operation
with normal cyclic prefix only. Each radio frame is long and consists of
20 slots of length, numbered from 0 to 19. A subframe is defined as two
consecutive slots where subframe consists of slots and.

The 10 subframes within a radio frame are available for downlink or
uplink transmissions. Downlink transmissions occupy one or more
consecutive subframes, starting anywhere within a subframe and ending
with the last subframe either fully occupied or following one of the
DwPTS durations in Table 4.2-1. Uplink transmisisons occupy one or more
consecutive subframes.

 5 Uplink
========

5.1 Overview
------------

The smallest resource unit for uplink transmissions is denoted a
resource element and is defined in clause 5.2.2.

### 5.1.1 Physical channels

An uplink physical channel corresponds to a set of resource elements
carrying information originating from higher layers and is the interface
defined between 3GPP TS 36.212 \[3\] and the present document
3GPP TS 36.211.\
The following uplink physical channels are defined:

\- Physical Uplink Shared Channel, PUSCH

\- Physical Uplink Control Channel, PUCCH

\- Short Physical Uplink Control Channel, SPUCCH

\- Physical Random Access Channel, PRACH

### 5.1.2 Physical signals

An uplink physical signal is used by the physical layer but does not
carry information originating from higher layers. The following uplink
physical signals are defined:

\- Reference signal

5.2 Slot structure and physical resources
-----------------------------------------

### 5.2.1 Resource grid

The transmitted signal in each slot is described by one or several
resource grids of subcarriers and SC-FDMA symbols. The resource grid is
illustrated in Figure 5.2.1-1. The quantity depends on the uplink
transmission bandwidth configured in the cell and shall fulfil

where and are the smallest and largest uplink bandwidths, respectively,
supported by the current version of this specification. The set of
allowed values for is given by 3GPP TS 36.101 \[7\].

The number of SC-FDMA symbols in a slot depends on the cyclic prefix
length configured by the higher layer parameter *UL-CyclicPrefixLength*
and is given in Table 5.2.3-1.

An antenna port is defined such that the channel over which a symbol on
the antenna port is conveyed can be inferred from the channel over which
another symbol on the same antenna port is conveyed. There is one
resource grid per antenna port. The antenna ports used for transmission
of a physical channel or signal depends on the number of antenna ports
configured for the physical channel or signal as shown in Table 5.2.1-1.
The index is used throughout clause 5 when a sequential numbering of the
antenna ports is necessary.

Figure 5.2.1-1: Uplink resource grid

Table 5.2.1-1: Antenna ports used for different physical channels and
signals

  --------------------------------------------------------------------------------------------
  Physical channel or signal   Index   Antenna port number as a function of\              
                                       the number of antenna ports configured\            
                                       for the respective physical channel/signal         
  ---------------------------- ------- -------------------------------------------- ----- ----
                                       1                                            2     4

  PUSCH                        0       10                                           20    40

                               1       \-                                           21    41

                               2       \-                                           \-    42

                               3       \-                                           \-    43

  SRS                          0       10                                           20    40

                               1       \-                                           21    41

                               2       \-                                           \-    42

                               3       \-                                           \-    43

  PUCCH, SPUCCH                0       100                                          200   \-

                               1       \-                                           201   \-
  --------------------------------------------------------------------------------------------

### 5.2.2 Resource elements

Each element in the resource grid is called a resource element and is
uniquely defined by the index pair in a slot where and are the indices
in the frequency and time domains, respectively. Resource element on
antenna port corresponds to the complex value *.*\
*When there is no risk for confusion, or no particular antenna port is
specified, the index* may be dropped*.*\
Quantities corresponding to resource elements not used for transmission
of a physical channel or a physical signal in a slot shall be set to
zero.

### 5.2.3 Resource blocks

A physical resource block is defined as consecutive SC-FDMA symbols in
the time domain and consecutive subcarriers in the frequency domain,
where and are given by Table 5.2.3-1.\
A physical resource block in the uplink thus consists of resource
elements, corresponding to one slot in the time domain and 180 kHz in
the frequency domain.

Table 5.2.3-1: Resource block parameters

  Configuration                 
  ------------------------ ---- ---
  Normal cyclic prefix     12   7
  Extended cyclic prefix   12   6

The relation between the physical resource block number in the frequency
domain and resource elements in a slot is given by

5.2.3A Resource unit

Resource units are used to describe the mapping of PUSCH using sub-PRB
allocations to resource elements for BL/CE UEs. A resource unit is
defined as ![](media/image210.wmf) SC-FDMA symbols in the time domain
and ![](media/image211.wmf)consecutive subcarriers in the frequency
domain, where ![](media/image212.wmf) and ![](media/image213.wmf) are
given by Table 5.2.3A-1.

Table 5.2.3A-1: Supported combinations of ![](media/image214.wmf),
![](media/image215.wmf), and ![](media/image216.wmf) for PUSCH using
sub-PRB allocations for Frame Structure type 1 and Frame Structure type
2.

  **Physical channel**   ![](media/image217.wmf)   **Modulation scheme**        ![](media/image212.wmf)   ![](media/image215.wmf)   ![](media/image213.wmf)   **Comment**
  ---------------------- ------------------------- ----------------------- ---- ------------------------- ------------------------- ------------------------- -----------------------------
  PUSCH                  15 kHz                    π/2-BPSK                12   3                         16                        7                         2 out of 3 subcarriers used
                                                   QPSK                         3                         8                                                   
                                                                                6                         4                                                   

### 5.2.4 Narrowbands and widebands

A narrowband is defined as six non-overlapping consecutive physical
resource blocks in the frequency domain. The total number of uplink
narrowbands in the uplink transmission bandwidth configured in the cell
is given by

The narrowbands are numbered in order of increasing physical
resource-block number where narrowband is composed of physical
resource-block indices

where

If , a wideband is defined as four non-overlapping narrowbands in the
frequency domain. The total number of uplink widebands in the uplink
transmission bandwidth configured in the cell is given by

and the widebands are numbered in order of increasing narrowband number
where wideband is composed of narrowband indices where .

If , then and the single wideband is composed of the non-overlapping
narrowband(s).

### 5.2.5 Guard period for narrowband and wideband retuning

For BL/CE UEs, a guard period of at most SC-FDMA symbols is created for
Tx-to-Tx frequency retuning between two consecutive subframes.

\- If the higher layer parameter *ce-RetuningSymbols* is set, then
equals *ce-RetuningSymbols*, otherwise .

\- If the higher layer parameter *ce-pusch-maxBandwidth-config* is set
to 5 MHz, then the rules for guard period creation defined in the
remainder of this clause do not apply for retuning between narrowbands
but for retuning between widebands and for transmissions involving
multiple widebands.

\- If a UE is configured with higher layer parameter
*ce-PUSCH-FlexibleStartPRB-AllocConfig* and the allocation resources are
not fully within one narrowband, the rules for guard period creation
defined in the remainder of this clause apply for retuning between
tuning narrowbands, where

\- In case of CEModeA, the tuning narrowband is defined as the 6
consecutive PRBs starting from $\text{RB}_{\text{start}}$ defined in
*8.1.1 of \[4\]* with the center frequency set in the middle.

\- In case of CEModeB, the tuning narrowband is defined as the 6
consecutive PRBs with the center frequency set in the middle of
allocated two PRBs.

\- If the UE retunes from a first narrowband carrying PUSCH to a second
narrowband carrying PUSCH, or if the UE retunes from a first narrowband
carrying PUCCH to a second narrowband carrying PUCCH,

\- if , a guard period is created by the UE not transmitting the last
SC-FDMA symbol in the first subframe;

\- if , a guard period is created by the UE not transmitting the last
SC-FDMA symbol in the first subframe and the first SC-FDMA symbol in the
second subframe.

\- If the UE retunes from a first narrowband carrying PUCCH to a second
narrowband carrying PUSCH,

\- if the PUCCH uses a shortened PUCCH format and , a guard period is
created by the UE not transmitting the last SC-FDMA symbol in the first
subframe;

\- if the PUCCH uses a shortened PUCCH format and , a guard period is
created by the UE not transmitting the last SC-FDMA symbol in the first
subframe and the first SC-FDMA symbol in the second subframe;

\- if the PUCCH uses a normal PUCCH format, a guard period is created by
the UE not transmitting the first SC-FDMA symbols in the second
subframe.

\- If the UE retunes from a first narrowband carrying PUSCH to a second
narrowband carrying PUCCH,

\- a guard period is created by the UE not transmitting the last SC-FDMA
symbols in the first subframe.

\- For CEModeA, if the PUSCH is associated with C-RNTI or SPS C-RNTI and
the higher layer parameter *ce-pusch-maxBandwidth-config* is set to 5
MHz,

\- If the PUSCH resource allocation is within a 5 MHz wideband, the
center frequency of the transmission bandwidth is the center frequency
of the wideband;

\- If the PUSCH resource allocation spans two 5 MHz widebands, the
center frequency of transmission bandwidth is in the center of PUSCH
resource allocation.

Furthermore, for BL/CE UEs configured with the higher layer parameter
*srs-UpPtsAdd*, a guard period of at most SC-FDMA symbols is created for
Tx-to-Tx frequency retuning between a first special subframe and a
second uplink subframe for frame structure type 2 according to:

\- If the UE retunes from a first narrowband carrying SRS in the last
UpPTS symbol to a second narrowband carrying PUSCH,

\- a guard period is created by the UE not transmitting the first
SC-FDMA symbols in the second subframe.

\- If the UE retunes from a first narrowband carrying SRS in the last
but one UpPTS symbol, but not in the last UpPTS symbol, to a second
narrowband carrying PUSCH,

> \- if , a guard period is created by the UE not transmitting the last
> UpPTS symbol in the first subframe;
>
> \- if , a guard period is created by the UE not transmitting the last
> UpPTS symbol in the first subframe and the first SC-FDMA symbol in the
> second subframe.

\- If the UE retunes from a first narrowband carrying SRS to a second
narrowband carrying PUCCH,

> \- if , a guard period is created by the UE not transmitting the last
> UpPTS symbol in the first subframe;
>
> \- if , a guard period is created by the UE not transmitting the last
> UpPTS symbol in the first subframe and the first SC-FDMA symbol in the
> second subframe.

For , and for SRS transmission in a special subframe, a BL/CE UE is not
expected to be configured with a first SRS transmission in symbol *l*
and a second SRS transmission in any of symbols if the first SRS
transmission and the second SRS transmission use different narrowbands.

 5.3 Physical uplink shared channel
----------------------------------

The baseband signal representing the physical uplink shared channel is
defined in terms of the following steps:

\- scrambling

\- modulation of scrambled bits to generate complex-valued symbols

\- mapping of the complex-valued modulation symbols onto one or several
transmission layers

\- transform precoding to generate complex-valued symbols

\- precoding of the complex-valued symbols

\- mapping of precoded complex-valued symbols to resource elements

\- generation of complex-valued time-domain SC-FDMA signal for each
antenna port

Figure 5.3-1: Overview of uplink physical channel processing

### 5.3.1 Scrambling

For each codeword , the block of bits , where is the number of bits
transmitted in codeword on the physical uplink shared channel in
subframe(s)/slot/subslot, shall be scrambled with a UE-specific
scrambling sequence prior to modulation, resulting in a block of
scrambled bits according to the following pseudo code

Set *i* = 0

while

if // ACK/NACK or Rank Indication placeholder bits

else

if // ACK/NACK or Rank Indication repetition placeholder bits

else // Data or channel quality coded bits, Rank Indication coded bits
or ACK/NACK coded bits

end if

end if

*i* = *i* + 1

end while

where x and y are tags defined in 3GPP TS 36.212 \[3\] clause 5.2.2.6
and where the scrambling sequence is given by clause 7.2. The scrambling
sequence generator shall be initialised with at the start of each
subframe where corresponds to the RNTI associated with the PUSCH
transmission as described in clause 8 in 3GPP TS 36.213 \[4\]. For AUL
PUSCH, $n_{\text{RNTI}} = 0.$

For BL/CE UEs,

\- if the PUSCH transmission is using sub-PRB allocations, the
scrambling sequence generator shall be initialised with

$$c_{\text{init}} = n_{\text{RNTI}} \cdot 2^{14} + q \cdot 2^{13} + \left\lbrack \ \left\lfloor \frac{i}{M_{\text{RU}} \cdot M_{\text{slots}}^{\text{UL}}\ /\ 2} \right\rfloor\ \ mod\ 10 \right\rbrack{\cdot 2}^{9} + N_{\text{ID}}^{\text{cell}}$$

at the first valid uplink subframe of every
$M_{\text{RU}} \cdot M_{\text{slots}}^{\text{UL}}\ /\ 2$ subframes
comprising the allocated UL resource unit(s),
where$\ i = 0,\ 1,\ \ldots,N - 1$, and *N* is the number of BL/CE UL
subframes for the PUSCH transmission as determined in clause 8.0 in
\[4\].

\- otherwise, the same scrambling sequence is applied per subframe to
PUSCH for a given block of subframes. The subframe number of the first
subframe in each block of consecutive subframes, denoted as , satisfies
. For the block of subframes, the scrambling sequence generator shall be
initialised with

where

and is the absolute subframe number of the first uplink subframe
intended for PUSCH. The PUSCH transmission spans consecutive subframes
including subframes that are not BL/CE UL subframes where the UE
postpones the PUSCH transmission. For a BL/CE UE configured in CEModeA,
. For a BL/CE UE configured with CEModeB, for frame structure type 1 and
for frame structure type 2.

For PUSCH with a subframe duration, up to two codewords can be
transmitted in one subframe, i.e., . In the case of single-codeword
transmission, .

### 5.3.2 Modulation

For each codeword, the block of scrambled bits shall be modulated as
described in clause 7.1, resulting in a block of complex-valued symbols
. Table 5.3.2-1 specifies the modulation mappings applicable for the
physical uplink shared channel. For sub-PRB allocations only π/2 BPSK
and QPSK are supported.

Table 5.3.2-1: Uplink modulation schemes

  Physical channel   Modulation schemes
  ------------------ --------------------------------------
  PUSCH              π/2 BPSK, QPSK, 16QAM, 64QAM, 256QAM

###  5.3.2A Layer mapping

The complex-valued modulation symbols for each of the codewords to be
transmitted are mapped onto one or two layers. Complex-valued modulation
symbols for codeword shall be mapped onto the layers , where is the
number of layers and is the number of modulation symbols per layer.

#### 5.3.2A.1 Layer mapping for transmission on a single antenna port

For transmission on a single antenna port, a single layer is used, , and
the mapping is defined by

with .

#### 5.3.2A.2 Layer mapping for spatial multiplexing

For spatial multiplexing, the layer mapping shall be done according to
Table 5.3.2A.2-1. The number of layers is less than or equal to the
number of antenna ports used for transmission of the physical uplink
shared channel.\
The case of a single codeword mapped to multiple layers is only
applicable when the number of antenna ports used for PUSCH is four,
except for slot-PUSCH and subslot-PUSCH transmission where a single
codeword is used irrespective of the number of layers.

Table 5.3.2A.2-1: Codeword-to-layer mapping for spatial multiplexing

  Number of layers                                     Number of codewords   Codeword-to-layer mapping   
  ---------------------------------------------------- --------------------- --------------------------- --
  1                                                    1                                                 
  2                                                    1                                                 
  2                                                    2                                                 
                                                                                                         
  3                                                    2                                                 
  4                                                    2                                                 
                                                                                                         
  4^1^                                                 1^1^                                              
  NOTE 1: Only used for slot-PUSCH and subslot-PUSCH                                                     

###  5.3.3 Transform precoding

For each layer the block of complex-valued symbols is divided into sets,
each corresponding to one SC-FDMA symbol. Transform precoding shall be
applied according to

resulting in a block of complex-valued symbols . The variable, where
represents the bandwidth of the PUSCH in terms of resource blocks, and
shall fulfil

where is a set of non-negative integers.

In case of PUSCH transmissions using sub-PRB allocations for BL/CE UEs,
the variable ![](media/image299.wmf).

### 5.3.3A Precoding

The precoder takes as input a block of vectors , from the transform
precoder and generates a block of vectors , to be mapped onto resource
elements.

#### 5.3.3A.1 Precoding for transmission on a single antenna port

For transmission on a single antenna port, precoding is defined by

where , .

#### 5.3.3A.2 Precoding for spatial multiplexing

Precoding for spatial multiplexing is only used in combination with
layer mapping for spatial multiplexing as described in clause 5.3.2A.2.
Spatial multiplexing supports or antenna ports where the set of antenna
ports used for spatial multiplexing is and , respectively.

Precoding for spatial multiplexing is defined by

where , .

The precoding matrix of size is given by one of the entries in Table
5.3.3A.2-1 for and by Tables 5.3.3A.2-2 through 5.3.3A.2-5 for where the
entries in each row are ordered from left to right in increasing order
of codebook indices.

Table 5.3.3A.2-1: Codebook for transmission on antenna ports

  Codebook index   Number of layers   
  ---------------- ------------------ ----
                                      
  0                                   
  1                                   \-
  2                                   \-
  3                                   \-
  4                                   \-
  5                                   \-

Table 5.3.3A.2-2: Codebook for transmission on antenna ports with

  Codebook index   Number of layers                     
  ---------------- ------------------ -- -- -- -- -- -- --
  0 -- 7                                                
  8 -- 15                                               
  16 -- 23                                              

Table 5.3.3A.2-3: Codebook for transmission on antenna ports with

  Codebook index   Number of layers         
  ---------------- ------------------ -- -- --
  0 -- 3                                    
  4 -- 7                                    
  8 -- 11                                   
  12 -- 15                                  

Table 5.3.3A.2-4: Codebook for transmission on antenna ports with

  Codebook index   Number of layers         
  ---------------- ------------------ -- -- --
  0 -- 3                                    
  4 -- 7                                    
  8 -- 11                                   

Table 5.3.3A.2-5: Codebook for transmission on antenna ports with

  Codebook index   Number of layers
  ---------------- ------------------
  0                

### 5.3.4 Mapping to physical resources

For each antenna port used for transmission of the PUSCH in a subframe
the block of complex-valued symbols shall be multiplied with the
amplitude scaling factor in order to conform to the transmit power
specified in clause 5.1.1.1 in 3GPP TS 36.213 \[4\], and mapped in
sequence starting with to physical resource blocks on antenna port and
assigned for transmission of PUSCH. The relation between the index and
the antenna port number is given by Table 5.2.1-1. The mapping to
resource elements corresponding to the physical resource blocks assigned
for transmission shall fulfil the following criteria:

\- not used for transmission of reference signals, and

\- not part of the last SC-FDMA symbol in a subframe, if the UE
transmits SRS in the same subframe in the same serving cell, and

\- not part of the last SC-FDMA symbol in a subframe configured with
cell-specific SRS for non-BL/CE UEs and BL/CE UEs in CEModeA, if the
PUSCH transmission partly or fully overlaps with the cell-specific SRS
bandwidth, and

\- not part of an SC-FDMA symbol reserved for possible trigger type 1
SRS transmission as specified in \[4\] in a UE-specific aperiodic SRS
subframe in the same serving cell, and

\- not part of an SC-FDMA symbol reserved for possible trigger type 0
SRS transmission as specified in \[4\] in a UE-specific periodic SRS
subframe in the same serving cell when the UE is configured with
multiple TAGs

\- not part of the first SC-FDMA symbol in a subframe if the associated
DCI indicates PUSCH starting position \'01\', \'10\', or \'11\' and does
not indicate PUSCH mode 2.

\- not part of the first SC-FDMA symbol in the second slot in a subframe
if the associated DCI indicates PUSCH starting position \'01\', \'10\',
or \'11\' and PUSCH mode 2.

\- not part of the last SC-FDMA symbol in a subframe if the associated
DCI indicates PUSCH ending symbol \'1\' and does not indicate PUSCH mode
3.

\- not part of the second slot in a subframe if the associated DCI
indicates PUSCH ending symbol \'0\' and PUSCH mode 3.

\- not part of SC-FDMA symbols 5 to 13 in a subframe if the associated
DCI indicates PUSCH ending symbol \'1\' and PUSCH mode 3.

The mapping to resource elements shall be in increasing order of first
the index , then the index . The mapping starts with the first slot in
an uplink subframe, except for slot-PUSCH, subslot-PUSCH transmission,
or PUSCH mode 2.

In case of PUSCH transmissions using sub-PRB allocations for BL/CE UEs,
the mapping starts over in every valid uplink subframe composing an UL
resource unit.

In case of slot-PUSCH, the mapping shall start at in the slot assigned
for transmission.

In case of PUSCH mode 2, the mapping shall start at
![](media/image399.wmf) in the second slot of the subframe assigned for
transmission.

In case of subslot-PUSCH, the mapping shall start at symbol where the
start of the mapping is dependent on the uplink subslot number in the
subframe assigned for transmission and the *DMRS-pattern* field in the
related uplink DCI format \[3\] according to Table 5.3.4-1 where
starting symbol index \"4\" for subslot \#5 is applied if the UE has
indicated the capability *ul-pattern-ddd-r15*.

Table 5.3.4-1: Starting symbol index for subslot-PUSCH transmission

  *DMRS-pattern* field in uplink-related DCI format \[3\]   Uplink subslot number                           
  --------------------------------------------------------- ----------------------- ----- ----- ----- ----- -----
                                                            \#0                     \#1   \#2   \#3   \#4   \#5
  00                                                        1                       4     6     1     3     5
  01                                                        0                       3     5     0     2     4
  10                                                        --                      3     --    0     2     --
  11                                                        --                      3     --    --    2     --

In case of a semi-persistently scheduled subslot-PUSCH, and
semi-persistent scheduling (i.e. higher layer parameter
*sps-ConfigUL-STTI* is configured, see 3GPP TS 36.331 \[9\]) with a
configured periodicity of 1 subslot (i.e.
*semiPersistSchedIntervalUL-STTI* set to *sTTI1*), the mapping shall
start at symbol depending on the *DMRS-pattern* field in the related
uplink DCI format \[3\] according to Table 5.3.4-2.

In case of a semi-persistently scheduled subslot-PUSCH and
semi-persistent scheduling (the higher layer parameter
*sps-ConfigUL-sTTI-r15* is configured, see 3GPP TS 36.331 \[9\]) with
repetitions enabled (the higher layer parameter
*totalNumberPUSCH-SPS-STTI-UL-Repetitions* is configured), the mapping
shall start at symbol depending on the *DMRS-pattern* field in the
related uplink DCI format \[3\] according to Table 5.3.4-2.

Table 5.3.4-2: Starting symbol index for subslot-PUSCH transmission in
case of semi-persistent scheduling with a configured periodicity of 1
subslot

  *DMRS-pattern* field in uplink-related DCI format \[3\]   Uplink subslot number                           
  --------------------------------------------------------- ----------------------- ----- ----- ----- ----- -----
                                                            \#0                     \#1   \#2   \#3   \#4   \#5
  00                                                        1                       4     6     1     3     5
  10                                                        1                       3     6     0     3     5

In case of subslot-PUSCH and semi-persistent scheduling with a
configured periodicity longer than 1 subslot the mapping shall start at
symbol according to the first row of Table 5.3.4-2 (i.e. equivalent to a
signalling of *DMRS-pattern* field set to \'00\').

For the UpPTS, the mapping shall start at symbol and if *dmrsLess-UpPts*
is set to true the mapping shall end at symbol in the second slot of a
special subframe, otherwise, the mapping shall end at symbol in the
second slot of a special subframe.

For BL/CE UEs, the PUSCH transmission is restricted as follows:

\- For CEModeA, if the PUSCH is associated with C-RNTI or SPS C-RNTI and
the higher layer parameter *ce-pusch-maxBandwidth-config* is set to 5
MHz, the maximum number of allocatable PRBs for PUSCH is 24 PRBs. The
allocatable PRBs include the PRBs belonging to the narrowbands defined
in clause 5.2.4 and the odd PRB at the center of the uplink system
bandwidth in case of odd total number of uplink PRBs. If a resource
assignment or frequency hopping would result in a PUSCH resource
allocation outside the allocatable PRBs then the PUSCH transmission in
that subframe is dropped.

\- For all other cases, the maximum number of allocatable PRBs for PUSCH
is 6 PRBs restricted to one of the narrowbands defined in clause 5.2.4.

For BL/CE UEs in CEModeB, resource elements in the last SC-FDMA symbol
in a subframe configured with cell-specific SRS shall be counted in the
PUSCH mapping but not used for transmission of the PUSCH.

For BL/CE UEs, if one or more SC-FDMA symbol(s) are left empty due to
guard period for narrowband or wideband retuning, the affected SC-FDMA
symbol(s) shall be counted in the PUSCH mapping but not used for
transmission of the PUSCH.

For a UE configured with SRS carrier switching, if the first symbol in a
subframe overlaps with an SRS transmission (including any interruption
due to uplink or downlink RF retuning time) in a carrier without
PUSCH/PUCCH, the resource elements in the first SC-FDMA symbol shall be
counted in the PUSCH mapping but not used for transmission of PUSCH.

For a UE configured with SRS carrier switching, if the last symbol in a
subframe is counted in the PUSCH mapping and the last symbol in the
subframe overlaps with an SRS transmission (including any interruption
due to uplink or downlink RF retuning time) in a carrier without
PUSCH/PUCCH, the resource elements in the last SC-FDMA symbol shall be
counted in the PUSCH mapping but not used for transmission of PUSCH.

For a UE configured with SRS carrier switching, if the last symbol in a
subframe is not counted in the PUSCH mapping and the second-to-last
symbol in the subframe overlaps with an SRS transmission (including any
interruption due to uplink or downlink RF retuning time) in a carrier
without PUSCH/PUCCH, the resource elements in the second-to-last SC-FDMA
symbol shall be counted in the PUSCH mapping but not used for
transmission of PUSCH.

For a UE configured with PUSCH Mode 1, if DCI indicates PUSCH mode 1
enabled and the corresponding transmission of PUSCH starts in the second
slot of a subframe, the resource elements in the first slot of the
subframe shall be counted in the PUSCH mapping but not used for
transmission of PUSCH.

For a UE configured with autonomous uplink,

\- if the UE indicates PUSCH ending symbol \'1\' in uplink control
information, or *endingSymbolAUL* is set to \'12\', the resource
elements in the last SC-FDMA symbol shall be counted in the PUSCH
mapping but not used for transmission of PUSCH;

\- if the UE indicates PUSCH starting symbol \'1\' in uplink control
information, the resource elements in the first SC-FDMA symbol shall be
counted in the PUSCH mapping but not used for transmission of PUSCH.

If uplink frequency-hopping is disabled or the resource blocks allocated
for PUSCH transmission are not contiguous in frequency, the set of
physical resource blocks to be used for transmission is given by where
is obtained from the uplink scheduling grant as described in clause 8.1
in 3GPP TS 36.213 \[4\].

If uplink frequency-hopping with type 1 PUSCH hopping is enabled, the
set of physical resource blocks to be used for transmission is given by
clause 8.4.1 in 3GPP TS 36.213 \[4\].

If uplink frequency-hopping with predefined hopping pattern is enabled,
the set of physical resource blocks to be used for transmission in slot
is given by the scheduling grant together with a predefined pattern
according to

where is obtained from the scheduling grant as described in clause 8.1
in 3GPP TS 36.213 \[4\]. The parameter *pusch-HoppingOffset*,, is
provided by higher layers. The size of each sub-band is given by,

where the number of sub-bands is given by higher layers. The function
determines whether mirroring is used or not. The parameter
*Hopping-mode* provided by higher layers determines if hopping is
\"inter-subframe\" or \"intra and inter-subframe\".

The hopping function and the function are given by

where and the pseudo-random sequence is given by clause 7.2 and
CURRENT\_TX\_NB indicates the transmission number for the transport
block transmitted in slot as defined in \[8\]. The pseudo-random
sequence generator shall be initialised with for frame structure type 1
and for frame structure type 2 at the start of each frame.

For BL/CE UEs, the PRB resources for PUSCH transmission in the first
subframe are obtained from the DCI as described in clauses 5.3.3.1.10
and 5.3.3.1.11 in \[3\], or from higher layers in *PUR-Config* when
PUSCH is transmitted using preconfigured uplink resources. Each of the
$N_{\text{TB}} \geq 1$ PUSCH codewords is transmitted with repetitions,
where $N_{\text{TB}}$ is the number of transport blocks defined in
clause 8.0 of 3GPP TS 36.213 \[4\]. The PUSCH transmission spans
$N_{\text{abs}}^{\text{PUSCH}} \geq N_{\text{TB}}N_{\text{rep}}^{\text{PUSCH}}$
consecutive subframes, including subframes that are not BL/CE UL
subframes where the UE postpones the PUSCH transmission if .

\- If uplink resource reservation is enabled for the UE as specified in
\[9\], and the Resource reservation field in the DCI is set to 1, then
in case of PUSCH transmission with associated with C-RNTI or SPS C-RNTI
using UE-specific MPDCCH search space including PUSCH transmission
without a corresponding MPDCCH,

\- In a subframe that is fully reserved as defined in clause 8.0 in
\[4\], the PUSCH transmission is postponed until the next BL/CE uplink
subframe that is not fully reserved.

\- In a subframe that is partially reserved, the reserved SC-FDMA
symbols shall be counted in the PUSCH mapping but not used for
transmission of the PUSCH.

\- In case the UE is a BL/CE UE configured with higher layer parameter
*ce-PUSCH-SubPRB-Config-r15* or *subPRB-Allocation* in
*PUR-PUSCH-Config*, the PUSCH transmission spans
$N_{\text{abs}}^{\text{PUSCH}} \geq N_{\text{TB}}N_{\text{rep}}^{\text{PUSCH}}M_{\text{RU}}M_{\text{slots}}^{\text{UL}}/2$
consecutive subframes including subframes that are not BL/CE UL
subframes where the UE postpones the PUSCH transmission, where
$N_{\text{TB}}$ is the number of scheduled TBs if
*ce-PUSCH-MultiTB-Config* is enabled and multiple TBs are scheduled,
otherwise $N_{\text{TB}} = 1$.

\- For BL/CE UE in CEModeA,

\- If PUSCH is transmitted using preconfigured uplink resources,

\- PUSCH frequency hopping is enabled when the higher layer parameter
*pur-PUSCH-FreqHopping* is set, otherwise frequency hopping is disabled.

\- Else, if PUSCH scheduled by DCI format 6-0A is associated with
PUR-RNTI,

\- PUSCH frequency hopping is enabled when the higher layer parameter
*pur-PUSCH-FreqHopping* is set and the frequency hopping flag in DCI
format 6-0A indicates frequency hopping, otherwise frequency hopping is
disabled.

\- Else,

\- PUSCH frequency hopping is enabled when the higher-layer parameter
*pusch-HoppingConfig* is set and the frequency hopping flag in DCI
format 6-0A indicates frequency hopping, otherwise frequency hopping is
disabled.

\- For BL/CE UE in CEModeB,

\- If PUSCH is transmitted using preconfigured uplink resources,

\- PUSCH frequency hopping is enabled when the higher layer parameter
*pur-PUSCH-FreqHopping* is set, otherwise frequency hopping is disabled.

\- Else, if PUSCH scheduled by DCI format 6-0B is associated with
PUR-RNTI,

\- PUSCH frequency hopping is enabled when the higher layer parameter
*pur-PUSCH-FreqHopping* is set, otherwise frequency hopping is disabled.

\- Else,

\- PUSCH frequency hopping is enabled when the higher-layer parameter
*pusch-HoppingConfig* is set, otherwise frequency hopping is disabled.

\- If frequency hopping is not enabled for PUSCH, all PUSCH repetitions
are located at the same PRB resources.

\- If a BL/CE UE is configured with higher layer parameter
*ce-PUSCH-FlexibleStartPRB-AllocConfig*, the UE is not expected to have
the frequency hopping enabled for PUSCH with the resource allocation
including the center PRB not belonging to any narrowband.

\- If frequency hopping is enabled for PUSCH and the UE is not
configured with CEModeA and higher layer parameter
*ce-PUSCH-FlexibleStartPRB-AllocConfig*,

\- PUSCH is transmitted in uplink subframe within the consecutive
subframes using the same number of consecutive PRBs as in the previous
subframe starting from the PRB resources of the narrowband with the same
RIV as that of narrowband . The narrowband is defined as

where is the absolute subframe number of the first UL subframe intended
for carrying the PUSCH and and are cell-specific higher-layer
parameters. For the consecutive subframes, the UE shall not transmit
PUSCH in subframe if it is not a BL/CE UL subframe.

\- If frequency hopping is enabled for PUSCH and the UE is configured
with CEModeA and higher layer parameter
*ce-PUSCH-FlexibleStartPRB-AllocConfig*,

\- Except when *the PUSCH resource allocation includes the center PRB*
not belonging to any narrowband, PUSCH is transmitted in uplink subframe
![](media/image429.wmf){width="9.375e-2in"
height="0.16666666666666666in"} within the
![](media/image430.wmf){width="0.5in" height="0.22916666666666666in"}
consecutive subframes using the same number of consecutive PRBs as in
the previous subframe, where $n_{\text{NB}}^{{(i}_{0})}$ *is the*
narrowband index that starting PRB located in the absolute subframe
number of the first UL subframe $i_{0}$, defined as

\- If $N_{\text{RB}}^{\mathbf{U}L}\ mod\ 2 =$0 or
$N_{\text{RB}}^{\mathbf{U}L}\ mod\ 2 = 1$ with
$\text{RB}_{\text{START}} < \left\lfloor \frac{N_{\mathbf{R}B}^{\mathbf{U}L}}{2} \right\rfloor$,
$n_{\text{NB}}^{(i_{0})}\  = \left\lfloor \frac{\text{RB}_{\text{START}} - l_{e}}{6} \right\rfloor$

\- If $N_{\text{RB}}^{\mathbf{U}L}\ mod\ 2 = 1\ $with
$\text{RB}_{\text{START}} > \left\lfloor \frac{N_{\mathbf{R}B}^{\mathbf{U}L}}{2} \right\rfloor,$
$n_{\text{NB}}^{(i_{0})}\  = \left\lfloor \frac{\text{RB}_{\text{START}} - l_{e} - 1}{6} \right\rfloor$

where
$l_{e} = \left\lfloor \frac{N_{\mathbf{R}B}^{\mathbf{U}L}}{2} \right\rfloor - \frac{6N_{\text{NB}}^{\mathbf{U}L}}{2}$
is the number of edge PRB(s) not belonging to narrowbands in one side of
system bandwidth $N_{\mathbf{R}B}^{\mathbf{U}L}$,
$N_{\mathbf{N}B}^{\mathbf{U}L}$ is the number of narrowbands, the
starting PRB index $\text{RB}_{\text{START}}$ and the length
$L_{\text{CRBs}}$ of the allocated resources are defined in clause 8.1.1
of \[4\]. After hopping, the narrowband in subframe
![](media/image429.wmf){width="9.375e-2in"
height="0.16666666666666666in"} is defined as

where and are cell-specific higher-layer parameters. For the consecutive
subframes, the UE shall not transmit PUSCH in subframe if it is not a
BL/CE UL subframe. After hopping, the resource blocks have the same
relative location of starting PRB in $n_{\text{NB}}^{(i)}$ as in
narrowband $n_{\text{NB}}^{(i_{0})}$.

\- If frequency hopping is enabled for PUSCH and the UE is configured
with higher layer parameter *ce-PUSCH-FlexibleStartPRB-AllocConfig*,

\- If a frequency hopping leads to a split resource allocation, where
some PRB(s) is (are) on one edge and some PRB(s) is (are) on the other
edge of the system bandwidth, the PUSCH transmission is dropped in that
subframe.

\- If a frequency hopping leads to a resource allocation, where some
PRB(s) is (are) not belonging to any narrowband, the PUSCH transmission
is dropped in that subframe.

For BL/CE UEs, for PUSCH transmission corresponding to the random access
response grant and its retransmission, frequency hopping of the PUSCH is
enabled when higher layer parameter *rar-HoppingConfig* is set. Further

\- if PRACH CE level 0 or 1 is used for the last PRACH attempt, is set
to the higher layer parameter *interval-UlHoppingConfigCommonModeA*;

\- if PRACH CE level 2 or 3 is used for the last PRACH attempt, is set
to the higher layer parameter *interval-UlHoppingConfigCommonModeB*.

For BL/CE UEs in CEModeB, for PUSCH transmission not associated with
Temporary C-RNTI, for frame structure type 1, after a transmission
duration of time units (which may include subframes that are not BL/CE
UL subframes), a gap of time units shall be inserted, according to the
UE capability *ue-CE-NeedULGaps*, as specified in 3GPP TS 36.331 \[9\].
BL/CE UL subframes within the gap of time units shall be counted for the
PUSCH resource mapping but not used for transmission of the PUSCH.

For BL/CE UEs, for PUSCH transmission associated with Temporary C-RNTI
for frame structure type 1, and if PRACH CE level 2 or 3 is used for the
last PRACH attempt, after a transmission duration of time units (which
may include subframes that are not BL/CE UL subframes), a gap of time
units shall be inserted. BL/CE UL subframes within the gap of time units
shall be counted for the PUSCH resource mapping but not used for
transmission of the PUSCH.

For UEs configured with *PUSCH-EnhancementsConfig*, the number of PUSCH
subframe repetitions and the PRB resources for PUSCH transmission in the
first subframe are obtained from the DCI as described in clause
5.3.3.1.1C in \[3\]. The PUSCH transmission spans consecutive subframes,
including DL subframes where the UE postpones the PUSCH transmission in
the case of frame structure type 2. PUSCH frequency hopping is enabled
when the higher-layer parameters *pusch-HoppingOffsetPUSCH-Enh* and
*interval-ULHoppingPUSCH-Enh* are set and the frequency hopping flag in
DCI format 0C indicates frequency hopping, otherwise frequency hopping
is disabled. If frequency hopping is not enabled for PUSCH, the PUSCH
repetitions are located at the same PRB resources as in the first
subframe. If frequency hopping is enabled for PUSCH, PUSCH is
transmitted in uplink subframe within the consecutive subframes using
the PRB resources starting at PRB index

$n_{\text{PRB}}^{\left( i \right)} = \left\{ \begin{matrix}
n_{\text{PRB}}^{\left( i_{0} \right)} & \text{if\ }\left\lfloor \frac{i}{N_{PRB,hop}^{\text{PUSCH}}} - j_{0} \right\rfloor mod\ 2 = 0\  \\
\left( n_{\text{PRB}}^{\left( i_{0} \right)} + f_{PRB,hop}^{\text{PUSCH}} \right)\text{mod\ }N_{\text{PRB}}^{\text{UL}} & \text{if\ }\left\lfloor \frac{i}{N_{PRB,hop}^{\text{PUSCH}}} - j_{0} \right\rfloor mod\ 2 = 1 \\
\end{matrix} \right.\ $

$j_{0} = \left\lfloor \frac{i_{0}}{N_{PRB,hop}^{\text{PUSCH}}} \right\rfloor,\ i_{0} \leq i \leq {i_{0} + \ N}_{\text{abs}}^{\text{PUSCH}} - 1$

where is the absolute subframe number of the first UL subframe carrying
the PUSCH and is given by the higher-layer parameter
*interval-ULHoppingPUSCH-Enh* and is given by the higher-layer parameter
*pusch-HoppingOffsetPUSCH-Enh*.

5.4 Physical uplink control channel
-----------------------------------

The physical uplink control channel, PUCCH, carries uplink control
information. Simultaneous transmission of PUCCH and PUSCH from the same
UE is supported if enabled by higher layers. For frame structure type 2,
the PUCCH is not transmitted in the UpPTS field.

The physical uplink control channel supports multiple formats as shown
in Table 5.4-1 with different number of bits per subframe, where
represents the bandwidth of the PUCCH format 4 as defined by clause
5.4.2B, and and are defined in Table 5.4.2C-1.

Formats 2a and 2b are supported for normal cyclic prefix only.

Table 5.4-1: Supported PUCCH formats

  PUCCH format   Modulation scheme   Number of bits per subframe,
  -------------- ------------------- ------------------------------
  1              N/A                 N/A
  1a             BPSK                1
  1b             QPSK                2
  2              QPSK                20
  2a             QPSK+BPSK           21
  2b             QPSK+QPSK           22
  3              QPSK                48
  4              QPSK                
  5              QPSK                

All PUCCH formats use a cyclic shift, , which varies with the symbol
number and the slot number according to

where the pseudo-random sequence is defined by clause 7.2. The
pseudo-random sequence generator shall be initialized with , where is
given by clause 5.5.1.5 with corresponding to the primary cell, at the
beginning of each radio frame.

The physical resources used for PUCCH format 1/1a/1b and PUCCH format
2/2a/2b depends on two parameters, and , given by higher layers.\
The variable denotes the bandwidth in terms of resource blocks that are
available for use by PUCCH formats 2/2a/2b transmission in each slot.
The variable denotes the number of cyclic shift used for PUCCH formats
1/1a/1b in a resource block used for a mix of formats 1/1a/1b and
2/2a/2b. The value of is an integer multiple of within the range of {0,
1, ..., 7}, where is provided by higher layers. No mixed resource block
is present if . At most one resource block in each slot supports a mix
of formats 1/1a/1b and 2/2a/2b.\
Resources used for transmission of PUCCH formats 1/1a/1b, 2/2a/2b, 3, 4,
and 5 are represented by the non-negative indices , , , and ,
respectively.

### 5.4.1 PUCCH formats 1, 1a and 1b

For PUCCH format 1, information is carried by the presence/absence of
transmission of PUCCH from the UE.\
In the remainder of this clause, shall be assumed for PUCCH format 1.

For PUCCH formats 1a and 1b, one or two explicit bits are transmitted,
respectively. The block of bits shall be modulated as described in Table
5.4.1-1, resulting in a complex-valued symbol.\
The modulation schemes for the different PUCCH formats are given by
Table 5.4-1.

The complex-valued symbol shall be multiplied with a cyclically shifted
length sequence for each of the antenna ports used for PUCCH
transmission according to

where is defined by clause 5.5.1 with and . The antenna-port specific
cyclic shift varies between symbols and slots as defined below.

The block of complex-valued symbols shall be scrambled by and block-wise
spread with the antenna-port specific orthogonal sequence according to

where

and

with for the two slots in a subframe given by Table 5.4.1-1a. The
sequence is given by Table 5.4.1-2 and Table 5.4.1-3 and is defined
below.

Resources used for transmission of PUCCH format 1, 1a and 1b are
identified by a resource index from which the orthogonal sequence index
and the cyclic shift are determined according to

where

The resource indices within the two resource blocks in the two slots of
a subframe to which the PUCCH is mapped are given by

for and by

for , where , with for normal CP and for extended CP.

The parameter *deltaPUCCH-Shift* is provided by higher layers.

Table 5.4.1-1: Modulation symbol for PUCCH formats 1a and 1b

  PUCCH format        
  -------------- ---- --
  1a             0    
                 1    
  1b             00   
                 01   
                 10   
                 11   

Table 5.4.1-1a: The quantity for PUCCH formats 1a and 1b

  PUCCH format                     
  ------------------- ------------ -------------
                      first slot   second slot
  normal 1/1a/1b      4            4
  shortened 1/1a/1b   4            3
                                   
                                   

Table 5.4.1-2: Orthogonal sequences for

  Sequence index   Orthogonal sequences
  ---------------- -----------------------------------------------------------------------
  0                ![](media/image505.wmf){width="1.15625in" height="0.25in"}
  1                ![](media/image506.wmf){width="1.1354166666666667in" height="0.25in"}
  2                ![](media/image507.wmf){width="1.1354166666666667in" height="0.25in"}

Table 5.4.1-3: Orthogonal sequences for

  Sequence index   Orthogonal sequences
  ---------------- ----------------------
  0                
  1                
  2                

###  5.4.2 PUCCH formats 2, 2a and 2b

The block of bits shall be scrambled with a UE-specific scrambling
sequence, resulting in a block of scrambled bits according to

where the scrambling sequence is given by clause 7.2. The scrambling
sequence generator shall be initialised with at the start of each
subframe where is C-RNTI.

The block of scrambled bits shall be QPSK modulated as described in
clause 7.1, resulting in a block of complex-valued modulation symbols .

Each complex-valued symbol shall be multiplied with a cyclically shifted
length sequence for each of the antenna ports used for PUCCH
transmission according to

where is defined by clause 5.5.1 with and .

Resources used for transmission of PUCCH formats 2/2a/2b are identified
by a resource index from which the cyclic shift is determined according
to

where

and

for and by

for .

For PUCCH formats 2a and 2b, supported for normal cyclic prefix only,
the bit(s) shall be modulated as described in Table 5.4.2-1 resulting in
a single modulation symbol used in the generation of the
reference-signal for PUCCH format 2a and 2b as described in clause
5.5.2.2.1.

Table 5.4.2-1: Modulation symbol for PUCCH formats 2a and 2b

  PUCCH format        
  -------------- ---- --
  2a             0    
                 1    
  2b             00   
                 01   
                 10   
                 11   

### 5.4.2A PUCCH format 3

The block of bits shall be scrambled with a UE-specific scrambling
sequence, resulting in a block of scrambled bits according to

where the scrambling sequence is given by clause 7.2. The scrambling
sequence generator shall be initialised with at the start of each
subframe where is the C-RNTI.

The block of scrambled bits shall be QPSK modulated as described in
Clause 7.1, resulting in a block of complex-valued modulation symbols
where .

The complex-valued symbols shall be block-wise spread with the
orthogonal sequences and resulting in sets of values each according to

where for both slots in a subframe using normal PUCCH format 3 and ,
holds for the first and second slot, respectively, in a subframe using
shortened PUCCH format 3. The orthogonal sequences and are given by
Table 5.4.2A-1. Resources used for transmission of PUCCH format 3 are
identified by a resource index from which the quantities and are derived
according to

Each set of complex-valued symbols shall be cyclically shifted according
to

where is given by Clause 5.4, is the slot number within a radio frame
and is the SC-FDMA symbol number within a slot.

The shifted sets of complex-valued symbols shall be transform precoded
according to

where is the number of antenna ports used for PUCCH transmission,
resulting in a block of complex-valued symbols .

Table 5.4.2A-1: The orthogonal sequence

  Sequence index   Orthogonal sequence   
  ---------------- --------------------- ----
                                         
  0                                      
  1                                      
  2                                      
  3                                      
  4                                      \-

###  5.4.2B PUCCH format 4

The block of bits shall be scrambled with a UE-specific scrambling
sequence, resulting in a block of scrambled bits according to

where the scrambling sequence is given by clause 7.2. The scrambling
sequence generator shall be initialised with at the start of each
subframe where is the C-RNTI.

The block of scrambled bits shall be QPSK modulated as described in
Clause 7.1, resulting in a block of complex-valued modulation symbols
where .

The block of complex-valued symbols is divided into sets, each
corresponding to one SC-FDMA symbol. Transform precoding shall be
applied according to

where , and are given by Table 5.4.2C-1 for normal PUCCH format 4 and
shortened PUCCH format 4, resulting in a block of complex-valued symbols
. The variable, where represents the bandwidth of the PUCCH format 4 in
terms of resource blocks, shall fulfil

where is a set of non-negative integers.

### 5.4.2C PUCCH format 5

The block of bits shall be scrambled with a UE-specific scrambling
sequence, resulting in a block of scrambled bits according to

where the scrambling sequence is given by clause 7.2. The scrambling
sequence generator shall be initialised with at the start of each
subframe where is the C-RNTI.

The block of scrambled bits shall be QPSK modulated as described in
Clause 7.1, resulting in a block of complex-valued modulation symbols
where .

The complex-valued symbols shall be divided into sets, each
corresponding to one SC-FDMA symbol. Block-wise spreading shall be
applied according to

where , and are given by Table 5.4.2C-1 for normal PUCCH format 5 and
shortened PUCCH format 5, and is given by Table 5.4.2C-2 with provided
by higher layers.

The block-wise spread complex-valued symbols shall be transform precoded
according to

where , resulting in a block of complex-valued symbols .

Table 5.4.2C-1: The quantities and

  PUCCH format type        Normal cyclic prefix      Extended cyclic prefix                              
  ------------------------ ------------------------- ------------------------- ------------------------- -------------------------
                           ![](media/image595.wmf)   ![](media/image596.wmf)   ![](media/image595.wmf)   ![](media/image596.wmf)
  Normal PUCCH format      6                         6                         5                         5
  Shortened PUCCH format   6                         5                         5                         4

Table 5.4.2C-2: Orthogonal sequences

      Orthogonal sequences
  --- ----------------------
  0   
  1   

### 5.4.3 Mapping to physical resources

The block of complex-valued symbols shall be multiplied with the
amplitude scaling factor in order to conform to the transmit power
specified in Clause 5.1.2.1 in 3GPP TS 36.213 \[4\], and mapped in
sequence starting with to resource elements. PUCCH uses one or more
resource block in each of the two slots in a subframe. Within the
physical resource block(s) used for transmission, the mapping of to
resource elements on antenna port and not used for transmission of
reference signals shall be in increasing order of first , then and
finally the slot number, starting with the first slot in the subframe.
The relation between the index and the antenna port number is given by
Table 5.2.1-1.

For non-BL/CE UEs, except for PUCCH format 4, the physical resource
blocks to be used for transmission of PUCCH in slot are given by

For BL/CE UEs, PUCCH is transmitted with repetitions. The PUCCH
transmission spans consecutive subframes, including subframes that are
not BL/CE UL subframes where the UE postpones the PUCCH transmission if
.

\- The quantity is given

\- by the higher layer parameter *pucch-NumRepetitionCE-Format1* for
PUCCH format 1/1a and *pucch-NumRepetitionCE-Format2* for PUCCH format
2/2a/2b, if configured. Otherwise

\- by the higher-layer parameter *pucch-NumRepetitionCE-Msg4-Level0-r13,
pucch-NumRepetitionCE-Msg4-Level1-r13,
pucch-NumRepetitionCE-Msg4-Level2-r13* or
*pucch-NumRepetitionCE-Msg4-Level3-r13*.

\- If uplink resource reservation is enabled for the UE as specified in
\[9\], then in case of PUCCH transmission with associated with C-RNTI or
SPS C-RNTI using UE-specific MPDCCH search space including PUCCH
transmission without a corresponding MPDCCH,

\- In a subframe that is fully reserved as defined in clause 8.0 in
\[4\], the PUCCH transmission is postponed until the next BL/CE uplink
subframe that is not fully reserved.

\- In a subframe that is partially reserved, the reserved SC-FDMA
symbols shall be counted in the PUCCH mapping but not used for
transmission of the PUCCH.

The physical resource blocks to be used for transmission of PUCCH in
subframe within the consecutive subframes are given by

where is the absolute subframe number of the first uplink subframe
intended for PUCCH.

The variable depends on the PUCCH format.

\- Formats 1, 1a and 1b:

\- Formats 2, 2a and 2b:

\- Format 3:

\- Format 5 (non-BL/CE UEs only):

For non-BL/CE UEs, for PUCCH format 4, the physical resource blocks to
be used for transmission of PUCCH in slot are given by

where is obtained from \[4\].

Mapping of modulation symbols for the physical uplink control channel
for PUCCH formats 1 -- 3 is illustrated in Figure 5.4.3-1.

In case of simultaneous transmission of sounding reference signal and
PUCCH format 1, 1a, 1b, 3, 4 or 5 when there is one serving cell
configured, the shortened PUCCH format shall be used where the last
SC-FDMA symbol in the second slot of a subframe shall be left empty.

In case of guard period for narrowband or wideband retuning for BL/CE
UEs, if an SC-FDMA symbol is left empty due to guard period, the SC-FDMA
symbol shall be counted in the PUCCH mapping but not used for
transmission of the PUCCH. The SC-FDMA symbol affected by the guard
period can be the first SC-FDMA symbol in the first slot of a subframe
and/or the last SC-FDMA symbol in the second slot of a subframe.

Figure 5.4.3-1: Mapping to physical resource blocks for PUCCH formats 1
-- 3 for non-BL/CE UEs.

 5.4A Short Physical Uplink Control Channel
------------------------------------------

### 5.4A.1 General

The short physical uplink control channel, SPUCCH, carries uplink
control information. Simultaneous transmission of SPUCCH and PUSCH from
the same UE where both SPUCCH and PUSCH is using either slot or subslot
transmission is supported if enabled by higher layers (see
*simultaneousPUCCH-PUSCH* in 3GPP TS 36.331 \[9\]). For frame structure
type 2 and in UpPTS, transmission of SPUCCH is not supported.

SPUCCH supports multiple formats as shown in Table 5.4A-1 and Table
5.4A-2 with different number of bits carried by each SPUCCH.

Table 5.4A-1: SPUCCH formats for slot transmission

  SPUCCH format   Modulation scheme   Number of bits per slot,
  --------------- ------------------- --------------------------
  1               N/A                 N/A
  1a              BPSK                1
  1b              QPSK                2
  3               QPSK                24
  4               QPSK                

Table 5.4A-2: SPUCCH formats for subslot transmission

  SPUCCH format   Modulation scheme   Number of bits per subslot,
  --------------- ------------------- -----------------------------
  1               N/A                 N/A
  1a              N/A                 1
  1b              N/A                 2
  4               QPSK                

The quantity represents the bandwidth of the SPUCCH format 4 as defined
by clause 5.4A.4.1, and and are defined in Table 5.4A.4.1-1 and Table
5.4A.4.2-1, respectively.

SPUCCH formats 1/1a/1b use a cyclic shift, , which varies with the
symbol number and the slot number as described in clause 5.4.

### 5.4A.2 SPUCCH formats 1,1a,1b

#### 5.4A.2.1 Slot-SPUCCH

Slot-SPUCCH format 1, 1a, 1b can be configured by higher layers to
either have frequency hopping enabled or disabled (see
*n1SlotSPUCCH-FH-AN-List* and *n1SlotSPUCCH-NoFH-AN-List* in 3GPP TS
36.331 \[9\]).

In case slot-SPUCCH format 1, 1a, 1b and frequency hopping is enabled,
the scrambled and block-wise spread complex-valued symbols are generated
as described in clause 5.4.1 for PUCCH format 1/1a/1b where , and.

In case slot-SPUCCH format 1, 1a, 1b and frequency hopping is disabled,
the scrambled and block-wise spread complex-valued symbols are generated
as described in clause 5.4.1 for PUCCH format 1/1a/1b where .

Irrespective of frequency hopping being enabled or disabled, is applied
as described in clause 5.4.1 for the slot in which the slot-SPUCCH is
transmitted in, i.e. either in the first or the second slot of the
subframe.

Resources used for transmission of slot-SPUCCH format 1, 1a and 1b are
identified by a resource index from which the cyclic shift is derived:

,

In case frequency hopping is enabled, the cyclic shift is determined as
described in clause 5.4.2, assuming the condition is fulfilled.

In case frequency hopping is disabled, the resource index also indicates
the orthogonal sequence index . Both the cyclic shift and the orthogonal
sequence index is in this case determined as described in clause 5.4.1.

#### 5.4A.2.2 Subslot-SPUCCH

For subslot-SPUCCH formats 1a and 1b, one or two bits are communicated
by SPUCCH resource selection. The resource set available for selection
are configured by higher layers (see *n1SubslotSPUCCH-AN-List* and
*sr-SubslotSPUCCH-ResourceList* in 3GPP TS 36.331 \[9\]). For
subslot-SPUCCH format 1, information is carried by the presence/absence
of transmission of subslot-SPUCCH from the UE.

The sequence is generated as described in clause 5.4.1, assuming .

The block of complex-valued symbols shall be scrambled by as described
in clause 5.4.1 assuming , , and with replaced by , defined in Table
5.4A.2.2-1.

Table 5.4A.2.2-1: The quantity for subslot-SPUCCH formats 1a and 1b

  SPUCCH format type        Subslot number in subframe   
  ------------------------- ---------------------------- ---
  Normal SPUCCH format      1,2,3,4                      2
  Normal SPUCCH format      0,5                          3
  Shortened SPUCCH format   5                            2

Resources used for transmission of SPUCCH format 1, 1a and 1b are
identified by a resource index from which the cyclic shift is
determined, as described in clause 5.4.2, assuming the condition is
fulfilled.The resource set for subslot-SPUCCH format 1/1a/1b is
configured by higher layers (see *n1SubslotSPUCCH-AN-List* in 3GPP TS
36.331 \[9\]):

\- subslot-SPUCCH format 1:

\- subslot-SPUCCH format 1a:

\- subslot-SPUCCH format 1b:

Each resource indicates (a) bit state(s) as defined by Table 5.4A.2.2-2.

Table 5.4A.2.2-2: Subslot-SPUCCH resource for formats 1a and 1b

  PUCCH format        
  -------------- ---- --
  1              \-   
  1a             0    
                 1    
  1b             00   
                 10   
                 01   
                 11   

### 5.4A.3 SPUCCH format 3

#### 5.4A.3.1 Slot-SPUCCH

The complex-valued modulation symbols shall be generated as described in
clause 5.4.2A.

Depending on if the slot-SPUCCH is transmitted in the first or the
second slot of the subframe, different block-wise spreading with the
orthogonal sequences or is applied. Each spreading results in sets of
values each according to:

where

\- (see clause 5.4.2A) if transmitted in the first slot, and (see clause
5.4.2A), if transmitted in the second slot.

\- The orthogonal sequences and are given by Table 5.4.2A-1

Resources used for transmission of SPUCCH format 3 are identified by a
resource index from which the quantities and are derived according to
clause 5.4A.3 by replacing with .

Each set of complex-valued symbols shall be cyclically shifted and
transform precoded according to clause 5.4.2A with replaced by in the
transform precoding.

### 5.4A.4 SPUCCH format 4

#### 5.4A.4.1 Slot-SPUCCH

The block of bits shall be scrambled according to clause 5.4.2B.

The block of scrambled bits shall be QPSK modulated as described in
Clause 7.1, resulting in a block of complex-valued modulation symbols
where .

The block of complex-valued symbols is divided into (defined in Table
5.4A.4.1-1) sets, each corresponding to one SC-FDMA symbol. Transform
precoding shall be applied according to clause 5.4.2B replacing with and
replacing with .

The variable, where represents the bandwidth of the SPUCCH format 4 in
terms of resource blocks in the frequency domain, and is determined by
higher layer signalling (*n4numberOfPRB-r15*, see 3GPP TS 36.213 \[4,
Table 10.1.1-2\] and 3GPP TS 36.331 \[9\]), and shall fulfil

,

where, is a set of non-negative integers.

Table 5.4A.4.1-1: The quantity .

  SPUCCH format type        
  ------------------------- ---
  Normal SPUCCH format      5
  Shortened SPUCCH format   4

#### 5.4A.4.2 Subslot-SPUCCH

For subslot-SPUCCH the procedure of slot-SPUCCH in clause 5.4A.4.1 is
followed except that:

\- the block of complex-valued symbols is divided into (defined in Table
5.4A.4.2-1) sets, instead of sets, and,

\- is replaced by , in the transform precoding.

Table 5.4A.4.2-1: The quantity .

  SPUCCH format type        Subslot number in subframe   
  ------------------------- ---------------------------- ---
  Normal SPUCCH format      1,2,3,4                      1
  Normal SPUCCH format      0,5                          2
  Shortened SPUCCH format   5                            1

### 5.4A.5 Mapping to physical resources

The block of complex-valued symbols shall be multiplied with the
amplitude scaling factor in order to conform to the transmit power
specified in Clause 5.1.2.1 of 3GPP TS 36.213 \[4\], and mapped in
sequence starting with to resource elements.

SPUCCH uses one or more resource block in the frequency domain and is
mapped to either a slot or a subslot in the time domain. Within the
physical resource block(s) used for transmission, the mapping of to
resource elements on antenna port and not used for transmission of
reference signals shall be in increasing order of first , then .

The starting symbol for each subslot number is provided by Table
5.4A.4.5-1 for subslot-SPUCCH.

For slot-SPUCCH the starting symbol is for the slot the SPUCCH is
transmitted in.

Table 5.4A.5-1: Starting symbol for subslot-SPUCCH mapping

                   Subslot number                   
  ---------------- ---------------- --- --- --- --- ---
                   0                1   2   3   4   5
  Format 1/1a/1b   0                3   5   0   2   4
  Format 4         1                4   6   1   3   5

The relation between the index and the antenna port number is given by
Table 5.2.1-1.

The physical resource blocks () within which the transmission of SPUCCH
is carried out in slot depends on the SPUCCH format and whether
frequency hopping is enabled or not.

In case of slot-SPUCCH format 1, 1a, 1b and frequency hopping disabled,
the PRB used is determined as described in clause 5.4.3 for PUCCH format
1, 1a, 1b.

In case of slot-SPUCCH format 3, the PRB used is given by

![](media/image608.wmf)

For the other SPUCCH formats, it is determined by Table 5.4A.5-2, Table
5.4A.5-3 and Table 5.4A.5-4.

Table 5.4A.5-2: for slot-SPUCCH format 1, 1a, 1b with frequency hopping
enabled

  Slot number   Slot-SPUCCH format
  ------------- -----------------------------------------------
                Format 1/1a/1b with frequency hopping enabled
                
                

Table 5.4A.5-3: for slot-SPUCCH format 4

  Slot number   Slot-SPUCCH format
  ------------- --------------------
                Format 4
                
                

Table 5.4A.5-4: for subslot-SPUCCH format 1, 1a, 1b, 4

  Subslot number   SPUCCH format    
  ---------------- ---------------- ----------
                   Format 1/1a/1b   Format 4
  0                                 
  1                                 
  2                                 
  3                                 
  4                                 
  5                                 

The variable depends on the SPUCCH format as defined in Table 5.4A.5-5.

Table 5.4A.5-5: for SPUCCH

+---------------+------------------+---------------------------------+
| SPUCCH Format |                  |                                 |
+===============+==================+=================================+
| Slot          | Format 1, 1a, 1b | Frequency hopping disabled:     |
|               |                  |                                 |
|               |                  | see derivation of for PUCCH     |
|               |                  | format 1, 1a, 1b in clause      |
|               |                  | 5.4.3 replacing with            |
|               |                  |                                 |
|               |                  | Frequency hopping enabled:      |
|               |                  |                                 |
|               |                  | see derivation of for PUCCH     |
|               |                  | format 2, 2a, 2b in clause      |
|               |                  | 5.4.3 replacing with            |
+---------------+------------------+---------------------------------+
|               | Format 3         |                                 |
+---------------+------------------+---------------------------------+
|               | Format 4         |                                 |
+---------------+------------------+---------------------------------+
| Subslot       | Format 1, 1a, 1b | see derivation of for PUCCH     |
|               |                  | format 2, 2a, 2b in clause      |
|               |                  | 5.4.3 replacing with            |
+---------------+------------------+---------------------------------+
|               | Format 4         |                                 |
+---------------+------------------+---------------------------------+

In case of subslot-SPUCCH, there is a configuration restriction that
each SPUCCH resource in the resource set, of up to four resources, ,
shall map to the same pair of PRBs () This restriction applies
separately to each of *n1SubslotSPUCCH-AN-List* and
*sr-SubslotSPUCCH-Resource* in 3GPP TS 36.331 \[9\].

In case of simultaneous transmission of sounding reference signal and
SPUCCH when there is one serving cell configured, the shortened SPUCCH
format shall be used where the last SC-FDMA symbol in the second slot of
a subframe shall be left empty.

5.5 Reference signals
---------------------

Two types of uplink reference signals are supported:

\- Demodulation reference signal, associated with transmission of PUSCH
or (S)PUCCH

\- Sounding reference signal, not associated with transmission of PUSCH
or (S)PUCCH

The same set of base sequences is used for demodulation and sounding
reference signals.

### 5.5.1 Generation of the reference signal sequence

Reference signal sequence is defined by a cyclic shift of a base
sequence according to

where

\- is the length of the reference signal sequence, , is defined in
clause 5.5.2.1.2, and,

\- when either

\- the higher-layer parameter *ul-DMRS-IFDMA* is set and the most recent
uplink-related DCI contains the *Cyclic Shift Field mapping table for
DMRS bit* field which is set to 1 to indicate the use of Table
5.5.2.1.1-3, or,

\- the *Cyclic Shift Field mapping table for DMRS bit* is set to 1 in
the most recent uplink-related DCI format 7 which indicates the use of
Table 5.5.2.1.1-4, and

\- otherwise.

Multiple reference signal sequences are defined from a single base
sequence through different values of .

Base sequences are divided into groups, where is the group number and is
the base sequence number within the group, such that each group contains
one base sequence () of each length , and two base sequences () of each
length , . The sequence group number and the number within the group may
vary in time as described in clauses 5.5.1.3 and 5.5.1.4, respectively.
The definition of the base sequence depends on the sequence length.

#### 5.5.1.1 Base sequences of length or larger

For, the base sequence is given by

where the root Zadoff-Chu sequence is defined by

with given by

The length of the Zadoff-Chu sequence is given by the largest prime
number such that.

####  5.5.1.2 Base sequences of length less than 

For , , , and , the base sequence is given by

where the value of is given by Table 5.5.1.2-1, Table 5.5.1.2-2, Table
5.5.1.2-3, and Table 5.5.1.2-4 for , , , and , respectively. For , the
base sequence is given by

Table 5.5.1.2-1: Definition of for .

  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
  0    -1   1    3    -3   3    3    1    1    3    1    -3   3
  1    1    1    3    3    3    -1   1    -3   -3   1    -3   3
  2    1    1    -3   -3   -3   -1   -3   -3   1    -3   1    -1
  3    -1   1    1    1    1    -1   -3   -3   1    -3   3    -1
  4    -1   3    1    -1   1    -1   -3   -1   1    -1   1    3
  5    1    -3   3    -1   -1   1    1    -1   -1   3    -3   1
  6    -1   3    -3   -3   -3   3    1    -1   3    3    -3   1
  7    -3   -1   -1   -1   1    -3   3    -1   1    -3   3    1
  8    1    -3   3    1    -1   -1   -1   1    1    3    -1   1
  9    1    -3   -1   3    3    -1   -3   1    1    1    1    1
  10   -1   3    -1   1    1    -3   -3   -1   -3   -3   3    -1
  11   3    1    -1   -1   3    3    -3   1    3    1    3    3
  12   1    -3   1    1    -3   1    1    1    -3   -3   -3   1
  13   3    3    -3   3    -3   1    1    3    -1   -3   3    3
  14   -3   1    -1   -3   -1   3    1    3    3    3    -1   1
  15   3    -1   1    -3   -1   -1   1    1    3    1    -1   -3
  16   1    3    1    -1   1    3    3    3    -1   -1   3    -1
  17   -3   1    1    3    -3   3    -3   -3   3    1    3    -1
  18   -3   3    1    1    -3   1    -3   -3   -1   -1   1    -3
  19   -1   3    1    3    1    -1   -1   3    -3   -1   -3   -1
  20   -1   -3   1    1    1    1    3    1    -1   1    -3   -1
  21   -1   3    -1   1    -3   -3   -3   -3   -3   1    -1   -3
  22   1    1    -3   -3   -3   -3   -1   3    -3   1    -3   3
  23   1    1    -1   -3   -1   -3   1    -1   1    3    -1   1
  24   1    1    3    1    3    3    -1   1    -1   -3   -3   1
  25   1    -3   3    3    1    3    3    1    -3   -1   -1   3
  26   1    3    -3   -3   3    -3   1    -1   -1   3    -1   -3
  27   -3   -1   -3   -1   -3   3    1    -1   1    3    -3   -3
  28   -1   3    -3   3    -1   3    3    -3   3    3    -1   -1
  29   3    -3   -3   -1   -1   -3   -1   3    -3   3    1    -1
  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----

Table 5.5.1.2-2: Definition of for

  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
  0    -1   3    1    -3   3    -1   1    3    -3   3    1    3    -3   3    1    1    -1   1    3    -3   3    -3   -1   -3
  1    -3   3    -3   -3   -3   1    -3   -3   3    -1   1    1    1    3    1    -1   3    -3   -3   1    3    1    1    -3
  2    3    -1   3    3    1    1    -3   3    3    3    3    1    -1   3    -1   1    1    -1   -3   -1   -1   1    3    3
  3    -1   -3   1    1    3    -3   1    1    -3   -1   -1   1    3    1    3    1    -1   3    1    1    -3   -1   -3   -1
  4    -1   -1   -1   -3   -3   -1   1    1    3    3    -1   3    -1   1    -1   -3   1    -1   -3   -3   1    -3   -1   -1
  5    -3   1    1    3    -1   1    3    1    -3   1    -3   1    1    -1   -1   3    -1   -3   3    -3   -3   -3   1    1
  6    1    1    -1   -1   3    -3   -3   3    -3   1    -1   -1   1    -1   1    1    -1   -3   -1   1    -1   3    -1   -3
  7    -3   3    3    -1   -1   -3   -1   3    1    3    1    3    1    1    -1   3    1    -1   1    3    -3   -1   -1   1
  8    -3   1    3    -3   1    -1   -3   3    -3   3    -1   -1   -1   -1   1    -3   -3   -3   1    -3   -3   -3   1    -3
  9    1    1    -3   3    3    -1   -3   -1   3    -3   3    3    3    -1   1    1    -3   1    -1   1    1    -3   1    1
  10   -1   1    -3   -3   3    -1   3    -1   -1   -3   -3   -3   -1   -3   -3   1    -1   1    3    3    -1   1    -1   3
  11   1    3    3    -3   -3   1    3    1    -1   -3   -3   -3   3    3    -3   3    3    -1   -3   3    -1   1    -3   1
  12   1    3    3    1    1    1    -1   -1   1    -3   3    -1   1    1    -3   3    3    -1   -3   3    -3   -1   -3   -1
  13   3    -1   -1   -1   -1   -3   -1   3    3    1    -1   1    3    3    3    -1   1    1    -3   1    3    -1   -3   3
  14   -3   -3   3    1    3    1    -3   3    1    3    1    1    3    3    -1   -1   -3   1    -3   -1   3    1    1    3
  15   -1   -1   1    -3   1    3    -3   1    -1   -3   -1   3    1    3    1    -1   -3   -3   -1   -1   -3   -3   -3   -1
  16   -1   -3   3    -1   -1   -1   -1   1    1    -3   3    1    3    3    1    -1   1    -3   1    -3   1    1    -3   -1
  17   1    3    -1   3    3    -1   -3   1    -1   -3   3    3    3    -1   1    1    3    -1   -3   -1   3    -1   -1   -1
  18   1    1    1    1    1    -1   3    -1   -3   1    1    3    -3   1    -3   -1   1    1    -3   -3   3    1    1    -3
  19   1    3    3    1    -1   -3   3    -1   3    3    3    -3   1    -1   1    -1   -3   -1   1    3    -1   3    -3   -3
  20   -1   -3   3    -3   -3   -3   -1   -1   -3   -1   -3   3    1    3    -3   -1   3    -1   1    -1   3    -3   1    -1
  21   -3   -3   1    1    -1   1    -1   1    -1   3    1    -3   -1   1    -1   1    -1   -1   3    3    -3   -1   1    -3
  22   -3   -1   -3   3    1    -1   -3   -1   -3   -3   3    -3   3    -3   -1   1    3    1    -3   1    3    3    -1   -3
  23   -1   -1   -1   -1   3    3    3    1    3    3    -3   1    3    -1   3    -1   3    3    -3   3    1    -1   3    3
  24   1    -1   3    3    -1   -3   3    -3   -1   -1   3    -1   3    -1   -1   1    1    1    1    -1   -1   -3   -1   3
  25   1    -1   1    -1   3    -1   3    1    1    -1   -1   -3   1    1    -3   1    3    -3   1    1    -3   -3   -1   -1
  26   -3   -1   1    3    1    1    -3   -1   -1   -3   3    -3   3    1    -3   3    -3   1    -1   1    -3   1    1    1
  27   -1   -3   3    3    1    1    3    -1   -3   -1   -1   -1   3    1    -3   -3   -1   3    -3   -1   -3   -1   -3   -1
  28   -1   -3   -1   -1   1    -3   -1   -1   1    -1   -3   1    1    -3   1    -3   -3   3    1    1    -1   3    -1   -1
  29   1    1    -1   -1   -3   -1   3    -1   3    -1   1    3    1    -1   3    1    3    -3   -3   1    -1   -1   1    3
  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----

Table 5.5.1.2-3: Definition of for

  ---- ---- ---- ---- ---- ---- ----
  0    -1   -3   3    -3   3    -3
  1    -1   3    -1   1    1    1
  2    3    -1   -3   -3   1    3
  3    3    -1   -1   1    -1   -1
  4    -1   -1   -3   1    -3   -1
  5    1    3    -3   -1   -3   3
  6    -3   3    -1   -1   1    -3
  7    -1   -3   -3   1    3    3
  8    3    -1   -1   3    1    3
  9    3    -3   3    1    -1   1
  10   -3   1    -3   -3   -3   -3
  11   -3   -3   -3   1    -3   -3
  12   3    -3   1    -1   -3   -3
  13   3    -3   3    -1   -1   -3
  14   3    -1   1    3    3    1
  15   -1   1    -1   -3   1    1
  16   -3   -1   -3   -1   3    3
  17   1    -1   3    -3   3    3
  18   1    3    1    1    -3   3
  19   -1   -3   -1   -1   3    -3
  20   3    -1   -3   -1   -1   -3
  21   3    1    3    -3   -3   1
  22   1    3    -1   -1   1    -1
  23   -3   1    -3   3    3    3
  24   1    3    -3   3    -3   3
  25   -1   -1   1    -3   1    -1
  26   1    -3   -1   -1   3    1
  27   -3   -1   -1   3    1    1
  28   -1   3    -3   -3   -3   3
  29   3    1    -1   1    3    1
  ---- ---- ---- ---- ---- ---- ----

Table 5.5.1.2-4: Definition of for

  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
  0    -3   -3   -3   -3   -3   -1   1    -1   -3   3    -1   3    -1   3    -3   -1   -1   3
  1    -3   -3   -3   -3   -3   -1   1    -1   1    -3   -3   -3   1    -1   3    -3   -3   1
  2    -3   -3   -3   -3   -3   -1   1    1    3    -3   1    1    -3   1    -3   3    1    -1
  3    -3   -3   -3   -3   -3   -1   1    3    -3   -1   3    -1   3    1    -1   -3   3    -3
  4    -3   -3   -3   -3   -3   -1   3    -3   -1   1    -1   -3   3    3    1    -3   1    -1
  5    -3   -3   -3   -3   -3   1    -3   -3   -3   -3   1    1    1    -3   1    1    -3   -3
  6    -3   -3   -3   -3   -3   1    -3   -3   1    1    -3   -3   -3   1    -1   3    -1   3
  7    -3   -3   -3   -3   -3   1    -3   -1   3    -1   3    3    -1   -1   1    3    3    -1
  8    -3   -3   -3   -3   -3   1    -1   -1   -1   -3   3    -1   3    -3   3    -1   1    3
  9    -3   -3   -3   -3   -3   3    -3   1    -1   3    -3   3    3    -1   -3   1    1    -3
  10   -3   -3   -3   -3   -3   3    -1   -3   -3   1    1    3    -3   -1   3    -1   3    1
  11   -3   -3   -3   -3   -3   3    3    -1   -1   -1   3    1    -3   3    -1   1    -3   1
  12   -3   -3   -3   -3   -1   -3   -3   -3   1    3    1    -1   3    -3   -1   -3   1    1
  13   -3   -3   -3   -3   -1   -3   -3   1    -1   -1   3    -3   -3   1    3    1    -3   1
  14   -3   -3   -3   -3   -1   -3   -3   1    3    -3   -1   3    1    3    -1   3    -1   -3
  15   -3   -3   -3   -3   -1   -3   -1   3    -3   1    -3   1    -1   -3   -3   1    1    3
  16   -3   -3   -3   -3   -1   -1   3    -3   3    -1   -3   1    1    -1   -3   -1   3    -3
  17   -3   -3   -3   -3   -1   -1   3    -1   -3   1    3    -1   -3   -3   1    3    -1   1
  18   -3   -3   -3   -3   -1   3    -1   -1   3    3    -1   -3   1    1    1    -1   -3   -1
  19   -3   -3   -3   -3   -1   3    1    -3   -1   -3   3    1    -1   3    -1   1    3    -1
  20   -3   -3   -3   -3   1    -3   -3   3    1    1    -3   -1   1    3    3    -1   3    -1
  21   -3   -3   -3   -3   1    -3   1    3    1    -1   -1   3    3    -1   1    1    -3   3
  22   -3   -3   -3   -3   1    -3   3    -3   -1   3    1    1    -1   -1   3    3    -1   3
  23   -3   -3   -3   -3   1    -3   3    -1   3    -3   -1   -1   -1   1    -3   -3   3    1
  24   -3   -3   -3   -3   1    1    3    1    1    -1   3    1    1    3    -1   -3   1    3
  25   -3   -3   -3   -3   1    3    3    3    1    -3   1    -3   -3   3    -3   1    -1   -3
  26   -3   -3   -3   -3   3    1    3    3    -1   3    -3   -3   -1   3    -1   -1   -3   1
  27   -3   -3   -3   -1   -3   -3   -1   -1   -3   3    3    1    -3   -1   -1   3    1    -3
  28   -3   -3   -3   -1   -3   1    -1   1    -3   3    1    -3   -1   1    3    1    -1   -1
  29   -3   -3   -3   -1   -3   3    1    1    -1   -1   1    3    1    -3   1    -3   -1   1
  ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----

####  5.5.1.3 Group hopping

The sequence-group number in slot is defined by a group hopping pattern
and a sequence-shift pattern according to

There are 17 different hopping patterns and 30 different sequence-shift
patterns. Sequence-group hopping can be enabled or disabled by means of
the cell-specific parameter *Group-hopping-enabled* provided by higher
layers. Sequence-group hopping for PUSCH can be disabled for a certain
UE through the higher-layer parameter *Disable-sequence-group-hopping*
despite being enabled on a cell basis unless the PUSCH transmission
corresponds to a Random Access Response Grant or a retransmission of the
same transport block as part of the contention based random access
procedure.

The group-hopping pattern may be different for PUSCH, (S)PUCCH and SRS
and is given by

where the pseudo-random sequence is defined by clause 7.2. The
pseudo-random sequence generator shall be initialized with at the
beginning of each radio frame where is given by clause 5.5.1.5.

The sequence-shift pattern definition differs between PUCCH, PUSCH and
SRS.

For SPUCCH/PUCCH, the sequence-shift pattern is given by where is given
by clause 5.5.1.5.

For PUSCH, the sequence-shift pattern is given by , where is configured
by higher layers, if no value for is provided by higher layers or if the
PUSCH transmission corresponds to a Random Access Response Grant or a
retransmission of the same transport block as part of the contention
based random access procedure, otherwise it is given by with given by
clause 5.5.1.5.

For SRS, the sequence-shift pattern is given by where is given by clause
5.5.1.5.

####  5.5.1.4 Sequence hopping

Sequence hopping only applies for reference-signals of length .

For reference-signals of length , the base sequence number within the
base sequence group is given by .

For reference-signals of length , the base sequence number within the
base sequence group in slot is defined by

where the pseudo-random sequence is given by clause 7.2. The parameter
*Sequence-hopping-enabled* provided by higher layers determines if
sequence hopping is enabled or not. Sequence hopping for PUSCH can be
disabled for a certain UE through the higher-layer parameter
*Disable-sequence-group-hopping* despite being enabled on a cell basis
unless the PUSCH transmission corresponds to a Random Access Response
Grant or a retransmission of the same transport block as part of the
contention based random access procedure.

For PUSCH or SPUCCH/PUCCH format 4 transmission with ≥ 6 RBs, the
pseudo-random sequence generator shall be initialized with at the
beginning of each radio frame where is given by clause 5.5.1.5.

For SRS, the pseudo-random sequence generator shall be initialized with
at the beginning of each radio frame where is given by clause 5.5.1.5
and is given by clause 5.5.1.3.

#### 5.5.1.5 Determining virtual cell identity for sequence generation

The definition of depends on the type of transmission.

Transmissions associated with PUSCH:

\- if no value for is configured by higher layers or if the PUSCH
transmission corresponds to a Random Access Response Grant or a
retransmission of the same transport block as part of the contention
based random access procedure,

\- otherwise.

Transmissions associated with SPUCCH/PUCCH:

\- if no value for is configured by higher layers,

\- otherwise.

Basic sounding reference signals:

\- $n_{\text{ID}}^{\text{RS}} = n_{\text{ID}}^{\text{SRS}}$ if the
higher-layer parameter *srs-VirtualCellID* is configured and
*srs-VirtualCellID-AllSRS* is configured as *TRUE*, where
$n_{\text{ID}}^{\text{SRS}}$ equals the higher-layer parameter
*srs-VirtualCellID*

\- $n_{\text{ID}}^{\text{RS}} = N_{\text{ID}}^{\text{cell}}$ otherwise.

Additional sounding reference signals:

\- $n_{\text{ID}}^{\text{RS}} = N_{\text{ID}}^{\text{cell}}$ if no value
for $n_{\text{ID}}^{\text{SRS}}$ is configured by the higher-layer
parameter *srs-VirtualCellID*

\- $n_{\text{ID}}^{\text{RS}} = n_{\text{ID}}^{\text{SRS}}$ otherwise.

###  5.5.2 Demodulation reference signal

#### 5.5.2.1 Demodulation reference signal for PUSCH

##### 5.5.2.1.1 Reference signal sequence

The PUSCH demodulation reference signal sequence associated with layer
is defined by

where

and if

\- the higher-layer parameter *ul-DMRS-IFDMA* is set and the most recent
uplink-related DCI contains the *Cyclic Shift Field mapping table for
DMRS bit* field which is set to 1 to indicate the use of Table
5.5.2.1.1-3, or,

\- the *Cyclic Shift Field mapping table for DMRS bit* field is set to 1
in the most recent uplink-related DCI format 7 which indicates the use
of Table 5.5.2.1.1-4, or,

\- subslot-PUSCH/slot-PUSCH for the transport block is semi-persistently
scheduled (i.e. higher layer parameter *sps-ConfigUL-STTI* is
configured, see 3GPP TS 36.331 \[9\]), and *ifdma-Config-SPS* is set.

In all other cases, .

Clause 5.5.1 defines the sequence where, for PUSCH demodulation
reference signal sequence, when

\- the higher-layer parameter *ul-DMRS-IFDMA* is set and the most recent
uplink-related DCI contains the *Cyclic Shift Field mapping table for
DMRS bit* field which is set to 1 to indicate the use of Table
5.5.2.1.1-3, or,

\- the *Cyclic Shift Field mapping table for DMRS bit* field is set to 1
in the most recent uplink-related DCI format 7 which indicates the use
of Table 5.5.2.1.1-4, or,

\- subslot-PUSCH/slot-PUSCH for the transport block is semi-persistently
scheduled (i.e. higher layer parameter *sps-ConfigUL-STTI* is
configured, see 3GPP TS 36.331 \[9\]), and *ifdma-Config-SPS* is set.

In all other cases, .

The orthogonal sequence is given by for subslot-PUSCH/slot-PUSCH. In all
other cases, it is given by for DCI format 0 if the higher-layer
parameter *Activate-DMRS-with OCC* is not set or if the temporary C-RNTI
was used to transmit the most recent uplink-related DCI for the
transport block associated with the corresponding PUSCH transmission.
Otherwise,

\- if higher-layer parameter *ul-DMRS-IFDMA* is not set, is given by
Table 5.5.2.1.1-1 using the cyclic shift field in the most recent
uplink-related DCI \[3\],

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is not present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-1 using the
cyclic shift field in the most recent uplink-related DCI,

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-1 using the
cyclic shift field in the most recent uplink-related DCI when the
*Cyclic Shift Field mapping table for DMRS bit* field is set to 0, and

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-3 using the
cyclic shift field in the most recent uplink-related DCI when the
*Cyclic Shift Field mapping table for DMRS bit* field is set to 1.

The cyclic shift in a slot is given as if the ul-V-SPS-RNTI-r14 was used
to transmit the most recent uplink-related DCI for the transport block
associated with the corresponding PUSCH transmission. For PUSCH
transmissions not using sub-PRB allocations, if *pusch-CyclicShift in
higher layer parameter PUR-PUSCH-Config* is configured, then for PUSCH
(re)transmission corresponding to preconfigured uplink resource it
provides the value of $n_{cs,\lambda}$ and the cyclic shift in a slot is
given as .

Otherwise, the cyclic shift in a slot is given as with

where the value of *is given by Table 5.5.2.1.1-2 according to the*
parameter *cyclicShift* provided by higher layers. For non-BL/CE UEs is
given using the most recent uplink-related DCI 3GPP TS 36.212 \[3\] for
the transport block associated with the corresponding PUSCH
transmission, except for subslot-PUSCH/slot-PUSCH, as follows:

\- if the higher-layer parameter *ul-DMRS-IFDMA* is not set, is given by
Table 5.5.2.1.1-1 using the cyclic shift field in the most recent
uplink-related DCI,

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is not present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-1 using the
cyclic shift field in the most recent uplink-related DCI,

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-1 using the
cyclic shift field in the most recent uplink-related DCI when the
*Cyclic Shift Field mapping table for DMRS bit* field is set to 0, and

\- if higher-layer parameter *ul-DMRS-IFDMA* is set and the *Cyclic
Shift Field mapping table for DMRS bit* field is present in the most
recent uplink-related DCI, is given by Table 5.5.2.1.1-3 using the
cyclic shift field in the most recent uplink-related DCI when the
*Cyclic Shift Field mapping table for DMRS bit* field is set to 1.

For subslot-PUSCH/slot-PUSCH for non-BL/CE UEs, is given by Table
5.5.2.1.1-4, using the cyclic shift field in the most recent
uplink-related DCI. If the *Cyclic Shift Field mapping table for DMRS
bit* field is set to 0, in Table 5.5.2.1.1-4 is ignored. If the *Cyclic
Shift Field mapping table for DMRS bit* field is set to 1, both and are
given by Table 5.5.2.1.1-4.

For BL/CE UEs, a cyclic shift field of \'000\' shall be assumed when
determining from Table 5.5.2.1.1-1.

For subframe-based PUSCH transmission, the first row of Table
5.5.2.1.1-1 shall be used to obtain and if there is no uplink-related
DCI for the same transport block associated with the corresponding PUSCH
transmission, and

\- if the initial PUSCH for the same transport block is
semi-persistently scheduled and *cyclicShiftSPS* is not configured, or

\- if the initial PUSCH for the same transport block is scheduled by the
random-access response grant.

An exception applies if subframe-based PUSCH for the transport block is
semi-persistently scheduled and the higher-layer parameter
*cyclicShiftSPS* is configured. In this case, the value of
![](media/image822.wmf) is given by Table 5.5.2.1.1-1 according to the
higher-layer parameter *cyclicShiftSPS*.

An exception applies if subslot-PUSCH/slot-PUSCH for the transport block
is semi-persistently scheduled (see 3GPP TS 36.331,
*sps-ConfigUL-sTTI*). In this case:

\- is given by Table 5.5.2.1.1-1 according to the higher-layer parameter
*cyclicShiftSPS-STTI* if the higher layer parameter *ifdma-Config-SPS*
is not set, and,

\- and are given by Table 5.5.2.1.1-3 *according to the higher-layer*
parameter *cyclicShiftSPS-STTI* if the higher layer parameter
*ifdma-Config-SPS* is set.

The quantity is given by

where the pseudo-random sequence is defined by clause 7.2. The
application of is cell-specific. The pseudo-random sequence generator
shall be initialized with at the beginning of each radio frame. The
quantity is given by if no value for is configured by higher layers for
PUSCH/(S)PUCCH format 4/PUCCH format 5 or the PUSCH transmission
corresponds to a Random Access Response Grant or a retransmission of the
same transport block as part of the contention based random access
procedure, otherwise it is given by .

The vector of reference signals shall be precoded according to

where is the number of antenna ports used for PUSCH transmission.

For PUSCH transmission using a single antenna port, , and .

For spatial multiplexing, or and the precoding matrix shall be identical
to the precoding matrix used in clause 5.3.3A.2 for precoding of the
PUSCH in the same subframe.

Table 5.5.2.1.1-1: Mapping of Cyclic Shift Field in uplink-related DCI
format to and

+-----------+-----------+-----------+----+----+-----------+---+---+---+
| Cyclic    |           |           |    |    |           |   |   |   |
| Shift     |           |           |    |    |           |   |   |   |
| Field in  |           |           |    |    |           |   |   |   |
|           |           |           |    |    |           |   |   |   |
| uplin     |           |           |    |    |           |   |   |   |
| k-related |           |           |    |    |           |   |   |   |
| DCI       |           |           |    |    |           |   |   |   |
| format    |           |           |    |    |           |   |   |   |
| \[3\]     |           |           |    |    |           |   |   |   |
+===========+===========+===========+====+====+===========+===+===+===+
|           | ![](med   | ![](med   |    |    | ![](med   |   |   |   |
|           | ia/image8 | ia/image8 |    |    | ia/image8 |   |   |   |
|           | 42.wmf){w | 43.wmf){w |    |    | 42.wmf){w |   |   |   |
|           | idth="0.3 | idth="0.3 |    |    | idth="0.3 |   |   |   |
|           | 541666666 | 229166666 |    |    | 541666666 |   |   |   |
|           | 666667in" | 666667in" |    |    | 666667in" |   |   |   |
|           | heig      | heig      |    |    | heig      |   |   |   |
|           | ht="0.166 | ht="0.166 |    |    | ht="0.166 |   |   |   |
|           | 666666666 | 666666666 |    |    | 666666666 |   |   |   |
|           | 66666in"} | 66666in"} |    |    | 66666in"} |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 000       | 0         | 6         | 3  | 9  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 001       | 6         | 0         | 9  | 3  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 010       | 3         | 9         | 6  | 0  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 011       | 4         | 10        | 7  | 1  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 100       | 2         | 8         | 5  | 11 |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 101       | 8         | 2         | 11 | 5  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 110       | 10        | 4         | 1  | 7  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+
| 111       | 9         | 3         | 0  | 6  |           |   |   |   |
+-----------+-----------+-----------+----+----+-----------+---+---+---+

Table 5.5.2.1.1-2: Mapping of *cyclicShift* to values

  cyclicShift   
  ------------- ----
  0             0
  1             2
  2             3
  3             4
  4             6
  5             8
  6             9
  7             10

Table 5.5.2.1.1-3: Mapping of Cyclic Shift Field in uplink-related DCI
format to , , and

<table>
<thead>
<tr class="header">
<th><p>Cyclic Shift Field in</p>
<p>uplink-related DCI format [3]</p></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td><img src="media/image852.wmf" /></td>
<td><img src="media/image853.wmf" /></td>
<td><img src="media/image854.wmf" /></td>
<td><img src="media/image855.wmf" /></td>
<td><img src="media/image856.wmf" /></td>
<td><img src="media/image857.wmf" /></td>
<td><img src="media/image858.wmf" /></td>
<td><img src="media/image859.wmf" /></td>
</tr>
<tr class="even">
<td>000</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>3</td>
<td>9</td>
<td><img src="media/image860.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image862.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
</tr>
<tr class="odd">
<td>001</td>
<td>1</td>
<td>6</td>
<td>0</td>
<td>9</td>
<td>3</td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
</tr>
<tr class="even">
<td>010</td>
<td>1</td>
<td>3</td>
<td>9</td>
<td>6</td>
<td>0</td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
</tr>
<tr class="odd">
<td>011</td>
<td>0</td>
<td>4</td>
<td>10</td>
<td>7</td>
<td>1</td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
</tr>
<tr class="even">
<td>100</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>5</td>
<td>11</td>
<td><img src="media/image860.wmf" /></td>
<td><img src="media/image860.wmf" /></td>
<td><img src="media/image860.wmf" /></td>
<td><img src="media/image860.wmf" /></td>
</tr>
<tr class="odd">
<td>101</td>
<td>0</td>
<td>8</td>
<td>2</td>
<td>11</td>
<td>5</td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
</tr>
<tr class="even">
<td>110</td>
<td>0</td>
<td>10</td>
<td>4</td>
<td>1</td>
<td>7</td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
</tr>
<tr class="odd">
<td>111</td>
<td>1</td>
<td>9</td>
<td>3</td>
<td>0</td>
<td>6</td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image861.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
<td><img src="media/image863.wmf" /></td>
</tr>
</tbody>
</table>

Table 5.5.2.1.1-4: for subslot-PUSCH/slot-PUSCH

+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| C     |       |       |       |       |       |       |       |       |
| yclic |       |       |       |       |       |       |       |       |
| Shift |       |       |       |       |       |       |       |       |
| Field |       |       |       |       |       |       |       |       |
| in    |       |       |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |       |
| upli  |       |       |       |       |       |       |       |       |
| nk-re |       |       |       |       |       |       |       |       |
| lated |       |       |       |       |       |       |       |       |
| DCI   |       |       |       |       |       |       |       |       |
| f     |       |       |       |       |       |       |       |       |
| ormat |       |       |       |       |       |       |       |       |
| \[3\] |       |       |       |       |       |       |       |       |
+=======+=======+=======+=======+=======+=======+=======+=======+=======+
|  {#se | !     | !     |  {    |  {    | !     | !     |  {    |  {    |
| ction | [](me | [](me | #sect | #sect | [](me | [](me | #sect | #sect |
|  .TT} | dia/i | dia/i | ion-3 | ion-4 | dia/i | dia/i | ion-7 | ion-8 |
|       | mage8 | mage8 |  .TT} |  .TT} | mage8 | mage8 |  .TT} |  .TT} |
|       | 42.wm | 43.wm |       |       | 42.wm | 43.wm |       |       |
|       | f){wi | f){wi |       |       | f){wi | f){wi |       |       |
|       | dth=" | dth=" |       |       | dth=" | dth=" |       |       |
|       | 0.354 | 0.322 |       |       | 0.354 | 0.322 |       |       |
|       | 16666 | 91666 |       |       | 16666 | 91666 |       |       |
|       | 66666 | 66666 |       |       | 66666 | 66666 |       |       |
|       | 667in | 667in |       |       | 667in | 667in |       |       |
|       | " hei | " hei |       |       | " hei | " hei |       |       |
|       | ght=" | ght=" |       |       | ght=" | ght=" |       |       |
|       | 0.166 | 0.166 |       |       | 0.166 | 0.166 |       |       |
|       | 66666 | 66666 |       |       | 66666 | 66666 |       |       |
|       | 66666 | 66666 |       |       | 66666 | 66666 |       |       |
|       | 6666i | 6666i |       |       | 6666i | 6666i |       |       |
|       | n"} { | n"} { |       |       | n"} { | n"} { |       |       |
|       | #sect | #sect |       |       | #sect | #sect |       |       |
|       | ion-1 | ion-2 |       |       | ion-5 | ion-6 |       |       |
|       |  .TT} |  .TT} |       |       |  .TT} |  .TT} |       |       |
|       | ====  | ====  |       |       | ====  | ====  |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
|       | ===== | ===== |       |       | ===== | ===== |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| 0     | 0     | 6     | 3     | 9     | 0     | 0     | 1     | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| 1     | 6     | 0     | 9     | 3     | 1     | 1     | 0     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+-------+

##### 5.5.2.1.2 Mapping to physical resources

For each antenna port used for transmission of the PUSCH, the sequence
shall be multiplied with the amplitude scaling factor and mapped in
sequence starting with to the resource blocks.

\- when either

\- the higher-layer parameter *ul-DMRS-IFDMA* is set and the most recent
uplink-related DCI contains the *Cyclic Shift Field mapping table for
DMRS bit* field which is set to 1 to indicate the use of Table
5.5.2.1.1-3, or

\- the *Cyclic Shift Field mapping table for DMRS bit* field is set to 1
in the most recent uplink-related DCI format 7 which indicates the use
of Table 5.5.2.1.1-4, and

\- otherwise.

If higher-layer parameter *ul-DMRS-IFDMA* is set and the most recent
uplink-related DCI contains the *Cyclic Shift Field mapping table for
DMRS bit* field which is set to 1 to indicate the use of Table
5.5.2.1.1-3, the mapping to resource elements , with for normal cyclic
prefix and for extended cyclic prefix, in the subframe shall be in
increasing order of first for all values of satisfying , then the slot
number. The quantity is given by Table 5.5.2.1.1-3 using the cyclic
shift field in the most recent uplink-related DCI.

In case of slot-PUSCH, the mapping to resource elements , with for
normal cyclic prefix, in the slot of the subframe where slot-PUSCH is
transmitted shall be in increasing order of first for all values of ,
except if the *Cyclic Shift Field mapping table for DMRS bit* field is
set to 1 in the most recent uplink-related DCI format 7, which indicates
the use of Table 5.5.2.1.1-4. In this case the mapping to resource
element shall be in increasing order of first only for values of
satisfying **.**

In case of subslot-PUSCH, the mapping to resource elements , in the
subframe shall be in increasing order of first for all values of ,
except if the *Cyclic Shift Field mapping table for DMRS bit* field is
set to 1 in the most recent uplink-related DCI format 7, which indicates
the use of Table 5.5.2.1.1-4. In this case the mapping to resource
element shall be in increasing order of first only for values of
satisfying **.** The value of depends on the uplink subslot number and
the *DMRS-pattern* field in the most recent uplink-related DCI,
according to Table 5.5.2.1.2-1, or according to Table 5.5.2.1.2-2 in
case of semi-persistent scheduling of subslot-PUSCH (i.e. higher layer
patameter *sps-ConfigUL-sTTI-r15* is configured, se 3GPP TS 36.331
\[9\]) and with a configured periodicity of 1 subslot (i.e.
*semiPersistSchedIntervalUL-STTI-r15* set to *sTTI1*). In case of
subslot-PUSCH and semi-persistent scheduling with a configured
periodicity longer than 1 subslot, the mapping shall start at symbol
according to the first row of Table 5.5.2.1.2-2 (i.e. equivalent to a
signalling of *DMRS-pattern* field set to \'00\'). In case no value of
is defined for the uplink subslot number, and in case no valid starting
symbol index (see table 5.3.4-1), no reference signal is transmitted
associated with the uplink-related DCI format.

Table 5.5.2.1.2-1: The quantity for subslot-PUSCH

  *DMRS-pattern* field in uplink-related DCI format \[3\]   Uplink subslot number                           
  --------------------------------------------------------- ----------------------- ----- ----- ----- ----- -----
                                                            \#0                     \#1   \#2   \#3   \#4   \#5
  00                                                        0                       3     5     0     2     4
  01                                                        2                       4     \-    1     3     \-
  10                                                        \-                      \-    \-    2     \-    \-
  11                                                        \-                      5     \-    \-    4     \-

Table 5.5.2.1.2-2: The quantity for subslot-PUSCH for semi-persistent
scheduling

  *DMRS-pattern* field in uplink-related DCI format \[3\]   Uplink subslot number                           
  --------------------------------------------------------- ----------------------- ----- ----- ----- ----- -----
                                                            \#0                     \#1   \#2   \#3   \#4   \#5
  00                                                        0                       3     5     0     2     4
  10                                                        0                       5     5     2     2     4

For all other cases, the set of physical resource blocks used in the
mapping process and the relation between the index and the antenna port
number shall be identical to the corresponding PUSCH transmission as
defined in clause 5.3.4.

The mapping to resource elements , with , or with according to Table
5.5.2.1.2-1 for subslot-PUSCH, for normal cyclic prefix and for extended
cyclic prefix, in the subframe shall be in increasing order of first,
then the slot number, except for slot-PUSCH and subslot-PUSCH where the
reference signal is only mapped to the slot where the
slot-PUSCH/subslot-PUSCH is transmitted). No DM-RS shall be transmitted
in UpPTS if *dmrsLess-UpPts* is set to true.

For BL/CE UEs, if uplink resource reservation is enabled for the UE as
specified in \[9\], and the Resource reservation field in the DCI is set
to 1, then in case of PUSCH transmission with associated with C-RNTI or
SPS C-RNTI using UE-specific MPDCCH search space including PUSCH
transmission without a corresponding MPDCCH,

\- In a subframe that is fully reserved as defined in clause 8.0 in
\[4\], the demodulation reference signal transmission is postponed until
the next BL/CE uplink subframe that is not fully reserved.

\- In a subframe that is partially reserved, the demodulation reference
signal transmission in a SC-FDMA symbol that is reserved is dropped.

#### 5.5.2.1A Demodulation reference signal for PUSCH with sub-PRB allocations

##### 5.5.2.1A.1 Reference signal sequence using modulation schemes other than π/2-BPSK

The reference signal sequence ![](media/image875.wmf) for
![](media/image876.wmf){width="0.5104166666666666in"
height="0.22916666666666666in"} **is defined by** a cyclic shift
![](media/image733.wmf) of a base sequence according to

![](media/image877.wmf),

where ![](media/image878.wmf) **is given by Tables 5.5.2.1A.1-1 and
5.5.2.1A.1-2 for**![](media/image879.wmf) and ![](media/image880.wmf),
respectively. The cyclic shift ![](media/image733.wmf) is derived from
higher layer parameters ***threeTone-CyclicShift* and
*sixTone-CyclicShift*, respectively,** as defined in Table 5.5.2.1A.1-3.

**If group hopping is enabled, the base sequence index**
![](media/image881.wmf) is given by clause 5.5.2.1A.3.

**If group hopping is not enabled, the base sequence index**
![](media/image881.wmf) is given by

**-** ![](media/image882.wmf) **for** ![](media/image879.wmf)

**-** ![](media/image883.wmf) **for** ![](media/image884.wmf)

Table 5.5.2.1A.1-1: Definition of ![](media/image878.wmf) for
![](media/image879.wmf)

  ![](media/image885.wmf){width="0.125in" height="0.14583333333333334in"}   $$\varnothing\left( 0 \right),\ \ldots\ ,\varnothing\left( 2 \right)$$        
  ------------------------------------------------------------------------- ------------------------------------------------------------------------ ---- ----
  0                                                                         1                                                                        -3   -3
  1                                                                         1                                                                        -3   -1
  2                                                                         1                                                                        -3   3
  3                                                                         1                                                                        -1   -1
  4                                                                         1                                                                        -1   1
  5                                                                         1                                                                        -1   3
  6                                                                         1                                                                        1    -3
  7                                                                         1                                                                        1    -1
  8                                                                         1                                                                        1    3
  9                                                                         1                                                                        3    -1
  10                                                                        1                                                                        3    1
  11                                                                        1                                                                        3    3

Table 5.5.2.1A.1-2: Definition of ![](media/image878.wmf) for
![](media/image880.wmf)

  ![](media/image885.wmf){width="0.125in" height="0.14583333333333334in"}   ![](media/image886.wmf){width="0.71875in" height="0.20833333333333334in"}                       
  ------------------------------------------------------------------------- --------------------------------------------------------------------------- ---- ---- ---- ---- ----
  0                                                                         1                                                                           1    1    1    3    -3
  1                                                                         1                                                                           1    3    1    -3   3
  2                                                                         1                                                                           -1   -1   -1   1    -3
  3                                                                         1                                                                           -1   3    -3   -1   -1
  4                                                                         1                                                                           3    1    -1   -1   3
  5                                                                         1                                                                           -3   -3   1    3    1
  6                                                                         -1                                                                          -1   1    -3   -3   -1
  7                                                                         -1                                                                          -1   -1   3    -3   -1
  8                                                                         3                                                                           -1   1    -3   -3   3
  9                                                                         3                                                                           -1   3    -3   -1   1
  10                                                                        3                                                                           -3   3    -1   3    3
  11                                                                        -3                                                                          1    3    1    -3   -1
  12                                                                        -3                                                                          1    -3   3    -3   -1
  13                                                                        -3                                                                          3    -3   1    1    -3

Table 5.5.2.1A.1-3: Definition of ![](media/image733.wmf)

  ![](media/image879.wmf)       ![](media/image887.wmf){width="0.5416666666666666in" height="0.22916666666666666in"}                               
  ----------------------------- -------------------------------------------------------------------------------------- --------------------------- -------------------------
  ***threeTone-CyclicShift***   ![](media/image733.wmf)                                                                ***sixTone-CyclicShift***   ![](media/image733.wmf)
  0                             ![](media/image888.wmf)                                                                0                           ![](media/image888.wmf)
  1                             ![](media/image889.wmf){width="0.3333333333333333in" height="0.20833333333333334in"}   1                           ![](media/image890.wmf)
  2                             ![](media/image891.wmf){width="0.3333333333333333in" height="0.20833333333333334in"}   2                           ![](media/image892.wmf)
  \-                            \-                                                                                     3                           ![](media/image893.wmf)

##### 5.5.2.1A.2 Reference signal sequence using π/2-BPSK modulation scheme

For ![](media/image879.wmf) using π/2-BPSK modulation scheme,
$\ N_{\text{ID}}^{\text{cell}}\text{mod}2$ is used to determine which 2
of 3 subcarriers will be used:

\- 0 indicates that the two subcarriers having the lowest indices among
the three allocated are utilized.

\- 1 indicates that the two subcarriers having the highest indices among
the three allocated are utilized.

The reference signal sequences ${\overline{r}}_{u1}(n)$ and
${\overline{r}}_{u2}(n)$ for ![](media/image879.wmf) **using 2 out of 3
subcarriers are defined by**

${\overline{r}}_{u1}\left( n \right) = \frac{1}{\sqrt{2}}\left( 1 + j \right)\left( 1 - 2c\left( n \right) \right)w\left( n\ \text{mod\ }16 \right),\ \ \ \ \ \ \ 0 \leq n < N_{\text{rep}}^{\text{PUSCH}}M_{\text{slots}}^{\text{UL}}M_{\text{RU}}$

${\overline{r}}_{u2}\left( n \right) = ({- 1)}^{n}\left( \frac{1}{\sqrt{2}}\left( 1 + j \right)\left( 1 - 2c\left( n \right) \right)w\left( n\ \text{mod\ }16 \right) \right),\ \ \ \ \ \ \ 0 \leq n < N_{\text{rep}}^{\text{PUSCH}}M_{\text{slots}}^{\text{UL}}M_{\text{RU}}$

where **the binary sequence** ![](media/image894.wmf) is defined by
clause 7.2 **and** shall be initialised with ![](media/image895.wmf) at
the start of the PUSCH transmission using sub-PRB allocations for BL/CE
UEs. The quantity ![](media/image896.wmf) is given by Table 5.5.2.1A.2-1
where ${u = N}_{\text{ID}}^{\text{cell}}\text{mod}16$ **if group hopping
is not enabled, and by clause** 5.5.2.1A.3 if group hopping is enabled
for PUSCH using sub-PRB allocations for BL/CE UEs**.**

Table 5.5.2.1A.2-1: Definition of ![](media/image897.wmf)

  ![](media/image898.wmf)   ![](media/image899.wmf)                                                                         
  ------------------------- ------------------------- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
  0                         1                         1    1    1    1    1    1    1    1    1    1    1    1    1    1    1
  1                         1                         -1   1    -1   1    -1   1    -1   1    -1   1    -1   1    -1   1    -1
  2                         1                         1    -1   -1   1    1    -1   -1   1    1    -1   -1   1    1    -1   -1
  3                         1                         -1   -1   1    1    -1   -1   1    1    -1   -1   1    1    -1   -1   1
  4                         1                         1    1    1    -1   -1   -1   -1   1    1    1    1    -1   -1   -1   -1
  5                         1                         -1   1    -1   -1   1    -1   1    1    -1   1    -1   -1   1    -1   1
  6                         1                         1    -1   -1   -1   -1   1    1    1    1    -1   -1   -1   -1   1    1
  7                         1                         -1   -1   1    -1   1    1    -1   1    -1   -1   1    -1   1    1    -1
  8                         1                         1    1    1    1    1    1    1    -1   -1   -1   -1   -1   -1   -1   -1
  9                         1                         -1   1    -1   1    -1   1    -1   -1   1    -1   1    -1   1    -1   1
  10                        1                         1    -1   -1   1    1    -1   -1   -1   -1   1    1    -1   -1   1    1
  11                        1                         -1   -1   1    1    -1   -1   1    -1   1    1    -1   -1   1    1    -1
  12                        1                         1    1    1    -1   -1   -1   -1   -1   -1   -1   -1   1    1    1    1
  13                        1                         -1   1    -1   -1   1    -1   1    -1   1    -1   1    1    -1   1    -1
  14                        1                         1    -1   -1   -1   -1   1    1    -1   -1   1    1    1    1    -1   -1
  15                        1                         -1   -1   1    -1   1    1    -1   -1   1    1    -1   1    -1   -1   1

The reference signal sequences for PUSCH using sub-PRB allocations for
BL/CE UEs is given by clause 5.3.3, where and correspond to the
complex-valued symbols at the input of the transform precoding. The
resulting complex-valued symbols at the output of the transform
precoding correspond to the sequence which is mapped to physical
resources as described in clause 5.5.2.1A.4.

##### 5.5.2.1A.3 Group hopping

For the reference signal for PUSCH transmission using sub-PRB
allocations for BL/CE UEs, sequence-group hopping can be enabled where
the sequence-group number ![](media/image749.wmf) in slot
![](media/image126.wmf) of a radio frame $n_{f}$ is defined by a group
hopping pattern $f_{\text{gh}}\left( n^{'} \right)$ and a sequence-shift
pattern ![](media/image776.wmf) according to

$u = \left( f_{\text{gh}}\left( n' \right) + f_{\text{ss}} \right)\text{mod}M_{\text{seq}}^{\text{RU}}$

where the number of reference signal sequences available for each
resource unit size, $M_{\text{seq}}^{\text{RU}}$ is given by Table
5.5.2.1A.3-1.

Table 5.5.2.1A.3-1: Definition of
$\mathbf{M}_{\mathbf{\text{seq}}}^{\mathbf{\text{RU}}}$

  **Modulation Scheme**   $$M_{\text{sc}}^{\text{RU}}$$   $$M_{\text{seq}}^{\text{RU}}$$
  ----------------------- ------------------------------- --------------------------------
  π/2-BPSK                3                               16
  QPSK                    3                               12
                          6                               14

Sequence-group hopping can be enabled or disabled as described in clause
5.5.1.3.

The group-hopping pattern $f_{\text{gh}}\left( n^{'} \right)$ is given
by

$f_{\text{gh}}\left( n' \right) = \left( \sum_{i = 0}^{7}{c(8n' + i) \bullet 2^{i}} \right)\text{mod}M_{\text{seq}}^{\text{RU}}$

where $n^{'} = n_{\text{s}}$ for
![](media/image876.wmf){width="0.5104166666666666in"
height="0.22916666666666666in"} **using QPSK modulation scheme. When**
![](media/image903.wmf){width="0.5416666666666666in"
height="0.21875in"}using π/2-BPSK modulation scheme, for frame structure
type 1, $n^{'}$ is the slot number $n_{\text{s}}$ of the first slot of
the resource unit, and for frame structure type 2, $n^{'}$ is the frame
number $n_{\text{f}}$ of the first slot of the resource unit**.** The
pseudo-random sequence ![](media/image447.wmf) is defined by clause 7.2.
The pseudo-random sequence generator shall be initialized with
$\ c_{\text{init}} = \left\lfloor \frac{N_{\text{ID}}^{\text{cell}}}{M_{\text{seq}}^{\text{RU}}} \right\rfloor$
at the beginning of the resource unit for ![](media/image879.wmf)using
π/2-BPSK modulation scheme **and in every** even slot for
![](media/image876.wmf){width="0.5104166666666666in"
height="0.22916666666666666in"} **using QPSK modulation scheme.**

The sequence-shift pattern ![](media/image776.wmf) is given by

$f_{\text{ss}}\left( n_{s} \right) = \left( N_{\text{ID}}^{\text{cell}} + \mathrm{\Delta}_{\text{ss}} \right)\text{mod}M_{\text{seq}}^{\text{RU}}$

where ![](media/image904.wmf).

##### 5.5.2.1A.4 Mapping to physical resources

The sequence ![](media/image905.wmf) shall be multiplied with the
amplitude scaling factor ![](media/image391.wmf) and mapped in sequence
starting with ![](media/image906.wmf) to the sub-carriers.

The set of sub-carriers used in the mapping process shall be identical
to the corresponding PUSCH transmissions using sub-PRB allocations for
BL/CE UEs as defined in clause 5.3.4.

The mapping to resource elements ![](media/image1.wmf) shall be in
increasing order of first![](media/image2.wmf), then
![](media/image907.wmf), and finally the slot number. The value of the
symbol index ![](media/image907.wmf) in a slot is 3.

For BL/CE UEs, if uplink resource reservation is enabled for the UE as
specified in \[9\], and the Resource reservation field in the DCI is set
to 1, then in case of PUSCH transmission with associated with C-RNTI or
SPS C-RNTI using UE-specific MPDCCH search space including PUSCH
transmission without a corresponding MPDCCH,

\- In a subframe that is fully reserved as defined in clause 8.0 in
\[4\], the demodulation reference signal transmission is postponed until
the next BL/CE uplink subframe that is not fully reserved.

\- In a subframe that is partially reserved, the demodulation reference
signal transmission in a SC-FDMA symbol that is reserved is dropped.

#### 5.5.2.2 Demodulation reference signal for PUCCH

##### 5.5.2.2.1 Reference signal sequence

The PUCCH demodulation reference signal sequence for PUCCH formats 1,
1a, 1b, 2, 2a, 2b, and 3 is defined by

where

and is the number of antenna ports used for PUCCH transmission. For
PUCCH formats 2a and 2b, equals for , where is defined in clause 5.4.2.
For all other cases,

The sequence is given by clause 5.5.1 with and where the expression for
the cyclic shift is determined by the PUCCH format.

For PUCCH formats 1, 1a and 1b, is given by

where , , and are defined by clause 5.4.1. The number of reference
symbols per slot and the sequence are given by Table 5.5.2.2.1-1 and
5.5.2.2.1-2, respectively.

For PUCCH formats 2, 2a and 2b, is defined by clause 5.4.2. The number
of reference symbols per slot and the sequence are given by Table
5.5.2.2.1-1 and 5.5.2.2.1-3, respectively.

For PUCCH format 3, is given by

where is given by Table 5.5.2.2.1-4 and and for the first and second
slot in a subframe, respectively, are obtained from clause 5.4.2A. The
number of reference symbols per slot and the sequence are given by Table
5.5.2.2.1-1 and 5.5.2.2.1-3, respectively.

Table 5.5.2.2.1-1: Number of PUCCH demodulation reference symbols per
slot

  PUCCH format   Normal cyclic prefix   Extended cyclic prefix
  -------------- ---------------------- ------------------------
  1, 1a, 1b      3                      2
  2, 3           2                      1
  2a, 2b         2                      N/A

Table 5.5.2.2.1-2: Orthogonal sequences for PUCCH formats 1, 1a and 1b

  Sequence index   Normal cyclic prefix   Extended cyclic prefix
  ---------------- ---------------------- ------------------------
  0                                       
  1                                       
  2                                       N/A

Table 5.5.2.2.1-3: Orthogonal sequences for PUCCH formats 2, 2a, 2b and
3.

  Normal cyclic prefix   Extended cyclic prefix
  ---------------------- ------------------------
                         

Table 5.5.2.2.1-4: Relation between and for PUCCH format 3.

  --- ---- -----
           
  0   0    0
  1   3    3
  2   6    6
  3   8    9
  4   10   N/A
  --- ---- -----

The PUCCH demodulation reference signal sequence for PUCCH formats 4 and
5 is defined by

where

and

Clause 5.5.1 defines the sequence where .

The cyclic shift in a slot is given as with

where the values of and are given by Clause 5.5.2.1.1 and

with obtained as described in clause 5.4.2C.

##### 5.5.2.2.2 Mapping to physical resources

The sequence shall be multiplied with the amplitude scaling factor and
mapped in sequence starting with to resource elements on antenna port .
The mapping shall be in increasing order of first, then and finally the
slot number. The set of values for and the relation between the index
and the antenna port number shall be identical to the values used for
the corresponding PUCCH transmission. The values of the symbol index in
a slot are given by Table 5.5.2.2.2-1.

Table 5.5.2.2.2-1: Demodulation reference signal location for different
PUCCH formats.

  PUCCH format   Set of values for      
  -------------- ---------------------- ------------------------
                 Normal cyclic prefix   Extended cyclic prefix
  1, 1a, 1b      2, 3, 4                2, 3
  2, 3           1, 5                   3
  2a, 2b         1, 5                   N/A
  4,5            3                      2

For BL/CE UEs, if uplink resource reservation is enabled for the UE as
specified in \[9\], then in case of PUCCH transmission with associated
with C-RNTI or SPS C-RNTI using UE-specific MPDCCH search space
including PUCCH transmission without a corresponding MPDCCH,

\- In a subframe that is fully reserved as defined in clause 8.0 in
\[4\], the demodulation reference signal transmission is postponed until
the next BL/CE uplink subframe that is not fully reserved.

\- In a subframe that is partially reserved, the demodulation reference
signal transmission in a SC-FDMA symbol that is reserved is dropped.

#### 5.5.2.3 Demodulation reference signal for SPUCCH

##### 5.5.2.3.1 Reference signal sequence

The SPUCCH demodulation reference signal sequence for subslot-SPUCCH
format 4, and, slot‑SPUCCH formats 1, 1a, 1b, 3 and 4 is as defined for
in clause 5.5.2.2.1 for PUCCH format 1, 1a, 1b, 2, 2a, 2b and 3, using
the parameter settings in Table 5.5.2.3.1-1, and with the number of
reference symbols replaced by and given by Table 5.5.2.3.1-2.

NOTE: Subslot-SPUCCH format 1/1a/1b does not employ a reference signal
based design.

The sequence is given by clause 5.5.1 with , where the expression for
the cyclic shift is determined depending on the SPUCCH format, see table
5.5.2.3.1-3.

Table 5.5.2.3.1-1: Parameters for SPUCCH demodulation reference signal

  SPUCCH format   Frequency hopping                                                                        
  --------------- ------------------- ---------- --- ---- ------------------------------------------------ ---
  Slot            1, 1a, 1b           Disabled   0   12   See Table 5.5.2.2.1-2 for normal cyclic prefix   1
                                      Enabled    0   12   1                                                1
                  3                   Disabled   0   12   See clause 5.5.2.2.2                             1
                  4                   Enabled    0        1                                                1
  Subslot         4                   Disabled   0        1                                                1

Table 5.5.2.3.1-2: Number of SPUCCH demodulation reference symbols per
slot or per subslot

  SPUCCH format   Frequency hopping                         
  --------------- ------------------- --------------------- ---
  Slot            1, 1a, 1b           Enabled or disabled   3
                  3                   Disabled              2
                  4                   Enabled               2
  Subslot         4                   Disabled              1

Table 5.5.2.3.1-3:

  SPUCCH format   Frequency hopping                         
  --------------- ------------------- --------------------- -----------------------------------------------------------------------------------
  Slot            1, 1a, 1b           Enabled or disabled   see in clause 5.4A.2
                  3                   Disabled              see for PUCCH format 3 in clause 5.5.2.2.1 and determining and in clause 5.4A.3.1
                  4                   Enabled               see for PUCCH format 4 in clause 5.5.2.2.1
  Subslot         4                   Disabled              see for PUCCH format 4 in clause 5.5.2.2.1

##### 5.5.2.3.2 Mapping to physical resources

The sequence shall be multiplied with the amplitude scaling factor and
mapped in sequence starting with to resource elements on antenna port .
The mapping shall be in increasing order of first, then . The set of
values for and the relation between the index and the antenna port
number shall be identical to the values used for the corresponding
SPUCCH transmission. The values of the symbol index in a slot and a
subslot are given by Table 5.5.2.3.2-1 and Table 5.5.2.3.2-2
respectively.

Table 5.5.2.3.2-1: Demodulation reference signal location for different
slot-SPUCCH formats

  SPUCCH format   Frequency hopping   Slot              Set of values for
  --------------- ------------------- ----------------- -------------------
  1, 1a, 1b       Enabled             1^st^             1, 4, 5
                                      2^nd^             1, 2, 5
                  Disabled            1^st^ and 2^nd^   2, 3, 4
  3               Disabled            1^st^ and 2^nd^   1, 5
  4               Enabled             1^st^ and 2^nd^   1, 5

Table 5.5.2.3.2-2: Demodulation reference signal location for different
subslot-SPUCCH formats

  SPUCCH format   Subslot number in subframe   Slot    
  --------------- ---------------------------- ------- ---
  4               0                            1^st^   0
                  1                            1^st^   3
                  2                            1^st^   5
                  3                            2^nd^   0
                  4                            2^nd^   2
                  5                            2^nd^   4

###  5.5.3 Sounding reference signal 

Two types of sounding reference signals can be configured:

\- basic sounding reference signal, supporting periodic or aperiodic
transmission

\- additional sounding reference signal, supporting aperiodic
transmission only

Basic SRS corresponds to either SRS trigger type 0 or type 1 in clause
8.2 of \[4\]. Additional SRS corresponds to SRS trigger type 2 in clause
8.2 of \[4\].

#### 5.5.3.1 Sequence generation

##### 5.5.3.1.1 Sequence generation for basic SRS

The sounding reference signal sequence is defined by clause 5.5.1, where
is the sequence-group number defined in clause 5.5.1.3, is the base
sequence number defined in clause 5.5.1.4, and . The cyclic shift of the
sounding reference signal is given as

,

where is configured separately for periodic and each configuration of
aperiodic sounding by the higher-layer parameters *cyclicShift* and
*cyclicShift-ap*, respectively, for each UE and is the number of antenna
ports used for sounding reference signal transmission. The parameter if
, otherwise . The parameter is given by the higher layer parameter
*transmissionCombNum* if configured, otherwise .

##### 5.5.3.1.2 Sequence generation for additional SRS

The sounding reference signal
$r_{\text{SRS}}^{(\widetilde{p})}\left( n \right)$ is defined by clause
5.5.3.1.1 with the following exceptions

\- $n_{\text{SRS}}^{\text{cs}}$ is given by the higher-layer parameter
*srs-CyclicShiftAdd*

\- $N_{\text{ap}}$ is given by the higher-layer parameter
*srs-AntennaPortAdd*

\- $K_{\text{TC}}$ is given by the higher-layer parameter
*srs-TransmissionCombNumAdd*

\- the function $f_{\text{gh}}$ in clause 5.5.1.3 is given by

$$f_{\text{gh}}\left( n_{\text{s}},l \right) = \left\{ \begin{matrix}
0 & \text{if\ group\ hopping\ is\ disabled} \\
\left( \sum_{i = 0}^{7}{2^{i}c\left( 8\left( n_{\text{s}}N_{\text{symb}}^{\text{UL}} + l \right) + i \right)} \right)\text{\ mod\ }30 & \text{if\ group\ hopping\ is\ enabled} \\
\end{matrix} \right.\ $$

where $l$ is the SC-FDMA symbol index within the slot $n_{\text{s}}$ and
$N_{\text{symb}}^{\text{UL}}$ is the number of SC-FDMA symbols per slot

\- the function $v$ in clause 5.5.1.4 is given by

$$v = \left\{ \begin{matrix}
c\left( n_{\text{s}}N_{\text{symb}}^{\text{UL}} + l \right) & \text{if\ group\ hopping\ is\ disabled\ and\ sequence\ hopping\ is\ enabled} \\
0 & \text{otherwise} \\
\end{matrix} \right.\ $$

#### 5.5.3.2 Mapping to physical resources

##### 5.5.3.2.1 Mapping to physical resources for basic SRS

The sequence shall be multiplied with the amplitude scaling factor in
order to conform to the transmit power specified in clause 5.1.3.1 in
3GPP TS 36.213 \[4\], and mapped in sequence starting with to resource
elements on antenna port according to

where is the number of antenna ports used for sounding reference signal
transmission and the relation between the index and the antenna port is
given by Table 5.2.1-1. The set of antenna ports used for sounding
reference signal transmission is configured independently for periodic
and each configuration of aperiodic sounding. The quantity is the
frequency-domain starting position of the sounding reference signal and
for and is the length of the sounding reference signal sequence defined
as

where is given by Table 5.5.3.2-1 through Table 5.5.3.2-4 for each
uplink bandwidth . The cell-specific parameter *srs-BandwidthConfig,*
and the UE-specific parameter *srs-Bandwidth,* are given by higher
layers. For UpPTS, shall be reconfigured to if this reconfiguration is
enabled by the cell-specific parameter *srsMaxUpPts* given by higher
layers, otherwise if the reconfiguration is disabled ,where is a SRS BW
configuration and is the set of SRS BW configurations from the Tables
5.5.3.2-1 to 5.5.3.2-4 for each uplink bandwidth , is the number of
format 4 PRACH in the addressed UpPTS and derived from Table 5.7.1-4.

The frequency-domain starting position is defined by

where for normal uplink subframes is defined by

and for UpPTS by

The quantity is given by

where the relation between the index and the antenna port is given by
Table 5.2.1-1, is given by the UE-specific parameter *transmissionComb
or transmissionComb-ap for periodic and each configuration of aperiodic
transmission, respectively,* provided by higher layers for the UE, and
is frequency position index. The variable is equal to 0 for UpPTS in the
first half frame and equal to 1 for UpPTS in the second half frame of a
radio frame.

The frequency hopping of the sounding reference signal is configured by
the parameter , provided by higher-layer parameter
*srs-HoppingBandwidth.* Frequency hopping is not supported for aperiodic
transmission, except for additional SRS. If frequency hopping of the
sounding reference signal is not enabled (i.e., ), the frequency
position index remains constant (unless re-configured) and is defined by
where the parameter is given by higher-layer parameters
*freqDomainPosition and freqDomainPosition-ap for periodic and each
configuration of aperiodic transmission, respectively*. If frequency
hopping of the sounding reference signal is enabled (i.e., ), the
frequency position indexes are defined by

where is given by Table 5.5.3.2-1 through Table 5.5.3.2-4 for each
uplink bandwidth ,

where regardless of the value on Table 5.5.3.2-1 through Table
5.5.3.2-4, and

counts the number of UE-specific SRS transmissions, where is UE-specific
periodicity of SRS transmission defined in clause 8.2 of
3GPP TS 36.213 \[4\], is SRS subframe offset defined in Table 8.2-2 of
3GPP TS 36.213 \[4\] and is the maximum value of for a certain
configuration of SRS subframe offset.

The sounding reference signal shall be transmitted in the last symbol of
the uplink subframe.

Table 5.5.3.2-1: and , , values for the uplink bandwidth of

  SRS bandwidth configuration   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth               
  ----------------------------- --------------- --------------- --------------- --------------- --- --- --- ---
                                                                                                            
  0                             36              1               12              3               4   3   4   1
  1                             32              1               16              2               8   2   4   2
  2                             24              1               4               6               4   1   4   1
  3                             20              1               4               5               4   1   4   1
  4                             16              1               4               4               4   1   4   1
  5                             12              1               4               3               4   1   4   1
  6                             8               1               4               2               4   1   4   1
  7                             4               1               4               1               4   1   4   1

Table 5.5.3.2-2: and , , values for the uplink bandwidth of

  SRS bandwidth configuration   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth                
  ----------------------------- --------------- --------------- --------------- --------------- ---- --- --- ---
                                                                                                             
  0                             48              1               24              2               12   2   4   3
  1                             48              1               16              3               8    2   4   2
  2                             40              1               20              2               4    5   4   1
  3                             36              1               12              3               4    3   4   1
  4                             32              1               16              2               8    2   4   2
  5                             24              1               4               6               4    1   4   1
  6                             20              1               4               5               4    1   4   1
  7                             16              1               4               4               4    1   4   1

Table 5.5.3.2-3: and , , values for the uplink bandwidth of

  SRS bandwidth configuration   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth                
  ----------------------------- --------------- --------------- --------------- --------------- ---- --- --- ---
                                                                                                             
  0                             72              1               24              3               12   2   4   3
  1                             64              1               32              2               16   2   4   4
  2                             60              1               20              3               4    5   4   1
  3                             48              1               24              2               12   2   4   3
  4                             48              1               16              3               8    2   4   2
  5                             40              1               20              2               4    5   4   1
  6                             36              1               12              3               4    3   4   1
  7                             32              1               16              2               8    2   4   2

Table 5.5.3.2-4: and, , values for the uplink bandwidth of

  SRS bandwidth configuration   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth   SRS-Bandwidth                
  ----------------------------- --------------- --------------- --------------- --------------- ---- --- --- ---
                                                                                                             
  0                             96              1               48              2               24   2   4   6
  1                             96              1               32              3               16   2   4   4
  2                             80              1               40              2               20   2   4   5
  3                             72              1               24              3               12   2   4   3
  4                             64              1               32              2               16   2   4   4
  5                             60              1               20              3               4    5   4   1
  6                             48              1               24              2               12   2   4   3
  7                             48              1               16              3               8    2   4   2

##### 5.5.3.2.2 Mapping to physical resources for additional SRS

An additional SRS spans one or more SC-FDMA symbols in the time domain,
where

\- the starting SC-FDMA symbol $l_{0}$ within the subframe is given by
the higher-layer parameter *srs-StartPosAdd*;

\- the duration $N$ in number of SC-FDMA symbols, including potential
guard symbols, is given by the higher-layer parameter *srs-DurationAdd*.

Mapping to physical resources shall be done according to clause
5.5.3.2.1 with the following exceptions:

\- frequency hopping between SC-FDMA symbols is supported and if a UE is
configured by higher layer parameter *srs-GuardSymbolFH-Add*, a guard
symbol is added between every frequency hop;

\- antenna switching within a subframe is supported and if a UE is
configured by higher layer parameter *srs-GuardSymbolAS-Add*, a guard
symbol is added between every antenna switching;

\- $n_{\text{SRS}} = \left\lfloor \frac{l'}{R} \right\rfloor$ where $l'$
is the additional SRS transmission number not counting guard symbol(s)
within the subframe with $l^{'} = 0$ corresponding to the starting
SC-FDMA symbol $l_{0}$, and
$R \in \left\{ 1,2,3,4,6,7,8,9,12,13 \right\}$ is the repetition factor
given by the higher-layer parameter *srs-RepNumAdd*;

\- $B_{\text{SRS}}$ is given by the higher-layer parameter
*srs-BandwidthAdd*;

\- $b_{\text{hop}}$ is given by the higher-layer parameter
*srs-HoppingBandwidthAdd*;

\- $N_{\text{FH}}$ is the number of frequency hops with the same
antenna/antenna pair for additional SRS, derived from
$N = RN_{\text{FH}} + \left( N_{\text{FH}} - 1 \right)G_{\text{FH}}$ if
antenna switching is not configured for additional SRS, and from
$N = RN_{\text{AS}}N_{\text{FH}} + \left( N_{\text{AS}} - 1 \right)G_{\text{AS}} + \left( N_{\text{FH}} - 1 \right){N_{\text{AS}}G}_{\text{FH}} + \left( N_{\text{AS}} - 1 \right)(1 - G_{\text{AS}})G_{\text{FH}}$
if antenna switching is configured for additional SRS, where $R$ is the
repetition factor given by the higher-layer parameter *srs-RepNumAdd*,
$N_{\text{AS}}$ is the number of antenna switches for additional SRS
defined in 8.2 of \[4\], $G_{\text{AS}} \in \left\{ 0,\ 1 \right\}$ is
the guard-symbol configuration for antenna switching given by the
higher-layer parameter *srs-GuardSymbolAS*,
$G_{\text{FH}} \in \left\{ 0,\ 1 \right\}$ is the guard symbol
configuration for frequency hopping given by the higher-layer parameter
*srs-GuardSymbolFH*, and $N$ is given by the higher-layer parameter
*srs-DurationAdd*;

\- $n_{\text{RRC}}$ is given by the higher-layer parameter
*srs-FreqDomainPosAdd*;

\- $N_{\text{ap}}$ is given by the higher-layer parameter
*srs-AntennaPortAdd*;

\- $n_{\text{SRS}}^{\text{cs}}$ is given by the higher-layer parameter
*srs-CyclicShiftAdd*;

\- $K_{\text{TC}}$ is given by the higher-layer parameter
*srs-TransmissionCombNumAdd*;

\- ${\overline{k}}_{\text{TC}}$ is given by the higher-layer parameter
*srs-TransmissionCombAdd*.

#### 5.5.3.3 Sounding reference signal subframe configuration

The cell-specific subframe configuration period and the cell-specific
subframe offset for the transmission of sounding reference signals are
listed in Tables 5.5.3.3-1 and 5.5.3.3-2, for frame structures type 1
and 2 respectively, where the parameter *srs-SubframeConfig* is provided
by higher layers. Sounding reference signal subframes are the subframes
satisfying. For frame structure type 2, a sounding reference signal is
transmitted only in uplink subframes or UpPTS.

Table 5.5.3.3-1: Frame structure type 1 sounding reference signal
subframe configuration

+--------------------+--------+----------------------+---------------------+
| srs-SubframeConfig | Binary | Configuration Period | Transmission offset |
|                    |        |                      |                     |
|                    |        | (subframes)          | (subframes)         |
+====================+========+======================+=====================+
| 0                  | 0000   | 1                    | {0}                 |
+--------------------+--------+----------------------+---------------------+
| 1                  | 0001   | 2                    | {0}                 |
+--------------------+--------+----------------------+---------------------+
| 2                  | 0010   | 2                    | {1}                 |
+--------------------+--------+----------------------+---------------------+
| 3                  | 0011   | 5                    | {0}                 |
+--------------------+--------+----------------------+---------------------+
| 4                  | 0100   | 5                    | {1}                 |
+--------------------+--------+----------------------+---------------------+
| 5                  | 0101   | 5                    | {2}                 |
+--------------------+--------+----------------------+---------------------+
| 6                  | 0110   | 5                    | {3}                 |
+--------------------+--------+----------------------+---------------------+
| 7                  | 0111   | 5                    | {0,1}               |
+--------------------+--------+----------------------+---------------------+
| 8                  | 1000   | 5                    | {2,3}               |
+--------------------+--------+----------------------+---------------------+
| 9                  | 1001   | 10                   | {0}                 |
+--------------------+--------+----------------------+---------------------+
| 10                 | 1010   | 10                   | {1}                 |
+--------------------+--------+----------------------+---------------------+
| 11                 | 1011   | 10                   | {2}                 |
+--------------------+--------+----------------------+---------------------+
| 12                 | 1100   | 10                   | {3}                 |
+--------------------+--------+----------------------+---------------------+
| 13                 | 1101   | 10                   | {0,1,2,3,4,6,8}     |
+--------------------+--------+----------------------+---------------------+
| 14                 | 1110   | 10                   | {0,1,2,3,4,5,6,8}   |
+--------------------+--------+----------------------+---------------------+
| 15                 | 1111   | reserved             | reserved            |
+--------------------+--------+----------------------+---------------------+

Table 5.5.3.3-2: Frame structure type 2 sounding reference signal
subframe configuration

+--------------------+--------+----------------------+---------------------+
| srs-SubframeConfig | Binary | Configuration Period | Transmission offset |
|                    |        |                      |                     |
|                    |        | (subframes)          | (subframes)         |
+====================+========+======================+=====================+
| 0                  | 0000   | 5                    | {1}                 |
+--------------------+--------+----------------------+---------------------+
| 1                  | 0001   | 5                    | {1, 2}              |
+--------------------+--------+----------------------+---------------------+
| 2                  | 0010   | 5                    | {1, 3}              |
+--------------------+--------+----------------------+---------------------+
| 3                  | 0011   | 5                    | {1, 4}              |
+--------------------+--------+----------------------+---------------------+
| 4                  | 0100   | 5                    | {1, 2, 3}           |
+--------------------+--------+----------------------+---------------------+
| 5                  | 0101   | 5                    | {1, 2, 4}           |
+--------------------+--------+----------------------+---------------------+
| 6                  | 0110   | 5                    | {1, 3, 4}           |
+--------------------+--------+----------------------+---------------------+
| 7                  | 0111   | 5                    | {1, 2, 3, 4}        |
+--------------------+--------+----------------------+---------------------+
| 8                  | 1000   | 10                   | {1, 2, 6}           |
+--------------------+--------+----------------------+---------------------+
| 9                  | 1001   | 10                   | {1, 3, 6}           |
+--------------------+--------+----------------------+---------------------+
| 10                 | 1010   | 10                   | {1, 6, 7}           |
+--------------------+--------+----------------------+---------------------+
| 11                 | 1011   | 10                   | {1, 2, 6, 8}        |
+--------------------+--------+----------------------+---------------------+
| 12                 | 1100   | 10                   | {1, 3, 6, 9}        |
+--------------------+--------+----------------------+---------------------+
| 13                 | 1101   | 10                   | {1, 4, 6, 7}        |
+--------------------+--------+----------------------+---------------------+
| 14                 | 1110   | reserved             | reserved            |
+--------------------+--------+----------------------+---------------------+
| 15                 | 1111   | reserved             | reserved            |
+--------------------+--------+----------------------+---------------------+

 5.6 SC-FDMA baseband signal generation
--------------------------------------

This clause applies to all uplink physical signals and uplink physical
channels except the physical random access channel and PUSCH using
sub-PRB allocations for BL/CE UEs.

The time-continuous signal for antenna port in SC-FDMA symbol in an
uplink slot is defined by

for where , , and is the content of resource element on antenna port .

For frame structure type 3, if the associated DCI indicates PUSCH
starting position other than \'00\' or if \'autonomous PUSCH\' is
configured, is given by

where

and were ![](media/image1117.wmf) is given by TS36.213 \[4\] if
\'autonomous PUSCH\' is configured.

The quantity is given by clause 8.1. The UE behaviour if is undefined.

The SC-FDMA symbols in a slot shall be transmitted in increasing order
of , starting with , where SC-FDMA symbol starts at time within the
slot.

Table 5.6-1 lists the values of that shall be used.

Table 5.6-1: SC-FDMA parameters

  Configuration            Cyclic prefix length
  ------------------------ ----------------------
  Normal cyclic prefix     
  Extended cyclic prefix   

5.6A SC-FDMA baseband signal generation for PUSCH using sub-PRB allocations
---------------------------------------------------------------------------

### 5.6A.1 Modulation schemes other than π/2-BPSK

For ![](media/image876.wmf){width="0.5104166666666666in"
height="0.22916666666666666in"}**,** the time-continuous signal
![](media/image1105.wmf) for antenna port ![](media/image1106.wmf) in
SC-FDMA symbol ![](media/image3.wmf) in an uplink slot is defined by
clause 5.6 with ![](media/image1126.wmf) replaced by
![](media/image1127.wmf).

### 5.6A.2 Modulation scheme π/2-BPSK

For $M_{\text{sc}}^{\text{RU}} = 3$ and π/2-BPSK modulation only 2-of-3
adjacent subcarriers are selected as described in 5.5.2.1A.2**. T**he
time-continuous signal ![](media/image1128.wmf) in SC-FDMA symbol
![](media/image3.wmf) in an uplink slot is defined by

for ![](media/image1130.wmf) where ![](media/image1110.wmf),
![](media/image1111.wmf), ![](media/image39.wmf) is given by Table
5.6-1, and $a_{k,l}$ and are respectively the modulation value for
subcarrier index and $k + 1$ for symbol
![](media/image1135.wmf){width="0.10416666666666667in"
height="0.19791666666666666in"}, and the values of used on and are
respectively obtained by subtracting from the resulting set of allocated
subcarriers as described in Table 8.1.6-1 of \[4\], and represents the
lower subcarrier index among the selected subcarriers and is the
subcarrier index adjacent to it. The phase rotation
![](media/image1141.wmf) is given by

$$\phi = \frac{\pi}{2}\left( \widetilde{l}\ mod\ 2 \right) + \varphi_{\text{avg}_{k}}\left( \widetilde{l} \right)$$

$$\ \varphi_{\text{avg}_{k}}\left( \widetilde{l} \right) = \varphi_{\text{avg}_{k}}\left( \widetilde{l} - 1 \right) + 2\pi\Delta f\left( k + 1 \right)\left( N + N_{\text{CP},l} \right)T_{s}\text{\ \ when\ \ }\widetilde{l} > 0$$

$$\varphi_{\text{avg}_{k}}\left( 0 \right) = 0$$

$$\ \widetilde{l} = 0,1,\ldots,N_{\text{TB}}N_{\text{rep}}^{\text{PUSCH}}M_{\text{RU}}M_{\text{slots}}^{\text{UL}}M_{\text{symb}}^{\text{UL}} - 1$$

$$l = \ \widetilde{l}\text{\ mod\ }M_{\text{symb}}^{\text{UL}}$$

where $N_{\text{TB}}$ is the number of transport blocks defined in
clause 8.0 of 3GPP TS 36.213 \[4\]. If $N_{\text{TB}}$ \>1 and
interleaving between codewords is applied according to clause 8.0 of
3GPP TS 36.213 \[4\], then the symbol counter is reset at the start of
the first PUSCH codeword transmission and incremented for each symbol
during the transmission of the $N_{\text{TB}}$ PUSCH codewords. For
other cases, the symbol counter is reset at the start of each PUSCH
codeword transmission and incremented for each symbol during the
transmission of the PUSCH codeword.

The SC-FDMA symbols in a slot shall be transmitted in increasing order
of ![](media/image3.wmf), starting with ![](media/image1120.wmf), where
SC-FDMA symbol ![](media/image1121.wmf) starts at time
![](media/image1143.wmf) within the slot.

 5.7 Physical random access channel
----------------------------------

### 5.7.1 Time and frequency structure

The physical layer random access preamble, illustrated in Figure
5.7.1-1, consists of a cyclic prefix of length and a sequence part of
length. The parameter values are listed in Table 5.7.1-1 and depend on
the frame structure and the random access configuration. Higher layers
control the preamble format.

Figure 5.7.1-1: Random access preamble format

Table 5.7.1-1: Random access preamble parameters

  Preamble format                                                                                                                                                                          
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -- --
  0                                                                                                                                                                                        
  1                                                                                                                                                                                        
  2                                                                                                                                                                                        
  3                                                                                                                                                                                        
  4 (see Note)                                                                                                                                                                             
  NOTE: Frame structure type 2 and special subframe configurations with UpPTS lengths and only assuming that the number of additional SC-FDMA symbols in UpPTS X in Table 4.2-1 is 0.      

The transmission of a random access preamble, if triggered by the MAC
layer, is restricted to certain time and frequency resources. These
resources are enumerated in increasing order of the subframe number
within the radio frame and the physical resource blocks in the frequency
domain such that index 0 correspond to the lowest numbered physical
resource block and subframe within the radio frame. PRACH resources
within the radio frame are indicated by a PRACH configuration index,
where the indexing is in the order of appearance in Table 5.7.1-2 and
Table 5.7.1-4.

For non-BL/CE UEs there are up to two PRACH configurations in a cell.
The first PRACH configuration is configured by higher layers with a
PRACH configuration index (*prach-ConfigurationIndex*) and a PRACH
frequency offset (*prach-FrequencyOffset*). The second PRACH
configuration (if any) is configured by higher layers with a PRACH
configuration index (*prach-ConfigurationIndexHighSpeed*) and a PRACH
frequency offset (*prach-FrequencyOffsetHighSpeed*)*.*

For BL/CE UEs, for each PRACH coverage enhancement level, there is a
PRACH configuration configured by higher layers with a PRACH
configuration index *(prach-ConfigurationIndex), a PRACH frequency
offset* (*prach-FrequencyOffset*), a number of PRACH repetitions per
attempt (*numRepetitionPerPreambleAttempt*) *and optionally* a PRACH
starting subframe periodicity (*prach-StartingSubframe*). PRACH of
preamble format 0-3 is transmitted times, whereas PRACH of preamble
format 4 is transmitted one time only.

*For BL/CE UEs and for each* PRACH coverage enhancement level*, if
frequency hopping is enabled for a PRACH configuration by the
higher-layer parameter prach-HoppingConfig*, *t*he value of the
parameter depends on the SFN and the PRACH configuration index and is
given by

\- In case the PRACH configuration index is such that a PRACH resource
occurs in every radio frame when calculated as below from Table 5.7.1-2
or Table 5.7.1-4,

\- otherwise

where is the system frame number corresponding to the first subframe for
each PRACH repetition, corresponds to a cell-specific higher-layer
parameter *prach-HoppingOffset*. If frequency hopping is not enabled for
the PRACH configuration then *.*

For frame structure type 1 with preamble format 0-3, for each of the
PRACH configurations there is at most one random access resource per
subframe.\
Table 5.7.1-2 lists the preamble formats according to Table 5.7.1-1 and
the subframes in which random access preamble transmission is allowed
for a given configuration in frame structure type 1. The start of the
random access preamble shall be aligned with the start of the
corresponding uplink subframe at the UE assuming , where is defined in
clause 8.1. For PRACH configurations 0, 1, 2, 15, 16, 17, 18, 31, 32,
33, 34, 47, 48, 49, 50 and 63 the UE may for handover purposes assume an
absolute value of the relative time difference between radio frame in
the current cell and the target cell of less than .\
The first physical resource block allocated to the PRACH opportunity
considered for preamble formats 0, 1, 2 and 3 is defined as .

Table 5.7.1-2: Frame structure type 1 random access configuration for
preamble formats 0-3

+-------+-------+-------+-------+-------+-------+-------+-------+
| PRACH | Prea  | S     | Sub   | PRACH | Prea  | S     | Sub   |
| Con   | mble\ | ystem | frame | Con   | mble\ | ystem | frame |
| figur | F     | frame | n     | figur | F     | frame | n     |
| ation | ormat | n     | umber | ation | ormat | n     | umber |
|       |       | umber |       |       |       | umber |       |
| Index |       |       |       | Index |       |       |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
| 0     | 0     | Even  | 1     | 32    | 2     | Even  | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 1     | 0     | Even  | 4     | 33    | 2     | Even  | 4     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 2     | 0     | Even  | 7     | 34    | 2     | Even  | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 3     | 0     | Any   | 1     | 35    | 2     | Any   | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 4     | 0     | Any   | 4     | 36    | 2     | Any   | 4     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 5     | 0     | Any   | 7     | 37    | 2     | Any   | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 6     | 0     | Any   | 1, 6  | 38    | 2     | Any   | 1, 6  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 7     | 0     | Any   | 2 ,7  | 39    | 2     | Any   | 2 ,7  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 8     | 0     | Any   | 3, 8  | 40    | 2     | Any   | 3, 8  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 9     | 0     | Any   | 1, 4, | 41    | 2     | Any   | 1, 4, |
|       |       |       | 7     |       |       |       | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 10    | 0     | Any   | 2, 5, | 42    | 2     | Any   | 2, 5, |
|       |       |       | 8     |       |       |       | 8     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 11    | 0     | Any   | 3, 6, | 43    | 2     | Any   | 3, 6, |
|       |       |       | 9     |       |       |       | 9     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 12    | 0     | Any   | 0, 2, | 44    | 2     | Any   | 0, 2, |
|       |       |       | 4, 6, |       |       |       | 4, 6, |
|       |       |       | 8     |       |       |       | 8     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 13    | 0     | Any   | 1, 3, | 45    | 2     | Any   | 1, 3, |
|       |       |       | 5, 7, |       |       |       | 5, 7, |
|       |       |       | 9     |       |       |       | 9     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 14    | 0     | Any   | 0, 1, | 46    | N/A   | N/A   | N/A   |
|       |       |       | 2, 3, |       |       |       |       |
|       |       |       | 4, 5, |       |       |       |       |
|       |       |       | 6, 7, |       |       |       |       |
|       |       |       | 8, 9  |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 15    | 0     | Even  | 9     | 47    | 2     | Even  | 9     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 16    | 1     | Even  | 1     | 48    | 3     | Even  | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 17    | 1     | Even  | 4     | 49    | 3     | Even  | 4     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 18    | 1     | Even  | 7     | 50    | 3     | Even  | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 19    | 1     | Any   | 1     | 51    | 3     | Any   | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | 1     | Any   | 4     | 52    | 3     | Any   | 4     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 21    | 1     | Any   | 7     | 53    | 3     | Any   | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 22    | 1     | Any   | 1, 6  | 54    | 3     | Any   | 1, 6  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 23    | 1     | Any   | 2 ,7  | 55    | 3     | Any   | 2 ,7  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 24    | 1     | Any   | 3, 8  | 56    | 3     | Any   | 3, 8  |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 25    | 1     | Any   | 1, 4, | 57    | 3     | Any   | 1, 4, |
|       |       |       | 7     |       |       |       | 7     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 26    | 1     | Any   | 2, 5, | 58    | 3     | Any   | 2, 5, |
|       |       |       | 8     |       |       |       | 8     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 27    | 1     | Any   | 3, 6, | 59    | 3     | Any   | 3, 6, |
|       |       |       | 9     |       |       |       | 9     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 28    | 1     | Any   | 0, 2, | 60    | N/A   | N/A   | N/A   |
|       |       |       | 4, 6, |       |       |       |       |
|       |       |       | 8     |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 29    | 1     | Any   | 1, 3, | 61    | N/A   | N/A   | N/A   |
|       |       |       | 5, 7, |       |       |       |       |
|       |       |       | 9     |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 30    | N/A   | N/A   | N/A   | 62    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 31    | 1     | Even  | 9     | 63    | 3     | Even  | 9     |
+-------+-------+-------+-------+-------+-------+-------+-------+

For frame structure type 2 with preamble formats 0-4, for each of the
PRACH configurations there might be multiple random access resources in
an UL subframe (or UpPTS for preamble format 4) depending on the UL/DL
configuration \[see table 4.2-2\]. Table 5.7.1-3 lists PRACH
configurations allowed for frame structure type 2 where the
configuration index corresponds to a certain combination of preamble
format, PRACH density value, and version index, .\
For frame structure type 2 with PRACH configuration indices 0, 1, 2, 20,
21, 22, 30, 31, 32, 40, 41, 42, 48, 49, 50, or with PRACH configuration
indices 51, 53, 54, 55, 56, 57 in UL/DL configuration 3, 4, 5, [
]{.underline} the UE may for handover purposes assume an absolute value
of the relative time difference between radio frame in the current cell
and the target cell is less than .

Table 5.7.1-3: Frame structure type 2 random access configurations for
preamble formats 0-4

+-------+-------+-------+-------+-------+-------+-------+-------+
| P     | Prea  | De    | Ve    | P     | Prea  | De    | Ve    |
| RACH\ | mble\ | nsity | rsion | RACH\ | mble\ | nsity | rsion |
| con   | F     |       |       | con   | F     |       |       |
| figur | ormat | Per   |       | figur | ormat | Per   |       |
| ation |       | 10 ms |       | ation |       | 10 ms |       |
|       |       |       |       |       |       |       |       |
| Index |       |       |       | Index |       |       |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
| 0     | 0     | 0.5   | 0     | 32    | 2     | 0.5   | 2     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 1     | 0     | 0.5   | 1     | 33    | 2     | 1     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 2     | 0     | 0.5   | 2     | 34    | 2     | 1     | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 3     | 0     | 1     | 0     | 35    | 2     | 2     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 4     | 0     | 1     | 1     | 36    | 2     | 3     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 5     | 0     | 1     | 2     | 37    | 2     | 4     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 6     | 0     | 2     | 0     | 38    | 2     | 5     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 7     | 0     | 2     | 1     | 39    | 2     | 6     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 8     | 0     | 2     | 2     | 40    | 3     | 0.5   | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 9     | 0     | 3     | 0     | 41    | 3     | 0.5   | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 10    | 0     | 3     | 1     | 42    | 3     | 0.5   | 2     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 11    | 0     | 3     | 2     | 43    | 3     | 1     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 12    | 0     | 4     | 0     | 44    | 3     | 1     | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 13    | 0     | 4     | 1     | 45    | 3     | 2     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 14    | 0     | 4     | 2     | 46    | 3     | 3     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 15    | 0     | 5     | 0     | 47    | 3     | 4     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 16    | 0     | 5     | 1     | 48    | 4     | 0.5   | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 17    | 0     | 5     | 2     | 49    | 4     | 0.5   | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 18    | 0     | 6     | 0     | 50    | 4     | 0.5   | 2     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 19    | 0     | 6     | 1     | 51    | 4     | 1     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20    | 1     | 0.5   | 0     | 52    | 4     | 1     | 1     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 21    | 1     | 0.5   | 1     | 53    | 4     | 2     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 22    | 1     | 0.5   | 2     | 54    | 4     | 3     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 23    | 1     | 1     | 0     | 55    | 4     | 4     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 24    | 1     | 1     | 1     | 56    | 4     | 5     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 25    | 1     | 2     | 0     | 57    | 4     | 6     | 0     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 26    | 1     | 3     | 0     | 58    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 27    | 1     | 4     | 0     | 59    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 28    | 1     | 5     | 0     | 60    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 29    | 1     | 6     | 0     | 61    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 30    | 2     | 0.5   | 0     | 62    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 31    | 2     | 0.5   | 1     | 63    | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+

Table 5.7.1-4 lists the mapping to physical resources for the different
random access opportunities needed for a certain PRACH density value, .
Each quadruple of the format indicates the location of a specific random
access resource, where is a frequency resource index within the
considered time instance, indicates whether the resource is reoccurring
in all radio frames, in even radio frames, or in odd radio frames,
respectively, indicates whether the random access resource is located in
first half frame or in second half frame, respectively, and where is the
uplink subframe number where the preamble starts, counting from 0 at the
first uplink subframe between 2 consecutive downlink-to-uplink switch
points, with the exception of preamble format 4 where is denoted as
(\*). The start of the random access preamble formats 0-3 shall be
aligned with the start of the corresponding uplink subframe at the UE
assuming and the random access preamble format 4 shall start before the
end of the UpPTS at the UE, where the UpPTS is referenced to the UE\'s
uplink frame timing assuming.

The random access opportunities for each PRACH configuration shall be
allocated in time first and then in frequency if and only if time
multiplexing is not sufficient to hold all opportunities of a PRACH
configuration needed for a certain density value without overlap in
time. For preamble format 0-3, the frequency multiplexing shall be done
according to

where is the number of uplink resource blocks, is the first physical
resource block allocated to the PRACH opportunity considered and where
is the first physical resource block available for PRACH.

For preamble format 4, the frequency multiplexing shall be done
according to

whereis the system frame number and whereis the number of DL to UL
switch points within the radio frame.

*For BL/CE UEs, only a subset of the subframes allowed for preamble
transmission are allowed as starting subframes for the* repetitions. The
allowed starting subframes for a PRACH configuration are determined as
follows:

\- Enumerate the subframes that are allowed for preamble transmission
for the PRACH configuration as where and correspond to the two subframes
allowed for preamble transmission with the smallest and the largest
absolute subframe number , respectively.

\- If a PRACH starting subframe periodicity is not provided by higher
layers, the periodicity of the allowed starting subframes in terms of
subframes allowed for preamble transmission is . The allowed starting
subframes defined over are given by where

\- If a PRACH starting subframe periodicity is provided by higher
layers, it indicates the periodicity of the allowed starting subframes
in terms of subframes allowed for preamble transmission. The allowed
starting subframes defined over are given by where

\- No starting subframe defined over such that is allowed.

Each random access preamble occupies a bandwidth corresponding to 6
consecutive resource blocks for both frame structures.

Table 5.7.1-4: Frame structure type 2 random access preamble mapping in
time and frequency

+-------+-------+-------+-------+-------+-------+-------+-------+
| PRACH | UL/DL |       |       |       |       |       |       |
|       | con   |       |       |       |       |       |       |
| con   | figur |       |       |       |       |       |       |
| figur | ation |       |       |       |       |       |       |
| ation | (See  |       |       |       |       |       |       |
| Index | Table |       |       |       |       |       |       |
|       | 4     |       |       |       |       |       |       |
| (See  | .2-2) |       |       |       |       |       |       |
| Table |       |       |       |       |       |       |       |
| 5.7   |       |       |       |       |       |       |       |
| .1-3) |       |       |       |       |       |       |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
|       | 0     | 1     | 2     | 3     | 4     | 5     | 6     |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 0     | (0,1  | (0,1  | (0,1  | (0,1  | (0,1  | (0,1  | (0,1  |
|       | ,0,2) | ,0,1) | ,0,0) | ,0,2) | ,0,1) | ,0,0) | ,0,2) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 1     | (0,2  | (0,2  | (0,2  | (0,2  | (0,2  | (0,2  | (0,2  |
|       | ,0,2) | ,0,1) | ,0,0) | ,0,2) | ,0,1) | ,0,0) | ,0,2) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 2     | (0,1  | (0,1  | (0,1  | (0,1  | (0,1  | N/A   | (0,1  |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,1) | ,0,0) |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 3     | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,2) | ,0,1) | ,0,0) | ,0,2) | ,0,1) | ,0,0) | ,0,2) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 4     | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | N/A   | (0,0  |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,1) | ,0,0) |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 5     | (0,0  | (0,0  | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,1) | ,0,0) |       | ,0,0) |       |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 6     | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,2) | ,0,1) | ,0,0) | ,0,1) | ,0,0) | ,0,0) | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (1,0  | (0,0  |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,2) | ,0,1) | ,0,0) | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 7     | (0,0  | (0,0  | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,1) | ,0,0) |       | ,0,0) |       |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (0,0  |       |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,2) |       |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 8     | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (0,0  |       |       | (0,0  |
|       | ,1,0) |       |       | ,0,1) |       |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 9     | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,1) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (1,0  | (0,0  |
|       | ,0,2) | ,0,1) | ,1,0) | ,0,1) | ,0,1) | ,0,0) | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (0,0  | (1,0  | (2,0  | (0,0  |
|       | ,1,2) | ,1,1) | ,0,0) | ,0,2) | ,0,1) | ,0,0) | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 10    | (0,0  | (0,0  | (0,0  | N/A   | (0,0  | N/A   | (0,0  |
|       | ,0,0) | ,0,1) | ,0,0) |       | ,0,0) |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  |       | (0,0  |       | (0,0  |
|       | ,1,0) | ,1,0) | ,1,0) |       | ,0,1) |       | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  |       | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,1) | ,1,0) |       | ,0,0) |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 11    | N/A   | (0,0  | N/A   | N/A   | N/A   | N/A   | (0,0  |
|       |       | ,0,0) |       |       |       |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       |       | (0,0  |       |       |       |       | (0,0  |
|       |       | ,0,1) |       |       |       |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       |       | (0,0  |       |       |       |       | (0,0  |
|       |       | ,1,0) |       |       |       |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 12    | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,1) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (1,0  | (0,0  |
|       | ,0,2) | ,0,1) | ,1,0) | ,0,1) | ,0,1) | ,0,0) | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (0,0  | (1,0  | (2,0  | (0,0  |
|       | ,1,1) | ,1,0) | ,0,0) | ,0,2) | ,0,0) | ,0,0) | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (1,0  | (1,0  | (3,0  | (0,0  |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,2) | ,0,1) | ,0,0) | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 13    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (0,0  |       |       | (0,0  |
|       | ,0,2) |       |       | ,0,1) |       |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (0,0  |       |       | (0,0  |
|       | ,1,0) |       |       | ,0,2) |       |       | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (1,0  |       |       | (0,0  |
|       | ,1,2) |       |       | ,0,1) |       |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 14    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (0,0  |       |       | (0,0  |
|       | ,0,1) |       |       | ,0,1) |       |       | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (0,0  |       |       | (0,0  |
|       | ,1,0) |       |       | ,0,2) |       |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (1,0  |       |       | (0,0  |
|       | ,1,1) |       |       | ,0,0) |       |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 15    | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (1,0  | (0,0  |
|       | ,0,1) | ,0,1) | ,1,0) | ,0,1) | ,0,1) | ,0,0) | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (0,0  | (1,0  | (2,0  | (0,0  |
|       | ,0,2) | ,1,0) | ,0,0) | ,0,2) | ,0,0) | ,0,0) | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (1,0  | (1,0  | (3,0  | (0,0  |
|       | ,1,1) | ,1,1) | ,1,0) | ,0,1) | ,0,1) | ,0,0) | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (1,0  | (2,0  | (1,0  | (2,0  | (4,0  | (0,0  |
|       | ,1,2) | ,0,1) | ,0,0) | ,0,2) | ,0,1) | ,0,0) | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 16    | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | N/A   | N/A   |
|       | ,0,1) | ,0,0) | ,0,0) | ,0,0) | ,0,0) |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |       |       |
|       | ,0,2) | ,0,1) | ,1,0) | ,0,1) | ,0,1) |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (0,0  | (1,0  |       |       |
|       | ,1,0) | ,1,0) | ,0,0) | ,0,2) | ,0,0) |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (1,0  | (1,0  |       |       |
|       | ,1,1) | ,1,1) | ,1,0) | ,0,0) | ,0,1) |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (1,0  | (2,0  | (1,0  | (2,0  |       |       |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,2) | ,0,0) |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 17    | (0,0  | (0,0  | N/A   | (0,0  | N/A   | N/A   | N/A   |
|       | ,0,0) | ,0,0) |       | ,0,0) |       |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (0,0  |       |       |       |
|       | ,0,1) | ,0,1) |       | ,0,1) |       |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (0,0  |       |       |       |
|       | ,0,2) | ,1,0) |       | ,0,2) |       |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  |       |       |       |
|       | ,1,0) | ,1,1) |       | ,0,0) |       |       |       |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (1,0  |       | (1,0  |       |       |       |
|       | ,1,2) | ,0,0) |       | ,0,1) |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 18    | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  |
|       | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (0,0  | (0,0  | (0,0  | (1,0  | (0,0  |
|       | ,0,1) | ,0,1) | ,1,0) | ,0,1) | ,0,1) | ,0,0) | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (0,0  | (1,0  | (2,0  | (0,0  |
|       | ,0,2) | ,1,0) | ,0,0) | ,0,2) | ,0,0) | ,0,0) | ,0,2) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  | (1,0  | (1,0  | (1,0  | (3,0  | (0,0  |
|       | ,1,0) | ,1,1) | ,1,0) | ,0,0) | ,0,1) | ,0,0) | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (1,0  | (2,0  | (1,0  | (2,0  | (4,0  | (0,0  |
|       | ,1,1) | ,0,1) | ,0,0) | ,0,1) | ,0,0) | ,0,0) | ,1,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (1,0  | (2,0  | (1,0  | (2,0  | (5,0  | (1,0  |
|       | ,1,2) | ,1,1) | ,1,0) | ,0,2) | ,0,1) | ,0,0) | ,0,2) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 19    | N/A   | (0,0  | N/A   | N/A   | N/A   | N/A   | (0,0  |
|       |       | ,0,0) |       |       |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       |       | (0,0  |       |       |       |       | (0,0  |
|       |       | ,0,1) |       |       |       |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       |       | (0,0  |       |       |       |       | (0,0  |
|       |       | ,1,0) |       |       |       |       | ,0,2) |
|       |       |       |       |       |       |       |       |
|       |       | (0,0  |       |       |       |       | (0,0  |
|       |       | ,1,1) |       |       |       |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       |       | (1,0  |       |       |       |       | (0,0  |
|       |       | ,0,0) |       |       |       |       | ,1,1) |
|       |       |       |       |       |       |       |       |
|       |       | (1,0  |       |       |       |       | (1,0  |
|       |       | ,1,0) |       |       |       |       | ,1,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 20 /  | (0,1  | (0,1  | N/A   | (0,1  | (0,1  | N/A   | (0,1  |
| 30    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 21 /  | (0,2  | (0,2  | N/A   | (0,2  | (0,2  | N/A   | (0,2  |
| 31    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 22 /  | (0,1  | (0,1  | N/A   | N/A   | N/A   | N/A   | (0,1  |
| 32    | ,1,1) | ,1,0) |       |       |       |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 23 /  | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| 33    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 24 /  | (0,0  | (0,0  | N/A   | N/A   | N/A   | N/A   | (0,0  |
| 34    | ,1,1) | ,1,0) |       |       |       |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 25 /  | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| 35    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 26 /  | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| 36    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (2,0  | (2,0  |       | (1,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 27 /  | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| 37    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (2,0  | (2,0  |       | (1,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (3,0  | (3,0  |       | (1,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 28 /  | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| 38    | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (2,0  | (2,0  |       | (1,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (3,0  | (3,0  |       | (1,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (2,0  | (2,0  |       | (4,0  | (4,0  |       | (2,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 29    | (0,0  | (0,0  | N/A   | (0,0  | (0,0  | N/A   | (0,0  |
| /39   | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (0,0  | (0,0  |       | (1,0  | (1,0  |       | (0,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (2,0  | (2,0  |       | (1,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (1,0  | (1,0  |       | (3,0  | (3,0  |       | (1,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
|       |       |       |       |       |       |       |       |
|       | (2,0  | (2,0  |       | (4,0  | (4,0  |       | (2,0  |
|       | ,0,1) | ,0,0) |       | ,0,1) | ,0,0) |       | ,0,1) |
|       |       |       |       |       |       |       |       |
|       | (2,0  | (2,0  |       | (5,0  | (5,0  |       | (2,0  |
|       | ,1,1) | ,1,0) |       | ,0,1) | ,0,0) |       | ,1,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 40    | (0,1  | N/A   | N/A   | (0,1  | N/A   | N/A   | (0,1  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 41    | (0,2  | N/A   | N/A   | (0,2  | N/A   | N/A   | (0,2  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 42    | (0,1  | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
|       | ,1,0) |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 43    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 44    | (0,0  | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
|       | ,1,0) |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 45    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (1,0  |       |       | (1,0  |
|       | ,1,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 46    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (1,0  |       |       | (1,0  |
|       | ,1,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  |       |       | (2,0  |       |       | (2,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 47    | (0,0  | N/A   | N/A   | (0,0  | N/A   | N/A   | (0,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (0,0  |       |       | (1,0  |       |       | (1,0  |
|       | ,1,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  |       |       | (2,0  |       |       | (2,0  |
|       | ,0,0) |       |       | ,0,0) |       |       | ,0,0) |
|       |       |       |       |       |       |       |       |
|       | (1,0  |       |       | (3,0  |       |       | (3,0  |
|       | ,1,0) |       |       | ,0,0) |       |       | ,0,0) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 48    | (0,1, | (0,1, | (0,1, | (0,1, | (0,1, | (0,1, | (0,1, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 49    | (0,2, | (0,2, | (0,2, | (0,2, | (0,2, | (0,2, | (0,2, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 50    | (0,1, | (0,1, | (0,1, | N/A   | N/A   | N/A   | (0,1, |
|       | 1,\*) | 1,\*) | 1,\*) |       |       |       | 1,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 51    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 52    | (0,0, | (0,0, | (0,0, | N/A   | N/A   | N/A   | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) |       |       |       | 1,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 53    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (0,0, | (0,0, | (0,0, | (1,0, | (1,0, | (1,0, | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 54    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (0,0, | (0,0, | (0,0, | (1,0, | (1,0, | (1,0, | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (2,0, | (2,0, | (2,0, | (1,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 55    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (0,0, | (0,0, | (0,0, | (1,0, | (1,0, | (1,0, | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (2,0, | (2,0, | (2,0, | (1,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (3,0, | (3,0, | (3,0, | (1,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 56    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (0,0, | (0,0, | (0,0, | (1,0, | (1,0, | (1,0, | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (2,0, | (2,0, | (2,0, | (1,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (3,0, | (3,0, | (3,0, | (1,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (2,0, | (2,0, | (2,0, | (4,0, | (4,0, | (4,0, | (2,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 57    | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, | (0,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (0,0, | (0,0, | (0,0, | (1,0, | (1,0, | (1,0, | (0,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (2,0, | (2,0, | (2,0, | (1,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (1,0, | (1,0, | (1,0, | (3,0, | (3,0, | (3,0, | (1,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
|       |       |       |       |       |       |       |       |
|       | (2,0, | (2,0, | (2,0, | (4,0, | (4,0, | (4,0, | (2,0, |
|       | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) | 0,\*) |
|       |       |       |       |       |       |       |       |
|       | (2,0, | (2,0, | (2,0, | (5,0, | (5,0, | (5,0, | (2,0, |
|       | 1,\*) | 1,\*) | 1,\*) | 0,\*) | 0,\*) | 0,\*) | 1,\*) |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 58    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 59    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 60    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 61    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 62    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| 63    | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   | N/A   |
+-------+-------+-------+-------+-------+-------+-------+-------+
| NOTE: |       |       |       |       |       |       |       |
| \*    |       |       |       |       |       |       |       |
| UpPTS |       |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+

###  5.7.2 Preamble sequence generation

The random access preambles are generated from Zadoff-Chu sequences with
zero correlation zone, generated from one or several root Zadoff-Chu
sequences. The network configures the set of preamble sequences the UE
is allowed to use.

There are up to two sets of 64 preambles available in a cell where Set 1
corresponds to higher layer PRACH configuration using
*prach-ConfigurationIndex and prach-FrequencyOffset* and Set 2, if
configured, corresponds to higher layer PRACH configuration using
*prach-ConfigurationIndexHighSpeed and prach-FrequencyOffsetHighSpeed*.
The set of 64 preamble sequences in a cell is found by including first,
in the order of increasing cyclic shift, all the available cyclic shifts
of a root Zadoff-Chu sequence with the logical index
*rootSequenceIndexHighSpeed (for Set 2, if configured) or with the
logical index [ ]{.underline}*RACH\_ROOT\_SEQUENCE (for Set 1), where
both *rootSequenceIndexHighSpeed (if configured) and*
RACH\_ROOT\_SEQUENCE are broadcasted as part of the System Information.
Additional preamble sequences, in case 64 preambles cannot be generated
from a single root Zadoff-Chu sequence, are obtained from the root
sequences with the consecutive logical indexes until all the 64
sequences are found.\
The logical root sequence order is cyclic: the logical index 0 is
consecutive to 837. The relation between a logical root sequence index
and physical root sequence index is given by Tables 5.7.2-4 and 5.7.2-5
for preamble formats 0 -- 3 and 4, respectively.

The root Zadoff-Chu sequence is defined by

where the length of the Zadoff-Chu sequence is given by Table 5.7.2-1.
From the root Zadoff-Chu sequence, random access preambles with zero
correlation zones of length are defined by cyclic shifts according to

where the cyclic shift is given by

and is given by Tables 5.7.2-2 and 5.7.2-3 for preamble formats 0-3 and
4, respectively, where the higher-layer parameters
*zeroCorrelationZoneConfig* and *zeroCorrelationZoneConfigHighSpeed*
shall be used for PRACH preamble Set 1 and Set 2 (if configured),
respectively. Restricted set type B shall be used for PRACH preamble Set
2 (if configured), and the parameter *High-speed-flag* provided by
higher layers determines if unrestricted set or restricted set type A
shall be used for PRACH preamble Set 1.

The variable is the cyclic shift corresponding to a Doppler shift of
magnitude and is given by

where is the smallest non-negative integer that fulfils . The parameters
for restricted sets of cyclic shifts depend on .

For restricted set type A and , the parameters are given by

For restricted set type A and , the parameters are given by

For restricted set type B and , the parameters are given by

For restricted set type B and , the parameters are given by

For restricted set type B and , the parameters are given by

For restricted set type B and , the parameters are given by

For restricted set type B and , the parameters are given by

For restricted set type B and , the parameters are given by

For all other values of , there are no cyclic shifts in the restricted
set.

Table 5.7.2-1: Random access preamble sequence length

  Preamble format   
  ----------------- -----
  0 -- 3            839
  4                 139

Table 5.7.2-2: for preamble generation (preamble formats 0-3)

  --------------------------------------------------------------------------------------------------------
  *zeroCorrelationZoneConfig,\          value                                      
  zeroCorrelationZoneConfigHighSpeed*                                              
  ------------------------------------- ------------------ ----------------------- -----------------------
                                        Unrestricted set   Restricted set type A   Restricted set type B

  0                                     0                  15                      15

  1                                     13                 18                      18

  2                                     15                 22                      22

  3                                     18                 26                      26

  4                                     22                 32                      32

  5                                     26                 38                      38

  6                                     32                 46                      46

  7                                     38                 55                      55

  8                                     46                 68                      68

  9                                     59                 82                      82

  10                                    76                 100                     100

  11                                    93                 128                     118

  12                                    119                158                     137

  13                                    167                202                     \-

  14                                    279                237                     \-

  15                                    419                \-                      \-
  --------------------------------------------------------------------------------------------------------

Table 5.7.2-3: for preamble generation (preamble format 4)

  *zeroCorrelationZoneConfig*   value
  ----------------------------- -------
  0                             2
  1                             4
  2                             6
  3                             8
  4                             10
  5                             12
  6                             15
  7                             N/A
  8                             N/A
  9                             N/A
  10                            N/A
  11                            N/A
  12                            N/A
  13                            N/A
  14                            N/A
  15                            N/A

Table 5.7.2-4: Root Zadoff-Chu sequence order for preamble formats 0 --
3

+------------------------------+--------------------------------------+
| Logical root sequence number | Physical root sequence number        |
|                              |                                      |
|                              | (in increasing order of the          |
|                              | corresponding logical sequence       |
|                              | number)                              |
+==============================+======================================+
| 0--23                        | 129, 710, 140, 699, 120, 719, 210,   |
|                              | 629, 168, 671, 84, 755, 105, 734,    |
|                              | 93, 746, 70, 769, 60, 779            |
|                              |                                      |
|                              | 2, 837, 1, 838                       |
+------------------------------+--------------------------------------+
| 24--29                       | 56, 783, 112, 727, 148, 691          |
+------------------------------+--------------------------------------+
| 30--35                       | 80, 759, 42, 797, 40, 799            |
+------------------------------+--------------------------------------+
| 36--41                       | 35, 804, 73, 766, 146, 693           |
+------------------------------+--------------------------------------+
| 42--51                       | 31, 808, 28, 811, 30, 809, 27, 812,  |
|                              | 29, 810                              |
+------------------------------+--------------------------------------+
| 52--63                       | 24, 815, 48, 791, 68, 771, 74, 765,  |
|                              | 178, 661, 136, 703                   |
+------------------------------+--------------------------------------+
| 64--75                       | 86, 753, 78, 761, 43, 796, 39, 800,  |
|                              | 20, 819, 21, 818                     |
+------------------------------+--------------------------------------+
| 76--89                       | 95, 744, 202, 637, 190, 649, 181,    |
|                              | 658, 137, 702, 125, 714, 151, 688    |
+------------------------------+--------------------------------------+
| 90--115                      | 217, 622, 128, 711, 142, 697, 122,   |
|                              | 717, 203, 636, 118, 721, 110, 729,   |
|                              | 89, 750, 103, 736, 61, 778, 55, 784, |
|                              | 15, 824, 14, 825                     |
+------------------------------+--------------------------------------+
| 116--135                     | 12, 827, 23, 816, 34, 805, 37, 802,  |
|                              | 46, 793, 207, 632, 179, 660, 145,    |
|                              | 694, 130, 709, 223, 616              |
+------------------------------+--------------------------------------+
| 136--167                     | 228, 611, 227, 612, 132, 707, 133,   |
|                              | 706, 143, 696, 135, 704, 161, 678,   |
|                              | 201, 638, 173, 666, 106, 733, 83,    |
|                              | 756, 91, 748, 66, 773, 53, 786, 10,  |
|                              | 829, 9, 830                          |
+------------------------------+--------------------------------------+
| 168--203                     | 7, 832, 8, 831, 16, 823, 47, 792,    |
|                              | 64, 775, 57, 782, 104, 735, 101,     |
|                              | 738, 108, 731, 208, 631, 184, 655,   |
|                              | 197, 642, 191, 648, 121, 718, 141,   |
|                              | 698, 149, 690, 216, 623, 218, 621    |
+------------------------------+--------------------------------------+
| 204--263                     | 152, 687, 144, 695, 134, 705, 138,   |
|                              | 701, 199, 640, 162, 677, 176, 663,   |
|                              | 119, 720, 158, 681, 164, 675, 174,   |
|                              | 665, 171, 668, 170, 669, 87, 752,    |
|                              | 169, 670, 88, 751, 107, 732, 81,     |
|                              | 758, 82, 757, 100, 739, 98, 741, 71, |
|                              | 768, 59, 780, 65, 774, 50, 789, 49,  |
|                              | 790, 26, 813, 17, 822, 13, 826, 6,   |
|                              | 833                                  |
+------------------------------+--------------------------------------+
| 264--327                     | 5, 834, 33, 806, 51, 788, 75, 764,   |
|                              | 99, 740, 96, 743, 97, 742, 166, 673, |
|                              | 172, 667, 175, 664, 187, 652, 163,   |
|                              | 676, 185, 654, 200, 639, 114, 725,   |
|                              | 189, 650, 115, 724, 194, 645, 195,   |
|                              | 644, 192, 647, 182, 657, 157, 682,   |
|                              | 156, 683, 211, 628, 154, 685, 123,   |
|                              | 716, 139, 700, 212, 627, 153, 686,   |
|                              | 213, 626, 215, 624, 150, 689         |
+------------------------------+--------------------------------------+
| 328--383                     | 225, 614, 224, 615, 221, 618, 220,   |
|                              | 619, 127, 712, 147, 692, 124, 715,   |
|                              | 193, 646, 205, 634, 206, 633, 116,   |
|                              | 723, 160, 679, 186, 653, 167, 672,   |
|                              | 79, 760, 85, 754, 77, 762, 92, 747,  |
|                              | 58, 781, 62, 777, 69, 770, 54, 785,  |
|                              | 36, 803, 32, 807, 25, 814, 18, 821,  |
|                              | 11, 828, 4, 835                      |
+------------------------------+--------------------------------------+
| 384--455                     | 3, 836, 19, 820, 22, 817, 41, 798,   |
|                              | 38, 801, 44, 795, 52, 787, 45, 794,  |
|                              | 63, 776, 67, 772, 72                 |
|                              |                                      |
|                              | 767, 76, 763, 94, 745, 102, 737, 90, |
|                              | 749, 109, 730, 165, 674, 111, 728,   |
|                              | 209, 630, 204, 635, 117, 722, 188,   |
|                              | 651, 159, 680, 198, 641, 113, 726,   |
|                              | 183, 656, 180, 659, 177, 662, 196,   |
|                              | 643, 155, 684, 214, 625, 126, 713,   |
|                              | 131, 708, 219, 620, 222, 617, 226,   |
|                              | 613                                  |
+------------------------------+--------------------------------------+
| 456--513                     | 230, 609, 232, 607, 262, 577, 252,   |
|                              | 587, 418, 421, 416, 423, 413, 426,   |
|                              | 411, 428, 376, 463, 395, 444, 283,   |
|                              | 556, 285, 554, 379, 460, 390, 449,   |
|                              | 363, 476, 384, 455, 388, 451, 386,   |
|                              | 453, 361, 478, 387, 452, 360, 479,   |
|                              | 310, 529, 354, 485, 328, 511, 315,   |
|                              | 524, 337, 502, 349, 490, 335, 504,   |
|                              | 324, 515                             |
+------------------------------+--------------------------------------+
| 514--561                     | 323, 516, 320, 519, 334, 505, 359,   |
|                              | 480, 295, 544, 385, 454, 292, 547,   |
|                              | 291, 548, 381, 458, 399, 440, 380,   |
|                              | 459, 397, 442, 369, 470, 377, 462,   |
|                              | 410, 429, 407, 432, 281, 558, 414,   |
|                              | 425, 247, 592, 277, 562, 271, 568,   |
|                              | 272, 567, 264, 575, 259, 580         |
+------------------------------+--------------------------------------+
| 562--629                     | 237, 602, 239, 600, 244, 595, 243,   |
|                              | 596, 275, 564, 278, 561, 250, 589,   |
|                              | 246, 593, 417, 422, 248, 591, 394,   |
|                              | 445, 393, 446, 370, 469, 365, 474,   |
|                              | 300, 539, 299, 540, 364, 475, 362,   |
|                              | 477, 298, 541, 312, 527, 313, 526,   |
|                              | 314, 525, 353, 486, 352, 487, 343,   |
|                              | 496, 327, 512, 350, 489, 326, 513,   |
|                              | 319, 520, 332, 507, 333, 506, 348,   |
|                              | 491, 347, 492, 322, 517              |
+------------------------------+--------------------------------------+
| 630--659                     | 330, 509, 338, 501, 341, 498, 340,   |
|                              | 499, 342, 497, 301, 538, 366, 473,   |
|                              | 401, 438, 371, 468, 408, 431, 375,   |
|                              | 464, 249, 590, 269, 570, 238, 601,   |
|                              | 234, 605                             |
+------------------------------+--------------------------------------+
| 660--707                     | 257, 582, 273, 566, 255, 584, 254,   |
|                              | 585, 245, 594, 251, 588, 412, 427,   |
|                              | 372, 467, 282, 557, 403, 436, 396,   |
|                              | 443, 392, 447, 391, 448, 382, 457,   |
|                              | 389, 450, 294, 545, 297, 542, 311,   |
|                              | 528, 344, 495, 345, 494, 318, 521,   |
|                              | 331, 508, 325, 514, 321, 518         |
+------------------------------+--------------------------------------+
| 708--729                     | 346, 493, 339, 500, 351, 488, 306,   |
|                              | 533, 289, 550, 400, 439, 378, 461,   |
|                              | 374, 465, 415, 424, 270, 569, 241,   |
|                              | 598                                  |
+------------------------------+--------------------------------------+
| 730--751                     | 231, 608, 260, 579, 268, 571, 276,   |
|                              | 563, 409, 430, 398, 441, 290, 549,   |
|                              | 304, 535, 308, 531, 358, 481, 316,   |
|                              | 523                                  |
+------------------------------+--------------------------------------+
| 752--765                     | 293, 546, 288, 551, 284, 555, 368,   |
|                              | 471, 253, 586, 256, 583, 263, 576    |
+------------------------------+--------------------------------------+
| 766--777                     | 242, 597, 274, 565, 402, 437, 383,   |
|                              | 456, 357, 482, 329, 510              |
+------------------------------+--------------------------------------+
| 778--789                     | 317, 522, 307, 532, 286, 553, 287,   |
|                              | 552, 266, 573, 261, 578              |
+------------------------------+--------------------------------------+
| 790--795                     | 236, 603, 303, 536, 356, 483         |
+------------------------------+--------------------------------------+
| 796--803                     | 355, 484, 405, 434, 404, 435, 406,   |
|                              | 433                                  |
+------------------------------+--------------------------------------+
| 804--809                     | 235, 604, 267, 572, 302, 537         |
+------------------------------+--------------------------------------+
| 810--815                     | 309, 530, 265, 574, 233, 606         |
+------------------------------+--------------------------------------+
| 816--819                     | 367, 472, 296, 543                   |
+------------------------------+--------------------------------------+
| 820--837                     | 336, 503, 305, 534, 373, 466, 280,   |
|                              | 559, 279, 560, 419, 420, 240, 599,   |
|                              | 258, 581, 229, 610                   |
+------------------------------+--------------------------------------+

Table 5.7.2-5: Root Zadoff-Chu sequence order for preamble format 4

<table>
<thead>
<tr class="header">
<th>Logical root sequence number</th>
<th><p>Physical root sequence number</p>
<p>(in increasing order of the corresponding logical sequence number)</p></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0 – 19</td>
<td>1</td>
<td>138</td>
<td>2</td>
<td>137</td>
<td>3</td>
<td>136</td>
<td>4</td>
<td>135</td>
<td>5</td>
<td>134</td>
<td>6</td>
<td>133</td>
<td>7</td>
<td>132</td>
<td>8</td>
<td>131</td>
<td>9</td>
<td>130</td>
<td>10</td>
<td>129</td>
</tr>
<tr class="even">
<td>20 – 39</td>
<td>11</td>
<td>128</td>
<td>12</td>
<td>127</td>
<td>13</td>
<td>126</td>
<td>14</td>
<td>125</td>
<td>15</td>
<td>124</td>
<td>16</td>
<td>123</td>
<td>17</td>
<td>122</td>
<td>18</td>
<td>121</td>
<td>19</td>
<td>120</td>
<td>20</td>
<td>119</td>
</tr>
<tr class="odd">
<td>40 – 59</td>
<td>21</td>
<td>118</td>
<td>22</td>
<td>117</td>
<td>23</td>
<td>116</td>
<td>24</td>
<td>115</td>
<td>25</td>
<td>114</td>
<td>26</td>
<td>113</td>
<td>27</td>
<td>112</td>
<td>28</td>
<td>111</td>
<td>29</td>
<td>110</td>
<td>30</td>
<td>109</td>
</tr>
<tr class="even">
<td>60 – 79</td>
<td>31</td>
<td>108</td>
<td>32</td>
<td>107</td>
<td>33</td>
<td>106</td>
<td>34</td>
<td>105</td>
<td>35</td>
<td>104</td>
<td>36</td>
<td>103</td>
<td>37</td>
<td>102</td>
<td>38</td>
<td>101</td>
<td>39</td>
<td>100</td>
<td>40</td>
<td>99</td>
</tr>
<tr class="odd">
<td>80 – 99</td>
<td>41</td>
<td>98</td>
<td>42</td>
<td>97</td>
<td>43</td>
<td>96</td>
<td>44</td>
<td>95</td>
<td>45</td>
<td>94</td>
<td>46</td>
<td>93</td>
<td>47</td>
<td>92</td>
<td>48</td>
<td>91</td>
<td>49</td>
<td>90</td>
<td>50</td>
<td>89</td>
</tr>
<tr class="even">
<td>100 – 119</td>
<td>51</td>
<td>88</td>
<td>52</td>
<td>87</td>
<td>53</td>
<td>86</td>
<td>54</td>
<td>85</td>
<td>55</td>
<td>84</td>
<td>56</td>
<td>83</td>
<td>57</td>
<td>82</td>
<td>58</td>
<td>81</td>
<td>59</td>
<td>80</td>
<td>60</td>
<td>79</td>
</tr>
<tr class="odd">
<td>120 – 137</td>
<td>61</td>
<td>78</td>
<td>62</td>
<td>77</td>
<td>63</td>
<td>76</td>
<td>64</td>
<td>75</td>
<td>65</td>
<td>74</td>
<td>66</td>
<td>73</td>
<td>67</td>
<td>72</td>
<td>68</td>
<td>71</td>
<td>69</td>
<td>70</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>138 – 837</td>
<td>N/A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

### 5.7.3 Baseband signal generation

The time-continuous random access signal is defined by

where, is an amplitude scaling factor in order to conform to the
transmit power specified in clause 6.1 in 3GPP TS 36.213 \[4\], and .
The location in the frequency domain is controlled by the parameter is
derived from clause 5.7.1. The factor accounts for the difference in
subcarrier spacing between the random access preamble and uplink data
transmission. The variable, the subcarrier spacing for the random access
preamble, and the variable, a fixed offset determining the
frequency-domain location of the random access preamble within the
physical resource blocks, are both given by Table 5.7.3-1.

Table 5.7.3-1: Random access baseband parameters

  Preamble format             
  ----------------- --------- ---
  0 -- 3            1250 Hz   7
  4                 7500 Hz   2

 5.8 Modulation and upconversion
-------------------------------

Modulation and upconversion to the carrier frequency of the
complex-valued SC-FDMA baseband signal for each antenna port or the
complex-valued PRACH baseband signal is shown in Figure 5.8-1. The
filtering required prior to transmission is defined by the requirements
in 3GPP TS 36.101 \[7\].

Figure 5.8-1: Uplink modulation
